#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// СтандартныеПодсистемы.ВерсионированиеОбъектов

// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.
//
// Параметры:
//  Настройки - Структура - настройки подсистемы.
Процедура ПриОпределенииНастроекВерсионированияОбъектов(Настройки) Экспорт

КонецПроцедуры

// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов

#КонецОбласти

#Область ПрограммныйИнтерфейс

Функция ТекстОтраженияВРеглУчетеУКР() Экспорт
	
//////	ТекстНалоговыйКредит = "
//////	|ВЫБРАТЬ // Налоговый кредит (Дт 6412 :: Кт 6442)
//////	|
//////	|	Операция.Ссылка КАК Ссылка,
//////	|	Операция.Дата КАК Период,
//////	|	Операция.Организация КАК Организация,
//////	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
//////	|
//////
//////	|	СУММА(Строки.СуммаНДС - Строки.СуммаНДСПропорционально) КАК Сумма,
//////	|
//////	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
//////	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
//////	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
//////	|
//////	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
//////	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеДт,
//////	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиДт,
//////	|
//////	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеДт,
//////	|
//////	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоНДС) КАК СчетДт,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт1,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
//////	
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
//////	|	
//////	|	0 КАК ВалютнаяСуммаДт,
//////	|	0 КАК КоличествоДт,
//////	|	0 КАК СуммаНУДт,
//////	|	0 КАК СуммаПРДт,
//////	|	0 КАК СуммаВРДт,
//////	|	
//////	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
//////	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
//////	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
//////	|
//////	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
//////	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеКт,
//////	|	Операция.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
//////	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеКт,
//////	|
//////	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НалоговыйКредитНеподтвержденный) КАК СчетКт,
//////	|	Операция.Контрагент КАК СубконтоКт1,
//////	|	Операция.Договор КАК СубконтоКт2,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
//////	|
//////	|	0 КАК ВалютнаяСуммаКт,
//////	|	0 КАК КоличествоКт,
//////	|	0 КАК СуммаНУКт,
//////	|	0 КАК СуммаПРКт,
//////	|	0 КАК СуммаВРКт,
//////	|	""НДС: налоговый кредит: "" + 
//////	|	ВЫБОР
//////	|      	КОГДА Операция.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.НалоговаяНакладная) ТОГДА
//////	|      		""налоговая накладная""
//////	|      	КОГДА Операция.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.ТоварныйЧек) ТОГДА
//////	|      		""подтверждение (товарный чек)""
//////	|      	КОГДА Операция.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.РасчетКорректировкиВозврат) ТОГДА
//////	|      		""расчет корректировки (возврат)""
//////	|      	КОГДА Операция.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.РасчетКорректировкиКорректировка) ТОГДА
//////	|      		""расчет корректировки (изменение суммы компенсации)""
//////	|      	КОГДА Операция.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.РаботыОтНерезидентаПрошлогоПериода) ТОГДА
//////	|      		""работы от нерезидента""
//////	|      	ИНАЧЕ	
//////	|			""""
//////	|   	КОНЕЦ КАК Содержание
//////	|
//////	|ИЗ
//////	|	ДокументыКОтражению КАК ДокументыКОтражению
//////	|	
//////	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
//////	|		Документ.РегистрацияВходящегоНалоговогоДокумента КАК Операция
//////	|	ПО
//////	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
//////	|
//////	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
//////	|		Документ.РегистрацияВходящегоНалоговогоДокумента.Поставка КАК Строки
//////	|	ПО
//////	|		Строки.Ссылка = Операция.Ссылка
//////	|	
//////	|ГДЕ
//////	|   Операция.ВидОперации В ( 
//////	|   	ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.НалоговаяНакладная), 
//////	|   	ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.РасчетКорректировкиВозврат), 
//////	|   	ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.РасчетКорректировкиКорректировка), 
//////	|   	ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.ТоварныйЧек),
//////	|   	ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.РаботыОтНерезидентаПрошлогоПериода)	
//////	|   ) 	
//////	|	И НЕ Строки.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)
//////	|
//////	|СГРУППИРОВАТЬ ПО
//////	|	Операция.Ссылка,
//////	|	Операция.Дата,
//////	|	Операция.Организация,
//////	|	Операция.НаправлениеДеятельности,
//////	|	Операция.Контрагент,
//////	|	Операция.Договор
//////	|";
//////	
//////	ТекстКорректировкиНалоговогоКредита = "
//////	|ВЫБРАТЬ // Налоговый кредит (Дт 6412 :: Кт 6443)
//////	|
//////	|	Операция.Ссылка КАК Ссылка,
//////	|	Операция.Дата КАК Период,
//////	|	Операция.Организация КАК Организация,
//////	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
//////	|
//////	|	СУММА(Строки.СуммаНДС - Строки.СуммаНДСПропорционально) КАК Сумма,
//////	|
//////	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
//////	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
//////	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
//////	|
//////	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
//////	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеДт,
//////	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиДт,
//////	|
//////	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеДт,
//////	|
//////	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоНДС) КАК СчетДт,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт1,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
//////	|	
//////	|	0 КАК ВалютнаяСуммаДт,
//////	|	0 КАК КоличествоДт,
//////	|	0 КАК СуммаНУДт,
//////	|	0 КАК СуммаПРДт,
//////	|	0 КАК СуммаВРДт,
//////	|	
//////	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
//////	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
//////	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
//////	|
//////	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
//////	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеКт,
//////	|	Операция.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
//////	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеКт,
//////	|
//////	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.КорректировкиНалоговогоКредита) КАК СчетКт,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт1,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
//////	|
//////	|	0 КАК ВалютнаяСуммаКт,
//////	|	0 КАК КоличествоКт,
//////	|	0 КАК СуммаНУКт,
//////	|	0 КАК СуммаПРКт,
//////	|	0 КАК СуммаВРКт,
//////	|	""НДС: налоговый кредит: исправление ошибки"" КАК Содержание
//////	|
//////	|ИЗ
//////	|	ДокументыКОтражению КАК ДокументыКОтражению
//////	|	
//////	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
//////	|		Документ.РегистрацияВходящегоНалоговогоДокумента КАК Операция
//////	|	ПО
//////	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
//////	|
//////	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
//////	|		Документ.РегистрацияВходящегоНалоговогоДокумента.Поставка КАК Строки
//////	|	ПО
//////	|		Строки.Ссылка = Операция.Ссылка
//////	|	
//////	|ГДЕ
//////	|   Операция.ВидОперации В ( 
//////	|   	ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.ИсправлениеОшибки),
//////	|   	ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияВходящегоНалоговогоДокумента.ВосстановлениеНалоговогоКредита)
//////	|   ) 
//////	|	И НЕ (Строки.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
//////	|
//////	|СГРУППИРОВАТЬ ПО
//////	|	Операция.Ссылка,
//////	|	Операция.Дата,
//////	|	Операция.Организация,
//////	|	Строки.НалоговоеНазначение
//////	|";
//////	
//////	
//////	ТекстУсловнаяПродажа = "
//////	|ВЫБРАТЬ // Условная продажа (Дт 6412 :: Кт 6435)
//////	|
//////	|	Операция.Ссылка КАК Ссылка,
//////	|	Операция.Дата КАК Период,
//////	|	Операция.Организация КАК Организация,
//////	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
//////	|
//////
//////	|	СУММА(ВЫБОР
//////	|      	КОГДА Строки.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) ТОГДА
//////	|      		Строки.СуммаНДСПропорционально
//////	|      	ИНАЧЕ	
//////	|			Строки.СуммаНДС
//////	|   	КОНЕЦ) КАК Сумма,
//////	|
//////	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
//////	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
//////	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт, 
//////	|
//////	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
//////	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеДт,
//////	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиДт, 
//////	
//////	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеДт,
//////	
//////	|
//////	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоНДС) КАК СчетДт,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт1,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2, 
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
//////	|	
//////	|	0 КАК ВалютнаяСуммаДт,
//////	|	0 КАК КоличествоДт,
//////	|	0 КАК СуммаНУДт,
//////	|	0 КАК СуммаПРДт,
//////	|	0 КАК СуммаВРДт,
//////	|	
//////	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
//////	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
//////	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
//////	|
//////	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
//////	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеКт,
//////	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиКт,
//////	
//////	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеКт,
//////	
//////	|
//////	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.УсловнаяПродажа) КАК СчетКт,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт1,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
//////	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
//////	|
//////	|	0 КАК ВалютнаяСуммаКт,
//////	|	0 КАК КоличествоКт,
//////	|	0 КАК СуммаНУКт,
//////	|	0 КАК СуммаПРКт,
//////	|	0 КАК СуммаВРКт,
//////	|	""Налоговый кредит по операциям не обл. НДС"" КАК Содержание
//////	|
//////	|ИЗ
//////	|	ДокументыКОтражению КАК ДокументыКОтражению
//////	|	
//////	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
//////	|		Документ.РегистрацияВходящегоНалоговогоДокумента КАК Операция
//////	|	ПО
//////	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
//////	|
//////	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
//////	|		Документ.РегистрацияВходящегоНалоговогоДокумента.Поставка КАК Строки
//////	|	ПО
//////	|		Строки.Ссылка = Операция.Ссылка
//////	|	
//////	|ГДЕ
//////	|	(Строки.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)
//////	|		ИЛИ Строки.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая))
//////	|
//////	|СГРУППИРОВАТЬ ПО
//////	|	Операция.Ссылка,
//////	|	Операция.Дата,
//////	|	Операция.Организация 
	//////|";
	//////
	//////
	//////Возврат
	//////	ТекстНалоговыйКредит
	//////	+ " ОБЪЕДИНИТЬ ВСЕ " + ТекстКорректировкиНалоговогоКредита
	//////	+ " ОБЪЕДИНИТЬ ВСЕ " + ТекстУсловнаяПродажа
	//////	;
	
КонецФункции

// Функция возвращает текст запроса дополнительных временных таблиц, 
// необходимых для отражения в регламетированном учете
//
Функция ТекстЗапросаВТОтраженияВРеглУчетеУКР() Экспорт
	
	ТекстЗапроса = "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область Проведение

Процедура ЗаполнитьПараметрыИнициализации(Запрос, ДокументСсылка)
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("Ссылка", ДокументСсылка);
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	ДанныеДокумента.Ссылка как Ссылка,
	|	ДанныеДокумента.Дата как Период,
	|	ДанныеДокумента.Организация КАК Организация
	|ИЗ
	|	Документ.СведенияОКонтролируемыхОперациях КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.Ссылка = &Ссылка
    |";
    
	Реквизиты = Запрос.Выполнить().Выбрать();
	Реквизиты.Следующий();
    
	Запрос.УстановитьПараметр("Период",         Реквизиты.Период);
	Запрос.УстановитьПараметр("Организация",    Реквизиты.Организация);
	
КонецПроцедуры


Процедура ИнициализироватьДанныеДокумента(ДокументСсылка, ДополнительныеСвойства, Регистры = Неопределено) Экспорт
    
	////////////////////////////////////////////////////////////////////////////
	// Создадим запрос инициализации движений
	
	Запрос = Новый Запрос;
	ЗаполнитьПараметрыИнициализации(Запрос, ДокументСсылка);
    
	////////////////////////////////////////////////////////////////////////////
	// Сформируем текст запроса
	
	ТекстыЗапроса = Новый СписокЗначений;
    ТекстЗапросаТаблицаКонтролируемыеОперации(Запрос, ТекстыЗапроса, Регистры);
    ТекстЗапросаТаблицаОбщиеСведенияОКонтролируемыхОперациях(Запрос, ТекстыЗапроса, Регистры);
	
	////////////////////////////////////////////////////////////////////////////
	// Поместим результаты запроса в дополнительные свойства
	
	ПроведениеСервер.ИницализироватьТаблицыДляДвижений(Запрос, ТекстыЗапроса, ДополнительныеСвойства.ТаблицыДляДвижений, Истина);
	
КонецПроцедуры

Функция ТекстЗапросаТаблицаКонтролируемыеОперации(Запрос, ТекстыЗапроса, Регистры)
    
	ИмяРегистра = "КонтролируемыеОперации";
	
	Если НЕ ПроведениеСервер.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
    КонецЕсли;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	&Период КАК Период,
	|	&Организация КАК Организация,
	|	КонтролируемыеСделки.Контрагент,
	|	КонтролируемыеСделки.ДокументИнформационнйБазы,
	|	КонтролируемыеСделки.ДоговорКонтрагента,
	|	КонтролируемыеСделки.КодНаименованияОперации,
	|	КонтролируемыеСделки.ПредметСделки,
	|	КонтролируемыеСделки.ХарактеристикаНоменклатуры,
	|	КонтролируемыеСделки.ПредметСделкиСтрока,
	|	КонтролируемыеСделки.КодПредмета,
	|	КонтролируемыеСделки.КодКлассификатораПродукцииИУслуг,
	|	КонтролируемыеСделки.КодУКТВЭД,
	|	КонтролируемыеСделки.КодУКВЭП,
	|	КонтролируемыеСделки.ДатаКонтракта,
	|	КонтролируемыеСделки.НомерКонтракта,
	|	КонтролируемыеСделки.КодСтороныОперации,
	|	КонтролируемыеСделки.КодСтраныПроисхождения,
	|	КонтролируемыеСделки.УсловиеПоставкиПоИнкотермс,
	|	КонтролируемыеСделки.ТорговаяМарка,
	|	КонтролируемыеСделки.Производитель,
	|	КонтролируемыеСделки.ДатаОперацииС,
	|	КонтролируемыеСделки.ДатаОперацииПо,
	|	КонтролируемыеСделки.ЦенаВал,
	|	КонтролируемыеСделки.Количество,
	|	КонтролируемыеСделки.КодВалюты,
	|	КонтролируемыеСделки.КурсВалюты,
	|	КонтролируемыеСделки.СуммаРегл,
	|	КонтролируемыеСделки.ЦенаРегл,
	|	КонтролируемыеСделки.КодОснования,
	|	КонтролируемыеСделки.КодМетода,
	|	КонтролируемыеСделки.КодИсточника,
	|	КонтролируемыеСделки.ЦенаОбычнаяРегл,
	|	КонтролируемыеСделки.СуммаКорректировкиДоходов,
	|	КонтролируемыеСделки.СуммаКорректировкиРасходов,
	|	КонтролируемыеСделки.ПоказательРентабельности,
	|	КонтролируемыеСделки.ЗначениеПоказателяРентабельности,
	|	КонтролируемыеСделки.ПризнакГруппировкиВСовокупность,
	|	КонтролируемыеСделки.ИсследуемаяСторона,
	|	КонтролируемыеСделки.Упаковка,
	|	КонтролируемыеСделки.СтатусКонтрагента
	|ИЗ
	|	Документ.СведенияОКонтролируемыхОперациях.КонтролируемыеСделки КАК КонтролируемыеСделки
	|ГДЕ
	|	КонтролируемыеСделки.Ссылка = &Ссылка
	|УПОРЯДОЧИТЬ ПО НомерСтроки
	|";
	
    ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаТаблицаОбщиеСведенияОКонтролируемыхОперациях(Запрос, ТекстыЗапроса, Регистры)
    
	ИмяРегистра = "ОбщиеСведенияОКонтролируемыхОперациях";
	
	Если НЕ ПроведениеСервер.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
    КонецЕсли;
	
	ТекстЗапроса = 
	"
	|ВЫБРАТЬ
	|	&Период КАК Период,
	|	&Организация КАК Организация,
	|	КонтролируемыеСделки.Контрагент,
	|	СУММА(КонтролируемыеСделки.СуммаРегл) КАК СуммаКонтролируемыхОпераций,
	|	0 КАК СуммаОбщая
	|ИЗ
	|	Документ.СведенияОКонтролируемыхОперациях.КонтролируемыеСделки КАК КонтролируемыеСделки
	|ГДЕ
	|	КонтролируемыеСделки.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	КонтролируемыеСделки.Контрагент
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Период,
	|	&Организация,
	|	СуммыВсехОпераций.Контрагент,
	|	0,
	|	СУММА(СуммыВсехОпераций.СуммаОперацийЗаПериод)
	|ИЗ
	|	Документ.СведенияОКонтролируемыхОперациях.СуммыВсехОпераций КАК СуммыВсехОпераций
	|ГДЕ
	|	СуммыВсехОпераций.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыВсехОпераций.Контрагент";
	
    ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;

КонецФункции

#КонецОбласти

#Область СозданиеНаОсновании

Процедура ДобавитьКомандыСозданияНаОсновании(КомандыСоздатьНаОсновании) Экспорт
	
	ВводНаОснованииПереопределяемый.ДобавитьКомандуСоздатьНаОснованииБизнесПроцессЗадание(КомандыСоздатьНаОсновании);
	
	ВводНаОснованииПереопределяемый.ДобавитьКомандыСоздатьНаОснованииПисмаПоШаблону(КомандыСоздатьНаОсновании);
	
КонецПроцедуры

#КонецОбласти

#Область Отчеты

// Заполняет список команд отчетов.
// 
// Параметры:
//   КомандыОтчетов - ТаблицаЗначений - состав полей см. в функции МенюОтчеты.СоздатьКоллекциюКомандОтчетов
//
Процедура ДобавитьКомандыОтчетов(КомандыОтчетов) Экспорт
	
	ВариантыОтчетовУТПереопределяемый.ДобавитьКомандуСтруктураПодчиненности(КомандыОтчетов);
	
	ВариантыОтчетовУТПереопределяемый.ДобавитьКомандуДвиженияДокумента(КомандыОтчетов);
	
КонецПроцедуры

#КонецОбласти

#Область ИнициализацияИЗаполнение

Функция ЗаполнитьЗаПериод(Объект) Экспорт 
	
	Возврат Истина;
	
КонецФункции // ЗаполнитьПоОстаткам

#КонецОбласти

#КонецОбласти

#КонецЕсли