////////////////////////////////////////////////////////////////////////////////
// УправлениеШтатнымРасписанием:
//
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Заполняет наборы записей регистров ИсторииИспользованияШтатногоРасписания, 
// ИсторияНачисленийПоШтатномуРасписанию, ИсторияПоказателейПоШтатномуРасписанию
// по регистратору
//
// Параметры:
//			Регистратор - ДокументОбъект
//			ДанныеПозиций - Структура, содержащая ключи с именами регистров и
//					выборками из запросов содержащих движения.
//
Процедура СформироватьДвиженияИсторииПозицийШтатногоРасписания(Регистратор, ДанныеПозиций) Экспорт
	
	ЗаполнитьНаборЗаписейИстории(
		Регистратор.Ссылка,
		Регистратор.Движения.ИсторияИспользованияШтатногоРасписания,
		ДанныеПозиций.ИсторииИспользованияШтатногоРасписания);
	
	ЗаполнитьНаборЗаписейИстории(
		Регистратор.Ссылка,
		Регистратор.Движения.ИсторияНачисленийПоШтатномуРасписанию,
		ДанныеПозиций.ИсторияНачисленийПоШтатномуРасписанию);
	
	ЗаполнитьНаборЗаписейИстории(
		Регистратор.Ссылка,
		Регистратор.Движения.ИсторияПоказателейПоШтатномуРасписанию,
		ДанныеПозиций.ИсторияПоказателейПоШтатномуРасписанию);
		
	КонецПроцедуры

// Заполняет движения видами специальностей по штатному расписанию
//		ИсторияСпециальностейПоШтатномуРасписанию.
//
// Параметры:
//	Движения - коллекция движений, в которой необходимо заполнить движения.
//	ДатаСобытия			- дата, на которые будут сделаны движения.
//	Специальности - таблица значений с полями:
//		ДатаСобытия
//		ПозицияШтатногоРасписания
//		Специальность
//
Процедура СформироватьДвиженияСпециальностейПоШтатномуРасписанию(Движения, ДатаСобытия, Специальности) Экспорт
	
	Движения.ИсторияСпециальностейПоШтатномуРасписанию.Записывать = Истина;
	Пока Специальности.Следующий() Цикл
		НоваяСтрока = Движения.ИсторияСпециальностейПоШтатномуРасписанию.Добавить();
		НоваяСтрока.Дата						= ДатаСобытия;
		НоваяСтрока.ПозицияШтатногоРасписания	= Специальности.ПозицияШтатногоРасписания;
		НоваяСтрока.Специальность				= Специальности.Специальность;
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти


#Область СлужебныеПроцедурыИФункции

Функция НачисленияНадбавкаЗаВредность() Экспорт
	
	ВРНадбавкаЗаВредность = Неопределено;
	
	НачисленияВРНадбавкаЗаВредность = РасчетЗарплаты.НачисленияПоКатегории(Перечисления.КатегорииНачисленийИНеоплаченногоВремени.НадбавкаЗаВредность);
	Если НачисленияВРНадбавкаЗаВредность.Количество() > 0 Тогда
		ВРНадбавкаЗаВредность = НачисленияВРНадбавкаЗаВредность[0];
	КонецЕсли;
	
	Возврат ВРНадбавкаЗаВредность;
	
КонецФункции

Процедура ЗаполнитьНаборыЗначенийДоступа(ДокументОбъект, Таблица, УчитыватьПодразделенияНеСозданныхПозиций = Истина) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", ДокументОбъект.Ссылка);
	
	Запрос.Текст =
		"ВЫБРАТЬ
		|	ДокументОбъект.Организация КАК ЗначениеДоступа
		|ИЗ
		|	Документ.УтверждениеШтатногоРасписания КАК ДокументОбъект
		|ГДЕ
		|	ДокументОбъект.Ссылка = &Ссылка
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументОбъект.Позиция.Подразделение
		|ИЗ
		|	Документ.УтверждениеШтатногоРасписания.Позиции КАК ДокументОбъект
		|ГДЕ
		|	ДокументОбъект.Ссылка = &Ссылка
		|	И НЕ ДокументОбъект.Позиция.Подразделение ЕСТЬ NULL ";
		
	Если УчитыватьПодразделенияНеСозданныхПозиций Тогда
		
		Запрос.Текст = Запрос.Текст
			+ "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|"
			+ "
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДокументОбъект.Подразделение
			|ИЗ
			|	Документ.УтверждениеШтатногоРасписания.Позиции КАК ДокументОбъект
			|ГДЕ
			|	ДокументОбъект.Ссылка = &Ссылка
			|	И ДокументОбъект.Подразделение <> ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
			|	И ДокументОбъект.Подразделение <> ЕСТЬNULL(ДокументОбъект.Позиция.Подразделение, ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))";
		
	КонецЕсли;
	
	МетаданныеДокумента = ДокументОбъект.Метаданные();
	ИмяДокумента = МетаданныеДокумента.Имя;
	Если ИмяДокумента <> "УтверждениеШтатногоРасписания" Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "УтверждениеШтатногоРасписания", ИмяДокумента);
	КонецЕсли;
	
	ТЧПозиции = МетаданныеДокумента.ТабличныеЧасти.Найти("Позиции");
	Если ТЧПозиции.Реквизиты.Найти("Позиция") = Неопределено Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "Позиция", "ПозицияШтатногоРасписания");
	КонецЕсли; 
		
	ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(Запрос.Выполнить().Выгрузить(), Таблица);
	
КонецПроцедуры

// Процедуры и функции модулей объектов документов УтверждениеШтатногоРасписания и ИзменениеШтатногоРасписания.

Процедура ДокументыОбработкаПроверкиЗаполнения(Объект, Отказ, ДатаВступленияВСилу, ИмяЭлемента, ПроверятьВсеПозиции) Экспорт
	
	РезультатПроверки = РегистрыСведений.ИсторияИспользованияШтатногоРасписания.ПроверитьВозможностьВнесенияИзменений(
		Объект.Ссылка, Объект.Позиции.ВыгрузитьКолонку("Позиция"), ДатаВступленияВСилу);
	
	МожноИзменятьШтатноеРасписание = РезультатПроверки.ИзмененияВозможны;
	
	Если НЕ МожноИзменятьШтатноеРасписание Тогда
		
		ТекстСообщения = НСтр("ru='Дата последнего изменения штатного расписания больше даты, с которой вступит в силу этот документ.';uk='Дата останньої зміни штатного розкладу більше дати, з якої вступить в силу цей документ.'");
		
		ТекстСообщения = ТекстСообщения + Символы.ПС + СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='См. %1, позиция - ""%2""';uk='См. %1, позиція - ""%2""'"),
			РезультатПроверки.РегистраторПредставление,
			РезультатПроверки.Позиция);
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, ИмяЭлемента, ,Отказ);
		Возврат;
		
	КонецЕсли;
	
	Подразделение = Неопределено;
	Если Объект.Метаданные().Реквизиты.Найти("Подразделение") <> Неопределено Тогда
		Подразделение = Объект.Подразделение;
	КонецЕсли; 
	
	ДанныеДляПроверки = СформироватьЗапросДляПроверкиДокумента(Объект.Ссылка, Объект.Организация, Подразделение, Объект.Позиции, Объект.Начисления, Объект.Показатели, ДатаВступленияВСилу).Выбрать();
	
	Пока ДанныеДляПроверки.СледующийПоЗначениюПоля("НомерСтроки") Цикл
		
		Если ДанныеДляПроверки.ОшибкаНоваяПозиция Тогда	
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Для создаваемой позиции в строке %1 установлено действие отличное от ""Создать новую"".';uk='Для позиції, що створюється, в рядку %1 встановлено дію відмінну від ""Створити нову"".'"), ДанныеДляПроверки.НомерСтроки);
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "Объект.Позиции[" + Формат(ДанныеДляПроверки.НомерСтроки - 1, "ЧГ=0") + "].Должность", , Отказ);
		КонецЕсли;
		
		Если Пользователи.РолиДоступны("ДобавлениеИзменениеНачисленийШтатногоРасписания", , Ложь) Тогда
			
			Если ЗначениеЗаполнено(ДанныеДляПроверки.НачислениеНомерСтроки) Тогда
				
				Пока ДанныеДляПроверки.СледующийПоЗначениюПоля("НачислениеНомерСтроки") Цикл	
					
					Если ДанныеДляПроверки.ОшибкаНачислениеДубль Тогда
						ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='У позиции в строке %1 начисление %2 присутствует в документе дважды.';uk='У позиції у рядку %1 нарахування %2 присутнє в документі двічі.'"), ДанныеДляПроверки.НомерСтроки, ДанныеДляПроверки.НачислениеНаименование);
						ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "Объект.Позиции[" + Формат(ДанныеДляПроверки.НомерСтроки - 1, "ЧГ=0") + "].Должность", , Отказ);	
					ИначеЕсли ДанныеДляПроверки.ОшибкаЗачетОтработанногоВремениДубль Тогда
						ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='У позиции в строке %1 присутствуют несколько начислений с зачетом отработанного времени.';uk='У позиції у рядку %1 присутні кілька нарахувань з заліком відпрацьованого часу.'"), ДанныеДляПроверки.НомерСтроки);
						ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "Объект.Позиции[" + Формат(ДанныеДляПроверки.НомерСтроки - 1, "ЧГ=0") + "].Должность", , Отказ);	
					КонецЕсли;
					
					Если ПолучитьФункциональнуюОпцию("ИспользоватьВилкуСтавокВШтатномРасписании") Тогда 
						Если ДанныеДляПроверки.РазныеМинЗначенияПоказателя Тогда
							ТекстСообщения = НСтр("ru='У позиции показателю %1 назначены разные минимальные значения';uk='У позиції показником %1 призначені різні мінімальні значення'");
							ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, ДанныеДляПроверки.РазныеМинЗначенияПоказателяПоказатель);
							ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "Объект.Позиции[" + Строка(ДанныеДляПроверки.НомерСтроки - 1) + "].Должность", , Отказ);
						КонецЕсли;
						Если ДанныеДляПроверки.РазныеМаксЗначенияПоказателя Тогда
							ТекстСообщения = НСтр("ru='У позиции показателю %1 назначены разные максимальные значения';uk='У позиції показником %1 призначені різні максимальні значення'");
							ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, ДанныеДляПроверки.РазныеМаксЗначенияПоказателяПоказатель);
							ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "Объект.Позиции[" + Строка(ДанныеДляПроверки.НомерСтроки - 1) + "].Должность", , Отказ);
						КонецЕсли;
					Иначе
						Если ДанныеДляПроверки.РазныеЗначенияПоказателя Тогда 
							ТекстСообщения = НСтр("ru='У позиции показателю %1 назначены разные значения';uk='У позиції показником %1 призначені різні значення'");
							ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, ДанныеДляПроверки.РазныеЗначенияПоказателяПоказатель);
							ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "Объект.Позиции[" + Строка(ДанныеДляПроверки.НомерСтроки - 1) + "].Должность", , Отказ);
						КонецЕсли;
					КонецЕсли;
					
					Если ЗначениеЗаполнено(ДанныеДляПроверки.ПоказательНомерСтроки) Тогда
						Пока ДанныеДляПроверки.СледующийПоЗначениюПоля("ПоказательНомерСтроки") Цикл
							Если ДанныеДляПроверки.ОшибкаЗначения Тогда
								ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='У позиции в строке %1 для начисления %2 минимальное значение показателя %3 не может быть больше максимального.';uk='У позиції у рядку %1 для нарахування %2 мінімальне значення показника %3 не може бути більше максимального.'"), ДанныеДляПроверки.НомерСтроки, ДанныеДляПроверки.НачислениеНаименование, ДанныеДляПроверки.ПоказательНаименование);
								ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Объект.Ссылка, "Объект.Позиции[" + Формат(ДанныеДляПроверки.НомерСтроки - 1, "ЧГ=0") + "].Должность", , Отказ);				
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;
					
				КонецЦикла;
				
			КонецЕсли;
			
		КонецЕсли; 
		
	КонецЦикла;
	
	ДанныеДляПроверки.Сбросить();
	Если ПроверятьВсеПозиции Тогда
		Пока ДанныеДляПроверки.НайтиСледующий(Истина, "ОшибкаАктуальнаяПозиция") Цикл 
			Если ДанныеДляПроверки.ОшибкаАктуальнаяПозиция Тогда
				ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Актуальная позиция %1 не включена в данный документ.';uk='Актуальна позиція %1 не включена в даний документ.'"), ДанныеДляПроверки.АктуальнаяПозицияНаименование);
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, ДанныеДляПроверки.АктуальнаяПозиция, , , Отказ);	
			КонецЕсли;
		КонецЦикла;
	КонецЕсли; 
	
КонецПроцедуры	

Процедура ДокументыПередЗаписью(ДокументШтатногоРасписанияОбъект, Отказ, РежимЗаписи, РежимПроведения, СозданныеПозиции, ДатаВступленияВСилу, ИмяЭлемента) Экспорт
	
	СинхронизироватьРеквизитыПозиций(ДокументШтатногоРасписанияОбъект);
	
	СведенияОНаименованиях = Неопределено;
	ДокументШтатногоРасписанияОбъект.ДополнительныеСвойства.Свойство("СведенияОНаименованиях", СведенияОНаименованиях);
	
	Если РежимЗаписи = РежимЗаписиДокумента.Проведение Или РежимЗаписи = РежимЗаписиДокумента.ОтменаПроведения Тогда
		Если Не ЗарплатаКадры.ОтключитьБизнесЛогикуПриЗаписи(ДокументШтатногоРасписанияОбъект) Тогда
			ПроверитьВозможностьИзменитьШтатноеРасписание(
				ДокументШтатногоРасписанияОбъект.Позиции.ВыгрузитьКолонку("Позиция"),
				ДатаВступленияВСилу,
				ДокументШтатногоРасписанияОбъект.Ссылка,
				РежимЗаписи,
				Отказ,
				ИмяЭлемента);
		КонецЕсли;
		
		СтрокиСозданныхПозиций = Новый Массив;
		
		Если РежимЗаписи = РежимЗаписиДокумента.Проведение Тогда
			СоздатьНовыеПозицииШтатногоРасписания(
				ДокументШтатногоРасписанияОбъект.Организация,
				ДокументШтатногоРасписанияОбъект.Позиции,
				ДокументШтатногоРасписанияОбъект.Начисления,
				ДокументШтатногоРасписанияОбъект.Показатели,
				СтрокиСозданныхПозиций,
				СведенияОНаименованиях);
		КонецЕсли;
		
		СозданныеПозиции = СтрокиСозданныхПозиций;
		
		Для каждого СтрокаПозицииОбъекта Из ДокументШтатногоРасписанияОбъект.Позиции Цикл
			НаборЗаписейКлассовУсловийТруда = РегистрыСведений.КлассыУсловийТрудаПоДолжностям.СоздатьНаборЗаписей();
			НаборЗаписейКлассовУсловийТруда.ДополнительныеСвойства.Вставить("УстановитьФункциональныеОпции",
				ДокументШтатногоРасписанияОбъект.Позиции.Количество() = СтрокаПозицииОбъекта.НомерСтроки);
			Если РежимЗаписи = РежимЗаписиДокумента.ОтменаПроведения Тогда
				НаборЗаписейКлассовУсловийТруда.Отбор.Должность.Установить(СтрокаПозицииОбъекта.Позиция);
				НаборЗаписейКлассовУсловийТруда.Отбор.Период.Установить(НачалоМесяца(ДатаВступленияВСилу));
				НаборЗаписейКлассовУсловийТруда.Записать();
			Иначе
				ЗаписатьКлассыУсловийТруда = Истина;
				Если Не ЗначениеЗаполнено(СтрокаПозицииОбъекта.КлассУсловийТруда) Тогда
					Запрос = Новый Запрос;
					Запрос.УстановитьПараметр("Позиция", СтрокаПозицииОбъекта.Позиция);
					Запрос.Текст =
					"ВЫБРАТЬ ПЕРВЫЕ 1
					|	КлассыУсловийТрудаПоДолжностям.КлассУсловийТруда КАК КлассУсловийТруда
					|ИЗ
					|	РегистрСведений.КлассыУсловийТрудаПоДолжностям КАК КлассыУсловийТрудаПоДолжностям
					|ГДЕ
					|	КлассыУсловийТрудаПоДолжностям.Должность = &Позиция
					|	И КлассыУсловийТрудаПоДолжностям.КлассУсловийТруда <> ЗНАЧЕНИЕ(Перечисление.КлассыУсловийТрудаПоРезультатамСпециальнойОценки.ПустаяСсылка)";
					РезультатЗапроса = Запрос.Выполнить();
					Если РезультатЗапроса.Пустой() Тогда
						ЗаписатьКлассыУсловийТруда = Ложь;
					КонецЕсли;
				КонецЕсли;
				Если ЗаписатьКлассыУсловийТруда Тогда
					НаборЗаписейКлассовУсловийТруда.Отбор.Должность.Установить(СтрокаПозицииОбъекта.Позиция);
					НаборЗаписейКлассовУсловийТруда.Отбор.Период.Установить(НачалоМесяца(ДатаВступленияВСилу));
					НоваяЗаписьНабораЗаписей = НаборЗаписейКлассовУсловийТруда.Добавить();
					НоваяЗаписьНабораЗаписей.Должность = СтрокаПозицииОбъекта.Позиция;
					НоваяЗаписьНабораЗаписей.КлассУсловийТруда = СтрокаПозицииОбъекта.КлассУсловийТруда;
					НоваяЗаписьНабораЗаписей.Период = НачалоМесяца(ДатаВступленияВСилу);
					Если ЗначениеЗаполнено(СтрокаПозицииОбъекта.КлассУсловийТрудаДатаРегистрацииИзменений) Тогда
						НоваяЗаписьНабораЗаписей.ДатаРегистрацииИзменений = НачалоМесяца(СтрокаПозицииОбъекта.КлассУсловийТрудаДатаРегистрацииИзменений);
					Иначе
						НоваяЗаписьНабораЗаписей.ДатаРегистрацииИзменений = НачалоМесяца(ДатаВступленияВСилу);
					КонецЕсли;
					НаборЗаписейКлассовУсловийТруда.Записать();
				КонецЕсли;
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	Если ТипЗнч(СведенияОНаименованиях) = Тип("Соответствие")
		И СведенияОНаименованиях.Количество() > 0 Тогда
		
		ПозицииКОбновлению = Новый Массив;
		СоответствиеПозицийИдентификаторам = Новый Соответствие;
		Для каждого СведениеОНаименовании Из СведенияОНаименованиях Цикл
			
			СтрокиПозиции = ДокументШтатногоРасписанияОбъект.Позиции.НайтиСтроки(Новый Структура("ИдентификаторСтрокиПозиции", СведениеОНаименовании.Ключ));
			Если СтрокиПозиции.Количество() > 0 Тогда
				ПозицииКОбновлению.Добавить(СтрокиПозиции[0].Позиция);
				СоответствиеПозицийИдентификаторам.Вставить(СведениеОНаименовании.Ключ, СтрокиПозиции[0].Позиция);
			КонецЕсли;
			
		КонецЦикла;
		
		НаименованияПозиций = ОбщегоНазначения.ЗначениеРеквизитаОбъектов(ПозицииКОбновлению, "Наименование");
		Для каждого СведениеОНаименовании Из СведенияОНаименованиях Цикл
			
			Позиция = СоответствиеПозицийИдентификаторам.Получить(СведениеОНаименовании.Ключ);
			Если ЗначениеЗаполнено(Позиция) Тогда
				
				Если НаименованияПозиций.Получить(Позиция) <> СведениеОНаименовании.Значение Тогда
					
					ПозицияОбъект = Позиция.ПолучитьОбъект();
					
					Попытка 
						ПозицияОбъект.Заблокировать();
					Исключение
						
						ТекстИсключенияЗаписи = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
							НСтр("ru='Не удалось изменить наименование ""%1"".
                            |Возможно, данные позиции редактируются другим пользователем'
                            |;uk='Не вдалося змінити найменування ""%1"".
                            |Можливо, дані позиції редагуються іншим користувачем'"),
							СведениеОНаименовании.Значение);
							
						ВызватьИсключение ТекстИсключенияЗаписи;
						
					КонецПопытки;
					
					ПозицияОбъект.Наименование = СведениеОНаименовании.Значение;
					ОтключитьОбновлениеСтруктурыШтатногоРасписания(ПозицияОбъект);
					
					ПозицияОбъект.Записать();
					
				КонецЕсли; 
				
			КонецЕсли; 
			
		КонецЦикла;
		
	КонецЕсли; 
	
КонецПроцедуры

Процедура ДокументыОбработкаПроведения(ДокументШтатногоРасписанияОбъект, Отказ, РежимПроведения, СозданныеПозиции, ДатаВступленияВСилу) Экспорт
	
	ПроведениеСервер.ПодготовитьНаборыЗаписейКРегистрацииДвижений(ДокументШтатногоРасписанияОбъект);
	
	ДанныеДляПроведения = ДанныеДляПроведения(ДокументШтатногоРасписанияОбъект, ДатаВступленияВСилу);
	
	СформироватьДвиженияИсторииПозицийШтатногоРасписания(ДокументШтатногоРасписанияОбъект, ДанныеДляПроведения);
	
	ОстаткиОтпусков.СформироватьДвиженияЕжегодныхОтпусковПоШтатномуРасписанию(
		ДокументШтатногоРасписанияОбъект.Движения, ДатаВступленияВСилу, ДанныеДляПроведения.ИсторияЕжегодныхОтпусковПоШтатномуРасписанию);
		
	СформироватьДвиженияСпециальностейПоШтатномуРасписанию(
			ДокументШтатногоРасписанияОбъект.Движения, ДатаВступленияВСилу, ДанныеДляПроведения.ИсторияСпециальностейПоШтатномуРасписанию);
	
	Если Отказ Тогда
		ОчиститьСозданныеПозиции(СозданныеПозиции);
	КонецЕсли;
	
	Если СозданныеПозиции <> Неопределено И СозданныеПозиции.Количество() > 0 Тогда
		Справочники.ШтатноеРасписание.ОбновитьСтруктуруШтатногоРасписанияПоПодразделениям();
	КонецЕсли; 
		
	СозданныеПозиции = Неопределено;
	
КонецПроцедуры

// Прочие процедуры модулей объектов документов УтверждениеШтатногоРасписания и ИзменениеШтатногоРасписания.

Процедура АвтозаполнениеТекущимиДаннымиШтатногоРасписания(ДокументШтатногоРасписанияОбъект, ДатаВступленияВСилу, ПроверятьЗаполненностьПодразделения = Ложь) Экспорт
	
	ДокументШтатногоРасписанияОбъект.Позиции.Очистить();
	ДокументШтатногоРасписанияОбъект.Начисления.Очистить();
	ДокументШтатногоРасписанияОбъект.Показатели.Очистить();
	
	Подразделение = Неопределено;
	Если ДокументШтатногоРасписанияОбъект.Метаданные().Реквизиты.Найти("Подразделение") <> Неопределено Тогда
		
		Если Не ПроверятьЗаполненностьПодразделения Или ЗначениеЗаполнено(ДокументШтатногоРасписанияОбъект.Подразделение) Тогда
			Подразделение = ДокументШтатногоРасписанияОбъект.Подразделение;
		КонецЕсли;
		
	КонецЕсли;
	
	РезультатЗапросаДанныхДляЗаполнения = СформироватьЗапросПоТекущемуСостояниюШтатногоРасписания(
		ДокументШтатногоРасписанияОбъект.Ссылка, 
		ДокументШтатногоРасписанияОбъект.Организация, 
		ДатаВступленияВСилу, 
		Подразделение);
	
	ДанныеДляЗаполнения = РезультатЗапросаДанныхДляЗаполнения.Выбрать();
	
	ИдентификаторСтрокиПозиции = 1;
	ИдентификаторСтрокиВидаРасчета = 1;
	Пока ДанныеДляЗаполнения.СледующийПоЗначениюПоля("Позиция") Цикл
		
		ПозицияШР = ДокументШтатногоРасписанияОбъект.Позиции.Добавить();
		ПозицияШР.ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции;
		
		ЗаполнитьЗначенияСвойств(ПозицияШР, ДанныеДляЗаполнения);
		
		Пока ДанныеДляЗаполнения.СледующийПоЗначениюПоля("Начисление") Цикл
			
			НезависимыйПоказатель = Не ЗначениеЗаполнено(ДанныеДляЗаполнения.Начисление);
			
			Если Не НезависимыйПоказатель Тогда
				
				НачислениеПоШР = ДокументШтатногоРасписанияОбъект.Начисления.Добавить();
				
				НачислениеПоШР.ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции;
				ЗаполнитьЗначенияСвойств(НачислениеПоШР, ДанныеДляЗаполнения);
				НачислениеПоШР.ИдентификаторСтрокиВидаРасчета = ИдентификаторСтрокиВидаРасчета;
				
			КонецЕсли;
			
			Если ЗначениеЗаполнено(ДанныеДляЗаполнения.Показатель) Тогда 
				
				Пока ДанныеДляЗаполнения.СледующийПоЗначениюПоля("Показатель") Цикл
					
					ПоказательНачисления = ДокументШтатногоРасписанияОбъект.Показатели.Добавить();
					ПоказательНачисления.ИдентификаторСтрокиВидаРасчета = ?(НезависимыйПоказатель, 0, ИдентификаторСтрокиВидаРасчета);
					ПоказательНачисления.ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции;
					ЗаполнитьЗначенияСвойств(ПоказательНачисления, ДанныеДляЗаполнения);
					
				КонецЦикла;
				
			КонецЕсли;
			
			Если Не НезависимыйПоказатель Тогда
				ИдентификаторСтрокиВидаРасчета = ИдентификаторСтрокиВидаРасчета + 1;
			КонецЕсли;
			
		КонецЦикла;
		
		ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции + 1;
		
	КонецЦикла;
	
	ОстаткиОтпусков.ЗаполнитьЕжегоднымиОтпускамиШтатногоРасписания(ДокументШтатногоРасписанияОбъект, ДатаВступленияВСилу);
	
	ЗаполнитьСпециальностямиШтатногоРасписания(ДокументШтатногоРасписанияОбъект, ДатаВступленияВСилу);
	
КонецПроцедуры

Процедура ЗаполнитьСпециальностямиШтатногоРасписания(Объект, ДатаВступленияВСилу)
	
	СпециальностиПозиций = СпециальностиПозицииШтатногоРасписания(Объект.Позиции.Выгрузить(, "Позиция"), ДатаВступленияВСилу, Объект.Ссылка);
	
	Объект.Специальности.Очистить();
	
	Для Каждого СтрокаПозиции Из Объект.Позиции Цикл
		
		СпециальностиПозиции = СпециальностиПозиций.НайтиСтроки(Новый Структура("ПозицияШтатногоРасписания", СтрокаПозиции.Позиция));
		Для Каждого СтрокаСпециальностиПоПозиции Из СпециальностиПозиции Цикл
			СтрокаСпециальности = Объект.Специальности.Добавить();
			СтрокаСпециальности.ИдентификаторСтрокиПозиции = СтрокаПозиции.ИдентификаторСтрокиПозиции;		
			СтрокаСпециальности.Специальность = СтрокаСпециальностиПоПозиции.Специальность;
		КонецЦикла;
		
	КонецЦикла;

КонецПроцедуры

Процедура ЗаполнитьНаборЗаписейИстории(Регистратор, НаборЗаписей, ВыборкаДвижений)
	
	Если ВыборкаДвижений.Количество() > 0  Тогда
		
		НаборЗаписей.Записывать = Истина;
		Пока ВыборкаДвижений.Следующий() Цикл
					
			ЗаписьНабора = НаборЗаписей.Добавить();
			ЗаполнитьЗначенияСвойств(ЗаписьНабора, ВыборкаДвижений);
			ЗаписьНабора.Регистратор = Регистратор;
			
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

Функция ДанныеДляПроведения(ДокументШтатногоРасписанияОбъект, ДатаВступленияВСилу)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", ДокументШтатногоРасписанияОбъект.Ссылка);
	Запрос.УстановитьПараметр("ДатаВступленияВСилу", ДатаВступленияВСилу);
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументШтатногоРасписанияПозиции.Ссылка КАК Ссылка,
	|	ДокументШтатногоРасписанияПозиции.КоличествоСтавок,
	|	ДокументШтатногоРасписанияПозиции.Позиция,
	|	ДокументШтатногоРасписанияПозиции.ИдентификаторСтрокиПозиции КАК ИдентификаторСтрокиПозиции,
	|	ДокументШтатногоРасписанияПозиции.Действие,
	|	ДокументШтатногоРасписанияПозиции.Должность,
	|	ДокументШтатногоРасписанияПозиции.Подразделение,
	|	ДокументШтатногоРасписанияПозиции.ГрафикРаботыСотрудников,
	|	ДокументШтатногоРасписанияПозиции.ФОТ КАК ФОТ,
	|	ДокументШтатногоРасписанияПозиции.ФОТМин КАК ФОТМин,
	|	ДокументШтатногоРасписанияПозиции.ФОТМакс КАК ФОТМакс,
	|	ДокументШтатногоРасписанияПозиции.НадбавкаЗаВредностьРазмер КАК НадбавкаЗаВредностьРазмер,
	|	ДокументШтатногоРасписанияПозиции.НадбавкаЗаВредностьРазмерМин КАК НадбавкаЗаВредностьРазмерМин,
	|	ДокументШтатногоРасписанияПозиции.НадбавкаЗаВредностьРазмерМакс КАК НадбавкаЗаВредностьРазмерМакс,
	|	ДокументШтатногоРасписанияПозиции.УсловияПриема,
	|	ДокументШтатногоРасписанияПозиции.ОкладТариф КАК ОкладТариф,
	|	ДокументШтатногоРасписанияПозиции.ОкладТарифМин КАК ОкладТарифМин,
	|	ДокументШтатногоРасписанияПозиции.ОкладТарифМакс КАК ОкладТарифМакс,
	|	ДокументШтатногоРасписанияПозиции.ТарифнаяСетка КАК ТарифнаяСетка,
	|	ДокументШтатногоРасписанияПозиции.РазрядКатегория КАК РазрядКатегория,
	|	ДокументШтатногоРасписанияПозиции.ТарифнаяСеткаНадбавки КАК ТарифнаяСеткаНадбавки,
	|	ДокументШтатногоРасписанияПозиции.РазрядКатегорияНадбавки КАК РазрядКатегорияНадбавки,
	|	ДокументШтатногоРасписанияПозиции.СпособОтраженияЗарплатыВБухучете,
	|	ДокументШтатногоРасписанияПозиции.СтатьяФинансирования,
	|	ДокументШтатногоРасписанияПозиции.ВыплачиваетсяНадбавкаЗаВредность,
	|	ДокументШтатногоРасписанияПозиции.ПроцентНадбавкиЗаВредность,
	|	ДокументШтатногоРасписанияПозиции.СозданоНовыхРабочихМест
	|ПОМЕСТИТЬ ВТПозиции
	|ИЗ
	|	Документ.УтверждениеШтатногоРасписания.Позиции КАК ДокументШтатногоРасписанияПозиции
	|ГДЕ
	|	ДокументШтатногоРасписанияПозиции.Ссылка = &Ссылка
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка,
	|	ИдентификаторСтрокиПозиции
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ДатаВступленияВСилу КАК Дата,
	|	Позиции.Позиция КАК ПозицияШтатногоРасписания,
	|	Позиции.КоличествоСтавок КАК КоличествоСтавок,
	|	ВЫБОР
	|		КОГДА Позиции.Действие = ЗНАЧЕНИЕ(Перечисление.ДействияСПозициямиШтатногоРасписания.ЗакрытьПозицию)
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК Используется,
	|	Позиции.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников,
	|	Позиции.ФОТ КАК ФОТ,
	|	Позиции.ФОТМин КАК ФОТМин,
	|	Позиции.ФОТМакс КАК ФОТМакс,
	|	Позиции.НадбавкаЗаВредностьРазмер КАК НадбавкаЗаВредностьРазмер,
	|	Позиции.НадбавкаЗаВредностьРазмерМин КАК НадбавкаЗаВредностьРазмерМин,
	|	Позиции.НадбавкаЗаВредностьРазмерМакс КАК НадбавкаЗаВредностьРазмерМакс,
	|	Позиции.УсловияПриема,
	|	Позиции.ОкладТариф КАК ОкладТариф,
	|	Позиции.ОкладТарифМин КАК ОкладТарифМин,
	|	Позиции.ОкладТарифМакс КАК ОкладТарифМакс,
	|	Позиции.ТарифнаяСетка КАК ТарифнаяСетка,
	|	Позиции.РазрядКатегория КАК РазрядКатегория,
	|	Позиции.ТарифнаяСеткаНадбавки КАК ТарифнаяСеткаНадбавки,
	|	Позиции.РазрядКатегорияНадбавки КАК РазрядКатегорияНадбавки,
	|	Позиции.СпособОтраженияЗарплатыВБухучете,
	|	Позиции.СтатьяФинансирования,
	|	Позиции.ВыплачиваетсяНадбавкаЗаВредность,
	|	Позиции.ПроцентНадбавкиЗаВредность,
	|	Позиции.СозданоНовыхРабочихМест
	|ИЗ
	|	ВТПозиции КАК Позиции
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ДатаВступленияВСилу КАК Дата,
	|	Позиции.Позиция КАК ПозицияШтатногоРасписания,
	|	ДокументШтатногоРасписанияНачисления.Начисление,
	|	ДокументШтатногоРасписанияНачисления.ИдентификаторСтрокиВидаРасчета КАК ИдентификаторСтрокиВидаРасчета,
	|	ДокументШтатногоРасписанияНачисления.Размер КАК Размер,
	|	ДокументШтатногоРасписанияНачисления.РазмерМин КАК РазмерМин,
	|	ДокументШтатногоРасписанияНачисления.РазмерМакс КАК РазмерМакс
	|ИЗ
	|	ВТПозиции КАК Позиции
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.УтверждениеШтатногоРасписания.Начисления КАК ДокументШтатногоРасписанияНачисления
	|		ПО Позиции.ИдентификаторСтрокиПозиции = ДокументШтатногоРасписанияНачисления.ИдентификаторСтрокиПозиции
	|			И Позиции.Ссылка = ДокументШтатногоРасписанияНачисления.Ссылка
	|			И (ДокументШтатногоРасписанияНачисления.Действие <> ЗНАЧЕНИЕ(Перечисление.ДействияСНачислениямиИУдержаниями.Отменить))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ДатаВступленияВСилу КАК Дата,
	|	Позиции.Позиция КАК ПозицияШтатногоРасписания,
	|	ДокументШтатногоРасписанияПоказатели.ИдентификаторСтрокиВидаРасчета КАК ИдентификаторСтрокиВидаРасчета,
	|	ДокументШтатногоРасписанияПоказатели.Показатель,
	|	ДокументШтатногоРасписанияПоказатели.Значение,
	|	ДокументШтатногоРасписанияПоказатели.ЗначениеМин,
	|	ДокументШтатногоРасписанияПоказатели.ЗначениеМакс
	|ИЗ
	|	ВТПозиции КАК Позиции
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.УтверждениеШтатногоРасписания.Показатели КАК ДокументШтатногоРасписанияПоказатели
	|		ПО Позиции.ИдентификаторСтрокиПозиции = ДокументШтатногоРасписанияПоказатели.ИдентификаторСтрокиПозиции
	|			И Позиции.Ссылка = ДокументШтатногоРасписанияПоказатели.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ДатаВступленияВСилу КАК Дата,
	|	Позиции.Позиция КАК ПозицияШтатногоРасписания,
	|	ДокументШтатногоРасписанияЕжегодныеОтпуска.ВидЕжегодногоОтпуска,
	|	ДокументШтатногоРасписанияЕжегодныеОтпуска.КоличествоДнейВГод
	|ИЗ
	|	ВТПозиции КАК Позиции
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.УтверждениеШтатногоРасписания.ЕжегодныеОтпуска КАК ДокументШтатногоРасписанияЕжегодныеОтпуска
	|		ПО Позиции.ИдентификаторСтрокиПозиции = ДокументШтатногоРасписанияЕжегодныеОтпуска.ИдентификаторСтрокиПозиции
	|			И Позиции.Ссылка = ДокументШтатногоРасписанияЕжегодныеОтпуска.Ссылка
	|			И (ДокументШтатногоРасписанияЕжегодныеОтпуска.Действие <> ЗНАЧЕНИЕ(Перечисление.ДействияСЕжегоднымиОтпусками.Отменить))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ДатаВступленияВСилу КАК Дата,
	|	Позиции.Позиция КАК ПозицияШтатногоРасписания,
	|	ДокументШтатногоРасписанияСпециальности.Специальность
	|ИЗ
	|	ВТПозиции КАК Позиции
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.УтверждениеШтатногоРасписания.Специальности КАК ДокументШтатногоРасписанияСпециальности
	|		ПО Позиции.ИдентификаторСтрокиПозиции = ДокументШтатногоРасписанияСпециальности.ИдентификаторСтрокиПозиции
	|			И Позиции.Ссылка = ДокументШтатногоРасписанияСпециальности.Ссылка";

	ИмяТаблицы = ДокументШтатногоРасписанияОбъект.Метаданные().Имя;
	Если ИмяТаблицы <> "УтверждениеШтатногоРасписания" Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, ".УтверждениеШтатногоРасписания.", "." + ИмяТаблицы + ".");
	КонецЕсли;
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	КоличествоРезультатов = РезультатЗапроса.Количество();
	
	ДанныеПроведения = Новый Структура;

	ДанныеПроведения.Вставить("ИсторииИспользованияШтатногоРасписания", РезультатЗапроса[КоличествоРезультатов - 5].Выбрать());
	ДанныеПроведения.Вставить("ИсторияНачисленийПоШтатномуРасписанию", РезультатЗапроса[КоличествоРезультатов - 4].Выбрать());
	ДанныеПроведения.Вставить("ИсторияПоказателейПоШтатномуРасписанию", РезультатЗапроса[КоличествоРезультатов - 3].Выбрать());
	ДанныеПроведения.Вставить("ИсторияЕжегодныхОтпусковПоШтатномуРасписанию", РезультатЗапроса[КоличествоРезультатов - 2].Выбрать());
	ДанныеПроведения.Вставить("ИсторияСпециальностейПоШтатномуРасписанию", РезультатЗапроса[КоличествоРезультатов - 1].Выбрать());
	
	Возврат ДанныеПроведения;
	
КонецФункции

Процедура СинхронизироватьРеквизитыПозиций(Объект) Экспорт
	
	ФОИспользоватьВилкуСтавокВШтатномРасписании = ПолучитьФункциональнуюОпцию("ИспользоватьВилкуСтавокВШтатномРасписании");
	
	Для каждого СтрокаТЧПозиции Из Объект.Позиции Цикл
		СинхронизироватьРеквизитыПозиции(СтрокаТЧПозиции, ФОИспользоватьВилкуСтавокВШтатномРасписании);
	КонецЦикла;
	
	СинхронизироватьРеквизитыНачислений(Объект, ФОИспользоватьВилкуСтавокВШтатномРасписании);
		
КонецПроцедуры

Процедура ОчиститьСозданныеПозиции(СозданныеПозиции)
	Если СозданныеПозиции <> Неопределено Тогда
		Для Каждого СтрокаПозиция Из СозданныеПозиции Цикл
			СтрокаПозиция.Позиция = Справочники.ШтатноеРасписание.ПустаяСсылка()
		КонецЦикла;
	КонецЕсли;
КонецПроцедуры

Процедура ПроверитьВозможностьИзменитьШтатноеРасписание(Позиции, Дата, Регистратор, РежимЗаписи, Отказ, ИмяЭлемента) Экспорт
	
	РезультатПроверки = РегистрыСведений.ИсторияИспользованияШтатногоРасписания.ПроверитьВозможностьВнесенияИзменений(
		Регистратор, Позиции, Дата);
	МожноИзменятьШтатноеРасписание = РезультатПроверки.ИзмененияВозможны;
	
	Если НЕ МожноИзменятьШтатноеРасписание Тогда
		
		Если РежимЗаписи = РежимЗаписиДокумента.Проведение Тогда
			ТекстСообщения = НСтр("ru='Дата последнего изменения штатного расписания больше даты, с которой вступит в силу этот документ. Проведение невозможно.';uk='Дата останньої зміни штатного розкладу більше дати, з якої вступить в силу цей документ. Проведення неможливе.'");
				
		Иначе
			ТекстСообщения = НСтр("ru='Дата последнего изменения штатного расписания больше даты, с которой вступит в силу этот документ. Отмена проведения невозможна.';uk='Дата останньої зміни штатного розкладу більше дати, з якої вступить в силу цей документ. Скасування проведення неможливе.'");
		КонецЕсли;
		
		ТекстСообщения = ТекстСообщения + Символы.ПС + СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='См. %1, позиция - ""%2""';uk='См. %1, позиція - ""%2""'"),
			РезультатПроверки.РегистраторПредставление,
			РезультатПроверки.Позиция);
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Регистратор, ИмяЭлемента, ,Отказ);
		
	КонецЕсли;
	
КонецПроцедуры

Процедура СоздатьНовыеПозицииШтатногоРасписания(Организация, Позиции, Начисления, Показатели, СтрокиСНовымиПозициями, СведенияОНаименованиях)
	
	ФОИспользоватьПриОписанииПозицииШтатногоРасписанияРазрядыКатегорииКлассыДолжностейИПрофессий =
		ПолучитьФункциональнуюОпцию("ИспользоватьПриОписанииПозицииШтатногоРасписанияРазрядыКатегорииКлассыДолжностейИПрофессий");
		
	Для каждого СтрокаПозиции Из Позиции Цикл
		
		СозданаПозиция = Ложь;
		Если ЗначениеЗаполнено(СтрокаПозиции.Позиция) Тогда
			ПозицияШтатногоРасписанияОбъект = СтрокаПозиции.Позиция.ПолучитьОбъект();
		Иначе
			СозданаПозиция = Истина;
			ПозицияШтатногоРасписанияОбъект = Справочники.ШтатноеРасписание.СоздатьЭлемент();
			ПозицияШтатногоРасписанияОбъект.Владелец = Организация;
		КонецЕсли;
		
		ЗаполнитьЗначенияСвойств(ПозицияШтатногоРасписанияОбъект, СтрокаПозиции);
		
		Если ФОИспользоватьПриОписанииПозицииШтатногоРасписанияРазрядыКатегорииКлассыДолжностейИПрофессий Тогда
			
			ПозицияШтатногоРасписанияОбъект.Наименование = УправлениеШтатнымРасписаниемКлиентСервер.НаименованиеПозицииШтатногоРасписания(
				СтрокаПозиции.Подразделение,
				СтрокаПозиции.Должность,
				СтрокаПозиции.РазрядКатегория);
				
		Иначе
				
			ПозицияШтатногоРасписанияОбъект.Наименование = УправлениеШтатнымРасписаниемКлиентСервер.НаименованиеПозицииШтатногоРасписания(
				СтрокаПозиции.Подразделение,
				СтрокаПозиции.Должность);
				
		КонецЕсли;
		
		Если ТипЗнч(СведенияОНаименованиях) = Тип("Соответствие") Тогда
			
			Наименование = СведенияОНаименованиях.Получить(СтрокаПозиции.ИдентификаторСтрокиПозиции);
			Если Наименование <> Неопределено Тогда
				ПозицияШтатногоРасписанияОбъект.Наименование = Наименование;
				СведенияОНаименованиях.Удалить(СтрокаПозиции.ИдентификаторСтрокиПозиции);
			КонецЕсли;
			
		КонецЕсли; 
			
		ОтключитьОбновлениеСтруктурыШтатногоРасписания(ПозицияШтатногоРасписанияОбъект);
		ПозицияШтатногоРасписанияОбъект.Записать();
		
		ПозицияШтатногоРасписания = ПозицияШтатногоРасписанияОбъект.Ссылка;
		
		СтрокаТЧПозиции = Позиции.Найти(СтрокаПозиции.НомерСтроки, "НомерСтроки");
		
		Если СтрокаТЧПозиции <> Неопределено Тогда
			СтрокаТЧПозиции.Позиция = ПозицияШтатногоРасписания.Ссылка;
		КонецЕсли;
		
		Если СозданаПозиция Тогда
			СтрокиСНовымиПозициями.Добавить(СтрокаТЧПозиции);
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Функция СформироватьЗапросПоТекущемуСостояниюШтатногоРасписания(Регистратор, Организация, Дата, Подразделение = Неопределено) 
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Отбор = Новый Массив;
	СтруктураОтбора = Новый Структура("ЛевоеЗначение, ВидСравнения, ПравоеЗначение", "Регистратор", "<>", Регистратор);
	Отбор.Добавить(СтруктураОтбора);
	
	СтруктураОтбора = Новый Структура("ЛевоеЗначение, ВидСравнения, ПравоеЗначение", "ПозицияШтатногоРасписания.Владелец", "=", Организация);
	Отбор.Добавить(СтруктураОтбора);
	
	Если Подразделение <> Неопределено Тогда
		СтруктураОтбора = Новый Структура("ЛевоеЗначение, ВидСравнения, ПравоеЗначение", "ПозицияШтатногоРасписания.Подразделение", "В ИЕРАРХИИ", Подразделение);
		Отбор.Добавить(СтруктураОтбора);
	КонецЕсли;
	
	ПараметрыПолученияПозиций = ПараметрыПолученияПозицийШтатногоРасписания();
	ПараметрыПолученияПозиций.ДатаАктуальности = Дата;
	ПараметрыПолученияПозиций.Отбор = Отбор;
	
	СоздатьВТПозицииШтатногоРасписания(Истина, Запрос.МенеджерВременныхТаблиц, "ВТАктуальныеПозицииШтатногоРасписания", ПараметрыПолученияПозиций);
	
	ОписательВременныхТаблиц = ОписательВременныхТаблицДляПолученияДанныхПозицийШтатногоРасписания(
		Запрос.МенеджерВременныхТаблиц,
		"ВТАктуальныеПозицииШтатногоРасписания");
	СоздатьВТНачисленияПозицийШтатногоРасписания(Истина, ОписательВременныхТаблиц, "ВТАктуальныеНачисленияПозиций");
	
	Запрос.УстановитьПараметр("ДатаАктуальности", Дата);
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	АктуальныеНачисленияПозиций.ПозицияШтатногоРасписания,
	|	МАКСИМУМ(АктуальныеНачисленияПозиций.Значение) КАК ОкладТариф,
	|	МАКСИМУМ(АктуальныеНачисленияПозиций.ЗначениеМин) КАК ОкладТарифМин,
	|	МИНИМУМ(АктуальныеНачисленияПозиций.ЗначениеМакс) КАК ОкладТарифМакс
	|ПОМЕСТИТЬ ВТЗначенияТарифа
	|ИЗ
	|	ВТАктуальныеНачисленияПозиций КАК АктуальныеНачисленияПозиций
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовРасчета.Начисления.Показатели КАК НачислениеПоказатели
	|		ПО АктуальныеНачисленияПозиций.Начисление = НачислениеПоказатели.Ссылка
	|			И АктуальныеНачисленияПозиций.Показатель = НачислениеПоказатели.Показатель
	|			И (НачислениеПоказатели.Ссылка.СпособВыполненияНачисления = ЗНАЧЕНИЕ(Перечисление.СпособыВыполненияНачислений.ЕжемесячноПриОкончательномРасчете))
	|			И (НачислениеПоказатели.Ссылка.ЗачетОтработанногоВремени)
	|			И (НачислениеПоказатели.ОсновнойПоказатель)
	|
	|СГРУППИРОВАТЬ ПО
	|	АктуальныеНачисленияПозиций.ПозицияШтатногоРасписания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	АктуальныеПозицииШтатногоРасписания.ПозицияШтатногоРасписания КАК Позиция,
	|	АктуальныеПозицииШтатногоРасписания.Подразделение,
	|	АктуальныеНачисленияПозиций.Начисление КАК Начисление,
	|	АктуальныеПозицииШтатногоРасписания.КоличествоСтавок КАК КоличествоСтавок,
	|	АктуальныеПозицииШтатногоРасписания.Должность,
	|	АктуальныеПозицииШтатногоРасписания.МестоВСтруктуреПредприятия,
	|	АктуальныеПозицииШтатногоРасписания.ТарифнаяСетка,
	|	АктуальныеПозицииШтатногоРасписания.РазрядКатегория,
	|	АктуальныеПозицииШтатногоРасписания.ТарифнаяСеткаНадбавки,
	|	АктуальныеПозицииШтатногоРасписания.РазрядКатегорияНадбавки,
	|	АктуальныеНачисленияПозиций.Показатель,
	|	АктуальныеНачисленияПозиций.Размер,
	|	АктуальныеНачисленияПозиций.РазмерМин,
	|	АктуальныеНачисленияПозиций.РазмерМакс,
	|	АктуальныеНачисленияПозиций.Значение КАК Значение,
	|	АктуальныеНачисленияПозиций.ЗначениеМин КАК ЗначениеМин,
	|	АктуальныеНачисленияПозиций.ЗначениеМакс КАК ЗначениеМакс,
	|	ЗначенияТарифа.ОкладТариф,
	|	ЗначенияТарифа.ОкладТарифМин,
	|	ЗначенияТарифа.ОкладТарифМакс,
	|	АктуальныеПозицииШтатногоРасписания.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников,
	|	АктуальныеПозицииШтатногоРасписания.СпособОтраженияЗарплатыВБухучете КАК СпособОтраженияЗарплатыВБухучете,
	|	АктуальныеПозицииШтатногоРасписания.СтатьяФинансирования КАК СтатьяФинансирования,
	|	АктуальныеПозицииШтатногоРасписания.ФОТ КАК ФОТ,
	|	АктуальныеПозицииШтатногоРасписания.ФОТМин КАК ФОТМин,
	|	АктуальныеПозицииШтатногоРасписания.ФОТМакс КАК ФОТМакс,
	|	АктуальныеПозицииШтатногоРасписания.НадбавкаЗаВредностьРазмер,
	|	АктуальныеПозицииШтатногоРасписания.НадбавкаЗаВредностьРазмерМин,
	|	АктуальныеПозицииШтатногоРасписания.НадбавкаЗаВредностьРазмерМакс,
	|	КлассыУсловийТрудаПоДолжностям.КлассУсловийТруда,
	|	КлассыУсловийТрудаПоДолжностям.ДатаРегистрацииИзменений КАК КлассУсловийТрудаДатаРегистрацииИзменений,
	|	АктуальныеПозицииШтатногоРасписания.ВыплачиваетсяНадбавкаЗаВредность,
	|	АктуальныеПозицииШтатногоРасписания.ПроцентНадбавкиЗаВредность
	|ИЗ
	|	ВТАктуальныеПозицииШтатногоРасписания КАК АктуальныеПозицииШтатногоРасписания
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТАктуальныеНачисленияПозиций КАК АктуальныеНачисленияПозиций
	|		ПО АктуальныеПозицииШтатногоРасписания.ПозицияШтатногоРасписания = АктуальныеНачисленияПозиций.ПозицияШтатногоРасписания
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗначенияТарифа КАК ЗначенияТарифа
	|		ПО АктуальныеПозицииШтатногоРасписания.ПозицияШтатногоРасписания = ЗначенияТарифа.ПозицияШтатногоРасписания
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КлассыУсловийТрудаПоДолжностям.СрезПоследних(&ДатаАктуальности, ) КАК КлассыУсловийТрудаПоДолжностям
	|		ПО АктуальныеПозицииШтатногоРасписания.ПозицияШтатногоРасписания = КлассыУсловийТрудаПоДолжностям.Должность
	|ГДЕ
	|	АктуальныеПозицииШтатногоРасписания.Дата <> АктуальныеПозицииШтатногоРасписания.Период
	|
	|УПОРЯДОЧИТЬ ПО
	|	Позиция,
	|	Начисление"; 
	
	Результат = Запрос.Выполнить();
	
	Если Результат.Пустой() Тогда
		
		Запрос.УстановитьПараметр("Организация", Организация);
		Запрос.УстановитьПараметр("Подразделение", Подразделение);
		Запрос.УстановитьПараметр("Дата", Дата);
		Запрос.УстановитьПараметр("Регистратор", Регистратор);

		Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ШтатноеРасписание.Ссылка КАК Позиция,
		|	ШтатноеРасписание.Подразделение,
		|	ШтатноеРасписание.Должность,
		|	ШтатноеРасписание.ТарифнаяСетка,
		|	ШтатноеРасписание.РазрядКатегория,
		|	ШтатноеРасписание.ТарифнаяСеткаНадбавки,
		|	ШтатноеРасписание.РазрядКатегорияНадбавки,
		|	ШтатноеРасписание.КоличествоСтавок КАК КоличествоСтавок,
		|	ШтатноеРасписание.ОкладТариф КАК ОкладТариф,
		|	ШтатноеРасписание.ОкладТарифМин КАК ОкладТарифМин,
		|	ШтатноеРасписание.ОкладТарифМакс КАК ОкладТарифМакс,
		|	ШтатноеРасписание.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников,
		|	ШтатноеРасписание.СпособОтраженияЗарплатыВБухучете КАК СпособОтраженияЗарплатыВБухучете,
		|	ШтатноеРасписание.СтатьяФинансирования КАК СтатьяФинансирования,
		|	ШтатноеРасписание.ФОТ КАК ФОТ,
		|	ШтатноеРасписание.ФОТМин КАК ФОТМин,
		|	ШтатноеРасписание.ФОТМакс КАК ФОТМакс,
		|	ШтатноеРасписание.НадбавкаЗаВредностьРазмер,
		|	ШтатноеРасписание.НадбавкаЗаВредностьРазмерМин,
		|	ШтатноеРасписание.НадбавкаЗаВредностьРазмерМакс,
		|	ШтатноеРасписание.ВыплачиваетсяНадбавкаЗаВредность,
		|	ШтатноеРасписание.ПроцентНадбавкиЗаВредность
		|ПОМЕСТИТЬ ВТТекущиеПозицииШР
		|ИЗ
		|	Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|ГДЕ
		|	ШтатноеРасписание.Владелец = &Организация
		|	И НЕ ШтатноеРасписание.ЭтоГруппа
		|	И (&Подразделение = НЕОПРЕДЕЛЕНО
		|			ИЛИ ШтатноеРасписание.Подразделение = &Подразделение)
		|	И (НЕ ШтатноеРасписание.Закрыта
		|			ИЛИ ШтатноеРасписание.ДатаЗакрытия <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|				И ШтатноеРасписание.ДатаЗакрытия > &Дата)";
		
		Запрос.Выполнить();
		
		СоздатьВТМестоПозицииВСтруктуреПредприятия(Запрос.МенеджерВременныхТаблиц, "ВТТекущиеПозицииШР");
		
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТекущиеПозицииШР.Позиция КАК Позиция,
		|	ТекущиеПозицииШР.Подразделение,
		|	ШтатноеРасписаниеНачисления.Начисление КАК Начисление,
		|	ТекущиеПозицииШР.Должность,
		|	МестоПозицииВСтруктуреПредприятия.МестоВСтруктуреПредприятия,
		|	ТекущиеПозицииШР.ТарифнаяСетка,
		|	ТекущиеПозицииШР.РазрядКатегория,
		|	ТекущиеПозицииШР.ТарифнаяСеткаНадбавки,
		|	ТекущиеПозицииШР.РазрядКатегорияНадбавки,
		|	ТекущиеПозицииШР.КоличествоСтавок КАК КоличествоСтавок,
		|	ТекущиеПозицииШР.ОкладТариф КАК ОкладТариф,
		|	ТекущиеПозицииШР.ОкладТарифМин КАК ОкладТарифМин,
		|	ТекущиеПозицииШР.ОкладТарифМакс КАК ОкладТарифМакс,
		|	ШтатноеРасписаниеПоказатели.Показатель КАК Показатель,
		|	ШтатноеРасписаниеПоказатели.Значение,
		|	ШтатноеРасписаниеПоказатели.ЗначениеМин,
		|	ШтатноеРасписаниеПоказатели.ЗначениеМакс,
		|	ТекущиеПозицииШР.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников,
		|	ТекущиеПозицииШР.СпособОтраженияЗарплатыВБухучете,
		|	ТекущиеПозицииШР.СтатьяФинансирования,
		|	ТекущиеПозицииШР.ФОТ КАК ФОТ,
		|	ТекущиеПозицииШР.ФОТМин КАК ФОТМин,
		|	ТекущиеПозицииШР.ФОТМакс КАК ФОТМакс,
		|	ТекущиеПозицииШР.НадбавкаЗаВредностьРазмер,
		|	ТекущиеПозицииШР.НадбавкаЗаВредностьРазмерМин,
		|	ТекущиеПозицииШР.НадбавкаЗаВредностьРазмерМакс,
		|	КлассыУсловийТрудаПоДолжностям.КлассУсловийТруда,
		|	КлассыУсловийТрудаПоДолжностям.ДатаРегистрацииИзменений КАК КлассУсловийТрудаДатаРегистрацииИзменений,
		|	ТекущиеПозицииШР.ВыплачиваетсяНадбавкаЗаВредность,
		|	ТекущиеПозицииШР.ПроцентНадбавкиЗаВредность
		|ИЗ
		|	ВТТекущиеПозицииШР КАК ТекущиеПозицииШР
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание.Начисления КАК ШтатноеРасписаниеНачисления
		|		ПО ТекущиеПозицииШР.Позиция = ШтатноеРасписаниеНачисления.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание.Показатели КАК ШтатноеРасписаниеПоказатели
		|		ПО (ШтатноеРасписаниеНачисления.Ссылка = ШтатноеРасписаниеПоказатели.Ссылка)
		|			И (ШтатноеРасписаниеНачисления.ИдентификаторСтрокиВидаРасчета = ШтатноеРасписаниеПоказатели.ИдентификаторСтрокиВидаРасчета)
		|			И (ШтатноеРасписаниеПоказатели.Показатель <> ЗНАЧЕНИЕ(Справочник.ПоказателиРасчетаЗарплаты.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КлассыУсловийТрудаПоДолжностям.СрезПоследних(&ДатаАктуальности, ) КАК КлассыУсловийТрудаПоДолжностям
		|		ПО ТекущиеПозицииШР.Позиция = КлассыУсловийТрудаПоДолжностям.Должность
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМестоПозицииВСтруктуреПредприятия КАК МестоПозицииВСтруктуреПредприятия
		|		ПО ТекущиеПозицииШР.Позиция = МестоПозицииВСтруктуреПредприятия.Позиция
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ТекущиеПозицииШР.Позиция,
		|	ТекущиеПозицииШР.Подразделение,
		|	ЗНАЧЕНИЕ(ПланВидовРасчета.Начисления.ПустаяСсылка),
		|	ТекущиеПозицииШР.Должность,
		|	МестоПозицииВСтруктуреПредприятия.МестоВСтруктуреПредприятия,
		|	ТекущиеПозицииШР.ТарифнаяСетка,
		|	ТекущиеПозицииШР.РазрядКатегория,
		|	ТекущиеПозицииШР.ТарифнаяСеткаНадбавки,
		|	ТекущиеПозицииШР.РазрядКатегорияНадбавки,
		|	ТекущиеПозицииШР.КоличествоСтавок,
		|	ТекущиеПозицииШР.ОкладТариф,
		|	ТекущиеПозицииШР.ОкладТарифМин,
		|	ТекущиеПозицииШР.ОкладТарифМакс,
		|	ШтатноеРасписаниеПоказатели.Показатель,
		|	ШтатноеРасписаниеПоказатели.Значение,
		|	ШтатноеРасписаниеПоказатели.ЗначениеМин,
		|	ШтатноеРасписаниеПоказатели.ЗначениеМакс,
		|	ТекущиеПозицииШР.ГрафикРаботыСотрудников,
		|	ТекущиеПозицииШР.СпособОтраженияЗарплатыВБухучете,
		|	ТекущиеПозицииШР.СтатьяФинансирования,
		|	ТекущиеПозицииШР.ФОТ,
		|	ТекущиеПозицииШР.ФОТМин,
		|	ТекущиеПозицииШР.ФОТМакс,
		|	ТекущиеПозицииШР.НадбавкаЗаВредностьРазмер,
		|	ТекущиеПозицииШР.НадбавкаЗаВредностьРазмерМин,
		|	ТекущиеПозицииШР.НадбавкаЗаВредностьРазмерМакс,
		|	КлассыУсловийТрудаПоДолжностям.КлассУсловийТруда,
		|	КлассыУсловийТрудаПоДолжностям.ДатаРегистрацииИзменений,
		|	ТекущиеПозицииШР.ВыплачиваетсяНадбавкаЗаВредность,
		|	ТекущиеПозицииШР.ПроцентНадбавкиЗаВредность
		|ИЗ
		|	ВТТекущиеПозицииШР КАК ТекущиеПозицииШР
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание.Показатели КАК ШтатноеРасписаниеПоказатели
		|		ПО ТекущиеПозицииШР.Позиция = ШтатноеРасписаниеПоказатели.Ссылка
		|			И (ШтатноеРасписаниеПоказатели.ИдентификаторСтрокиВидаРасчета = 0)
		|			И (ШтатноеРасписаниеПоказатели.Показатель <> ЗНАЧЕНИЕ(Справочник.ПоказателиРасчетаЗарплаты.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КлассыУсловийТрудаПоДолжностям.СрезПоследних(&ДатаАктуальности, ) КАК КлассыУсловийТрудаПоДолжностям
		|		ПО ТекущиеПозицииШР.Позиция = КлассыУсловийТрудаПоДолжностям.Должность
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМестоПозицииВСтруктуреПредприятия КАК МестоПозицииВСтруктуреПредприятия
		|		ПО ТекущиеПозицииШР.Позиция = МестоПозицииВСтруктуреПредприятия.Позиция
		|
		|УПОРЯДОЧИТЬ ПО
		|	Позиция,
		|	Начисление,
		|	Показатель";
		
		Возврат Запрос.Выполнить();
		
	Иначе
		Возврат Результат;
	КонецЕсли;
	
КонецФункции

Функция СформироватьЗапросДляПроверкиДокумента(Регистратор, Организация, Подразделение, Позиции, Начисления, Показатели, ДатаВступленияВСилу)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Регистратор", Регистратор);
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("Подразделение", Подразделение);
	Запрос.УстановитьПараметр("НеОтбиратьПоПодразделению", Не ЗначениеЗаполнено(Подразделение));
	Запрос.УстановитьПараметр("Позиции", Позиции);
	Запрос.УстановитьПараметр("Начисления", Начисления);
	Запрос.УстановитьПараметр("Показатели", Показатели);
	Запрос.УстановитьПараметр("ДатаВступленияВСилу", ДатаВступленияВСилу);
	
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	УтверждениеШтатногоРасписанияПозиции.НомерСтроки,
		|	УтверждениеШтатногоРасписанияПозиции.Должность,
		|	УтверждениеШтатногоРасписанияПозиции.Подразделение,
		|	УтверждениеШтатногоРасписанияПозиции.Позиция,
		|	УтверждениеШтатногоРасписанияПозиции.Действие,
		|	УтверждениеШтатногоРасписанияПозиции.ИдентификаторСтрокиПозиции КАК ИдентификаторСтрокиПозиции
		|ПОМЕСТИТЬ ВТПозиции
		|ИЗ
		|	&Позиции КАК УтверждениеШтатногоРасписанияПозиции
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ИдентификаторСтрокиПозиции
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	УтверждениеШтатногоРасписанияНачисления.НомерСтроки,
		|	УтверждениеШтатногоРасписанияНачисления.ИдентификаторСтрокиПозиции КАК ИдентификаторСтрокиПозиции,
		|	УтверждениеШтатногоРасписанияНачисления.Начисление,
		|	УтверждениеШтатногоРасписанияНачисления.ИдентификаторСтрокиВидаРасчета КАК ИдентификаторСтрокиВидаРасчета,
		|	УтверждениеШтатногоРасписанияНачисления.Действие КАК Действие
		|ПОМЕСТИТЬ ВТТаблицаНачисления
		|ИЗ
		|	&Начисления КАК УтверждениеШтатногоРасписанияНачисления
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ИдентификаторСтрокиВидаРасчета,
		|	ИдентификаторСтрокиПозиции
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	УтверждениеШтатногоРасписанияПоказатели.НомерСтроки,
		|	УтверждениеШтатногоРасписанияПоказатели.ИдентификаторСтрокиВидаРасчета КАК ИдентификаторСтрокиВидаРасчета,
		|	УтверждениеШтатногоРасписанияПоказатели.Показатель,
		|	УтверждениеШтатногоРасписанияПоказатели.Значение,
		|	УтверждениеШтатногоРасписанияПоказатели.ЗначениеМин,
		|	УтверждениеШтатногоРасписанияПоказатели.ЗначениеМакс
		|ПОМЕСТИТЬ ВТПоказатели
		|ИЗ
		|	&Показатели КАК УтверждениеШтатногоРасписанияПоказатели
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ИдентификаторСтрокиВидаРасчета
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТаблицаНачисления.Начисление,
		|	ТаблицаНачисления.ИдентификаторСтрокиПозиции,
		|	ТаблицаНачисления.ИдентификаторСтрокиВидаРасчета,
		|	ТаблицаНачисления.НомерСтроки,
		|	ТаблицаНачисления.Действие,
		|	Начисления.Наименование,
		|	Начисления.ЗачетОтработанногоВремени,
		|	ОбозначенияВТабелеУчетаРабочегоВремени.Ссылка КАК ОбозначениеВТабелеУчетаРабочегоВремени
		|ПОМЕСТИТЬ ВТДанныеНачислений
		|ИЗ
		|	ВТТаблицаНачисления КАК ТаблицаНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовРасчета.Начисления КАК Начисления
		|		ПО ТаблицаНачисления.Начисление = Начисления.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыИспользованияРабочегоВремени КАК ОбозначенияВТабелеУчетаРабочегоВремени
		|		ПО (ОбозначенияВТабелеУчетаРабочегоВремени.Ссылка = Начисления.ОбозначениеВТабелеУчетаРабочегоВремени)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Начисления.НомерСтроки
		|ПОМЕСТИТЬ ВТЗачетОтработанногоВремениДубль
		|ИЗ
		|	ВТДанныеНачислений КАК Начисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДанныеНачислений КАК НачисленияДубльЗачетВремени
		|		ПО (Начисления.ЗачетОтработанногоВремени)
		|			И (НачисленияДубльЗачетВремени.ЗачетОтработанногоВремени)
		|			И Начисления.НомерСтроки > НачисленияДубльЗачетВремени.НомерСтроки
		|			И Начисления.ИдентификаторСтрокиПозиции = НачисленияДубльЗачетВремени.ИдентификаторСтрокиПозиции
		|			И Начисления.ОбозначениеВТабелеУчетаРабочегоВремени = НачисленияДубльЗачетВремени.ОбозначениеВТабелеУчетаРабочегоВремени
		|			И (НачисленияДубльЗачетВремени.Действие <> ЗНАЧЕНИЕ(Перечисление.ДействияСНачислениямиИУдержаниями.Отменить))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Начисления.НомерСтроки
		|ПОМЕСТИТЬ ВТНачисленияДубль
		|ИЗ
		|	ВТДанныеНачислений КАК Начисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДанныеНачислений КАК НачисленияДубль
		|		ПО Начисления.ИдентификаторСтрокиПозиции = НачисленияДубль.ИдентификаторСтрокиПозиции
		|			И Начисления.Начисление = НачисленияДубль.Начисление
		|			И Начисления.НомерСтроки > НачисленияДубль.НомерСтроки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТаблицаНачисления.НомерСтроки,
		|	ТаблицаНачисления.ИдентификаторСтрокиПозиции,
		|	ТаблицаНачисления.Начисление,
		|	Показатели.Показатель,
		|	Показатели.Значение,
		|	Показатели.ЗначениеМин,
		|	Показатели.ЗначениеМакс
		|ПОМЕСТИТЬ ВТНачисленияПоказатели
		|ИЗ
		|	ВТТаблицаНачисления КАК ТаблицаНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПоказатели КАК Показатели
		|		ПО ТаблицаНачисления.ИдентификаторСтрокиВидаРасчета = Показатели.ИдентификаторСтрокиВидаРасчета
		|ГДЕ
		|	ТаблицаНачисления.Действие <> ЗНАЧЕНИЕ(Перечисление.ДействияСНачислениямиИУдержаниями.Отменить)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НачисленияПоказатели.НомерСтроки,
		|	НачисленияПоказателиДубль.НомерСтроки КАК НомерСтроки1,
		|	НачисленияПоказатели.Показатель
		|ПОМЕСТИТЬ ВТОшибкиЗначенийПоказателей
		|ИЗ
		|	ВТНачисленияПоказатели КАК НачисленияПоказатели
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНачисленияПоказатели КАК НачисленияПоказателиДубль
		|		ПО НачисленияПоказатели.ИдентификаторСтрокиПозиции = НачисленияПоказателиДубль.ИдентификаторСтрокиПозиции
		|			И НачисленияПоказатели.Показатель = НачисленияПоказателиДубль.Показатель
		|			И НачисленияПоказатели.НомерСтроки > НачисленияПоказателиДубль.НомерСтроки
		|			И НачисленияПоказатели.Значение <> НачисленияПоказателиДубль.Значение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НачисленияПоказатели.НомерСтроки,
		|	НачисленияПоказателиДубль.НомерСтроки КАК НомерСтроки1,
		|	НачисленияПоказатели.Показатель
		|ПОМЕСТИТЬ ВТОшибкиМинЗначенийПоказателей
		|ИЗ
		|	ВТНачисленияПоказатели КАК НачисленияПоказатели
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНачисленияПоказатели КАК НачисленияПоказателиДубль
		|		ПО НачисленияПоказатели.ИдентификаторСтрокиПозиции = НачисленияПоказателиДубль.ИдентификаторСтрокиПозиции
		|			И НачисленияПоказатели.Показатель = НачисленияПоказателиДубль.Показатель
		|			И НачисленияПоказатели.НомерСтроки > НачисленияПоказателиДубль.НомерСтроки
		|			И НачисленияПоказатели.ЗначениеМин <> НачисленияПоказателиДубль.ЗначениеМин
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НачисленияПоказатели.НомерСтроки,
		|	НачисленияПоказателиДубль.НомерСтроки КАК НомерСтроки1,
		|	НачисленияПоказатели.Показатель
		|ПОМЕСТИТЬ ВТОшибкиМаксЗначенийПоказателей
		|ИЗ
		|	ВТНачисленияПоказатели КАК НачисленияПоказатели
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНачисленияПоказатели КАК НачисленияПоказателиДубль
		|		ПО НачисленияПоказатели.ИдентификаторСтрокиПозиции = НачисленияПоказателиДубль.ИдентификаторСтрокиПозиции
		|			И НачисленияПоказатели.Показатель = НачисленияПоказателиДубль.Показатель
		|			И НачисленияПоказатели.НомерСтроки > НачисленияПоказателиДубль.НомерСтроки
		|			И НачисленияПоказатели.ЗначениеМакс <> НачисленияПоказателиДубль.ЗначениеМакс
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Начисления.Начисление,
		|	Начисления.ИдентификаторСтрокиПозиции,
		|	Начисления.НомерСтроки,
		|	ВЫБОР
		|		КОГДА ЗачетОтработанногоВремениДубль.НомерСтроки ЕСТЬ NULL 
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ КАК ОшибкаЗачетОтработанногоВремениДубль,
		|	ВЫБОР
		|		КОГДА НачисленияДубль.НомерСтроки ЕСТЬ NULL 
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ КАК ОшибкаНачислениеДубль,
		|	ВЫБОР
		|		КОГДА НЕ Показатели.Показатель ЕСТЬ NULL 
		|				И ЕСТЬNULL(Показатели.ЗначениеМакс, 0) <> 0
		|				И ЕСТЬNULL(Показатели.ЗначениеМин, 0) <> 0
		|				И ЕСТЬNULL(Показатели.ЗначениеМин, 0) > ЕСТЬNULL(Показатели.ЗначениеМакс, 0)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ОшибкаЗначения,
		|	ВЫБОР
		|		КОГДА ОшибкиЗначенийПоказателей.НомерСтроки ЕСТЬ NULL 
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ КАК РазныеЗначенияПоказателя,
		|	ОшибкиЗначенийПоказателей.Показатель КАК РазныеЗначенияПоказателяПоказатель,
		|	ВЫБОР
		|		КОГДА ОшибкиМинЗначенийПоказателей.НомерСтроки ЕСТЬ NULL 
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ КАК РазныеМинЗначенияПоказателя,
		|	ОшибкиМинЗначенийПоказателей.Показатель КАК РазныеМинЗначенияПоказателяПоказатель,
		|	ВЫБОР
		|		КОГДА ОшибкиМаксЗначенийПоказателей.НомерСтроки ЕСТЬ NULL 
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ КАК РазныеМаксЗначенияПоказателя,
		|	ОшибкиМаксЗначенийПоказателей.Показатель КАК РазныеМаксЗначенияПоказателяПоказатель,
		|	Начисления.Наименование КАК НачислениеНаименование,
		|	ДанныеПоказателей.Наименование КАК ПоказательНаименование,
		|	Начисления.НомерСтроки КАК НачислениеНомерСтроки,
		|	Показатели.НомерСтроки КАК ПоказательНомерСтроки
		|ПОМЕСТИТЬ ВТОшибкиПоказателей
		|ИЗ
		|	ВТДанныеНачислений КАК Начисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоказатели КАК Показатели
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПоказателиРасчетаЗарплаты КАК ДанныеПоказателей
		|			ПО Показатели.Показатель = ДанныеПоказателей.Ссылка
		|		ПО Начисления.ИдентификаторСтрокиВидаРасчета = Показатели.ИдентификаторСтрокиВидаРасчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗачетОтработанногоВремениДубль КАК ЗачетОтработанногоВремениДубль
		|		ПО Начисления.НомерСтроки = ЗачетОтработанногоВремениДубль.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачисленияДубль КАК НачисленияДубль
		|		ПО Начисления.НомерСтроки = НачисленияДубль.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОшибкиЗначенийПоказателей КАК ОшибкиЗначенийПоказателей
		|		ПО Начисления.НомерСтроки = ОшибкиЗначенийПоказателей.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОшибкиМинЗначенийПоказателей КАК ОшибкиМинЗначенийПоказателей
		|		ПО Начисления.НомерСтроки = ОшибкиМинЗначенийПоказателей.НомерСтроки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОшибкиМаксЗначенийПоказателей КАК ОшибкиМаксЗначенийПоказателей
		|		ПО Начисления.НомерСтроки = ОшибкиМаксЗначенийПоказателей.НомерСтроки
		|ГДЕ
		|	(ВЫБОР
		|				КОГДА ЗачетОтработанногоВремениДубль.НомерСтроки ЕСТЬ NULL 
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ ИСТИНА
		|			КОНЕЦ
		|			ИЛИ ВЫБОР
		|				КОГДА НачисленияДубль.НомерСтроки ЕСТЬ NULL 
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ ИСТИНА
		|			КОНЕЦ
		|			ИЛИ ВЫБОР
		|				КОГДА ОшибкиЗначенийПоказателей.НомерСтроки ЕСТЬ NULL 
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ ИСТИНА
		|			КОНЕЦ
		|			ИЛИ ВЫБОР
		|				КОГДА ОшибкиМинЗначенийПоказателей.НомерСтроки ЕСТЬ NULL 
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ ИСТИНА
		|			КОНЕЦ
		|			ИЛИ ВЫБОР
		|				КОГДА ОшибкиМаксЗначенийПоказателей.НомерСтроки ЕСТЬ NULL 
		|					ТОГДА ЛОЖЬ
		|				ИНАЧЕ ИСТИНА
		|			КОНЕЦ
		|			ИЛИ ВЫБОР
		|				КОГДА НЕ Показатели.Показатель ЕСТЬ NULL 
		|						И ЕСТЬNULL(Показатели.ЗначениеМакс, 0) <> 0
		|						И ЕСТЬNULL(Показатели.ЗначениеМин, 0) <> 0
		|						И ЕСТЬNULL(Показатели.ЗначениеМин, 0) > ЕСТЬNULL(Показатели.ЗначениеМакс, 0)
		|					ТОГДА ИСТИНА
		|				ИНАЧЕ ЛОЖЬ
		|			КОНЕЦ)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
		|	МАКСИМУМ(ИсторияИспользованияШтатногоРасписания.Дата) КАК Дата
		|ПОМЕСТИТЬ ВТШтатноеРасписаниеАктуальное
		|ИЗ
		|	РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписания
		|ГДЕ
		|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Владелец = &Организация
		|	И ИсторияИспользованияШтатногоРасписания.Дата <= &ДатаВступленияВСилу
		|	И ИсторияИспользованияШтатногоРасписания.Регистратор <> &Регистратор
		|
		|СГРУППИРОВАТЬ ПО
		|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания КАК Позиция,
		|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Наименование
		|ПОМЕСТИТЬ ВТАктуальныеПозиции
		|ИЗ
		|	РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписания
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТШтатноеРасписаниеАктуальное КАК ШтатноеРасписаниеАктуальное
		|		ПО ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания = ШтатноеРасписаниеАктуальное.ПозицияШтатногоРасписания
		|			И ИсторияИспользованияШтатногоРасписания.Дата = ШтатноеРасписаниеАктуальное.Дата
		|ГДЕ
		|	ИсторияИспользованияШтатногоРасписания.Используется
		|	И (&НеОтбиратьПоПодразделению
		|			ИЛИ ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Подразделение = &Подразделение)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА Позиции.Позиция = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|				И Позиции.Действие <> ЗНАЧЕНИЕ(Перечисление.ДействияСПозициямиШтатногоРасписания.СоздатьНовуюПозицию)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ОшибкаНоваяПозиция,
		|	ОшибкиПоказателей.Начисление,
		|	ЕСТЬNULL(ОшибкиПоказателей.ОшибкаЗачетОтработанногоВремениДубль, ЛОЖЬ) КАК ОшибкаЗачетОтработанногоВремениДубль,
		|	ЕСТЬNULL(ОшибкиПоказателей.ОшибкаНачислениеДубль, ЛОЖЬ) КАК ОшибкаНачислениеДубль,
		|	ЕСТЬNULL(ОшибкиПоказателей.ОшибкаЗначения, ЛОЖЬ) КАК ОшибкаЗначения,
		|	ЕСТЬNULL(ОшибкиПоказателей.РазныеЗначенияПоказателя, ЛОЖЬ) КАК РазныеЗначенияПоказателя,
		|	ОшибкиПоказателей.РазныеЗначенияПоказателяПоказатель КАК РазныеЗначенияПоказателяПоказатель,
		|	ЕСТЬNULL(ОшибкиПоказателей.РазныеМинЗначенияПоказателя, ЛОЖЬ) КАК РазныеМинЗначенияПоказателя,
		|	ОшибкиПоказателей.РазныеМинЗначенияПоказателяПоказатель КАК РазныеМинЗначенияПоказателяПоказатель,
		|	ЕСТЬNULL(ОшибкиПоказателей.РазныеМаксЗначенияПоказателя, ЛОЖЬ) КАК РазныеМаксЗначенияПоказателя,
		|	ОшибкиПоказателей.РазныеМаксЗначенияПоказателяПоказатель КАК РазныеМаксЗначенияПоказателяПоказатель,
		|	ЕСТЬNULL(ОшибкиПоказателей.НачислениеНаименование, """") КАК НачислениеНаименование,
		|	ЕСТЬNULL(ОшибкиПоказателей.ПоказательНаименование, """") КАК ПоказательНаименование,
		|	Позиции.НомерСтроки КАК НомерСтроки,
		|	ОшибкиПоказателей.НачислениеНомерСтроки КАК НачислениеНомерСтроки,
		|	ОшибкиПоказателей.ПоказательНомерСтроки КАК ПоказательНомерСтроки,
		|	ЛОЖЬ КАК ОшибкаАктуальнаяПозиция,
		|	"""" КАК АктуальнаяПозицияНаименование,
		|	NULL КАК АктуальнаяПозиция
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОшибкиПоказателей КАК ОшибкиПоказателей
		|		ПО Позиции.ИдентификаторСтрокиПозиции = ОшибкиПоказателей.ИдентификаторСтрокиПозиции
		|ГДЕ
		|	(ВЫБОР
		|				КОГДА Позиции.Позиция = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|						И Позиции.Действие <> ЗНАЧЕНИЕ(Перечисление.ДействияСПозициямиШтатногоРасписания.СоздатьНовуюПозицию)
		|					ТОГДА ИСТИНА
		|				ИНАЧЕ ЛОЖЬ
		|			КОНЕЦ
		|			ИЛИ ВЫБОР
		|				КОГДА Позиции.НомерСтроки ЕСТЬ NULL 
		|					ТОГДА ИСТИНА
		|				ИНАЧЕ ЛОЖЬ
		|			КОНЕЦ
		|			ИЛИ ОшибкиПоказателей.ОшибкаЗачетОтработанногоВремениДубль
		|			ИЛИ ОшибкиПоказателей.ОшибкаНачислениеДубль
		|			ИЛИ ОшибкиПоказателей.ОшибкаЗначения
		|			ИЛИ ОшибкиПоказателей.РазныеЗначенияПоказателя
		|			ИЛИ ОшибкиПоказателей.РазныеМинЗначенияПоказателя
		|			ИЛИ ОшибкиПоказателей.РазныеМаксЗначенияПоказателя)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЛОЖЬ,
		|	NULL,
		|	ЛОЖЬ,
		|	ЛОЖЬ,
		|	ЛОЖЬ,
		|	ЛОЖЬ,
		|	NULL,
		|	ЛОЖЬ,
		|	NULL,
		|	ЛОЖЬ,
		|	NULL,
		|	"""",
		|	"""",
		|	NULL,
		|	NULL,
		|	NULL,
		|	ИСТИНА,
		|	АктуальныеПозиции.Позиция.Наименование,
		|	АктуальныеПозиции.Позиция
		|ИЗ
		|	ВТАктуальныеПозиции КАК АктуальныеПозиции
		|		ПОЛНОЕ СОЕДИНЕНИЕ ВТПозиции КАК Позиции
		|		ПО АктуальныеПозиции.Позиция = Позиции.Позиция
		|ГДЕ
		|	Позиции.НомерСтроки ЕСТЬ NULL 
		|
		|УПОРЯДОЧИТЬ ПО
		|	ОшибкаАктуальнаяПозиция,
		|	НомерСтроки,
		|	НачислениеНомерСтроки,
		|	ПоказательНомерСтроки";
	
	РезультатЗапроса =  Запрос.Выполнить();
	
	Возврат РезультатЗапроса;
	
КонецФункции

// Погашает настройку использования вилки ставок в штатном расписании если расчет зарплаты не используется.
//
// Параметры:
//	- ИспользоватьРасчетЗарплаты - булево, признак использования расчета зарплаты.
//
Процедура ЗаполнитьНастройкиШтатногоРасписания(ИспользоватьРасчетЗарплаты) Экспорт
	
	Настройка = РегистрыСведений.НастройкиШтатногоРасписания.СоздатьМенеджерЗаписи();
	Настройка.Прочитать();
	
	Если Не Настройка.Выбран() Тогда
		ЗначенияПоУмолчанию = НастройкиШтатногоРасписанияПоУмолчанию();
		Для Каждого КлючИЗначение Из ЗначенияПоУмолчанию Цикл
			Настройка[КлючИЗначение.Ключ] = КлючИЗначение.Значение;
		КонецЦикла;
	КонецЕсли;
	
	Если ИспользоватьРасчетЗарплаты Тогда
		Настройка.НеИспользоватьВилкуСтавокВШтатномРасписании = Не Настройка.ИспользоватьВилкуСтавокВШтатномРасписании;
	Иначе
		Настройка.ИспользоватьВилкуСтавокВШтатномРасписании = Ложь;
		Настройка.НеИспользоватьВилкуСтавокВШтатномРасписании = Ложь;
	КонецЕсли;
	
	Настройка.Записать();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Подготовка описателей временных таблиц для получения данных позиции.

Функция ОписательВременныхТаблицДляСоздатьВТПозицииШтатногоРасписания(МенеджерВременныхТаблиц, ИмяВТОтбораПозицийШтатногоРасписания, ИменаРеквизитов = "ПозицияШтатногоРасписания,Дата") Экспорт
	
	ОписательВременныхТаблиц = Новый Структура;
	ОписательВременныхТаблиц.Вставить("МенеджерВременныхТаблиц", МенеджерВременныхТаблиц);
	ОписательВременныхТаблиц.Вставить("ИмяВТОтбораПозицийШтатногоРасписания", ИмяВТОтбораПозицийШтатногоРасписания);
	ОписательВременныхТаблиц.Вставить("ИменаРеквизитов", ИменаРеквизитовВТПозицииШтатногоРасписания(ИменаРеквизитов));
	
	Возврат ОписательВременныхТаблиц;
	
КонецФункции

Функция ОписательВременныхТаблицДляПолученияДанныхПозицийШтатногоРасписания(МенеджерВременныхТаблиц, ИмяВТПозицииШтатногоРасписания = "ВТПозицииШтатногоРасписания", ИменаРеквизитов = "ПозицияШтатногоРасписания,Дата") Экспорт
	
	ОписательВременныхТаблиц = Новый Структура;
	ОписательВременныхТаблиц.Вставить("МенеджерВременныхТаблиц", МенеджерВременныхТаблиц);
	ОписательВременныхТаблиц.Вставить("ИмяВТПозицииШтатногоРасписания", ИмяВТПозицииШтатногоРасписания);
	ОписательВременныхТаблиц.Вставить("ИменаРеквизитов", ИменаРеквизитовВТПозицииШтатногоРасписания(ИменаРеквизитов));
	
	Возврат ОписательВременныхТаблиц;
	
КонецФункции

Функция ИменаРеквизитовВТПозицииШтатногоРасписания(ИменаРеквизитов = "ПозицияШтатногоРасписания,Дата")
	
	СтруктураИменРеквизитов = Новый Структура("Позиция,Дата", "ПозицияШтатногоРасписания","Дата");
	
	МассивИмен = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(ИменаРеквизитов);
	Если МассивИмен.Количество() > 1 Тогда
		СтруктураИменРеквизитов.Позиция = МассивИмен[0];
		СтруктураИменРеквизитов.Дата = МассивИмен[1];
	КонецЕсли;
	
	Возврат СтруктураИменРеквизитов;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// Запросы по начислениям позиций штатного расписания.

Процедура СоздатьВТНачисленияПозицийШтатногоРасписания(ТолькоРазрешенные, ОписательВременныхТаблиц, ИмяВТНачисленияПозицийШтатногоРасписания = "ВТНачисленияПозицийШтатногоРасписания", ПолноеОписаниеНачислений = Ложь) Экспорт
	
	Запрос = ЗапросВТНачисленияПозицийШтатногоРасписания(
		ТолькоРазрешенные, ОписательВременныхТаблиц.ИмяВТПозицииШтатногоРасписания, ИмяВТНачисленияПозицийШтатногоРасписания, ОписательВременныхТаблиц.ИменаРеквизитов, ПолноеОписаниеНачислений);
		
	Запрос.МенеджерВременныхТаблиц = ОписательВременныхТаблиц.МенеджерВременныхТаблиц;
	
	Запрос.Выполнить();
	
КонецПроцедуры	

Функция ЗапросВТНачисленияПозицийШтатногоРасписания(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ИмяВТНачисленияПозицийШтатногоРасписания, ИменаРеквизитов = Неопределено, ПолноеОписаниеНачислений = Ложь) Экспорт
	
	Если ИменаРеквизитов = Неопределено Тогда
		ИменаРеквизитов = ИменаРеквизитовВТПозицииШтатногоРасписания(ИменаРеквизитов);
	КонецЕсли;
	
	ФОИспользоватьНесколькоТарифныхСтавок = ПолучитьФункциональнуюОпцию("ИспользоватьНесколькоТарифныхСтавок");
	
	Запрос = Новый Запрос;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьИсториюИзмененияШтатногоРасписания") Тогда
		
		ТекстЗапроса = 
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ПозицииШтатногоРасписания.Период КАК Период,
			|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	ИсторияНачисленийПоШтатномуРасписанию.Начисление КАК Начисление,
			|	ИсторияНачисленийПоШтатномуРасписанию.Размер КАК Размер,
			|	ИсторияНачисленийПоШтатномуРасписанию.РазмерМин КАК РазмерМин,
			|	ИсторияНачисленийПоШтатномуРасписанию.РазмерМакс КАК РазмерМакс,
			|	ЕСТЬNULL(Показатели.Показатель, ЗНАЧЕНИЕ(Справочник.ПоказателиРасчетаЗарплаты.ПустаяСсылка)) КАК Показатель,
			|	ЕСТЬNULL(Показатели.Значение, 0) КАК Значение,
			|	ЕСТЬNULL(Показатели.ЗначениеМин, 0) КАК ЗначениеМин,
			|	ЕСТЬNULL(Показатели.ЗначениеМакс, 0) КАК ЗначениеМакс,
			|	ИсторияНачисленийПоШтатномуРасписанию.ИдентификаторСтрокиВидаРасчета
			|ПОМЕСТИТЬ ВТНачисленияПозицийШтатногоРасписания
			|{ВЫБРАТЬ
			|	Период,
			|	ПозицияШтатногоРасписания,
			|	Начисление.*,
			|	Размер,
			|	РазмерМин,
			|	РазмерМакс,
			|	Показатель.*,
			|	Значение,
			|	ЗначениеМин,
			|	ЗначениеМакс,
			|	ИдентификаторСтрокиВидаРасчета}
			|ИЗ
			|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияНачисленийПоШтатномуРасписанию КАК ИсторияНачисленийПоШтатномуРасписанию
			|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияПоказателейПоШтатномуРасписанию КАК Показатели
			|			ПО ИсторияНачисленийПоШтатномуРасписанию.ПозицияШтатногоРасписания = Показатели.ПозицияШтатногоРасписания
			|				И ИсторияНачисленийПоШтатномуРасписанию.Дата = Показатели.Дата
			|				И ИсторияНачисленийПоШтатномуРасписанию.ИдентификаторСтрокиВидаРасчета = Показатели.ИдентификаторСтрокиВидаРасчета
			|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = ИсторияНачисленийПоШтатномуРасписанию.ПозицияШтатногоРасписания
			|			И ПозицииШтатногоРасписания.Дата = ИсторияНачисленийПоШтатномуРасписанию.Дата";
						
		Если ФОИспользоватьНесколькоТарифныхСтавок Тогда
			
			ТекстЗапроса = ТекстЗапроса
				+	"
					|
					|ОБЪЕДИНИТЬ ВСЕ
					|
					|"
				+	"ВЫБРАТЬ
					|	ПозицииШтатногоРасписания.Период КАК Период,
					|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания,
					|	ЗНАЧЕНИЕ(ПланВидовРасчета.Начисления.ПустаяСсылка) КАК Поле1,
					|	0 КАК Поле2,
					|	0 КАК Поле3,
					|	0 КАК Поле4,
					|	ИсторияПоказателейПоШтатномуРасписанию.Показатель,
					|	ИсторияПоказателейПоШтатномуРасписанию.Значение,
					|	ИсторияПоказателейПоШтатномуРасписанию.ЗначениеМин,
					|	ИсторияПоказателейПоШтатномуРасписанию.ЗначениеМакс,
					|	ИсторияПоказателейПоШтатномуРасписанию.ИдентификаторСтрокиВидаРасчета
					|ИЗ
					|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
					|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияПоказателейПоШтатномуРасписанию КАК ИсторияПоказателейПоШтатномуРасписанию
					|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = ИсторияПоказателейПоШтатномуРасписанию.ПозицияШтатногоРасписания
					|			И ПозицииШтатногоРасписания.Дата = ИсторияПоказателейПоШтатномуРасписанию.Дата
					|			И (ИсторияПоказателейПоШтатномуРасписанию.ИдентификаторСтрокиВидаРасчета = 0)
					|{ГДЕ
					|	ПозицииШтатногоРасписания.Организация КАК Организация,
					|	ПозицииШтатногоРасписания.Подразделение КАК Подразделение,
					|	ПозицииШтатногоРасписания.Должность КАК Должность,
					|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания}";
			
		КонецЕсли;
			
	Иначе
		
		ТекстЗапроса = 
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ПозицииШтатногоРасписания.Период КАК Период,
			|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	Начисления.Начисление КАК Начисление,
			|	Начисления.Размер КАК Размер,
			|	Начисления.РазмерМин КАК РазмерМин,
			|	Начисления.РазмерМакс КАК РазмерМакс,
			|	ЕСТЬNULL(Показатели.Показатель, ЗНАЧЕНИЕ(Справочник.ПоказателиРасчетаЗарплаты.ПустаяСсылка)) КАК Показатель,
			|	ЕСТЬNULL(Показатели.Значение, 0) КАК Значение,
			|	ЕСТЬNULL(Показатели.ЗначениеМин, 0) КАК ЗначениеМин,
			|	ЕСТЬNULL(Показатели.ЗначениеМакс, 0) КАК ЗначениеМакс,
			|	Начисления.ИдентификаторСтрокиВидаРасчета
			|ПОМЕСТИТЬ ВТНачисленияПозицийШтатногоРасписания
			|{ВЫБРАТЬ
			|	Период,
			|	ПозицияШтатногоРасписания,
			|	Начисление.*,
			|	Размер,
			|	РазмерМин,
			|	РазмерМакс,
			|	Показатель.*,
			|	Значение,
			|	ЗначениеМин,
			|	ЗначениеМакс,
			|	ИдентификаторСтрокиВидаРасчета}
			|ИЗ
			|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание.Начисления КАК Начисления
			|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание.Показатели КАК Показатели
			|			ПО Начисления.Ссылка = Показатели.Ссылка
			|				И Начисления.ИдентификаторСтрокиВидаРасчета = Показатели.ИдентификаторСтрокиВидаРасчета
			|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = Начисления.Ссылка";
						
		Если ФОИспользоватьНесколькоТарифныхСтавок Тогда
			
			ТекстЗапроса = ТекстЗапроса
				+ 	"
					|
					|ОБЪЕДИНИТЬ ВСЕ
					|
					|"
				+	"ВЫБРАТЬ
					|	ПозицииШтатногоРасписания.Период КАК Период,
					|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания,
					|	ЗНАЧЕНИЕ(ПланВидовРасчета.Начисления.ПустаяСсылка),
					|	0,
					|	0,
					|	0,
					|	Показатели.Показатель,
					|	Показатели.Значение,
					|	Показатели.ЗначениеМин,
					|	Показатели.ЗначениеМакс,
					|	Показатели.ИдентификаторСтрокиВидаРасчета
					|ИЗ
					|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
					|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание.Показатели КАК Показатели
					|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = Показатели.Ссылка
					|			И (Показатели.ИдентификаторСтрокиВидаРасчета = 0)
					|{ГДЕ
					|	Показатели.Ссылка.Владелец.* КАК Организация,
					|	Показатели.Ссылка.Подразделение.*,
					|	Показатели.Ссылка.Должность.*,
					|	Показатели.Ссылка.* КАК ПозицияШтатногоРасписания}";
				
		КонецЕсли;
		
	КонецЕсли;
		
	Если ПолноеОписаниеНачислений Тогда
		
		ТекстЗапроса = 
			ТекстЗапроса 
			+	"
				|ОБЪЕДИНИТЬ ВСЕ
				|"
			+	"ВЫБРАТЬ
				|	ПозицииШтатногоРасписания.Период КАК Период,
				|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания,
				|	&НачислениеНадбавкаЗаВредность КАК Начисление,
				|	ПозицииШтатногоРасписания.НадбавкаЗаВредностьРазмер КАК Размер,
				|	ПозицииШтатногоРасписания.НадбавкаЗаВредностьРазмерМин КАК РазмерМин,
				|	ПозицииШтатногоРасписания.НадбавкаЗаВредностьРазмерМакс КАК РазмерМакс,
				|	&ПоказательПроцентНадбавкиЗаВредность КАК Показатель,
				|	ПозицииШтатногоРасписания.ПроцентНадбавкиЗаВредность КАК Значение,
				|	ПозицииШтатногоРасписания.ПроцентНадбавкиЗаВредность КАК ЗначениеМин,
				|	ПозицииШтатногоРасписания.ПроцентНадбавкиЗаВредность КАК ЗначениеМакс,
				|	99997 КАК ИдентификаторСтрокиВидаРасчета
				|ИЗ
				|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
				|ГДЕ
				|	ПозицииШтатногоРасписания.ВыплачиваетсяНадбавкаЗаВредность
				|	И &НачислениеНадбавкаЗаВредность <> НЕОПРЕДЕЛЕНО
				|	И &ПоказательПроцентНадбавкиЗаВредность <> НЕОПРЕДЕЛЕНО
				|";				
		НачислениеНадбавкаЗаВредность = НачисленияНадбавкаЗаВредность();
		ПоказательПроцентНадбавкиЗаВредность = ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.ПроцентНадбавкиЗаВредность");
				
		Запрос.УстановитьПараметр("НачислениеНадбавкаЗаВредность", НачислениеНадбавкаЗаВредность);
		Запрос.УстановитьПараметр("ПоказательПроцентНадбавкиЗаВредность", ПоказательПроцентНадбавкиЗаВредность);
		

	КонецЕсли;
	
	ТекстЗапроса = ТекстЗапроса + "
		|ИНДЕКСИРОВАТЬ ПО
		|	Период,
		|	ПозицияШтатногоРасписания";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТПозицииШтатногоРасписания", ИмяВТПозицииШтатногоРасписания);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПозицииШтатногоРасписания.ПозицияШтатногоРасписания", "ПозицииШтатногоРасписания." + ИменаРеквизитов.Позиция);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПозицииШтатногоРасписания.Дата", "ПозицииШтатногоРасписания." + ИменаРеквизитов.Дата);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТНачисленияПозицийШтатногоРасписания", ИмяВТНачисленияПозицийШтатногоРасписания);
	
	Если НЕ ТолькоРазрешенные Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВЫБРАТЬ РАЗРЕШЕННЫЕ", "ВЫБРАТЬ");
	КонецЕсли;
	
	Запрос.Текст = ?(ПустаяСтрока(Запрос.Текст), "", Запрос.Текст + ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов()) + ТекстЗапроса;
	
	Возврат Запрос;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// Запросы по ежегодным отпускам позиций штатного расписания.

Процедура СоздатьВТЕжегодныеОтпускаПозицийШтатногоРасписания(ТолькоРазрешенные, ОписательВременныхТаблиц, ИмяВТЕжегодныеОтпускаПозицийШтатногоРасписания = "ВТЕжегодныеОтпускаПозицийШтатногоРасписания")
	
	Запрос = ЗапросВТЕжегодныеОтпускаПозицийШтатногоРасписания(
		ТолькоРазрешенные, ОписательВременныхТаблиц.ИмяВТПозицииШтатногоРасписания, ОписательВременныхТаблиц.ИменаРеквизитов, ИмяВТЕжегодныеОтпускаПозицийШтатногоРасписания);
		
	Запрос.МенеджерВременныхТаблиц = ОписательВременныхТаблиц.МенеджерВременныхТаблиц;
	
	Запрос.Выполнить();
	
КонецПроцедуры	

Функция ЗапросВТЕжегодныеОтпускаПозицийШтатногоРасписания(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ИменаРеквизитов, ИмяВТЕжегодныеОтпускаПозицийШтатногоРасписания)
	
	Запрос = Новый Запрос;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьИсториюИзмененияШтатногоРасписания") Тогда
		
		ИмяВТПоследниеДатыИсторияЕжегодныхОтпусковПоШтатномуРасписанию = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТПоследниеДатыИсторияЕжегодныхОтпусковПоШтатномуРасписанию");
		
		ТекстЗапроса = 
			"ВЫБРАТЬ
			|	МАКСИМУМ(ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.Дата) КАК Дата,
			|	ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания
			|ПОМЕСТИТЬ ВТПоследниеДатыИсторияЕжегодныхОтпусковПоШтатномуРасписанию
			|ИЗ
			|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияЕжегодныхОтпусковПоШтатномуРасписанию КАК ИсторияЕжегодныхОтпусковПоШтатномуРасписанию
			|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ПозицияШтатногоРасписания
			|			И ПозицииШтатногоРасписания.Дата >= ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.Дата
			|
			|СГРУППИРОВАТЬ ПО
			|	ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ПозицияШтатногоРасписания
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания,
			|	ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
			|	ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.КоличествоДнейВГод КАК КоличествоДнейВГод
			|ПОМЕСТИТЬ ВТЕжегодныеОтпускаПозицийШтатногоРасписания
			|ИЗ
			|	ВТПоследниеДатыИсторияЕжегодныхОтпусковПоШтатномуРасписанию КАК ПозицииШтатногоРасписания
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияЕжегодныхОтпусковПоШтатномуРасписанию КАК ИсторияЕжегодныхОтпусковПоШтатномуРасписанию
			|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ПозицияШтатногоРасписания
			|			И ПозицииШтатногоРасписания.Дата = ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.Дата
			|{ГДЕ
			|	ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ПозицияШтатногоРасписания.Владелец.* КАК Организация,
			|	ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ПозицияШтатногоРасписания.Подразделение.* КАК Подразделение,
			|	ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ПозицияШтатногоРасписания.Должность.* КАК Должность,
			|	ИсторияЕжегодныхОтпусковПоШтатномуРасписанию.ПозицияШтатногоРасписания.*}";
			
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТПоследниеДатыИсторияЕжегодныхОтпусковПоШтатномуРасписанию", ИмяВТПоследниеДатыИсторияЕжегодныхОтпусковПоШтатномуРасписанию);
		
	Иначе
		
		ТекстЗапроса = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания,
		|	ЕжегодныеОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ЕжегодныеОтпуска.КоличествоДнейВГод КАК КоличествоДнейВГод
		|ПОМЕСТИТЬ ВТЕжегодныеОтпускаПозицийШтатногоРасписания
		|ИЗ
		|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание.ЕжегодныеОтпуска КАК ЕжегодныеОтпуска
		|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = ЕжегодныеОтпуска.Ссылка
		|{ГДЕ
		|	ЕжегодныеОтпуска.Ссылка.Владелец.* КАК Организация,
		|	ЕжегодныеОтпуска.Ссылка.Подразделение.*,
		|	ЕжегодныеОтпуска.Ссылка.Должность.*,
		|	ЕжегодныеОтпуска.Ссылка.Ссылка.* КАК ПозицияШтатногоРасписания}";
		
	КонецЕсли;

	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТПозицииШтатногоРасписания", ИмяВТПозицииШтатногоРасписания);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПозицииШтатногоРасписания.ПозицияШтатногоРасписания", "ПозицииШтатногоРасписания." + ИменаРеквизитов.Позиция);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПозицииШтатногоРасписания.Дата", "ПозицииШтатногоРасписания." + ИменаРеквизитов.Дата);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТЕжегодныеОтпускаПозицийШтатногоРасписания", ИмяВТЕжегодныеОтпускаПозицийШтатногоРасписания);
	
	Если НЕ ТолькоРазрешенные Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВЫБРАТЬ РАЗРЕШЕННЫЕ", "ВЫБРАТЬ");
	КонецЕсли;
	
	Запрос.Текст = ТекстЗапроса;
	
	Возврат Запрос;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// Запросы к позициям штатного расписания.

Функция ПараметрыПолученияПозицийШтатногоРасписания() Экспорт
	
	СтруктураПараметров = Новый Структура;
	
	СтруктураПараметров.Вставить("ДатаАктуальности", '00010101');
	СтруктураПараметров.Вставить("Организация", Справочники.Организации.ПустаяСсылка());
	СтруктураПараметров.Вставить("Подразделение", Справочники.ПодразделенияОрганизаций.ПустаяСсылка());
	СтруктураПараметров.Вставить("ПозицииШтатногоРасписания", Неопределено);
	СтруктураПараметров.Вставить("Отбор", Новый Массив);
	
	Возврат СтруктураПараметров;
	
КонецФункции

Процедура СоздатьВТПозицииШтатногоРасписания(ТолькоРазрешенные, МенеджерВременныхТаблиц, ИмяВТПозицииШтатногоРасписания, ПараметрыПолученияПозиций) Экспорт
	
	Запрос = ЗапросВТПозицииШтатногоРасписанияПоПараметрам(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ПараметрыПолученияПозиций);
	
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Выполнить();
	
КонецПроцедуры

Функция ЗапросВТПозицииШтатногоРасписанияПоПараметрам(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ПараметрыПолученияПозиций) Экспорт
	
	Запрос = Новый Запрос;
	
	ФОИспользоватьИсториюИзмененияШтатногоРасписания = ПолучитьФункциональнуюОпцию("ИспользоватьИсториюИзмененияШтатногоРасписания");
	
	Организация = ПараметрыПолученияПозиций.Организация;
	Подразделение = ПараметрыПолученияПозиций.Подразделение;
	Позиции = ПараметрыПолученияПозиций.ПозицииШтатногоРасписания;
	ДатаАктуальности = ПараметрыПолученияПозиций.ДатаАктуальности;
	Отбор = ПараметрыПолученияПозиций.Отбор;
	
	ОтборПоПостояннымДанным= Новый Массив;
	
	УсловияЗапроса = Новый Массив;
	
	Если ЗначениеЗаполнено(Организация) Тогда
		
		СтруктураОтбора = Новый Структура;

		Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
			ЛевоеЗначение = "ПозицияШтатногоРасписания.Владелец";
		Иначе
			ЛевоеЗначение = "Владелец";
		КонецЕсли;
		СтруктураОтбора.Вставить("ЛевоеЗначение", ЛевоеЗначение);
		
		Если ТипЗнч(Организация) = Тип("Строка") Тогда
			ВидСравненияОтбора = "=";
			ПравоеЗначение = Организация;
		Иначе
			ВидСравненияОтбора = "В";
			Если ТипЗнч(Организация) = Тип("СправочникСсылка.Организации") Тогда
				ПравоеЗначение = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(Организация);
			Иначе
				ПравоеЗначение = Организация;
			КонецЕсли;
		КонецЕсли;
		СтруктураОтбора.Вставить("ВидСравнения", ВидСравненияОтбора);
		СтруктураОтбора.Вставить("ПравоеЗначение", ПравоеЗначение);
		
		ОтборПоПостояннымДанным.Добавить(СтруктураОтбора);
		
	КонецЕсли; 
	
	Если ЗначениеЗаполнено(Подразделение) Тогда
		
		СтруктураОтбора = Новый Структура;

		Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
			ЛевоеЗначение = "ПозицияШтатногоРасписания.Подразделение";
		Иначе
			ЛевоеЗначение = "Подразделение";
		КонецЕсли;
		СтруктураОтбора.Вставить("ЛевоеЗначение", ЛевоеЗначение);
		
		Если ТипЗнч(Подразделение) = Тип("Строка") Тогда
			ВидСравненияОтбора = "=";
			ПравоеЗначение = Подразделение;
		Иначе
			ВидСравненияОтбора = "В";
			Если ТипЗнч(Организация) = Тип("СправочникСсылка.ПодразделенияОрганизаций") Тогда
				ПравоеЗначение = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(Подразделение);
			Иначе
				ПравоеЗначение = Подразделение;
			КонецЕсли;
		КонецЕсли;
		СтруктураОтбора.Вставить("ВидСравнения", ВидСравненияОтбора);
		СтруктураОтбора.Вставить("ПравоеЗначение", ПравоеЗначение);
		
		ОтборПоПостояннымДанным.Добавить(СтруктураОтбора);
		
	КонецЕсли; 
	
	Если Позиции <> Неопределено Тогда
		
		Если ТипЗнч(Позиции) = Тип("СправочникСсылка.ШтатноеРасписание") Тогда
			СписокПозиций = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(Позиции);
		Иначе
			СписокПозиций = Позиции;
		КонецЕсли;
		
		Запрос.УстановитьПараметр("СписокПозиций", СписокПозиций);
		Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
			УсловияЗапроса.Добавить("(ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания В (&СписокПозиций))");
		Иначе
			УсловияЗапроса.Добавить("(Ссылка В (&СписокПозиций))");
		КонецЕсли;
		
	КонецЕсли; 
	
	Если ЗначениеЗаполнено(ДатаАктуальности) Тогда
		
		Если ТипЗнч(ДатаАктуальности) <> Тип("Строка") Тогда
			Запрос.УстановитьПараметр("ДатаАктуальностиПозиций", ДатаАктуальности);
		КонецЕсли;
		
		Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
			УсловияЗапроса.Добавить("(ИсторияИспользованияШтатногоРасписания.Дата <= &ДатаАктуальностиПозиций)");
		Иначе
			УсловияЗапроса.Добавить("(ШтатноеРасписание.ДатаУтверждения <= &ДатаАктуальностиПозиций
				|И (НЕ ШтатноеРасписание.Закрыта ИЛИ ШтатноеРасписание.ДатаЗакрытия  > &ДатаАктуальностиПозиций))");
		КонецЕсли;
		
	Иначе
		Запрос.УстановитьПараметр("ДатаАктуальностиПозиций", ТекущаяДатаСеанса());
	КонецЕсли;
	
	Если ФОИспользоватьИсториюИзмененияШтатногоРасписания
		И Отбор <> Неопределено Тогда
		
		Для каждого ОписаниеЭлементаОтбора Из Отбор Цикл
			
			Если ВРег(ОписаниеЭлементаОтбора.ЛевоеЗначение) = ВРег("Регистратор") Тогда
				
				ОтборПоПостояннымДанным.Добавить(ОписаниеЭлементаОтбора);
				Прервать;
				
			КонецЕсли; 
			
		КонецЦикла;
		
	КонецЕсли; 
	
	ТекстУсловий = ТекстУсловийЗапросаСОтборами(Запрос, ОтборПоПостояннымДанным, ФОИспользоватьИсториюИзмененияШтатногоРасписания, УсловияЗапроса);
	
	ИмяВТВсеПозицииНаДатуАктуальности = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТВсеПозицииНаДатуАктуальности");
	
	Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
		
		ТекстЗапроса =
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	&ДатаАктуальностиПозиций КАК Период,
			|	МАКСИМУМ(ИсторияИспользованияШтатногоРасписания.Дата) КАК Дата,
			|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	МИНИМУМ(ИсторияИспользованияШтатногоРасписанияСледующие.Дата) КАК СледующаяДата
			|ПОМЕСТИТЬ ВТВсеПозицииНаДатуАктуальности
			|ИЗ
			|	РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписания
			|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписанияСледующие
			|		ПО ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания = ИсторияИспользованияШтатногоРасписанияСледующие.ПозицияШтатногоРасписания
			|			И ИсторияИспользованияШтатногоРасписания.Дата < ИсторияИспользованияШтатногоРасписанияСледующие.Дата
			|ГДЕ
			|	&ТекстУсловийЗапроса
			|{ГДЕ
			|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Владелец.* КАК Организация,
			|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Подразделение.* КАК Подразделение,
			|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Должность.* КАК Должность,
			|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Ссылка.* КАК ПозицияШтатногоРасписания}
			|
			|СГРУППИРОВАТЬ ПО
			|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	ПозицияШтатногоРасписания,
			|	Дата";
			
		Если Отбор <> Неопределено
			И Отбор.Количество() > 0 Тогда
			
			ИмяВТПромежуточнаяВсеПозицииНаДатуАктуальности = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТПромежуточнаяВсеПозицииНаДатуАктуальности");
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТВсеПозицииНаДатуАктуальности", "ВТПромежуточнаяВсеПозицииНаДатуАктуальности");
			
			ТекстЗапроса = ТекстЗапроса
				+ ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов()
				+ "ВЫБРАТЬ РАЗРЕШЕННЫЕ
				  |	ПромежуточнаяВсеПозицииНаДатуАктуальности.Период КАК Период,
				  |	ПромежуточнаяВсеПозицииНаДатуАктуальности.Дата КАК Дата,
				  |	ПромежуточнаяВсеПозицииНаДатуАктуальности.СледующаяДата КАК СледующаяДата,
				  |	ПромежуточнаяВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания
				  |ПОМЕСТИТЬ ВТВсеПозицииНаДатуАктуальности
				  |ИЗ
				  |	ВТПромежуточнаяВсеПозицииНаДатуАктуальности КАК ПромежуточнаяВсеПозицииНаДатуАктуальности
				  |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписания
				  |		ПО ПромежуточнаяВсеПозицииНаДатуАктуальности.Дата = ИсторияИспользованияШтатногоРасписания.Дата
				  |			И ПромежуточнаяВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания = ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания
				  |			И (&ТекстУсловийСвязи)
				  |ГДЕ
				  |	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания ЕСТЬ НЕ NULL ";
				  
			ТекстУсловийСвязи = ТекстУсловийЗапросаСОтборами(Запрос, Отбор, ФОИспользоватьИсториюИзмененияШтатногоРасписания);
			
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТПромежуточнаяВсеПозицииНаДатуАктуальности", ИмяВТПромежуточнаяВсеПозицииНаДатуАктуальности);
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстУсловийСвязи", ТекстУсловийСвязи);
			
		КонецЕсли;
			
	Иначе
		
		ТекстЗапроса =
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	&ДатаАктуальностиПозиций КАК Период,
			|	ШтатноеРасписание.ДатаУтверждения КАК Дата,
			|	ДАТАВРЕМЯ(1, 1, 1) КАК СледующаяДата,
			|	ШтатноеРасписание.Ссылка КАК ПозицияШтатногоРасписания
			|ПОМЕСТИТЬ ВТВсеПозицииНаДатуАктуальности
			|ИЗ
			|	Справочник.ШтатноеРасписание КАК ШтатноеРасписание
			|ГДЕ
			|	&ТекстУсловийЗапроса
			|{ГДЕ
			|	ШтатноеРасписание.Владелец.* КАК Организация,
			|	ШтатноеРасписание.Подразделение.*,
			|	ШтатноеРасписание.Должность.*,
			|	ШтатноеРасписание.Ссылка.* КАК ПозицияШтатногоРасписания}
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	ПозицияШтатногоРасписания,
			|	Период";
			
		Если Отбор <> Неопределено
			И Отбор.Количество() > 0 Тогда
			ТекстУсловий = ТекстУсловий + Символы.ПС + "	И "	+ ТекстУсловийЗапросаСОтборами(Запрос, Отбор, ФОИспользоватьИсториюИзмененияШтатногоРасписания);
		КонецЕсли;
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТВсеПозицииНаДатуАктуальности", ИмяВТВсеПозицииНаДатуАктуальности);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстУсловийЗапроса", ТекстУсловий);
	
	Если ЗначениеЗаполнено(ДатаАктуальности) И ТипЗнч(ДатаАктуальности) = Тип("Строка") Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ДатаАктуальностиПозиций", ДатаАктуальности);
	КонецЕсли;
	
	Если НЕ ТолькоРазрешенные Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВЫБРАТЬ РАЗРЕШЕННЫЕ", "ВЫБРАТЬ");
	КонецЕсли; 
	
	Запрос.Текст = ТекстЗапроса;
	
	ЗапросВтПозиции = ЗапросВТПозицииШтатногоРасписания(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ИмяВТВсеПозицииНаДатуАктуальности, Ложь);
	ЗарплатаКадрыОбщиеНаборыДанных.ОбъединитьЗапросы(Запрос, ЗапросВтПозиции);
	
	Возврат Запрос;
	
КонецФункции

Процедура СоздатьВТПозицииШтатногоРасписанияПоВременнойТаблице(ТолькоРазрешенные, ОписательВременныхТаблиц, ИмяВТПозицииШтатногоРасписания) Экспорт
	
	Запрос = ЗапросВТПозицииШтатногоРасписания(
		ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ОписательВременныхТаблиц.ИмяВТОтбораПозицийШтатногоРасписания, Истина, ОписательВременныхТаблиц.ИменаРеквизитов);
		
	Запрос.МенеджерВременныхТаблиц = ОписательВременныхТаблиц.МенеджерВременныхТаблиц;
	Запрос.Выполнить();
	
КонецПроцедуры

Функция ЗапросВТПозицииШтатногоРасписания(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ИмяВТОтбораПозицийШтатногоРасписания, ПодобратьПоДатеАктуальности, ИменаРеквизитов = Неопределено) Экспорт
	
	Если ИменаРеквизитов = Неопределено
		Или ТипЗнч(ИменаРеквизитов) = Тип("Строка") Тогда
		
		ИменаРеквизитов = ИменаРеквизитовВТПозицииШтатногоРасписания(ИменаРеквизитов);
		
	КонецЕсли;
	
	Запрос = Новый Запрос;
	
	ФОИспользоватьИсториюИзмененияШтатногоРасписания = ПолучитьФункциональнуюОпцию("ИспользоватьИсториюИзмененияШтатногоРасписания");
	
	Если ПодобратьПоДатеАктуальности Тогда
		
		ИменаРеквизитовТаблицыОтбора = ИменаРеквизитовВТПозицииШтатногоРасписания();
		ИмяВТОтбораПозиций = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТВсеОтобранныеПозицииНаДатуАктуальности");;
		
		Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
			
			ТекстЗапроса =
				"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
				|	НАЧАЛОПЕРИОДА(ОтборПозицийШтатногоРасписания.Дата, ДЕНЬ) КАК Период,
				|	МАКСИМУМ(ИсторияИспользованияШтатногоРасписания.Дата) КАК Дата,
				|	МИНИМУМ(ИсторияИспользованияШтатногоРасписанияСледующие.Дата) КАК СледующаяДата,
				|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
				|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Подразделение КАК Подразделение
				|ПОМЕСТИТЬ ВТВсеОтобранныеПозицииНаДатуАктуальности
				|ИЗ
				|	РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписания
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтбораПозицийШтатногоРасписания КАК ОтборПозицийШтатногоРасписания
				|		ПО ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания = ОтборПозицийШтатногоРасписания.ПозицияШтатногоРасписания
				|			И ИсторияИспользованияШтатногоРасписания.Дата <= ОтборПозицийШтатногоРасписания.Дата
				|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписанияСледующие
				|		ПО (ОтборПозицийШтатногоРасписания.ПозицияШтатногоРасписания = ИсторияИспользованияШтатногоРасписанияСледующие.ПозицияШтатногоРасписания)
				|			И (ОтборПозицийШтатногоРасписания.Дата < ИсторияИспользованияШтатногоРасписанияСледующие.Дата)
				|{ГДЕ
				|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Владелец.* КАК Организация,
				|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Подразделение.* КАК Подразделение,
				|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Должность.* КАК Должность,
				|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Ссылка.* КАК ПозицияШтатногоРасписания}
				|
				|СГРУППИРОВАТЬ ПО
				|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания,
				|	ОтборПозицийШтатногоРасписания.Дата,
				|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Подразделение
				|
				|ИНДЕКСИРОВАТЬ ПО
				|	ПозицияШтатногоРасписания,
				|	Дата";
				
		Иначе
			
			ТекстЗапроса =
				"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
				|	НАЧАЛОПЕРИОДА(ОтборПозицийШтатногоРасписания.Дата, ДЕНЬ) КАК Период,
				|	ШтатноеРасписание.ДатаУтверждения КАК Дата,
				|	ДАТАВРЕМЯ(1, 1, 1) КАК СледующаяДата,
				|	ШтатноеРасписание.Ссылка КАК ПозицияШтатногоРасписания,
				|	ШтатноеРасписание.Подразделение КАК Подразделение
				|ПОМЕСТИТЬ ВТВсеОтобранныеПозицииНаДатуАктуальности
				|ИЗ
				|	Справочник.ШтатноеРасписание КАК ШтатноеРасписание
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтбораПозицийШтатногоРасписания КАК ОтборПозицийШтатногоРасписания
				|		ПО ШтатноеРасписание.Ссылка = ОтборПозицийШтатногоРасписания.ПозицияШтатногоРасписания
				|ГДЕ
				|	ШтатноеРасписание.ДатаУтверждения <= ОтборПозицийШтатногоРасписания.Дата
				|	И (НЕ ШтатноеРасписание.Закрыта
				|			ИЛИ ШтатноеРасписание.ДатаЗакрытия > ОтборПозицийШтатногоРасписания.Дата)
				|{ГДЕ
				|	ШтатноеРасписание.Владелец.* КАК Организация,
				|	ШтатноеРасписание.Подразделение.*,
				|	ШтатноеРасписание.Должность.*,
				|	ШтатноеРасписание.Ссылка.* КАК ПозицияШтатногоРасписания}
				|
				|ИНДЕКСИРОВАТЬ ПО
				|	ПозицияШтатногоРасписания,
				|	Период";
				
		КонецЕсли;
			
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТВсеОтобранныеПозицииНаДатуАктуальности", ИмяВТОтбораПозиций);
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ОтборПозицийШтатногоРасписания.Дата", "ОтборПозицийШтатногоРасписания." + ИменаРеквизитов.Дата);
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ОтборПозицийШтатногоРасписания.ПозицияШтатногоРасписания", "ОтборПозицийШтатногоРасписания." + ИменаРеквизитов.Позиция);
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТОтбораПозицийШтатногоРасписания", ИмяВТОтбораПозицийШтатногоРасписания);
		
		ТекстЗапроса = ТекстЗапроса + ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов();
		
	Иначе
		ИменаРеквизитовТаблицыОтбора = ИменаРеквизитов;
		ИмяВТОтбораПозиций = ИмяВТОтбораПозицийШтатногоРасписания;
		ТекстЗапроса = "";
	КонецЕсли;
	
	ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТВсеПозицииНаДатуАктуальности", "СтруктурнаяЕдиница");
	Если ПодобратьПоДатеАктуальности Тогда
		ОписаниеФильтра.СоответствиеИзмеренийРегистраИзмерениямФильтра.Вставить("СтруктурнаяЕдиница", "ПозицияШтатногоРасписания.Подразделение");
	Иначе
		ОписаниеФильтра.СоответствиеИзмеренийРегистраИзмерениямФильтра.Вставить("СтруктурнаяЕдиница", ИменаРеквизитовТаблицыОтбора.Позиция + ".Подразделение");
	КонецЕсли;
	
	ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТВсеПозицииНаДатуАктуальности", "Должность");
	Если ПодобратьПоДатеАктуальности Тогда
		ОписаниеФильтра.СоответствиеИзмеренийРегистраИзмерениямФильтра.Вставить("Должность", "ПозицияШтатногоРасписания");
	Иначе
		ОписаниеФильтра.СоответствиеИзмеренийРегистраИзмерениямФильтра.Вставить("Должность", ИменаРеквизитовТаблицыОтбора.Позиция);
	КонецЕсли;
	
	ИмяВТКлассыУсловийТрудаПоДолжностямСрезПоследних = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТКлассыУсловийТрудаПоДолжностямСрезПоследних");
	
	ЗапросВТКлассыУсловийТрудаПоДолжностямСрез = ЗарплатаКадрыОбщиеНаборыДанных.ЗапросВТИмяРегистраСрез(
		"КлассыУсловийТрудаПоДолжностям",
		ТолькоРазрешенные,
		ОписаниеФильтра,
		,
		Истина,
		"ВТКлассыУсловийТрудаПоДолжностям");
		
	ЗарплатаКадрыОбщиеНаборыДанных.СкопироватьПараметрыЗапроса(Запрос, ЗапросВТКлассыУсловийТрудаПоДолжностямСрез);
	
	ИспользоватьТарифныеСеткиПриРасчетеЗарплаты = ПолучитьФункциональнуюОпцию("ИспользоватьТарифныеСеткиПриРасчетеЗарплаты");
	Запрос.УстановитьПараметр("ИспользоватьТарифныеСеткиПриРасчетеЗарплаты", ИспользоватьТарифныеСеткиПриРасчетеЗарплаты);
	
	Запрос.УстановитьПараметр("ИспользоватьНадбавкуЗаВредность", ПолучитьФункциональнуюОпцию("ИспользоватьНадбавкуЗаВредность"));
	
	Запрос.УстановитьПараметр("ИспользоватьРазрядыКатегорииКлассыДолжностей", 
		ИспользоватьТарифныеСеткиПриРасчетеЗарплаты ИЛИ ПолучитьФункциональнуюОпцию("ИспользоватьПриОписанииПозицииШтатногоРасписанияРазрядыКатегорииКлассыДолжностейИПрофессий"));
		
	Запрос.УстановитьПараметр("ИспользоватьКвалификационнуюНадбавку", ПолучитьФункциональнуюОпцию("ИспользоватьКвалификационнуюНадбавку"));
	
	ИмяВТМестоПозицииВСтруктуреПредприятия = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТМестоПозицииВСтруктуреПредприятия");
	
	ТекстЗапросаВТМестоПозицииВСтруктуреПредприятия = ТекстЗапросаВТМестоПозицииВСтруктуреПредприятия(Запрос);
	
	ТекстЗапроса = 
		?(ПустаяСтрока(ТекстЗапроса), "", ТекстЗапроса)
		+ ЗапросВТКлассыУсловийТрудаПоДолжностямСрез.Текст
		+ ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов()
		+ ТекстЗапросаВТМестоПозицииВСтруктуреПредприятия
		+ ЗарплатаКадрыОбщиеНаборыДанных.РазделительЗапросов();
	
	Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
		
		ТекстЗапроса = ТекстЗапроса
			+	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
			 	|	ВсеПозицииНаДатуАктуальности.Период КАК Период,
			 	|	ИсторияИспользованияШтатногоРасписания.Регистратор,
			 	|	ИсторияИспользованияШтатногоРасписания.Дата КАК Дата,
			 	|	ВсеПозицииНаДатуАктуальности.СледующаяДата КАК СледующаяДата,
			 	|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			 	|	ВЫРАЗИТЬ(ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания КАК Справочник.ШтатноеРасписание).Наименование КАК Наименование,
			 	|	ИсторияИспользованияШтатногоРасписания.КоличествоСтавок,
			 	|	ИсторияИспользованияШтатногоРасписания.ГрафикРаботыСотрудников,
			 	|	ИсторияИспользованияШтатногоРасписания.УсловияПриема,
			 	|	ИсторияИспользованияШтатногоРасписания.СпособОтраженияЗарплатыВБухучете,
			 	|	ИсторияИспользованияШтатногоРасписания.СтатьяФинансирования,
			 	|	ВЫБОР
			 	|		КОГДА &ИспользоватьТарифныеСеткиПриРасчетеЗарплаты = ИСТИНА
			 	|			ТОГДА ИсторияИспользованияШтатногоРасписания.ТарифнаяСетка
			 	|		ИНАЧЕ ВЫБОР
			 	|				КОГДА ИсторияИспользованияШтатногоРасписания.ТарифнаяСетка ЕСТЬ NULL 
			 	|					ТОГДА NULL
			 	|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТарифныеСетки.ПустаяСсылка)
			 	|			КОНЕЦ
			 	|	КОНЕЦ КАК ТарифнаяСетка,
			 	|	ВЫБОР
			 	|		КОГДА &ИспользоватьТарифныеСеткиПриРасчетеЗарплаты = ИСТИНА
			 	|			ТОГДА ИсторияИспользованияШтатногоРасписания.ТарифнаяСеткаНадбавки
			 	|		ИНАЧЕ ВЫБОР
			 	|				КОГДА ИсторияИспользованияШтатногоРасписания.ТарифнаяСеткаНадбавки ЕСТЬ NULL 
			 	|					ТОГДА NULL
			 	|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТарифныеСетки.ПустаяСсылка)
			 	|			КОНЕЦ
			 	|	КОНЕЦ КАК ТарифнаяСеткаНадбавки,
			 	|	ИсторияИспользованияШтатногоРасписания.ФОТ,
			 	|	ИсторияИспользованияШтатногоРасписания.ФОТМин,
			 	|	ИсторияИспользованияШтатногоРасписания.ФОТМакс,
			 	|	ИсторияИспользованияШтатногоРасписания.НадбавкаЗаВредностьРазмер,
			 	|	ИсторияИспользованияШтатногоРасписания.НадбавкаЗаВредностьРазмерМин,
			 	|	ИсторияИспользованияШтатногоРасписания.НадбавкаЗаВредностьРазмерМакс,
			 	|	ИсторияИспользованияШтатногоРасписания.ОкладТариф,
			 	|	ИсторияИспользованияШтатногоРасписания.ОкладТарифМин,
			 	|	ИсторияИспользованияШтатногоРасписания.ОкладТарифМакс,
			 	|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Владелец КАК Организация,
			 	|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Подразделение КАК Подразделение,
			 	|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Должность КАК Должность,
			 	|	ВЫБОР
			 	|		КОГДА &ИспользоватьРазрядыКатегорииКлассыДолжностей = ИСТИНА
			 	|			ТОГДА ИсторияИспользованияШтатногоРасписания.РазрядКатегория
			 	|		ИНАЧЕ ВЫБОР
			 	|				КОГДА ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания ЕСТЬ NULL 
			 	|					ТОГДА NULL
			 	|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.РазрядыКатегорииДолжностей.ПустаяСсылка)
			 	|			КОНЕЦ
			 	|	КОНЕЦ КАК РазрядКатегория,
			 	|	ВЫБОР
			 	|		КОГДА &ИспользоватьКвалификационнуюНадбавку
			 	|			ТОГДА ИсторияИспользованияШтатногоРасписания.РазрядКатегорияНадбавки
			 	|		ИНАЧЕ ВЫБОР
			 	|				КОГДА ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания ЕСТЬ NULL 
			 	|					ТОГДА NULL
			 	|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.РазрядыКатегорииДолжностей.ПустаяСсылка)
			 	|			КОНЕЦ
			 	|	КОНЕЦ КАК РазрядКатегорияНадбавки,
			 	|	ВЫБОР
			 	|		КОГДА НЕ &ИспользоватьНадбавкуЗаВредность
			 	|			ТОГДА ЛОЖЬ
			 	|		ИНАЧЕ ИсторияИспользованияШтатногоРасписания.ВыплачиваетсяНадбавкаЗаВредность
			 	|	КОНЕЦ КАК ВыплачиваетсяНадбавкаЗаВредность,
			 	|	ВЫБОР
			 	|		КОГДА ИсторияИспользованияШтатногоРасписания.ВыплачиваетсяНадбавкаЗаВредность
			 	|			ТОГДА ИсторияИспользованияШтатногоРасписания.ПроцентНадбавкиЗаВредность
			 	|		ИНАЧЕ 0
			 	|	КОНЕЦ КАК ПроцентНадбавкиЗаВредность,
			 	|	МестоПозицииВСтруктуреПредприятия.МестоВСтруктуреПредприятия,
			 	|	КлассыУсловийТрудаПоДолжностям.КлассУсловийТруда,
			 	|	КлассыУсловийТрудаПоДолжностям.ПериодЗаписи КАК КлассУсловийТрудаПериод,
			 	|	КлассыУсловийТрудаПоДолжностям.ДатаРегистрацииИзменений КАК КлассУсловийТрудаДатаРегистрацииИзменений
			 	|ПОМЕСТИТЬ ВТПозицииШтатногоРасписания
			 	|ИЗ
			 	|	ВТВсеПозицииНаДатуАктуальности КАК ВсеПозицииНаДатуАктуальности
			 	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписания
			 	|		ПО ВсеПозицииНаДатуАктуальности.Дата = ИсторияИспользованияШтатногоРасписания.Дата
			 	|			И ВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания = ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания
			 	|			И (ИсторияИспользованияШтатногоРасписания.Используется)
			 	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТКлассыУсловийТрудаПоДолжностям КАК КлассыУсловийТрудаПоДолжностям
			 	|		ПО ВсеПозицииНаДатуАктуальности.Период = КлассыУсловийТрудаПоДолжностям.Период
			 	|			И ВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания = КлассыУсловийТрудаПоДолжностям.Должность
			 	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМестоПозицииВСтруктуреПредприятия КАК МестоПозицииВСтруктуреПредприятия
			 	|		ПО ВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания = МестоПозицииВСтруктуреПредприятия.Позиция
			 	|{ГДЕ
			 	|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Владелец.* КАК Организация,
			 	|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Подразделение.* КАК Подразделение,
			 	|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.Должность.* КАК Должность,
			 	|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания.*}
			 	|
			 	|ИНДЕКСИРОВАТЬ ПО
			 	|	Период,
			 	|	ПозицияШтатногоРасписания";
		
	Иначе
		
		ТекстЗапроса = ТекстЗапроса
			+	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
			 	|	ВсеПозицииНаДатуАктуальности.Период КАК Период,
			 	|	НЕОПРЕДЕЛЕНО КАК Регистратор,
			 	|	ШтатноеРасписание.ДатаУтверждения КАК Дата,
			 	|	ВсеПозицииНаДатуАктуальности.СледующаяДата КАК СледующаяДата,
			 	|	ШтатноеРасписание.Ссылка КАК ПозицияШтатногоРасписания,
			 	|	ШтатноеРасписание.Наименование КАК Наименование,
			 	|	ШтатноеРасписание.КоличествоСтавок,
			 	|	ШтатноеРасписание.ГрафикРаботыСотрудников,
			 	|	ШтатноеРасписание.УсловияПриема,
			 	|	ШтатноеРасписание.СпособОтраженияЗарплатыВБухучете,
			 	|	ШтатноеРасписание.СтатьяФинансирования,
			 	|	ВЫБОР
			 	|		КОГДА &ИспользоватьТарифныеСеткиПриРасчетеЗарплаты = ИСТИНА
			 	|			ТОГДА ШтатноеРасписание.ТарифнаяСетка
			 	|		ИНАЧЕ ВЫБОР
			 	|				КОГДА ШтатноеРасписание.ТарифнаяСетка ЕСТЬ NULL 
			 	|					ТОГДА NULL
			 	|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТарифныеСетки.ПустаяСсылка)
			 	|			КОНЕЦ
			 	|	КОНЕЦ КАК ТарифнаяСетка,
			 	|	ВЫБОР
			 	|		КОГДА &ИспользоватьТарифныеСеткиПриРасчетеЗарплаты = ИСТИНА
			 	|			ТОГДА ШтатноеРасписание.ТарифнаяСеткаНадбавки
			 	|		ИНАЧЕ ВЫБОР
			 	|				КОГДА ШтатноеРасписание.ТарифнаяСеткаНадбавки ЕСТЬ NULL 
			 	|					ТОГДА NULL
			 	|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ТарифныеСетки.ПустаяСсылка)
			 	|			КОНЕЦ
			 	|	КОНЕЦ КАК ТарифнаяСеткаНадбавки,
			 	|	ШтатноеРасписание.ФОТ,
			 	|	ШтатноеРасписание.ФОТМин,
			 	|	ШтатноеРасписание.ФОТМакс,
			 	|	ШтатноеРасписание.НадбавкаЗаВредностьРазмер,
			 	|	ШтатноеРасписание.НадбавкаЗаВредностьРазмерМин,
			 	|	ШтатноеРасписание.НадбавкаЗаВредностьРазмерМакс,
			 	|	ШтатноеРасписание.ОкладТариф,
			 	|	ШтатноеРасписание.ОкладТарифМин,
			 	|	ШтатноеРасписание.ОкладТарифМакс,
			 	|	ШтатноеРасписание.Владелец КАК Организация,
			 	|	ШтатноеРасписание.Подразделение КАК Подразделение,
			 	|	ШтатноеРасписание.Должность КАК Должность,
			 	|	ВЫБОР
			 	|		КОГДА &ИспользоватьРазрядыКатегорииКлассыДолжностей = ИСТИНА
			 	|			ТОГДА ШтатноеРасписание.РазрядКатегория
			 	|		ИНАЧЕ ВЫБОР
			 	|				КОГДА ШтатноеРасписание.РазрядКатегория ЕСТЬ NULL 
			 	|					ТОГДА NULL
			 	|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.РазрядыКатегорииДолжностей.ПустаяСсылка)
			 	|			КОНЕЦ
			 	|	КОНЕЦ КАК РазрядКатегория,
			 	|	ВЫБОР
			 	|		КОГДА &ИспользоватьКвалификационнуюНадбавку
			 	|			ТОГДА ШтатноеРасписание.РазрядКатегорияНадбавки
			 	|		ИНАЧЕ ВЫБОР
			 	|				КОГДА ШтатноеРасписание.РазрядКатегорияНадбавки ЕСТЬ NULL 
			 	|					ТОГДА NULL
			 	|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.РазрядыКатегорииДолжностей.ПустаяСсылка)
			 	|			КОНЕЦ
			 	|	КОНЕЦ КАК РазрядКатегорияНадбавки,
			 	|	ВЫБОР
			 	|		КОГДА НЕ &ИспользоватьНадбавкуЗаВредность
			 	|			ТОГДА ЛОЖЬ
			 	|		ИНАЧЕ ШтатноеРасписание.ВыплачиваетсяНадбавкаЗаВредность
			 	|	КОНЕЦ КАК ВыплачиваетсяНадбавкаЗаВредность,
			 	|	ВЫБОР
			 	|		КОГДА ШтатноеРасписание.ВыплачиваетсяНадбавкаЗаВредность
			 	|			ТОГДА ШтатноеРасписание.ПроцентНадбавкиЗаВредность
			 	|		ИНАЧЕ 0
			 	|	КОНЕЦ КАК ПроцентНадбавкиЗаВредность,
			 	|	МестоПозицииВСтруктуреПредприятия.МестоВСтруктуреПредприятия,
			 	|	КлассыУсловийТрудаПоДолжностям.КлассУсловийТруда,
			 	|	КлассыУсловийТрудаПоДолжностям.ПериодЗаписи КАК КлассУсловийТрудаПериод,
			 	|	КлассыУсловийТрудаПоДолжностям.ДатаРегистрацииИзменений КАК КлассУсловийТрудаДатаРегистрацииИзменений
			 	|ПОМЕСТИТЬ ВТПозицииШтатногоРасписания
			 	|ИЗ
			 	|	ВТВсеПозицииНаДатуАктуальности КАК ВсеПозицииНаДатуАктуальности
			 	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
			 	|		ПО ВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания = ШтатноеРасписание.Ссылка
			 	|			И (ШтатноеРасписание.Утверждена)
			 	|			И ВсеПозицииНаДатуАктуальности.Период >= ШтатноеРасписание.ДатаУтверждения
			 	|			И (НЕ ШтатноеРасписание.Закрыта
			 	|				ИЛИ ВсеПозицииНаДатуАктуальности.Период < ШтатноеРасписание.ДатаЗакрытия)
			 	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТКлассыУсловийТрудаПоДолжностям КАК КлассыУсловийТрудаПоДолжностям
			 	|		ПО ВсеПозицииНаДатуАктуальности.Период = КлассыУсловийТрудаПоДолжностям.Период
			 	|			И ВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания = КлассыУсловийТрудаПоДолжностям.Должность
			 	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМестоПозицииВСтруктуреПредприятия КАК МестоПозицииВСтруктуреПредприятия
			 	|		ПО ВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания = МестоПозицииВСтруктуреПредприятия.Позиция
			 	|{ГДЕ
			 	|	ШтатноеРасписание.Владелец.* КАК Организация,
			 	|	ШтатноеРасписание.Подразделение.*,
			 	|	ШтатноеРасписание.Должность.*,
			 	|	ШтатноеРасписание.Ссылка.* КАК ПозицияШтатногоРасписания}
			 	|
			 	|ИНДЕКСИРОВАТЬ ПО
			 	|	Период,
			 	|	ПозицияШтатногоРасписания";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТВсеПозицииНаДатуАктуальности", ИмяВТОтбораПозиций);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТКлассыУсловийТрудаПоДолжностям", ИмяВТКлассыУсловийТрудаПоДолжностямСрезПоследних);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВсеПозицииНаДатуАктуальности.Дата", "ВсеПозицииНаДатуАктуальности." + ИменаРеквизитовТаблицыОтбора.Дата);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВсеПозицииНаДатуАктуальности.ПозицияШтатногоРасписания", "ВсеПозицииНаДатуАктуальности." + ИменаРеквизитовТаблицыОтбора.Позиция);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТПозицииШтатногоРасписания", ИмяВТПозицииШтатногоРасписания);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТМестоПозицииВСтруктуреПредприятия", ИмяВТМестоПозицииВСтруктуреПредприятия);
	
	Если НЕ ТолькоРазрешенные Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВЫБРАТЬ РАЗРЕШЕННЫЕ", "ВЫБРАТЬ");
	КонецЕсли; 
		
	Запрос.Текст = ТекстЗапроса;
	
	Возврат Запрос;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// Получение данных позиции штатного расписания.

Функция ОписаниеПозицииШтатногоРасписания() Экспорт
	
	ДанныеПозиции = Новый Структура();
	ДанныеПозиции.Вставить("Дата", '00010101');
	ДанныеПозиции.Вставить("СледующаяДата", '00010101');
	ДанныеПозиции.Вставить("ПозицияШтатногоРасписания");
	ДанныеПозиции.Вставить("Наименование", "");
	ДанныеПозиции.Вставить("Организация");
	ДанныеПозиции.Вставить("Подразделение");
	ДанныеПозиции.Вставить("МестоВСтруктуреПредприятия");
	ДанныеПозиции.Вставить("Должность");
	ДанныеПозиции.Вставить("РазрядКатегория");
	ДанныеПозиции.Вставить("РазрядКатегорияНадбавки");
	ДанныеПозиции.Вставить("ГрафикРаботыСотрудников");
	ДанныеПозиции.Вставить("КоличествоСтавок", 0);
	ДанныеПозиции.Вставить("ОкладТариф", 0);
	ДанныеПозиции.Вставить("ОкладТарифМин", 0);
	ДанныеПозиции.Вставить("ОкладТарифМакс", 0);
	ДанныеПозиции.Вставить("ФОТ", 0);
	ДанныеПозиции.Вставить("ФОТМин", 0);
	ДанныеПозиции.Вставить("ФОТМакс", 0);
	ДанныеПозиции.Вставить("НадбавкаЗаВредностьРазмер", 0);
	ДанныеПозиции.Вставить("НадбавкаЗаВредностьРазмерМин", 0);
	ДанныеПозиции.Вставить("НадбавкаЗаВредностьРазмерМакс", 0);
	ДанныеПозиции.Вставить("УсловияПриема", "");
	ДанныеПозиции.Вставить("Начисления", Новый Массив);
	ДанныеПозиции.Вставить("НезависимыеПоказатели", Новый Массив);
	ДанныеПозиции.Вставить("ЕжегодныеОтпуска", Новый Массив);
	ДанныеПозиции.Вставить("Специальности", Новый Массив);
	ДанныеПозиции.Вставить("ПрименятьСевернуюНадбавку", Ложь);
	ДанныеПозиции.Вставить("ПроцентСевернойНадбавки", 0);
	ДанныеПозиции.Вставить("СпособОтраженияЗарплатыВБухучете");
	ДанныеПозиции.Вставить("СтатьяФинансирования");
	ДанныеПозиции.Вставить("ТарифнаяСетка");
	ДанныеПозиции.Вставить("ТарифнаяСеткаНадбавки");
	ДанныеПозиции.Вставить("ВыплачиваетсяНадбавкаЗаВредность", Ложь);
	ДанныеПозиции.Вставить("ПроцентНадбавкиЗаВредность", 0);
	ДанныеПозиции.Вставить("КлассУсловийТруда");
	ДанныеПозиции.Вставить("КлассУсловийТрудаПериод");
	ДанныеПозиции.Вставить("КлассУсловийТрудаДатаРегистрацииИзменений");
	
	Возврат ДанныеПозиции;
	
КонецФункции

Функция ОписаниеНачисленияПозицииШтатногоРасписания()
	
	СтруктураНачисления = Новый Структура;
	СтруктураНачисления.Вставить("ИдентификаторСтрокиВидаРасчета", 0);
	СтруктураНачисления.Вставить("Размер", 0);
	СтруктураНачисления.Вставить("РазмерМин", 0);
	СтруктураНачисления.Вставить("РазмерМакс", 0);
	СтруктураНачисления.Вставить("Начисление", ПланыВидовРасчета.Начисления.ПустаяСсылка());
	СтруктураНачисления.Вставить("Показатели", Новый Массив);
	Возврат СтруктураНачисления;
	
КонецФункции

Функция ОписаниеПоказателяШтатногоРасписания()
	
	СтруктураПоказателя = Новый Структура;
	СтруктураПоказателя.Вставить("ИдентификаторСтрокиВидаРасчета", 0);
	СтруктураПоказателя.Вставить("Значение", 0);
	СтруктураПоказателя.Вставить("ЗначениеМин", 0);
	СтруктураПоказателя.Вставить("ЗначениеМакс", 0);
	СтруктураПоказателя.Вставить("Показатель", Справочники.ПоказателиРасчетаЗарплаты.ПустаяСсылка());
	Возврат СтруктураПоказателя;
	
КонецФункции

Функция ОписаниеЕжегодногоОтпускаПозицииШтатногоРасписания()
	
	СтруктураОтпуска = Новый Структура("КоличествоДнейВГод", 0);
	СтруктураОтпуска.Вставить("ВидЕжегодногоОтпуска", Справочники.ВидыОтпусков.ПустаяСсылка());
	Возврат СтруктураОтпуска;
	
КонецФункции

Функция ОписаниеСпециальностиПозицииШтатногоРасписания()
	
	СтруктураСпециальности = Новый Структура("Специальность", Справочники.КлассификаторСпециальностейПоОбразованию.ПустаяСсылка());
	
	Возврат СтруктураСпециальности;

КонецФункции

Функция ДанныеПозицииШтатногоРасписания(Позиция, ДатаПозиции = '00010101', ЗаполнятьОписаниеНачислений = Истина, ПолноеОписаниеНачислений = Истина) Экспорт
	
	ДанныеПозиций = ДанныеПозицийШтатногоРасписания(Истина, Позиция, ДатаПозиции, ЗаполнятьОписаниеНачислений, ПолноеОписаниеНачислений);
	ДанныеПозиции = ДанныеПозиций.Получить(Позиция);
	
	Если ДанныеПозиции = Неопределено Тогда
		
		ДанныеПозиции = ОписаниеПозицииШтатногоРасписания();
		
		СвойстваПозиции = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Позиция, "Владелец,Подразделение,Должность");
		
		ДанныеПозиции.ПозицияШтатногоРасписания = Позиция;
		ДанныеПозиции.Организация = СвойстваПозиции.Владелец;
		ДанныеПозиции.Подразделение = СвойстваПозиции.Подразделение;
		ДанныеПозиции.Должность = СвойстваПозиции.Должность;
		
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.ОрганизационнаяСтруктура") Тогда
			Модуль = ОбщегоНазначения.ОбщийМодуль("ОрганизационнаяСтруктура");
			ДанныеПозиции.МестоВСтруктуреПредприятия = Модуль.МестоПозицииВСтруктуреПредприятия(Позиция);
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат ДанныеПозиции;
	
КонецФункции

Функция ДанныеПозицийШтатногоРасписания(ТолькоРазрешенные, Позиции = Неопределено, ДатаАктуальности = '00010101', ЗаполнятьОписаниеНачислений = Истина, ПолноеОписаниеНачислений = Истина) Экспорт
	
	СоответствиеДанныхПозициям = Новый Соответствие;
	
	Если ТипЗнч(Позиции) = Тип("СправочникСсылка.ШтатноеРасписание") Тогда
		СписокПозиций = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(Позиции);
	Иначе
		СписокПозиций = Позиции;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	ИмяВТПозицииШтатногоРасписания = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТПозицииШтатногоРасписания");
	
	ПараметрыПолученияПозиций = ПараметрыПолученияПозицийШтатногоРасписания();
	ПараметрыПолученияПозиций.ПозицииШтатногоРасписания = Позиции;
	ПараметрыПолученияПозиций.ДатаАктуальности = ДатаАктуальности;
	
	СоздатьВТПозицииШтатногоРасписания(ТолькоРазрешенные, Запрос.МенеджерВременныхТаблиц, ИмяВТПозицииШтатногоРасписания, ПараметрыПолученияПозиций);
	
	Запрос.Текст =
		"ВЫБРАТЬ Т.* ИЗ " + ИмяВТПозицииШтатногоРасписания + " КАК Т";
	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		ДанныеПозиции = ОписаниеПозицииШтатногоРасписания();
		ЗаполнитьЗначенияСвойств(ДанныеПозиции, Выборка);
		СоответствиеДанныхПозициям.Вставить(Выборка.ПозицияШтатногоРасписания, ДанныеПозиции);
	КонецЦикла;
	
	Если СписокПозиций <> Неопределено Тогда
		
		ПозицииБезДанных = Новый Массив;
		Для каждого Позиция Из СписокПозиций Цикл
			
			Если СоответствиеДанныхПозициям.Получить(Позиция) = Неопределено Тогда
				ПозицииБезДанных.Добавить(Позиция);
			КонецЕсли;
			
		КонецЦикла;
		
		Если ПозицииБезДанных.Количество() > 0 Тогда
			
			СвойстваПозиций = ОбщегоНазначения.ЗначенияРеквизитовОбъектов(ПозицииБезДанных, "Владелец,Подразделение,Должность");
			Для каждого Позиция Из ПозицииБезДанных Цикл
				
				ДанныеПозиции = ОписаниеПозицииШтатногоРасписания();
				
				СвойстваПозиции = СвойстваПозиций.Получить(Позиция);
				
				ДанныеПозиции.ПозицияШтатногоРасписания = Позиция;
				ДанныеПозиции.Организация = СвойстваПозиции.Владелец;
				ДанныеПозиции.Подразделение = СвойстваПозиции.Подразделение;
				ДанныеПозиции.Должность = СвойстваПозиции.Должность;
				
				СоответствиеДанныхПозициям.Вставить(Позиция, ДанныеПозиции);
				
			КонецЦикла;
			
		КонецЕсли;
		
	КонецЕсли;
	
	Если ЗаполнятьОписаниеНачислений Тогда
	
		ОписательВременныхТаблиц = ОписательВременныхТаблицДляПолученияДанныхПозицийШтатногоРасписания(
			Запрос.МенеджерВременныхТаблиц,
			ИмяВТПозицииШтатногоРасписания);
		
		// Начисления позиций
		
		ИмяВТНачисленияПозицийШтатногоРасписания = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТНачисленияПозицийШтатногоРасписания");
		СоздатьВТНачисленияПозицийШтатногоРасписания(ТолькоРазрешенные, ОписательВременныхТаблиц, ИмяВТНачисленияПозицийШтатногоРасписания, ПолноеОписаниеНачислений);
		
		Запрос.Текст =
			"ВЫБРАТЬ
			|	НачисленияПозицийШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	НачисленияПозицийШтатногоРасписания.Начисление КАК Начисление,
			|	НачисленияПозицийШтатногоРасписания.Размер КАК Размер,
			|	НачисленияПозицийШтатногоРасписания.РазмерМин КАК РазмерМин,
			|	НачисленияПозицийШтатногоРасписания.РазмерМакс КАК РазмерМакс,
			|	НачисленияПозицийШтатногоРасписания.Показатель КАК Показатель,
			|	НачисленияПозицийШтатногоРасписания.Значение КАК Значение,
			|	НачисленияПозицийШтатногоРасписания.ЗначениеМин КАК ЗначениеМин,
			|	НачисленияПозицийШтатногоРасписания.ЗначениеМакс КАК ЗначениеМакс,
			|	НачисленияПозицийШтатногоРасписания.ИдентификаторСтрокиВидаРасчета КАК ИдентификаторСтрокиВидаРасчета
			|ИЗ
			|	ВТНачисленияПозицийШтатногоРасписания КАК НачисленияПозицийШтатногоРасписания
			|ГДЕ
			|	НачисленияПозицийШтатногоРасписания.Начисление <> ЗНАЧЕНИЕ(ПланВидовРасчета.Начисления.ПустаяСсылка)
			|
			|УПОРЯДОЧИТЬ ПО
			|	ВЫРАЗИТЬ(НачисленияПозицийШтатногоРасписания.Начисление КАК ПланВидовРасчета.Начисления).РеквизитДопУпорядочивания
			|ИТОГИ
			|	МАКСИМУМ(Размер),
			|	МАКСИМУМ(РазмерМин),
			|	МАКСИМУМ(РазмерМакс),
			|	МАКСИМУМ(ИдентификаторСтрокиВидаРасчета)
			|ПО
			|	ПозицияШтатногоРасписания,
			|	Начисление";
		
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "ВТНачисленияПозицийШтатногоРасписания", ИмяВТНачисленияПозицийШтатногоРасписания);
		
		ВыборкаПоПозициям = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаПоПозициям.Следующий() Цикл
			
			ДанныеПозиции = СоответствиеДанныхПозициям.Получить(ВыборкаПоПозициям.ПозицияШтатногоРасписания);
			
			ВыборкаПоНачислениям = ВыборкаПоПозициям.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			Пока ВыборкаПоНачислениям.Следующий() Цикл
				
				СтруктураНачисления = ОписаниеНачисленияПозицииШтатногоРасписания();
				ЗаполнитьЗначенияСвойств(СтруктураНачисления, ВыборкаПоНачислениям);
				
				ИнформацияОНачислении = ЗарплатаКадрыРасширенныйПовтИсп.ПолучитьИнформациюОВидеРасчета(ВыборкаПоНачислениям.Начисление);
				
				ВыборкаПоПоказателям = ВыборкаПоНачислениям.Выбрать();
				Пока ВыборкаПоПоказателям.Следующий() Цикл
					
					Если ЗначениеЗаполнено(ВыборкаПоПоказателям.Показатель) Тогда
						
						ДобавитьПоказатель = Ложь;
						Для каждого СтруктураПоказателя Из ИнформацияОНачислении.Показатели Цикл
							
							Если СтруктураПоказателя.Показатель = ВыборкаПоПоказателям.Показатель Тогда
								ДобавитьПоказатель = СтруктураПоказателя.ЗапрашиватьПриВводе;
								Прервать;
							КонецЕсли;
							
						КонецЦикла;
						
						Если НЕ ДобавитьПоказатель Тогда
							Продолжить;
						КонецЕсли;
						
						СтруктураПоказателя = ОписаниеПоказателяШтатногоРасписания();
						ЗаполнитьЗначенияСвойств(СтруктураПоказателя, ВыборкаПоПоказателям);
						СтруктураНачисления.Показатели.Добавить(СтруктураПоказателя);
						
					КонецЕсли;
					
				КонецЦикла;
				
				ДанныеПозиции.Начисления.Добавить(СтруктураНачисления);
				
			КонецЦикла;
			
			СоответствиеДанныхПозициям.Вставить(ВыборкаПоПозициям.ПозицияШтатногоРасписания, ДанныеПозиции);
			
		КонецЦикла;
		
		// Независимые показатели позиций.
		
		Запрос.Текст =
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	НачисленияПозицийШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	НачисленияПозицийШтатногоРасписания.Показатель КАК Показатель,
			|	НачисленияПозицийШтатногоРасписания.Значение КАК Значение,
			|	НачисленияПозицийШтатногоРасписания.ЗначениеМин КАК ЗначениеМин,
			|	НачисленияПозицийШтатногоРасписания.ЗначениеМакс КАК ЗначениеМакс,
			|	НачисленияПозицийШтатногоРасписания.ИдентификаторСтрокиВидаРасчета КАК ИдентификаторСтрокиВидаРасчета
			|ИЗ
			|	ВТНачисленияПозицийШтатногоРасписания КАК НачисленияПозицийШтатногоРасписания
			|ГДЕ
			|	НачисленияПозицийШтатногоРасписания.Начисление = ЗНАЧЕНИЕ(ПланВидовРасчета.Начисления.ПустаяСсылка)
			|ИТОГИ ПО
			|	ПозицияШтатногоРасписания";
		
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "ВТНачисленияПозицийШтатногоРасписания", ИмяВТНачисленияПозицийШтатногоРасписания);
		
		ВыборкаПоПозициям = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаПоПозициям.Следующий() Цикл
			
			ДанныеПозиции = СоответствиеДанныхПозициям.Получить(ВыборкаПоПозициям.ПозицияШтатногоРасписания);
			
			ВыборкаПоПоказателям = ВыборкаПоПозициям.Выбрать();
			Пока ВыборкаПоПоказателям.Следующий() Цикл
				
				Если ЗначениеЗаполнено(ВыборкаПоПоказателям.Показатель) Тогда
					
					СтруктураПоказателя = ОписаниеПоказателяШтатногоРасписания();
					ЗаполнитьЗначенияСвойств(СтруктураПоказателя, ВыборкаПоПоказателям);
					ДанныеПозиции.НезависимыеПоказатели.Добавить(СтруктураПоказателя);
					
				КонецЕсли;
				
			КонецЦикла;
			
			СоответствиеДанныхПозициям.Вставить(ВыборкаПоПозициям.ПозицияШтатногоРасписания, ДанныеПозиции);
			
		КонецЦикла;
		
	КонецЕсли;
	
	ОписательВременныхТаблиц = ОписательВременныхТаблицДляПолученияДанныхПозицийШтатногоРасписания(
		Запрос.МенеджерВременныхТаблиц,
		ИмяВТПозицииШтатногоРасписания);
	
	// Ежегодные отпуска позиций
	
	ИмяВТЕжегодныеОтпускаПозицийШтатногоРасписания = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТЕжегодныеОтпускаПозицийШтатногоРасписания");
	СоздатьВТЕжегодныеОтпускаПозицийШтатногоРасписания(ТолькоРазрешенные, ОписательВременныхТаблиц, ИмяВТЕжегодныеОтпускаПозицийШтатногоРасписания);
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ЕжегодныеОтпускаПозицийШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
		|	ЕжегодныеОтпускаПозицийШтатногоРасписания.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ЕжегодныеОтпускаПозицийШтатногоРасписания.КоличествоДнейВГод КАК КоличествоДнейВГод
		|ИЗ
		|	ВТЕжегодныеОтпускаПозицийШтатногоРасписания КАК ЕжегодныеОтпускаПозицийШтатногоРасписания
		|ИТОГИ ПО
		|	ПозицияШтатногоРасписания";
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "ВТЕжегодныеОтпускаПозицийШтатногоРасписания", ИмяВТЕжегодныеОтпускаПозицийШтатногоРасписания);
	
	ВыборкаПоПозициям = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаПоПозициям.Следующий() Цикл
		
		ДанныеПозиции = СоответствиеДанныхПозициям.Получить(ВыборкаПоПозициям.ПозицияШтатногоРасписания);
		
		ВыборкаПоОтпускам = ВыборкаПоПозициям.Выбрать();
		Пока ВыборкаПоОтпускам.Следующий() Цикл
			
			СтруктураОтпуска = ОписаниеЕжегодногоОтпускаПозицииШтатногоРасписания();
			ЗаполнитьЗначенияСвойств(СтруктураОтпуска, ВыборкаПоОтпускам);
			ДанныеПозиции.ЕжегодныеОтпуска.Добавить(СтруктураОтпуска);
			
		КонецЦикла;
		
		СоответствиеДанныхПозициям.Вставить(ВыборкаПоПозициям.ПозицияШтатногоРасписания, ДанныеПозиции);
		
	КонецЦикла;
	
	// Специальности
	
	ИмяВТСпециальностиПозицийШтатногоРасписания = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТСпециальностиПозицийШтатногоРасписания");
	СоздатьВТСпециальностиПозицийШтатногоРасписания(ТолькоРазрешенные, ОписательВременныхТаблиц, ИмяВТСпециальностиПозицийШтатногоРасписания);
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	СпециальностиПозицийШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
		|	СпециальностиПозицийШтатногоРасписания.Специальность КАК Специальность
		|ИЗ
		|	ВТСпециальностиПозицийШтатногоРасписания КАК СпециальностиПозицийШтатногоРасписания
		|ИТОГИ ПО
		|	ПозицияШтатногоРасписания";
	
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "ВТСпециальностиПозицийШтатногоРасписания", ИмяВТСпециальностиПозицийШтатногоРасписания);
	
	ВыборкаПоПозициям = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаПоПозициям.Следующий() Цикл
		
		ДанныеПозиции = СоответствиеДанныхПозициям.Получить(ВыборкаПоПозициям.ПозицияШтатногоРасписания);
		
		ВыборкаПоСпециальностям = ВыборкаПоПозициям.Выбрать();
		Пока ВыборкаПоСпециальностям.Следующий() Цикл
			
			СтруктураСпециальности = ОписаниеСпециальностиПозицииШтатногоРасписания();
			ЗаполнитьЗначенияСвойств(СтруктураСпециальности, ВыборкаПоСпециальностям);
			ДанныеПозиции.Специальности.Добавить(СтруктураСпециальности);
			
		КонецЦикла;
		
		СоответствиеДанныхПозициям.Вставить(ВыборкаПоПозициям.ПозицияШтатногоРасписания, ДанныеПозиции);
		
	КонецЦикла;
	
	Возврат СоответствиеДанныхПозициям;
	
КонецФункции

Функция ЗапросПредставленияШтатноеРасписание(ТолькоРазрешенные, ДатаАктуальности, ИмяВТПредставления_ШтатноеРасписание = "Представления_ШтатноеРасписание", ВключатьНачисления = Истина, ИмяВТОтбораПозицийШтатногоРасписания = "") Экспорт
	
	Если ВключатьНачисления Тогда
		ИмяВТПозицииШтатногоРасписания = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТПозицииШтатногоРасписания");
	Иначе
		ИмяВТПозицииШтатногоРасписания = ИмяВТПредставления_ШтатноеРасписание;
	КонецЕсли;
	
	Если Не ПустаяСтрока(ИмяВТОтбораПозицийШтатногоРасписания) Тогда
		Запрос = ЗапросВТПозицииШтатногоРасписания(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ИмяВТОтбораПозицийШтатногоРасписания, Истина);
	Иначе
		
		ПараметрыПолученияПозиций = УправлениеШтатнымРасписанием.ПараметрыПолученияПозицийШтатногоРасписания();
		ПараметрыПолученияПозиций.ДатаАктуальности = ДатаАктуальности;
		
		Запрос = УправлениеШтатнымРасписанием.ЗапросВТПозицииШтатногоРасписанияПоПараметрам(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ПараметрыПолученияПозиций);
		
	КонецЕсли;
	
	Если ВключатьНачисления Тогда
		
		ИмяВТНачисленияПозицийШтатногоРасписания = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТНачисленияПозицийШтатногоРасписания");
		ЗапросПоНачислениям = УправлениеШтатнымРасписанием.ЗапросВТНачисленияПозицийШтатногоРасписания(
			ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ИмяВТНачисленияПозицийШтатногоРасписания, , Истина);
			
		ЗарплатаКадрыОбщиеНаборыДанных.ОбъединитьЗапросы(Запрос, ЗапросПоНачислениям);
			
		ТекстСводногоЗапроса = 
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
			|	НачисленияПозицийШтатногоРасписания.Период КАК Период,
			|	НачисленияПозицийШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	НачисленияПозицийШтатногоРасписания.Начисление КАК Начисление,
			|	ВЫБОР
			|		КОГДА НачисленияПозицийШтатногоРасписания.Начисление.ВидВремени В (ЗНАЧЕНИЕ(Перечисление.ВидыРабочегоВремениСотрудников.ОтработанноеВПределахНормы), ЗНАЧЕНИЕ(Перечисление.ВидыРабочегоВремениСотрудников.ЧасовоеОтработанноеВПределахНормы))
			|			ТОГДА ИСТИНА
			|		ИНАЧЕ ЛОЖЬ
			|	КОНЕЦ КАК ЭтоТарифнаяСтавка
			|ПОМЕСТИТЬ ВТНачисленияСПризнакомТарифнойСтавки
			|ИЗ
			|	ВТНачисленияПозицийШтатногоРасписания КАК НачисленияПозицийШтатногоРасписания
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Период,
			|	ПозицияШтатногоРасписания,
			|	Начисление
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	НачисленияПозицийШтатногоРасписания.Период КАК Период,
			|	НачисленияПозицийШтатногоРасписания.ПозицияШтатногоРасписания,
			|	НачисленияПозицийШтатногоРасписания.Начисление КАК Начисление,
			|	МАКСИМУМ(ПоказателиЗависящиеОтСтажа.Показатель) КАК Показатель,
			|	МАКСИМУМ(ЕСТЬNULL(ШкалаОценкиСтажа.ЗначениеПоказателя, 0)) КАК Значение
			|ПОМЕСТИТЬ ВТНачисленияСПоказателямиЗависящимиОтСтажа
			|ИЗ
			|	ВТНачисленияПозицийШтатногоРасписания КАК НачисленияПозицийШтатногоРасписания
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовРасчета.Начисления.Показатели КАК ПоказателиЗависящиеОтСтажа
			|		ПО НачисленияПозицийШтатногоРасписания.Начисление = ПоказателиЗависящиеОтСтажа.Ссылка
			|			И (ПоказателиЗависящиеОтСтажа.Показатель.ТипПоказателя = ЗНАЧЕНИЕ(Перечисление.ТипыПоказателейРасчетаЗарплаты.ЧисловойЗависящийОтСтажа))
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПоказателиРасчетаЗарплаты.ШкалаОценкиСтажа КАК ШкалаОценкиСтажа
			|		ПО (ПоказателиЗависящиеОтСтажа.Показатель = ШкалаОценкиСтажа.Ссылка)
			|
			|СГРУППИРОВАТЬ ПО
			|	НачисленияПозицийШтатногоРасписания.Период,
			|	НачисленияПозицийШтатногоРасписания.ПозицияШтатногоРасписания,
			|	НачисленияПозицийШтатногоРасписания.Начисление
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	НачисленияПозицийШтатногоРасписания.Период КАК Период,
			|	НачисленияПозицийШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	МИНИМУМ(ВЫРАЗИТЬ(НачисленияПозицийШтатногоРасписания.Начисление КАК ПланВидовРасчета.Начисления).РеквизитДопУпорядочивания) КАК ЗначениеРеквизитаДопУпорядочивания
			|ПОМЕСТИТЬ ВТПорядокОсновныхНачислений
			|ИЗ
			|	ВТНачисленияСПризнакомТарифнойСтавки КАК НачисленияПозицийШтатногоРасписания
			|ГДЕ
			|	НачисленияПозицийШтатногоРасписания.ЭтоТарифнаяСтавка
			|
			|СГРУППИРОВАТЬ ПО
			|	НачисленияПозицийШтатногоРасписания.Период,
			|	НачисленияПозицийШтатногоРасписания.ПозицияШтатногоРасписания
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	Период,
			|	ПозицияШтатногоРасписания,
			|	ЗначениеРеквизитаДопУпорядочивания
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	НачисленияСПризнакомТарифнойСтавки.Период,
			|	НачисленияСПризнакомТарифнойСтавки.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	НачисленияСПризнакомТарифнойСтавки.Начисление,
			|	ВЫБОР
			|		КОГДА ЕСТЬNULL(НачисленияСПризнакомТарифнойСтавки.ЭтоТарифнаяСтавка, ЛОЖЬ)
			|				И ВЫРАЗИТЬ(НачисленияСПризнакомТарифнойСтавки.Начисление КАК ПланВидовРасчета.Начисления).РеквизитДопУпорядочивания = ПорядокОсновныхНачислений.ЗначениеРеквизитаДопУпорядочивания
			|			ТОГДА ИСТИНА
			|		ИНАЧЕ ЛОЖЬ
			|	КОНЕЦ КАК ЭтоТарифнаяСтавка,
			|	ЕСТЬNULL(НачисленияПозицийШтатногоРасписания.Показатель, НачисленияСПризнакомТарифнойСтавки.Начисление) КАК Показатель,
			|	ЕСТЬNULL(НачисленияПозицийШтатногоРасписания.Размер, 0) КАК Размер,
			|	ЕСТЬNULL(НачисленияПозицийШтатногоРасписания.РазмерМин, 0) КАК РазмерМин,
			|	ЕСТЬNULL(НачисленияПозицийШтатногоРасписания.РазмерМакс, 0) КАК РазмерМакс,
			|	ЕСТЬNULL(ВЫБОР
			|			КОГДА НЕ НачисленияСПоказателямиЗависящимиОтСтажа.Показатель ЕСТЬ NULL 
			|				ТОГДА НачисленияСПоказателямиЗависящимиОтСтажа.Значение
			|			ИНАЧЕ НачисленияПозицийШтатногоРасписания.Значение
			|		КОНЕЦ, 0) КАК Значение,
			|	ЕСТЬNULL(ВЫБОР
			|			КОГДА НЕ НачисленияСПоказателямиЗависящимиОтСтажа.Показатель ЕСТЬ NULL 
			|				ТОГДА НачисленияСПоказателямиЗависящимиОтСтажа.Значение
			|			ИНАЧЕ НачисленияПозицийШтатногоРасписания.ЗначениеМин
			|		КОНЕЦ, 0) КАК ЗначениеМин,
			|	ЕСТЬNULL(ВЫБОР
			|			КОГДА НЕ НачисленияСПоказателямиЗависящимиОтСтажа.Показатель ЕСТЬ NULL 
			|				ТОГДА НачисленияСПоказателямиЗависящимиОтСтажа.Значение
			|			ИНАЧЕ НачисленияПозицийШтатногоРасписания.ЗначениеМакс
			|		КОНЕЦ, 0) КАК ЗначениеМакс
			|ПОМЕСТИТЬ ВТНачисленияСПоказателями
			|ИЗ
			|	ВТНачисленияСПризнакомТарифнойСтавки КАК НачисленияСПризнакомТарифнойСтавки
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачисленияПозицийШтатногоРасписания КАК НачисленияПозицийШтатногоРасписания
			|		ПО НачисленияСПризнакомТарифнойСтавки.Период = НачисленияПозицийШтатногоРасписания.Период
			|			И НачисленияСПризнакомТарифнойСтавки.ПозицияШтатногоРасписания = НачисленияПозицийШтатногоРасписания.ПозицияШтатногоРасписания
			|			И НачисленияСПризнакомТарифнойСтавки.Начисление = НачисленияПозицийШтатногоРасписания.Начисление
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПорядокОсновныхНачислений КАК ПорядокОсновныхНачислений
			|		ПО НачисленияСПризнакомТарифнойСтавки.Период = ПорядокОсновныхНачислений.Период
			|			И НачисленияСПризнакомТарифнойСтавки.ПозицияШтатногоРасписания = ПорядокОсновныхНачислений.ПозицияШтатногоРасписания
			|			И (ВЫРАЗИТЬ(НачисленияСПризнакомТарифнойСтавки.Начисление КАК ПланВидовРасчета.Начисления).РеквизитДопУпорядочивания = ПорядокОсновныхНачислений.ЗначениеРеквизитаДопУпорядочивания)
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
			|		ПО НачисленияСПризнакомТарифнойСтавки.ПозицияШтатногоРасписания = ПозицииШтатногоРасписания.ПозицияШтатногоРасписания
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачисленияСПоказателямиЗависящимиОтСтажа КАК НачисленияСПоказателямиЗависящимиОтСтажа
			|		ПО НачисленияСПризнакомТарифнойСтавки.Период = НачисленияСПоказателямиЗависящимиОтСтажа.Период
			|			И НачисленияСПризнакомТарифнойСтавки.ПозицияШтатногоРасписания = НачисленияСПоказателямиЗависящимиОтСтажа.ПозицияШтатногоРасписания
			|			И НачисленияСПризнакомТарифнойСтавки.Начисление = НачисленияСПоказателямиЗависящимиОтСтажа.Начисление
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	ПозицияШтатногоРасписания
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ПозицииШтатногоРасписания.Период КАК Период,
			|	ПозицииШтатногоРасписания.Организация КАК Организация,
			|	ПозицииШтатногоРасписания.Подразделение КАК Подразделение,
			|	ПозицииШтатногоРасписания.Должность КАК Должность,
			|	ПозицииШтатногоРасписания.ТарифнаяСетка,
			|	ПозицииШтатногоРасписания.РазрядКатегория,
			|	ПозицииШтатногоРасписания.ТарифнаяСеткаНадбавки,
			|	ПозицииШтатногоРасписания.РазрядКатегорияНадбавки,
			|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
			|	ПозицииШтатногоРасписания.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников,
			|	ПозицииШтатногоРасписания.КоличествоСтавок КАК КоличествоСтавок,
			|	ПозицииШтатногоРасписания.СпособОтраженияЗарплатыВБухучете КАК СпособОтраженияЗарплатыВБухучете,
			|	ПозицииШтатногоРасписания.СтатьяФинансирования КАК СтатьяФинансирования,
			|	ЕСТЬNULL(НачисленияСПоказателями.Размер, 0) КАК ФОТ,
			|	ЕСТЬNULL(НачисленияСПоказателями.РазмерМин, 0) КАК ФОТМин,
			|	ЕСТЬNULL(НачисленияСПоказателями.РазмерМакс, 0) КАК ФОТМакс,
			|	ПозицииШтатногоРасписания.ОкладТариф КАК ОкладТариф,
			|	ПозицииШтатногоРасписания.ОкладТарифМин КАК ОкладТарифМин,
			|	ПозицииШтатногоРасписания.ОкладТарифМакс КАК ОкладТарифМакс,
			|	ПозицииШтатногоРасписания.ФОТ КАК ФОТПозиции,
			|	ПозицииШтатногоРасписания.ФОТМин КАК ФОТПозицииМин,
			|	ПозицииШтатногоРасписания.ФОТМакс КАК ФОТПозицииМакс,
			|	ЕСТЬNULL(НачисленияСПоказателями.Начисление, ЗНАЧЕНИЕ(ПланВидовРасчета.Начисления.ПустаяСсылка)) КАК Начисление,
			|	ЕСТЬNULL(НачисленияСПоказателями.Показатель, ЗНАЧЕНИЕ(Справочник.ПоказателиРасчетаЗарплаты.ПустаяСсылка)) КАК Показатель,
			|	ЕСТЬNULL(НачисленияСПоказателями.ЭтоТарифнаяСтавка, ЛОЖЬ) КАК ЭтоТарифнаяСтавка,
			|	ЕСТЬNULL(НачисленияСПоказателями.Значение, 0) КАК Значение,
			|	ЕСТЬNULL(НачисленияСПоказателями.ЗначениеМин, 0) КАК ЗначениеМин,
			|	ЕСТЬNULL(НачисленияСПоказателями.ЗначениеМакс, 0) КАК ЗначениеМакс
			|ПОМЕСТИТЬ Представления_ШтатноеРасписание
			|ИЗ
			|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
			|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачисленияСПоказателями КАК НачисленияСПоказателями
			|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = НачисленияСПоказателями.ПозицияШтатногоРасписания";
			
		ИмяВТНачисленияСПризнакомТарифнойСтавки = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТНачисленияСПризнакомТарифнойСтавки");
		ИмяВТПорядокОсновныхНачислений = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТПорядокОсновныхНачислений");
		ИмяВТНачисленияСПоказателями = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТНачисленияСПоказателями");
		
		ТекстСводногоЗапроса = СтрЗаменить(ТекстСводногоЗапроса, "ВТПозицииШтатногоРасписания", ИмяВТПозицииШтатногоРасписания);
		ТекстСводногоЗапроса = СтрЗаменить(ТекстСводногоЗапроса, "ВТНачисленияПозицийШтатногоРасписания", ИмяВТНачисленияПозицийШтатногоРасписания);
		ТекстСводногоЗапроса = СтрЗаменить(ТекстСводногоЗапроса, "ВТНачисленияСПризнакомТарифнойСтавки", ИмяВТНачисленияСПризнакомТарифнойСтавки);
		ТекстСводногоЗапроса = СтрЗаменить(ТекстСводногоЗапроса, "ВТПорядокОсновныхНачислений", ИмяВТПорядокОсновныхНачислений);
		ТекстСводногоЗапроса = СтрЗаменить(ТекстСводногоЗапроса, "ВТНачисленияСПоказателями", ИмяВТНачисленияСПоказателями);
		ТекстСводногоЗапроса = СтрЗаменить(ТекстСводногоЗапроса, "Представления_ШтатноеРасписание", ИмяВТПредставления_ШтатноеРасписание);
		
		Если НЕ ТолькоРазрешенные Тогда
			ТекстСводногоЗапроса = СтрЗаменить(ТекстСводногоЗапроса, "ВЫБРАТЬ РАЗРЕШЕННЫЕ", "ВЫБРАТЬ");
		КонецЕсли; 
		
		ЗарплатаКадрыОбщиеНаборыДанных.ОбъединитьТекстыЗапросов(Запрос.Текст, ТекстСводногоЗапроса);
		
	КонецЕсли; 
	
	Возврат Запрос;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// Работа с настройками штатного расписания.

// Предназначена для получения настроек системы.
//
// Возвращаемое значение - структура с именем настройки в качестве ключа.
//
Функция НастройкиШтатногоРасписания() Экспорт
	
	НастройкиШтатногоРасписания = РегистрыСведений.НастройкиШтатногоРасписания.СоздатьМенеджерЗаписи();
	НастройкиШтатногоРасписания.Прочитать();
	
	СтруктураНастроек = ОбщегоНазначения.СтруктураПоМенеджеруЗаписи(
							НастройкиШтатногоРасписания, Метаданные.РегистрыСведений.НастройкиШтатногоРасписания);
	
	Если НастройкиШтатногоРасписания.Выбран() Тогда
		Возврат СтруктураНастроек;
	КонецЕсли;
	
	// Если настройки не заполнены, устанавливаем значения по умолчанию.
	
	ЗначенияПоУмолчанию = НастройкиШтатногоРасписанияПоУмолчанию();
	
	Для Каждого КлючИЗначение Из ЗначенияПоУмолчанию Цикл
		СтруктураНастроек.Вставить(КлючИЗначение.Ключ, КлючИЗначение.Значение);
	КонецЦикла;
	
	Возврат СтруктураНастроек;
	
КонецФункции

// Записывает настройки штатного расписания и применяет к базе данных их изменение.
//
// Параметры:
//			Настройки - РегистрыСведений.НастройкиШтатногоРасписания.МенеджерЗаписи
//
Процедура ЗаписатьНастройкиШтатногоРасписания(Настройки) Экспорт
	
	ТекущиеНастройки = НастройкиШтатногоРасписания();
	
	ВключениеИспользованияШтатногоРасписания =
		Настройки.ИспользоватьШтатноеРасписание
		И ТекущиеНастройки.ИспользоватьШтатноеРасписание <> Настройки.ИспользоватьШтатноеРасписание;
		
	ВключениеИспользованияИсторииШтатногоРасписания =
		Настройки.ИспользоватьИсториюИзмененияШтатногоРасписания
		И ТекущиеНастройки.ИспользоватьИсториюИзмененияШтатногоРасписания <> Настройки.ИспользоватьИсториюИзмененияШтатногоРасписания;
		
	ОтключениеИспользованияИсторииШтатногоРасписания =
		НЕ Настройки.ИспользоватьИсториюИзмененияШтатногоРасписания
		И ТекущиеНастройки.ИспользоватьИсториюИзмененияШтатногоРасписания <> Настройки.ИспользоватьИсториюИзмененияШтатногоРасписания;
		
	Попытка
		
		Если ОтключениеИспользованияИсторииШтатногоРасписания Тогда
			ПеренестиСведенияОПозицияхВСправочник();
			Настройки.Записать();
		Иначе
			Настройки.Записать();
			ПрименитьИзменениеНастроекШтатногоРасписания(ВключениеИспользованияШтатногоРасписания, ВключениеИспользованияИсторииШтатногоРасписания);
		КонецЕсли;
	
	Исключение
		
		ОписаниеОшибки = ИнформацияОбОшибке();
		ТекстИсключения = НСтр("ru='Не удалось применить изменение настроек использования штатного расписания.';uk='Не вдалося застосувати зміна настройок використання штатного розкладу.'") + " " + ОписаниеОшибки.Описание;
		
		ЗаполнитьЗначенияСвойств(Настройки, ТекущиеНастройки);
		Настройки.Записать();
		
		ВызватьИсключение ТекстИсключения;
		
	КонецПопытки;
	
КонецПроцедуры

Функция НастройкиШтатногоРасписанияПоУмолчанию() Экспорт 

	ЗначенияПоУмолчанию = Новый Структура;
	ЗначенияПоУмолчанию.Вставить("ИспользоватьШтатноеРасписание", Истина);
	ЗначенияПоУмолчанию.Вставить("НеИспользоватьШтатноеРасписание", Ложь);
	ЗначенияПоУмолчанию.Вставить("ИспользоватьИсториюИзмененияШтатногоРасписания", Ложь);
	ЗначенияПоУмолчанию.Вставить("НеИспользоватьИсториюИзмененияШтатногоРасписания", Истина);
	ЗначенияПоУмолчанию.Вставить("ПроверятьНаСоответствиеШтатномуРасписаниюАвтоматически", Ложь);
	ЗначенияПоУмолчанию.Вставить("ИспользоватьВилкуСтавокВШтатномРасписании", Ложь);
	ЗначенияПоУмолчанию.Вставить("НеИспользоватьВилкуСтавокВШтатномРасписании", Истина);
	ЗначенияПоУмолчанию.Вставить("ИспользоватьПриОписанииПозицииШтатногоРасписанияРазрядыКатегорииКлассыДолжностейИПрофессий", Ложь);
	ЗначенияПоУмолчанию.Вставить("ПредставлениеТарифовИНадбавок", Перечисления.ПредставлениеТарифовИНадбавок.МесячныйРазмерВГривнах);
	ЗначенияПоУмолчанию.Вставить("ИспользоватьБронированиеПозиций", Истина);
	ЗначенияПоУмолчанию.Вставить("ДнейСохраненияБрони", 14);
	
	Возврат ЗначенияПоУмолчанию;

КонецФункции

Процедура ПрименитьИзменениеНастроекШтатногоРасписания(ВключениеИспользованияШтатногоРасписания, ВключениеИспользованияИсторииШтатногоРасписания)
	
	Если ВключениеИспользованияШтатногоРасписания Тогда
		
		// Создание недостающих позиций.
		СоздатьПозицииШтатногоРасписания(ВключениеИспользованияИсторииШтатногоРасписания);
		
		// Заполнение позиций в кадровых приказах.
		ЗаполнитьПозицииВКадровыхПриказах();
		
		// Заполнение движений регистров.
		ЗаполнитьПозицииВДвиженияхРегистров();
		
		// Обновление структуры справочника ШтатноеРасписание.
		Справочники.ШтатноеРасписание.ОбновитьСтруктуруШтатногоРасписанияПоПодразделениям();

	КонецЕсли;
		
	Если ВключениеИспользованияИсторииШтатногоРасписания Тогда
		СоздатьУтверждениеШтатногоРасписания();
	КонецЕсли;
	
КонецПроцедуры

Процедура СоздатьПозицииШтатногоРасписания(ВключениеИспользованияИстории)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	КадровыйУчетРасширенный.СоздатьВТТекущаяКадроваяРасстановка(Запрос.МенеджерВременныхТаблиц);
	
	ИзмеренияДаты = Новый ТаблицаЗначений;
	ИзмеренияДаты.Колонки.Добавить("ДатаНачала", Новый ОписаниеТипов("Дата"));
	ИзмеренияДаты.Колонки.Добавить("ДатаОкончания", Новый ОписаниеТипов("Дата"));
	ИзмеренияДаты.Добавить();
	
	ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистра(
		"КадроваяИсторияСотрудников",
		Запрос.МенеджерВременныхТаблиц,
		Ложь,
		ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра(ИзмеренияДаты));
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КадроваяИсторияСотрудников.Период,
		|	КадроваяИсторияСотрудников.Сотрудник,
		|	МАКСИМУМ(КадроваяИсторияСотрудниковПредыдущиеСобытия.Период) КАК ПериодПредыдущий
		|ПОМЕСТИТЬ ВТПериодыПредыдущихСобытий
		|ИЗ
		|	ВТКадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТКадроваяИсторияСотрудников КАК КадроваяИсторияСотрудниковПредыдущиеСобытия
		|		ПО КадроваяИсторияСотрудников.Сотрудник = КадроваяИсторияСотрудниковПредыдущиеСобытия.Сотрудник
		|			И КадроваяИсторияСотрудников.Период > КадроваяИсторияСотрудниковПредыдущиеСобытия.Период
		|ГДЕ
		|	КадроваяИсторияСотрудников.ВидСобытия = ЗНАЧЕНИЕ(Перечисление.ВидыКадровыхСобытий.Перемещение)
		|
		|СГРУППИРОВАТЬ ПО
		|	КадроваяИсторияСотрудников.Период,
		|	КадроваяИсторияСотрудников.Сотрудник
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КадроваяИсторияСотрудников.Регистратор,
		|	КадроваяИсторияСотрудников.Организация,
		|	КадроваяИсторияСотрудников.Подразделение,
		|	КадроваяИсторияСотрудников.ВидСобытия,
		|	КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписанию,
		|	КадроваяИсторияСотрудников.КоличествоСтавок,
		|	КадроваяИсторияСотрудников.Должность,
		|	КадроваяИсторияСотрудников.ВидЗанятости,
		|	КадроваяИсторияСотрудников.Период
		|ПОМЕСТИТЬ ВТСтавкиОсвобожденныеПеремещениями
		|ИЗ
		|	ВТКадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПериодыПредыдущихСобытий КАК ПериодыПредыдущихСобытий
		|		ПО КадроваяИсторияСотрудников.Период = ПериодыПредыдущихСобытий.ПериодПредыдущий
		|			И КадроваяИсторияСотрудников.Сотрудник = ПериодыПредыдущихСобытий.Сотрудник";
	
	Запрос.Выполнить();
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КадроваяИсторияСотрудников.Регистратор,
		|	КадроваяИсторияСотрудников.Организация,
		|	КадроваяИсторияСотрудников.Подразделение,
		|	КадроваяИсторияСотрудников.ВидСобытия,
		|	КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписанию,
		|	ВЫБОР
		|		КОГДА КадроваяИсторияСотрудников.ВидСобытия = ЗНАЧЕНИЕ(Перечисление.ВидыКадровыхСобытий.Увольнение)
		|			ТОГДА -КадроваяИсторияСотрудников.КоличествоСтавок
		|		ИНАЧЕ КадроваяИсторияСотрудников.КоличествоСтавок
		|	КОНЕЦ КАК КоличествоСтавок,
		|	КадроваяИсторияСотрудников.Должность,
		|	КадроваяИсторияСотрудников.ВидЗанятости,
		|	КадроваяИсторияСотрудников.Период
		|ПОМЕСТИТЬ ВТТаблицаКадровойИстории
		|ИЗ
		|	ВТКадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	СтавкиОсвобожденныеПеремещениями.Регистратор,
		|	СтавкиОсвобожденныеПеремещениями.Организация,
		|	СтавкиОсвобожденныеПеремещениями.Подразделение,
		|	СтавкиОсвобожденныеПеремещениями.ВидСобытия,
		|	СтавкиОсвобожденныеПеремещениями.ДолжностьПоШтатномуРасписанию,
		|	-СтавкиОсвобожденныеПеремещениями.КоличествоСтавок,
		|	СтавкиОсвобожденныеПеремещениями.Должность,
		|	СтавкиОсвобожденныеПеремещениями.ВидЗанятости,
		|	СтавкиОсвобожденныеПеремещениями.Период
		|ИЗ
		|	ВТСтавкиОсвобожденныеПеремещениями КАК СтавкиОсвобожденныеПеремещениями";
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьПодработки") Тогда
		
		ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистра(
			"СостоянияПодработок",
			Запрос.МенеджерВременныхТаблиц,
			Ложь,
			ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра(ИзмеренияДаты));
		
		Запрос.Текст = Запрос.Текст + "
			|ОБЪЕДИНИТЬ ВСЕ
			|"
			+ "
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СостоянияПодработок.Регистратор,
			|	СостоянияПодработок.Организация,
			|	СостоянияПодработок.Подразделение,
			|	СостоянияПодработок.ВидСобытия,
			|	СостоянияПодработок.ДолжностьПоШтатномуРасписанию,
			|	ВЫБОР
			|		КОГДА СостоянияПодработок.ВидСобытия = ЗНАЧЕНИЕ(Перечисление.ВидыКадровыхСобытий.Увольнение)
			|			ТОГДА -СостоянияПодработок.КоличествоСтавок
			|		ИНАЧЕ СостоянияПодработок.КоличествоСтавок
			|	КОНЕЦ КАК КоличествоСтавок,
			|	СостоянияПодработок.Должность,
			|	СостоянияПодработок.ВидЗанятости,
			|	СостоянияПодработок.Период
			|ИЗ
			|	ВТСостоянияПодработок КАК СостоянияПодработок";
		
	КонецЕсли;
	
	Запрос.Выполнить();
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ТаблицаКадровойИстории.Подразделение,
		|	ТаблицаКадровойИстории.Должность
		|ПОМЕСТИТЬ ВТНедостающиеПозицииПоПодразделениямИДолжностям
		|ИЗ
		|	ВТТаблицаКадровойИстории КАК ТаблицаКадровойИстории
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО ТаблицаКадровойИстории.Организация = ШтатноеРасписание.Владелец
		|			И ТаблицаКадровойИстории.Подразделение = ШтатноеРасписание.Подразделение
		|			И ТаблицаКадровойИстории.Должность = ШтатноеРасписание.Должность
		|ГДЕ
		|	ШтатноеРасписание.Ссылка ЕСТЬ NULL 
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТаблицаКадровойИстории.Организация КАК Организация,
		|	НедостающиеПозицииПоПодразделениямИДолжностям.Подразделение,
		|	НедостающиеПозицииПоПодразделениямИДолжностям.Должность,
		|	СУММА(ТаблицаКадровойИстории.КоличествоСтавок) КАК КоличествоСтавок,
		|	ИСТИНА КАК Утверждена,
		|	МИНИМУМ(ТаблицаКадровойИстории.Период) КАК ДатаУтверждения,
		|	ВЫБОР
		|		КОГДА ТекущаяКадроваяРасстановка.Подразделение ЕСТЬ NULL 
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Закрыта,
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА ТекущаяКадроваяРасстановка.Подразделение ЕСТЬ NULL 
		|				ТОГДА ТаблицаКадровойИстории.Период
		|			ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
		|		КОНЕЦ) КАК ДатаЗакрытия,
		|	ЕСТЬNULL(ТекущаяКадроваяРасстановка.ГрафикРаботыСотрудников, ЗНАЧЕНИЕ(Справочник.ГрафикиРаботыСотрудников.ПустаяСсылка)) КАК ГрафикРаботыСотрудников,
		|	МИНИМУМ(ЕСТЬNULL(ШтатноеРасписание.Ссылка, ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка))) КАК Позиция
		|ПОМЕСТИТЬ ВТСоздаваемыеПозицииПредварительно
		|ИЗ
		|	ВТНедостающиеПозицииПоПодразделениямИДолжностям КАК НедостающиеПозицииПоПодразделениямИДолжностям
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТТаблицаКадровойИстории КАК ТаблицаКадровойИстории
		|		ПО НедостающиеПозицииПоПодразделениямИДолжностям.Подразделение = ТаблицаКадровойИстории.Подразделение
		|			И НедостающиеПозицииПоПодразделениямИДолжностям.Должность = ТаблицаКадровойИстории.Должность
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТТекущаяКадроваяРасстановка КАК ТекущаяКадроваяРасстановка
		|		ПО НедостающиеПозицииПоПодразделениямИДолжностям.Подразделение = ТекущаяКадроваяРасстановка.Подразделение
		|			И НедостающиеПозицииПоПодразделениямИДолжностям.Должность = ТекущаяКадроваяРасстановка.Должность
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО НедостающиеПозицииПоПодразделениямИДолжностям.Подразделение = ШтатноеРасписание.Подразделение
		|			И НедостающиеПозицииПоПодразделениямИДолжностям.Должность = ШтатноеРасписание.Должность
		|
		|СГРУППИРОВАТЬ ПО
		|	НедостающиеПозицииПоПодразделениямИДолжностям.Подразделение,
		|	НедостающиеПозицииПоПодразделениямИДолжностям.Должность,
		|	ТаблицаКадровойИстории.Организация,
		|	ВЫБОР
		|		КОГДА ТекущаяКадроваяРасстановка.Подразделение ЕСТЬ NULL 
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
		|	ЕСТЬNULL(ТекущаяКадроваяРасстановка.ГрафикРаботыСотрудников, ЗНАЧЕНИЕ(Справочник.ГрафикиРаботыСотрудников.ПустаяСсылка))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СоздаваемыеПозицииПредварительно.Организация КАК Организация,
		|	СоздаваемыеПозицииПредварительно.Подразделение,
		|	СоздаваемыеПозицииПредварительно.Должность,
		|	СоздаваемыеПозицииПредварительно.КоличествоСтавок КАК КоличествоСтавок,
		|	СоздаваемыеПозицииПредварительно.Утверждена,
		|	СоздаваемыеПозицииПредварительно.ДатаУтверждения,
		|	СоздаваемыеПозицииПредварительно.Закрыта,
		|	СоздаваемыеПозицииПредварительно.ДатаЗакрытия,
		|	СоздаваемыеПозицииПредварительно.ГрафикРаботыСотрудников,
		|	СоздаваемыеПозицииПредварительно.Позиция
		|ИЗ
		|	ВТСоздаваемыеПозицииПредварительно КАК СоздаваемыеПозицииПредварительно
		|ГДЕ
		|	СоздаваемыеПозицииПредварительно.Позиция = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|	И СоздаваемыеПозицииПредварительно.Организация <> ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|	И СоздаваемыеПозицииПредварительно.Подразделение <> ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	И СоздаваемыеПозицииПредварительно.Должность <> ЗНАЧЕНИЕ(Справочник.Должности.ПустаяСсылка)
		|ИТОГИ ПО
		|	Организация";
	
	СоответствиеПозицийОрганизациям = Новый Соответствие;
	
	ВыборкаПоОрганизациям = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока ВыборкаПоОрганизациям.Следующий() Цикл
		
		СозданныеПозиции = Новый Массив;
		
		Выборка = ВыборкаПоОрганизациям.Выбрать();
		Пока Выборка.Следующий() Цикл
			
			ПозицияОбъект = Справочники.ШтатноеРасписание.СоздатьЭлемент();
			ЗаполнитьЗначенияСвойств(ПозицияОбъект, Выборка);
			ПозицияОбъект.Владелец = Выборка.Организация;
			ПозицияОбъект.Наименование = УправлениеШтатнымРасписаниемКлиентСервер.НаименованиеПозицииШтатногоРасписания(
				Выборка.Подразделение, Выборка.Должность);
			ОтключитьОбновлениеСтруктурыШтатногоРасписания(ПозицияОбъект);
			ПозицияОбъект.Записать();
			
			Если НЕ ПозицияОбъект.Закрыта Тогда
				СозданныеПозиции.Добавить(ПозицияОбъект.Ссылка);
			КонецЕсли; 
			
		КонецЦикла; 
		
		Если СозданныеПозиции.Количество() > 0 Тогда
			СоответствиеПозицийОрганизациям.Вставить(ВыборкаПоОрганизациям.Организация, СозданныеПозиции);
		КонецЕсли; 
		
	КонецЦикла;
	
	Если НЕ ВключениеИспользованияИстории Тогда
		
		Для каждого СоответствиеПозицийОрганизации Из СоответствиеПозицийОрганизациям Цикл
			
			Запрос = Новый Запрос;
			
			Запрос.УстановитьПараметр("Позиции", СоответствиеПозицийОрганизации.Значение);
			
			Запрос.Текст =
				"ВЫБРАТЬ
				|	ДанныеДляЗаполнения.Подразделение,
				|	ДанныеДляЗаполнения.Должность,
				|	ДанныеДляЗаполнения.Ссылка КАК ИдентификаторСтрокиПозиции
				|ИЗ
				|	Справочник.ШтатноеРасписание КАК ДанныеДляЗаполнения
				|ГДЕ
				|	ДанныеДляЗаполнения.Ссылка В(&Позиции)";
			
			ДанныеДляПолученияКадровыхДанных = Запрос.Выполнить().Выгрузить();
			
			ДанныеДляЗаполнения = ТекущиеКадровыеДанныеПозиций(
				СоответствиеПозицийОрганизации.Ключ, ДанныеДляПолученияКадровыхДанных, ТекущаяДатаСеанса());
			
			Для каждого ДанныеПозиции Из ДанныеДляЗаполнения Цикл
				
				ПозицияОбъект = ДанныеПозиции.Ключ.ПолучитьОбъект();
				ИдентификаторСтрокиВидаРасчета = 1;
				
				Для каждого ДанныеНачисления Из ДанныеПозиции.Значение.Начисления Цикл
					
					СтрокаНовогоНачисления = ПозицияОбъект.Начисления.Добавить();
					СтрокаНовогоНачисления.Начисление = ДанныеНачисления.Начисление;
					СтрокаНовогоНачисления.ИдентификаторСтрокиВидаРасчета = ИдентификаторСтрокиВидаРасчета;
					
					Для каждого ДанныеПоказателя Из ДанныеНачисления.Показатели Цикл
						
						СтрокаНовогоПоказателя = ПозицияОбъект.Показатели.Добавить();
						СтрокаНовогоПоказателя.Показатель = ДанныеПоказателя.Показатель;
						
						Если ДанныеПоказателя.Свойство("Значение") Тогда
							СтрокаНовогоПоказателя.Значение = ДанныеПоказателя.Значение;
						КонецЕсли; 
						
						Если ДанныеПоказателя.Свойство("МинимальноеЗначение") Тогда
							СтрокаНовогоПоказателя.ЗначениеМин = ДанныеПоказателя.МинимальноеЗначение;
						КонецЕсли; 
						
						Если ДанныеПоказателя.Свойство("МаксимальноеЗначение") Тогда
							СтрокаНовогоПоказателя.ЗначениеМакс = ДанныеПоказателя.МаксимальноеЗначение;
						КонецЕсли; 
						
						СтрокаНовогоПоказателя.ИдентификаторСтрокиВидаРасчета = ИдентификаторСтрокиВидаРасчета;
						
					КонецЦикла;
					
					ИдентификаторСтрокиВидаРасчета = ИдентификаторСтрокиВидаРасчета + 1;
					
				КонецЦикла;
				
				Для каждого ДанныеОтпуска Из ДанныеПозиции.Значение.ЕжегодныеОтпуска Цикл
					
					НоваяСтрокаОтпуска = ПозицияОбъект.ЕжегодныеОтпуска.Добавить();
					ЗаполнитьЗначенияСвойств(НоваяСтрокаОтпуска, ДанныеОтпуска);
					
				КонецЦикла;
				
				Для каждого ДанныеСпециальности Из ДанныеПозиции.Значение.Специальности Цикл
					
					НоваяСтрокаСпециальности = ПозицияОбъект.Специальности.Добавить();
					ЗаполнитьЗначенияСвойств(НоваяСтрокаСпециальности, ДанныеСпециальности);
					
				КонецЦикла;
				
				ОтключитьОбновлениеСтруктурыШтатногоРасписания(ПозицияОбъект);
				ПозицияОбъект.Записать();
				
			КонецЦикла;
			
			Запрос.Текст =
				"ВЫБРАТЬ
				|	НЕОПРЕДЕЛЕНО КАК Действие,
				|	ШтатноеРасписание.Ссылка КАК Позиция,
				|	ШтатноеРасписание.Владелец КАК Организация,
				|	ШтатноеРасписание.Подразделение,
				|	ШтатноеРасписание.Должность,
				|	ШтатноеРасписание.ГрафикРаботыСотрудников,
				|	ШтатноеРасписание.ОкладТариф,
				|	ШтатноеРасписание.ОкладТарифМин,
				|	ШтатноеРасписание.ОкладТарифМакс,
				|	ШтатноеРасписание.ФОТ,
				|	ШтатноеРасписание.ФОТМин,
				|	ШтатноеРасписание.ФОТМакс,
				|	ШтатноеРасписание.НадбавкаЗаВредностьРазмер,
				|	ШтатноеРасписание.НадбавкаЗаВредностьРазмерМин,
				|	ШтатноеРасписание.НадбавкаЗаВредностьРазмерМакс,
				|	ШтатноеРасписание.ВыплачиваетсяНадбавкаЗаВредность,
				|	ШтатноеРасписание.ПроцентНадбавкиЗаВредность
				|ПОМЕСТИТЬ ВТПозицииПредварительно
				|ИЗ
				|	Справочник.ШтатноеРасписание КАК ШтатноеРасписание
				|ГДЕ
				|	ШтатноеРасписание.Ссылка В(&РассчитываемыеСсылки)
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ПозицииПредварительноМеньшие.Позиция) КАК ИдентификаторСтрокиПозиции,
				|	ПозицииПредварительно.Действие,
				|	ПозицииПредварительно.Позиция,
				|	ПозицииПредварительно.Организация,
				|	ПозицииПредварительно.Подразделение,
				|	ПозицииПредварительно.Должность,
				|	ПозицииПредварительно.ГрафикРаботыСотрудников,
				|	ПозицииПредварительно.ОкладТариф,
				|	ПозицииПредварительно.ОкладТарифМин,
				|	ПозицииПредварительно.ОкладТарифМакс,
				|	ПозицииПредварительно.ФОТ,
				|	ПозицииПредварительно.ФОТМин,
				|	ПозицииПредварительно.ФОТМакс,
				|	ПозицииПредварительно.НадбавкаЗаВредностьРазмер,
				|	ПозицииПредварительно.НадбавкаЗаВредностьРазмерМин,
				|	ПозицииПредварительно.НадбавкаЗаВредностьРазмерМакс,
				|	ПозицииПредварительно.ВыплачиваетсяНадбавкаЗаВредность,
				|	ПозицииПредварительно.ПроцентНадбавкиЗаВредность
				|ПОМЕСТИТЬ ВТПозиции
				|ИЗ
				|	ВТПозицииПредварительно КАК ПозицииПредварительно
				|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПозицииПредварительно КАК ПозицииПредварительноМеньшие
				|		ПО ПозицииПредварительно.Позиция > ПозицииПредварительноМеньшие.Позиция
				|
				|СГРУППИРОВАТЬ ПО
				|	ПозицииПредварительно.Действие,
				|	ПозицииПредварительно.Позиция,
				|	ПозицииПредварительно.Организация,
				|	ПозицииПредварительно.Подразделение,
				|	ПозицииПредварительно.Должность,
				|	ПозицииПредварительно.ГрафикРаботыСотрудников,
				|	ПозицииПредварительно.ОкладТариф,
				|	ПозицииПредварительно.ОкладТарифМин,
				|	ПозицииПредварительно.ОкладТарифМакс,
				|	ПозицииПредварительно.ФОТ,
				|	ПозицииПредварительно.ФОТМин,
				|	ПозицииПредварительно.ФОТМакс,
				|	ПозицииПредварительно.НадбавкаЗаВредностьРазмер,
				|	ПозицииПредварительно.НадбавкаЗаВредностьРазмерМин,
				|	ПозицииПредварительно.НадбавкаЗаВредностьРазмерМакс,
				|	ПозицииПредварительно.ВыплачиваетсяНадбавкаЗаВредность,
				|	ПозицииПредварительно.ПроцентНадбавкиЗаВредность
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	Позиции.ИдентификаторСтрокиПозиции,
				|	Позиции.Действие,
				|	Позиции.Позиция,
				|	Позиции.Организация,
				|	Позиции.Подразделение,
				|	Позиции.Должность,
				|	Позиции.ГрафикРаботыСотрудников,
				|	Позиции.ОкладТариф,
				|	Позиции.ОкладТарифМин,
				|	Позиции.ОкладТарифМакс,
				|	Позиции.ФОТ,
				|	Позиции.ФОТМин,
				|	Позиции.ФОТМакс,
				|	Позиции.НадбавкаЗаВредностьРазмер,
				|	Позиции.НадбавкаЗаВредностьРазмерМин,
				|	Позиции.НадбавкаЗаВредностьРазмерМакс,
				|	Позиции.ВыплачиваетсяНадбавкаЗаВредность,
				|	Позиции.ПроцентНадбавкиЗаВредность
				|ИЗ
				|	ВТПозиции КАК Позиции
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	Позиции.ИдентификаторСтрокиПозиции КАК ИдентификаторСтрокиПозиции,
				|	ШтатноеРасписаниеНачисления.Начисление,
				|	ШтатноеРасписаниеНачисления.ИдентификаторСтрокиВидаРасчета,
				|	НЕОПРЕДЕЛЕНО КАК Действие,
				|	ШтатноеРасписаниеНачисления.Размер,
				|	ШтатноеРасписаниеНачисления.РазмерМин,
				|	ШтатноеРасписаниеНачисления.РазмерМакс
				|ИЗ
				|	Справочник.ШтатноеРасписание.Начисления КАК ШтатноеРасписаниеНачисления
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПозиции КАК Позиции
				|		ПО ШтатноеРасписаниеНачисления.Ссылка = Позиции.Позиция
				|ГДЕ
				|	ШтатноеРасписаниеНачисления.Ссылка В(&РассчитываемыеСсылки)
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	Позиции.ИдентификаторСтрокиПозиции КАК ИдентификаторСтрокиПозиции,
				|	ШтатноеРасписаниеПоказатели.ИдентификаторСтрокиВидаРасчета,
				|	ШтатноеРасписаниеПоказатели.Показатель,
				|	ШтатноеРасписаниеПоказатели.Значение,
				|	ШтатноеРасписаниеПоказатели.ЗначениеМин,
				|	ШтатноеРасписаниеПоказатели.ЗначениеМакс
				|ИЗ
				|	Справочник.ШтатноеРасписание.Показатели КАК ШтатноеРасписаниеПоказатели
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПозиции КАК Позиции
				|		ПО ШтатноеРасписаниеПоказатели.Ссылка = Позиции.Позиция
				|ГДЕ
				|	ШтатноеРасписаниеПоказатели.Ссылка В(&РассчитываемыеСсылки)";
			
			Запрос.УстановитьПараметр("РассчитываемыеСсылки", ДанныеДляПолученияКадровыхДанных.ВыгрузитьКолонку("ИдентификаторСтрокиПозиции"));
			
			РезультатЗапроса = Запрос.ВыполнитьПакет();
			
			ОписаниеПозиций = Новый Структура;
			ОписаниеПозиций.Вставить("Организация", СоответствиеПозицийОрганизации.Ключ);
			ОписаниеПозиций.Вставить("ДатаВступленияВСилу", ТекущаяДатаСеанса());
			ОписаниеПозиций.Вставить("Позиции", РезультатЗапроса[РезультатЗапроса.Количество() - 3].Выгрузить());
			ОписаниеПозиций.Вставить("Начисления", РезультатЗапроса[РезультатЗапроса.Количество() - 2].Выгрузить());
			ОписаниеПозиций.Вставить("Показатели", РезультатЗапроса[РезультатЗапроса.Количество() - 1].Выгрузить());
			
			РассчитатьФОТНесколькихПозиций(ОписаниеПозиций);
			
			Для каждого СтруктураПозиции Из ОписаниеПозиций.Позиции Цикл
				
				ПозицияОбъект = СтруктураПозиции.Позиция.ПолучитьОбъект();
				ЗаполнитьЗначенияСвойств(ПозицияОбъект, СтруктураПозиции, СвойстваПозицииСРезультатамиРасчетаФОТ());
				
				СтрокиНачислений = ОписаниеПозиций.Начисления.НайтиСтроки(Новый Структура("ИдентификаторСтрокиПозиции", СтруктураПозиции.ИдентификаторСтрокиПозиции));
				Для каждого СтрокаНачислений Из СтрокиНачислений Цикл
					СтрокиПозиции = ПозицияОбъект.Начисления.НайтиСтроки(Новый Структура("Начисление", СтрокаНачислений.Начисление));
					Для каждого СтрокаПозиции Из СтрокиПозиции Цикл
						ЗаполнитьЗначенияСвойств(СтрокаПозиции, СтрокаНачислений, "Размер,РазмерМин,РазмерМакс");
					КонецЦикла;
				КонецЦикла;
				
				ОтключитьОбновлениеСтруктурыШтатногоРасписания(ПозицияОбъект);
				ПозицияОбъект.Записать();
				
			КонецЦикла;
			
		КонецЦикла;
		
	КонецЕсли; 
	
КонецПроцедуры

Процедура ЗаполнитьПозицииВКадровыхПриказах()
	
	СписокРегистраторов = Новый Массив;
	
	Запрос = Новый Запрос;
	
	Запрос.Текст =
		"ВЫБРАТЬ
		|	Документы.Ссылка,
		|	МАКСИМУМ(ШтатноеРасписание.Ссылка) КАК ДолжностьПоШтатномуРасписанию
		|ИЗ
		|	Документ.ИзменениеПлановыхНачислений КАК Документы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Документы.Организация = ШтатноеРасписание.Владелец
		|			И Документы.Подразделение = ШтатноеРасписание.Подразделение
		|			И Документы.Должность = ШтатноеРасписание.Должность
		|			И Документы.ДатаИзменения >= ШтатноеРасписание.ДатаУтверждения
		|			И (ШтатноеРасписание.Утверждена)
		|ГДЕ
		|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Документы.Ссылка
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Документы.Ссылка,
		|	МАКСИМУМ(ШтатноеРасписание.Ссылка)
		|ИЗ
		|	Документ.КадровыйПеревод КАК Документы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Документы.Организация = ШтатноеРасписание.Владелец
		|			И Документы.Подразделение = ШтатноеРасписание.Подразделение
		|			И Документы.Должность = ШтатноеРасписание.Должность
		|			И Документы.ДатаНачала >= ШтатноеРасписание.ДатаУтверждения
		|			И (ШтатноеРасписание.Утверждена)
		|ГДЕ
		|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Документы.Ссылка
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Документы.Ссылка,
		|	МАКСИМУМ(ШтатноеРасписание.Ссылка)
		|ИЗ
		|	Документ.ПереводКДругомуРаботодателю КАК Документы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Документы.Организация = ШтатноеРасписание.Владелец
		|			И Документы.Подразделение = ШтатноеРасписание.Подразделение
		|			И Документы.Должность = ШтатноеРасписание.Должность
		|			И Документы.ДатаПриема >= ШтатноеРасписание.ДатаУтверждения
		|			И (ШтатноеРасписание.Утверждена)
		|ГДЕ
		|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Документы.Ссылка
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Документы.Ссылка,
		|	МАКСИМУМ(ШтатноеРасписание.Ссылка)
		|ИЗ
		|	Документ.ПриемНаРаботу КАК Документы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Документы.Организация = ШтатноеРасписание.Владелец
		|			И Документы.Подразделение = ШтатноеРасписание.Подразделение
		|			И Документы.Должность = ШтатноеРасписание.Должность
		|			И Документы.ДатаПриема >= ШтатноеРасписание.ДатаУтверждения
		|			И (ШтатноеРасписание.Утверждена)
		|ГДЕ
		|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Документы.Ссылка";

		
	Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.Подработки") Тогда
		
		Запрос.Текст = 	Запрос.Текст + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|" 
			+ "ВЫБРАТЬ
			|	Документы.Ссылка,
			|	МАКСИМУМ(ШтатноеРасписание.Ссылка)
			|ИЗ
			|	Документ.НазначениеПодработки КАК Документы
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
			|		ПО Документы.Организация = ШтатноеРасписание.Владелец
			|			И Документы.Подразделение = ШтатноеРасписание.Подразделение
			|			И Документы.Должность = ШтатноеРасписание.Должность
			|			И Документы.ДатаНачала >= ШтатноеРасписание.ДатаУтверждения
			|			И (ШтатноеРасписание.Утверждена)
			|ГДЕ
			|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
			|
			|СГРУППИРОВАТЬ ПО
			|	Документы.Ссылка";
		
	КонецЕсли;
		
	РезультатЗапроса = Запрос.Выполнить();
	Если НЕ РезультатЗапроса.Пустой() Тогда
		
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			
			ДокументОбъект = Выборка.Ссылка.ПолучитьОбъект();
			ДокументОбъект.ДолжностьПоШтатномуРасписанию = Выборка.ДолжностьПоШтатномуРасписанию;
			
			ДокументОбъект.ДополнительныеСвойства.Вставить("ОтключитьПроверкуДатыЗапретаИзменения", Истина);
			ДокументОбъект.ОбменДанными.Загрузка = Истина;
			
			Попытка
				
				ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
				СписокРегистраторов.Добавить(ДокументОбъект.Ссылка);
				
			Исключение
				
				ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
					НСтр("ru='При заполнении позиций в кадровых приказах не удалось записать %1, этот документ необходимо обработать в ручном режиме.';uk='При заповненні позицій в кадрових наказах не вдалося записати %1, цей документ необхідно обробити в ручному режимі.'"),
					ДокументОбъект.Ссылка);
					
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
					ТекстСообщения,
					ДокументОбъект.Ссылка);
					
			КонецПопытки;
			
		КонецЦикла;
		
	КонецЕсли; 
	
	Запрос.Текст =
		"ВЫБРАТЬ
		|	Документы.Ссылка КАК Ссылка,
		|	Документы.НомерСтроки,
		|	МАКСИМУМ(ШтатноеРасписание.Ссылка) КАК ДолжностьПоШтатномуРасписанию
		|ИЗ
		|	Документ.НачальнаяШтатнаяРасстановка.Сотрудники КАК Документы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Документы.Ссылка.Организация = ШтатноеРасписание.Владелец
		|			И Документы.Подразделение = ШтатноеРасписание.Подразделение
		|			И Документы.Должность = ШтатноеРасписание.Должность
		|			И Документы.Ссылка.Месяц >= ШтатноеРасписание.ДатаУтверждения
		|ГДЕ
		|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Документы.Ссылка,
		|	Документы.НомерСтроки
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Документы.Ссылка,
		|	Документы.НомерСтроки,
		|	МАКСИМУМ(ШтатноеРасписание.Ссылка)
		|ИЗ
		|	Документ.ПеремещениеВДругоеПодразделение.Сотрудники КАК Документы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Документы.Ссылка.ОрганизацияНовая = ШтатноеРасписание.Владелец
		|			И Документы.Ссылка.ПодразделениеНовое = ШтатноеРасписание.Подразделение
		|			И Документы.Должность = ШтатноеРасписание.Должность
		|			И Документы.Ссылка.ДатаПеремещения >= ШтатноеРасписание.ДатаУтверждения
		|ГДЕ
		|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Документы.Ссылка,
		|	Документы.НомерСтроки
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Документы.Ссылка,
		|	Документы.НомерСтроки,
		|	МАКСИМУМ(ШтатноеРасписание.Ссылка)
		|ИЗ
		|	Документ.ПриемНаРаботуСписком.Сотрудники КАК Документы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Документы.Ссылка.Организация = ШтатноеРасписание.Владелец
		|			И Документы.Подразделение = ШтатноеРасписание.Подразделение
		|			И Документы.Должность = ШтатноеРасписание.Должность
		|			И Документы.ДатаПриема >= ШтатноеРасписание.ДатаУтверждения
		|ГДЕ
		|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Документы.Ссылка,
		|	Документы.НомерСтроки
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Документы.Ссылка,
		|	Документы.НомерСтроки,
		|	МАКСИМУМ(ШтатноеРасписание.Ссылка)
		|ИЗ
		|	Документ.КадровыйПереводСписком.Сотрудники КАК Документы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Документы.Ссылка.Организация = ШтатноеРасписание.Владелец
		|			И Документы.Подразделение = ШтатноеРасписание.Подразделение
		|			И Документы.Должность = ШтатноеРасписание.Должность
		|			И Документы.ДатаНачала >= ШтатноеРасписание.ДатаУтверждения
		|ГДЕ
		|	Документы.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Документы.Ссылка,
		|	Документы.НомерСтроки
		|ИТОГИ ПО
		|	Ссылка";
		
	РезультатЗапроса = Запрос.Выполнить();
	Если НЕ РезультатЗапроса.Пустой() Тогда
		
		ВыборкаПоДокументам = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаПоДокументам.Следующий() Цикл
			
			ДокументОбъект = ВыборкаПоДокументам.Ссылка.ПолучитьОбъект();
			
			ВыборкаПоНомерамСтрок = ВыборкаПоДокументам.Выбрать();
			Пока ВыборкаПоНомерамСтрок.Следующий() Цикл
				
				СтрокаДокумента = ДокументОбъект.Сотрудники.Найти(ВыборкаПоНомерамСтрок.НомерСТроки, "НомерСтроки");
				Если СтрокаДокумента <> Неопределено Тогда
					СтрокаДокумента.ДолжностьПоШтатномуРасписанию = ВыборкаПоНомерамСтрок.ДолжностьПоШтатномуРасписанию;
				КонецЕсли;
			
			КонецЦикла;
			
			ДокументОбъект.ДополнительныеСвойства.Вставить("ОтключитьПроверкуДатыЗапретаИзменения", Истина);
			ДокументОбъект.ОбменДанными.Загрузка = Истина;
			
			Попытка
				
				ДокументОбъект.Записать(РежимЗаписиДокумента.Запись);
				СписокРегистраторов.Добавить(ДокументОбъект.Ссылка);
				
			Исключение
				
				ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
					НСтр("ru='При заполнении позиций в кадровых приказах не удалось записать %1, этот документ необходимо обработать в ручном режиме.';uk='При заповненні позицій в кадрових наказах не вдалося записати %1, цей документ необхідно обробити в ручному режимі.'"),
					ДокументОбъект.Ссылка);
					
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
					ТекстСообщения,
					ДокументОбъект.Ссылка);
					
			КонецПопытки;
			
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьПозицииВДвиженияхРегистров()
	
	Запрос = Новый Запрос;
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	// Восстановление движений по регистру сведений КадроваяИсторияСотрудников.
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КадроваяИсторияСотрудников.Регистратор
		|ПОМЕСТИТЬ ВТРегистраторы
		|ИЗ
		|	РегистрСведений.КадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников
		|ГДЕ
		|	(КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|			ИЛИ КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписаниюПоОкончании = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|				И КадроваяИсторияСотрудников.ДолжностьПоОкончании <> ЗНАЧЕНИЕ(Справочник.Должности.ПустаяСсылка))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КадроваяИсторияСотрудников.Период,
		|	КадроваяИсторияСотрудников.Регистратор КАК Регистратор,
		|	КадроваяИсторияСотрудников.Сотрудник,
		|	КадроваяИсторияСотрудников.ГоловнаяОрганизация,
		|	КадроваяИсторияСотрудников.ФизическоеЛицо,
		|	КадроваяИсторияСотрудников.Организация,
		|	КадроваяИсторияСотрудников.Подразделение,
		|	КадроваяИсторияСотрудников.ВидСобытия,
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|				ТОГДА ЕСТЬNULL(Позиции.Ссылка, ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка))
		|			ИНАЧЕ КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписанию
		|		КОНЕЦ) КАК ДолжностьПоШтатномуРасписанию,
		|	КадроваяИсторияСотрудников.КоличествоСтавок,
		|	КадроваяИсторияСотрудников.Должность,
		|	КадроваяИсторияСотрудников.ВидЗанятости,
		|	КадроваяИсторияСотрудников.ДействуетДо,
		|	КадроваяИсторияСотрудников.ОрганизацияПоОкончании,
		|	КадроваяИсторияСотрудников.ПодразделениеПоОкончании,
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписаниюПоОкончании = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|					И КадроваяИсторияСотрудников.ПодразделениеПоОкончании <> ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|					И КадроваяИсторияСотрудников.ДолжностьПоОкончании <> ЗНАЧЕНИЕ(Справочник.Должности.ПустаяСсылка)
		|				ТОГДА ЕСТЬNULL(ПозицииПоОкончании.Ссылка, ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка))
		|			ИНАЧЕ КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписаниюПоОкончании
		|		КОНЕЦ) КАК ДолжностьПоШтатномуРасписаниюПоОкончании,
		|	КадроваяИсторияСотрудников.ДолжностьПоОкончании,
		|	КадроваяИсторияСотрудников.КоличествоСтавокПоОкончании,
		|	КадроваяИсторияСотрудников.ВидСобытияПоОкончании,
		|	КадроваяИсторияСотрудников.ВидЗанятостиПоОкончании,
		|	КадроваяИсторияСотрудников.ПервичныйДокумент,
		|	КадроваяИсторияСотрудников.ВидДоговора,
		|	КадроваяИсторияСотрудников.ВидДоговораПоОкончании
		|ИЗ
		|	РегистрСведений.КадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК Позиции
		|		ПО КадроваяИсторияСотрудников.Подразделение = Позиции.Подразделение
		|			И КадроваяИсторияСотрудников.Должность = Позиции.Должность
		|			И КадроваяИсторияСотрудников.Период >= Позиции.ДатаУтверждения
		|			И (НЕ Позиции.ЭтоГруппа)
		|			И (Позиции.Утверждена)
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ПозицииПоОкончании
		|		ПО КадроваяИсторияСотрудников.ПодразделениеПоОкончании = ПозицииПоОкончании.Подразделение
		|			И КадроваяИсторияСотрудников.ДолжностьПоОкончании = ПозицииПоОкончании.Должность
		|			И КадроваяИсторияСотрудников.ДействуетДо >= ПозицииПоОкончании.ДатаУтверждения
		|			И (НЕ ПозицииПоОкончании.ЭтоГруппа)
		|			И (ПозицииПоОкончании.Утверждена)
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРегистраторы КАК Регистраторы
		|		ПО КадроваяИсторияСотрудников.Регистратор = Регистраторы.Регистратор
		|
		|СГРУППИРОВАТЬ ПО
		|	КадроваяИсторияСотрудников.Период,
		|	КадроваяИсторияСотрудников.Регистратор,
		|	КадроваяИсторияСотрудников.Сотрудник,
		|	КадроваяИсторияСотрудников.ГоловнаяОрганизация,
		|	КадроваяИсторияСотрудников.ФизическоеЛицо,
		|	КадроваяИсторияСотрудников.Организация,
		|	КадроваяИсторияСотрудников.Подразделение,
		|	КадроваяИсторияСотрудников.ВидСобытия,
		|	КадроваяИсторияСотрудников.КоличествоСтавок,
		|	КадроваяИсторияСотрудников.Должность,
		|	КадроваяИсторияСотрудников.ВидЗанятости,
		|	КадроваяИсторияСотрудников.ДействуетДо,
		|	КадроваяИсторияСотрудников.ОрганизацияПоОкончании,
		|	КадроваяИсторияСотрудников.ПодразделениеПоОкончании,
		|	КадроваяИсторияСотрудников.ДолжностьПоОкончании,
		|	КадроваяИсторияСотрудников.КоличествоСтавокПоОкончании,
		|	КадроваяИсторияСотрудников.ВидСобытияПоОкончании,
		|	КадроваяИсторияСотрудников.ВидЗанятостиПоОкончании,
		|	КадроваяИсторияСотрудников.ПервичныйДокумент,
		|	КадроваяИсторияСотрудников.ВидДоговора,
		|	КадроваяИсторияСотрудников.ВидДоговораПоОкончании
		|ИТОГИ ПО
		|	Регистратор";
		
	ВыборкаПоРегистраторам = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаПоРегистраторам.Следующий() Цикл
		
		НаборЗаписей = РегистрыСведений.КадроваяИсторияСотрудников.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Регистратор.Установить(ВыборкаПоРегистраторам.Регистратор);
		
		ВыборкаПоЗаписям = ВыборкаПоРегистраторам.Выбрать();
		Пока ВыборкаПоЗаписям.Следующий() Цикл
			
			Запись = НаборЗаписей.Добавить();
			ЗаполнитьЗначенияСвойств(Запись, ВыборкаПоЗаписям);
			
		КонецЦикла;
		
		НаборЗаписей.ДополнительныеСвойства.Вставить("ОтключитьПроверкуДатыЗапретаИзменения", Истина);
		НаборЗаписей.ОбменДанными.Загрузка = Истина;
		НаборЗаписей.Записать();
		
	КонецЦикла;
	
	Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.Подработки") Тогда
		
		// Восстановление движений по регистру сведений СостоянияПодработок.
		
		Запрос.Текст =
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	СостоянияПодработок.Регистратор
			|ПОМЕСТИТЬ ВТРегистраторыПодработок
			|ИЗ
			|	РегистрСведений.СостоянияПодработок КАК СостоянияПодработок
			|ГДЕ
			|	СостоянияПодработок.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	СостоянияПодработок.Период,
			|	СостоянияПодработок.Регистратор КАК Регистратор,
			|	СостоянияПодработок.Сотрудник,
			|	СостоянияПодработок.ГоловнаяОрганизация,
			|	СостоянияПодработок.ФизическоеЛицо,
			|	СостоянияПодработок.Организация,
			|	МАКСИМУМ(ВЫБОР
			|			КОГДА СостоянияПодработок.ДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
			|				ТОГДА ЕСТЬNULL(Позиции.Ссылка, ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка))
			|			ИНАЧЕ СостоянияПодработок.ДолжностьПоШтатномуРасписанию
			|		КОНЕЦ) КАК ДолжностьПоШтатномуРасписанию,
			|	СостоянияПодработок.Подразделение,
			|	СостоянияПодработок.Должность,
			|	СостоянияПодработок.КоличествоСтавок,
			|	СостоянияПодработок.ВидЗанятости,
			|	СостоянияПодработок.ОтсутствующийСотрудник,
			|	СостоянияПодработок.ВидДоговора,
			|	СостоянияПодработок.ВидСобытия,
			|	СостоянияПодработок.ДействуетДо,
			|	СостоянияПодработок.ВидСобытияПоОкончании
			|ИЗ
			|	РегистрСведений.СостоянияПодработок КАК СостоянияПодработок
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК Позиции
			|		ПО СостоянияПодработок.Подразделение = Позиции.Подразделение
			|			И СостоянияПодработок.Должность = Позиции.Должность
			|			И СостоянияПодработок.Период >= Позиции.ДатаУтверждения
			|			И (НЕ Позиции.ЭтоГруппа)
			|			И (Позиции.Утверждена)
			|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРегистраторыПодработок КАК Регистраторы
			|		ПО СостоянияПодработок.Регистратор = Регистраторы.Регистратор
			|
			|СГРУППИРОВАТЬ ПО
			|	СостоянияПодработок.Период,
			|	СостоянияПодработок.Регистратор,
			|	СостоянияПодработок.Сотрудник,
			|	СостоянияПодработок.ГоловнаяОрганизация,
			|	СостоянияПодработок.ФизическоеЛицо,
			|	СостоянияПодработок.Организация,
			|	СостоянияПодработок.Подразделение,
			|	СостоянияПодработок.ВидСобытия,
			|	СостоянияПодработок.КоличествоСтавок,
			|	СостоянияПодработок.Должность,
			|	СостоянияПодработок.ВидЗанятости,
			|	СостоянияПодработок.ДействуетДо,
			|	СостоянияПодработок.ВидСобытияПоОкончании,
			|	СостоянияПодработок.ОтсутствующийСотрудник,
			|	СостоянияПодработок.ВидДоговора
			|ИТОГИ ПО
			|	Регистратор";
			
		ВыборкаПоРегистраторам = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаПоРегистраторам.Следующий() Цикл
			
			НаборЗаписей = РегистрыСведений.СостоянияПодработок.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.Регистратор.Установить(ВыборкаПоРегистраторам.Регистратор);
			
			ВыборкаПоЗаписям = ВыборкаПоРегистраторам.Выбрать();
			Пока ВыборкаПоЗаписям.Следующий() Цикл
				
				Запись = НаборЗаписей.Добавить();
				ЗаполнитьЗначенияСвойств(Запись, ВыборкаПоЗаписям);
				
			КонецЦикла;
			
			НаборЗаписей.ДополнительныеСвойства.Вставить("ОтключитьПроверкуДатыЗапретаИзменения", Истина);
			НаборЗаписей.ОбменДанными.Загрузка = Истина;
			НаборЗаписей.Записать();
			
		КонецЦикла;
		
	КонецЕсли;
	
	// Заполнение текущей должности по штатному расписанию.
	ЗаполнитьТекущуюДолжностьПоШтатномуРасписанию();
	
	// Заполнение данных для подбора сотрудников
	КадровыйУчетРасширенный.ЗаполнитьДанныеДляПодбораСотрудников();
	
	// Восстановление движений по регистру накопления ЗанятыеПозицииШтатногоРасписания.
		
	Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КадроваяИстория.Период,
		|	КадроваяИстория.Сотрудник,
		|	МАКСИМУМ(КадроваяИсторияПредыдущая.Период) КАК ПериодПредыдущий
		|ПОМЕСТИТЬ ВТМаксимальныеПредыдущиеПериоды
		|ИЗ
		|	РегистрСведений.КадроваяИсторияСотрудников КАК КадроваяИстория
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КадроваяИсторияСотрудников КАК КадроваяИсторияПредыдущая
		|		ПО КадроваяИстория.Сотрудник = КадроваяИсторияПредыдущая.Сотрудник
		|			И КадроваяИстория.Период > КадроваяИсторияПредыдущая.Период
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРегистраторы КАК Регистраторы
		|		ПО КадроваяИстория.Регистратор = Регистраторы.Регистратор
		|
		|СГРУППИРОВАТЬ ПО
		|	КадроваяИстория.Период,
		|	КадроваяИстория.Сотрудник
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КадроваяИстория.Регистратор КАК Регистратор,
		|	КадроваяИстория.Период КАК ДатаСобытия,
		|	КадроваяИстория.ДолжностьПоШтатномуРасписанию КАК Позиция,
		|	КадроваяИстория.ВидСобытия,
		|	КадроваяИстория.КоличествоСтавок,
		|	КадроваяИстория.Сотрудник,
		|	КадроваяИстория.ДействуетДо,
		|	КадроваяИсторияПредыдущая.ДолжностьПоШтатномуРасписанию КАК ТекущаяПозиция,
		|	КадроваяИсторияПредыдущая.КоличествоСтавок КАК ТекущееКоличествоСтавок
		|ИЗ
		|	РегистрСведений.КадроваяИсторияСотрудников КАК КадроваяИстория
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТМаксимальныеПредыдущиеПериоды КАК МаксимальныеПредыдущиеПериоды
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КадроваяИсторияСотрудников КАК КадроваяИсторияПредыдущая
		|			ПО МаксимальныеПредыдущиеПериоды.ПериодПредыдущий = КадроваяИсторияПредыдущая.Период
		|				И МаксимальныеПредыдущиеПериоды.Сотрудник = КадроваяИсторияПредыдущая.Сотрудник
		|		ПО КадроваяИстория.Период = МаксимальныеПредыдущиеПериоды.Период
		|			И КадроваяИстория.Сотрудник = МаксимальныеПредыдущиеПериоды.Сотрудник
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРегистраторы КАК Регистраторы
		|		ПО КадроваяИстория.Регистратор = Регистраторы.Регистратор
		|
		|УПОРЯДОЧИТЬ ПО
		|	Регистратор
		|ИТОГИ ПО
		|	Регистратор";
		
	ВыборкаПоРегистраторам = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаПоРегистраторам.Следующий() Цикл
		
		ДокументОбъект = ВыборкаПоРегистраторам.Регистратор.ПолучитьОбъект();
		
		Выборка = ВыборкаПоРегистраторам.Выбрать();
		Пока Выборка.Следующий() Цикл
			КадровыйУчетРасширенный.ДополнитьДвиженияЗанятыхПозицийПоСтрокеКадровыхДвижений(ДокументОбъект.Движения, Выборка, Истина);
		КонецЦикла;
		
		ДвиженияПоРегистру = ДокументОбъект.Движения.Найти("ЗанятыеПозицииШтатногоРасписания");
		ДвиженияПоРегистру.ДополнительныеСвойства.Вставить("ОтключитьПроверкуДатыЗапретаИзменения", Истина);
		ДвиженияПоРегистру.ОбменДанными.Загрузка = Истина;
		ДвиженияПоРегистру.Записать();
		
	КонецЦикла; 
	
КонецПроцедуры

Процедура СоздатьУтверждениеШтатногоРасписания()
	
	Запрос = Новый Запрос;
	Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Организации.Ссылка КАК Организация
		|ПОМЕСТИТЬ ВТОрганизации
		|ИЗ
		|	Справочник.Организации КАК Организации
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.УтверждениеШтатногоРасписания КАК УтверждениеШтатногоРасписания
		|		ПО (УтверждениеШтатногоРасписания.Организация = Организации.Ссылка)
		|ГДЕ
		|	УтверждениеШтатногоРасписания.Ссылка ЕСТЬ NULL 
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Организации.Организация,
		|	МИНИМУМ(ШтатноеРасписание.ДатаУтверждения) КАК ДатаУтверждения
		|ПОМЕСТИТЬ ВТОрганизацииПериоды
		|ИЗ
		|	ВТОрганизации КАК Организации
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|		ПО Организации.Организация = ШтатноеРасписание.Владелец
		|			И (НЕ ШтатноеРасписание.Закрыта)
		|
		|СГРУППИРОВАТЬ ПО
		|	Организации.Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОрганизацииПериоды.Организация,
		|	НАЧАЛОПЕРИОДА(ОрганизацииПериоды.ДатаУтверждения, МЕСЯЦ) КАК МесяцВступленияВСилу
		|ИЗ
		|	ВТОрганизацииПериоды КАК ОрганизацииПериоды";
		
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		ДокументУтверждение = Документы.УтверждениеШтатногоРасписания.СоздатьДокумент();
		ДокументУтверждение.Организация = Выборка.Организация;
		ДокументУтверждение.Ответственный = Пользователи.ТекущийПользователь();
		
		ЗаполнитьПодписантовДокумента(ДокументУтверждение,
			?(ЗначениеЗаполнено(Выборка.МесяцВступленияВСилу), Выборка.МесяцВступленияВСилу, КонецМесяца(ТекущаяДатаСеанса()) + 1));
		
		ПараметрыВыполнения = Новый Структура("Организация,Подразделение,ДатаВступленияВСилу");
		ЗаполнитьЗначенияСвойств(ПараметрыВыполнения, ДокументУтверждение);
		ПараметрыВыполнения.ДатаВступленияВСилу = ТекущаяДатаСеанса();
		
		ДокументУтверждение.АвтозаполнениеТекущимиДаннымиШР();
		
		ПараметрыВыполнения.Вставить("Позиции", ДокументУтверждение.Позиции.Выгрузить());
		ПараметрыВыполнения.Вставить("Начисления", ДокументУтверждение.Начисления.Выгрузить());
		ПараметрыВыполнения.Вставить("Показатели", ДокументУтверждение.Показатели.Выгрузить());
		ПараметрыВыполнения.Вставить("ЕжегодныеОтпуска", ДокументУтверждение.ЕжегодныеОтпуска.Выгрузить());
		ПараметрыВыполнения.Вставить("Специальности", ДокументУтверждение.Специальности.Выгрузить());
		
		ДанныеЗаполнения = РезультатЗаполненияПоТекущейКадровойРасстановке(ПараметрыВыполнения);
		
		ЗаполнитьДокументПоДаннымЗаполнения(ДокументУтверждение, ДанныеЗаполнения);
		
		Если НЕ ЗначениеЗаполнено(Выборка.МесяцВступленияВСилу) Тогда
			
			Запрос = Новый Запрос;
			Запрос.Текст =
				"ВЫБРАТЬ ПЕРВЫЕ 1
				|	КадроваяИсторияСотрудников.Период КАК Период
				|ИЗ
				|	РегистрСведений.КадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников
				|ГДЕ
				|	КадроваяИсторияСотрудников.Организация = &Организация
				|	И КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписанию В(&ДолжностьПоШтатномуРасписанию)
				|
				|УПОРЯДОЧИТЬ ПО
				|	Период";
				
			Запрос.УстановитьПараметр("Организация", Выборка.Организация);
			Запрос.УстановитьПараметр("ДолжностьПоШтатномуРасписанию", ДокументУтверждение.Позиции);
			
			ВыборкаПоРаннимДатам = Запрос.Выполнить().Выбрать();
			Если ВыборкаПоРаннимДатам.Следующий() Тогда
				ДокументУтверждение.МесяцВступленияВСилу = НачалоМесяца(ВыборкаПоРаннимДатам.Период);
			Иначе
				ДокументУтверждение.МесяцВступленияВСилу = НачалоМесяца(ТекущаяДатаСеанса());
			КонецЕсли;
			
		Иначе
			ДокументУтверждение.МесяцВступленияВСилу = Выборка.МесяцВступленияВСилу;
		КонецЕсли; 
		
		ДокументУтверждение.ДополнительныеСвойства.Вставить("ОтключитьПроверкуДатыЗапретаИзменения", Истина);
		ДокументУтверждение.Дата = ДокументУтверждение.МесяцВступленияВСилу;
		
		Если ДокументУтверждение.Позиции.Количество() > 0 Тогда
			ДокументУтверждение.Записать(РежимЗаписиДокумента.Проведение);
		КонецЕсли; 
		
	КонецЦикла; 

КонецПроцедуры

Процедура ПеренестиСведенияОПозицияхВСправочник()
	
	ДанныеПозиций = ДанныеПозицийШтатногоРасписания(Ложь, , ТекущаяДатаСеанса(), , Ложь);
	
	Для каждого ОписаниеПозиции Из ДанныеПозиций Цикл
		
		ПозицияОбъект = ОписаниеПозиции.Ключ.ПолучитьОбъект();
		
		ЗаполнитьОбъектСправочникаСведениямиОПозиции(ПозицияОбъект, ОписаниеПозиции);
		
		ОтключитьОбновлениеСтруктурыШтатногоРасписания(ПозицияОбъект);
		ПозицияОбъект.Записать();
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ЗаполнитьОбъектСправочникаСведениямиОПозиции(ПозицияОбъект, ОписанияПозиции)
	
	ЗаполнитьЗначенияСвойств(ПозицияОбъект, ОписанияПозиции.Значение, , "Подразделение,Должность,Начисления,ЕжегодныеОтпуска,Специальности");
	
	// Сведения о начислениях
	Начисления = ПозицияОбъект.Начисления;
	Начисления.Очистить();
	
	Показатели = ПозицияОбъект.Показатели;
	Показатели.Очистить();
	
	Для каждого ОписаниеНачисления Из ОписанияПозиции.Значение.Начисления Цикл
		ЗаполнитьЗначенияСвойств(Начисления.Добавить(), ОписаниеНачисления);
		Для каждого ОписаниеПоказателя Из ОписаниеНачисления.Показатели Цикл
			ЗаполнитьЗначенияСвойств(Показатели.Добавить(), ОписаниеПоказателя);
		КонецЦикла;
	КонецЦикла;
	
	// Сведения о независимых показателях.
	Для каждого ОписаниеПоказателя Из ОписанияПозиции.Значение.НезависимыеПоказатели Цикл
		ЗаполнитьЗначенияСвойств(Показатели.Добавить(), ОписаниеПоказателя);
	КонецЦикла;
	
	// Ежегодные отпуска
	ЕжегодныеОтпуска = ПозицияОбъект.ЕжегодныеОтпуска;
	ЕжегодныеОтпуска.Очистить();
	Для каждого ОписаниеОтпуска Из ОписанияПозиции.Значение.ЕжегодныеОтпуска Цикл
		ЗаполнитьЗначенияСвойств(ЕжегодныеОтпуска.Добавить(), ОписаниеОтпуска);
	КонецЦикла;
	
	// Специальности
	Специальности = ПозицияОбъект.Специальности;
	Специальности.Очистить();
	Для каждого ОписаниеСпециальности Из ОписанияПозиции.Значение.Специальности Цикл
		ЗаполнитьЗначенияСвойств(Специальности.Добавить(), ОписаниеСпециальности);
	КонецЦикла;
	
КонецПроцедуры

Процедура УстановитьДоступностьОтчетовПоШтатномуРасписанию(Настройки) Экспорт
	
	// Варианты отчетов для функциональной опции "ИспользоватьВилкуСтавокВШтатномРасписании".
	Вариант = ВариантыОтчетов.ОписаниеВарианта(Настройки, Метаданные.Отчеты.ШтатноеРасписание, "АнализШтатногоРасписанияИспользуетсяВилкаСтавок");
	Вариант.ФункциональныеОпции.Добавить("ИспользоватьВилкуСтавокВШтатномРасписании");
	
	Вариант = ВариантыОтчетов.ОписаниеВарианта(Настройки, Метаданные.Отчеты.ШтатноеРасписаниеНачисления, "ШтатноеРасписаниеКроссТаблицаИспользуетсяВилкаСтавок");
	Вариант.ФункциональныеОпции.Добавить("ИспользоватьВилкуСтавокВШтатномРасписании");
	
	Вариант = ВариантыОтчетов.ОписаниеВарианта(Настройки, Метаданные.Отчеты.ШтатноеРасписаниеНачисления, "НачисленияПозицийШтатногоРасписанияИспользуетсяВилкаСтавок");
	Вариант.ФункциональныеОпции.Добавить("ИспользоватьВилкуСтавокВШтатномРасписании");

	// Варианты отчетов для функциональной опции "НеИспользоватьВилкуСтавокВШтатномРасписании".
	Вариант = ВариантыОтчетов.ОписаниеВарианта(Настройки, Метаданные.Отчеты.ШтатноеРасписание, "АнализШтатногоРасписания");
	Вариант.ФункциональныеОпции.Добавить("НеИспользоватьВилкуСтавокВШтатномРасписании");
	
	Вариант = ВариантыОтчетов.ОписаниеВарианта(Настройки, Метаданные.Отчеты.ШтатноеРасписаниеНачисления, "ШтатноеРасписаниеКроссТаблица");
	Вариант.ФункциональныеОпции.Добавить("НеИспользоватьВилкуСтавокВШтатномРасписании");
	
	Вариант = ВариантыОтчетов.ОписаниеВарианта(Настройки, Метаданные.Отчеты.ШтатноеРасписаниеНачисления, "НачисленияПозицийШтатногоРасписания");
	Вариант.ФункциональныеОпции.Добавить("НеИспользоватьВилкуСтавокВШтатномРасписании");
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Расчета ФОТ позиций штатного расписания.

Процедура РассчитатьФОТВФормеСОднойПозицией(Форма, ДанныеПозиции, Знач Организация, Знач ДатаРасчета, Знач ОписаниеТаблицыВидовРасчета) Экспорт
	
	Если НЕ ЗначениеЗаполнено(ДатаРасчета) Тогда
		ДатаРасчета = ТекущаяДатаСеанса();
	КонецЕсли; 
	
	КоллекцияПозиций = ПустаяТаблицаКоллекцииПозицийДляРасчетаФОТ();
	КоллекцияНачислений = ПустаяТаблицаКоллекцииНачисленийДляРасчетаФОТ();
	КоллекцияПоказателей = ПустаяТаблицаКоллекцииПоказателейДляРасчетаФОТ();
	
	ПересчетТолькоЗависимыхНачислений = Ложь;
	Если Форма.НачисленияФиксРасчет <> Неопределено Тогда
		
		СоответствиеФиксРасчет = Новый Соответствие(Форма.НачисленияФиксРасчет);
		ПересчетТолькоЗависимыхНачислений = СоответствиеФиксРасчет.Количество() > 0;
		
	КонецЕсли; 
	
	ЗаполнитьЗначенияСвойств(КоллекцияПозиций.Добавить(), ДанныеПозиции);
	
	// Начисления с показателями
	МаксимальноеКоличествоПоказателей = ЗарплатаКадрыРасширенныйКлиентСервер.МаксимальноеКоличествоПоказателейПоОписаниюТаблицы(Форма, ОписаниеТаблицыВидовРасчета);
	ДанныеНачислений = ОбщегоНазначенияКлиентСервер.ПолучитьРеквизитФормыПоПути(Форма, ОписаниеТаблицыВидовРасчета.ПутьКДанным);
	
	МассивНачислений = ОбщегоНазначения.ВыгрузитьКолонку(ДанныеНачислений, "Начисление", Истина);
	ОбщегоНазначенияКлиентСервер.УдалитьЗначениеИзМассива(МассивНачислений, ПланыВидовРасчета.Начисления.ПустаяСсылка());
	
	Для каждого СтрокаНачислений Из ДанныеНачислений Цикл
		
		Если СтрокаНачислений.Свойство("Действие")
			И СтрокаНачислений.Действие = Перечисления.ДействияСНачислениямиИУдержаниями.Отменить Тогда
			Продолжить;
		КонецЕсли; 
		
		Если Не ЗначениеЗаполнено(СтрокаНачислений.Начисление) Тогда
			Продолжить;
		КонецЕсли; 
		
		ИнфоОВидеРасчета = ЗарплатаКадрыРасширенныйПовтИсп.ПолучитьИнформациюОВидеРасчета(СтрокаНачислений.Начисление);
		
		Если ИнфоОВидеРасчета.Рассчитывается Тогда
			Размер = СтрокаНачислений.Размер;
			РазмерМин = СтрокаНачислений.РазмерМин;
			РазмерМакс = СтрокаНачислений.РазмерМакс;
		Иначе
			Если СтрокаНачислений.Свойство("Значение1") Тогда
				Размер = СтрокаНачислений.Значение1;
				РазмерМин = СтрокаНачислений.Значение1;
				РазмерМакс = СтрокаНачислений.Значение1;
			ИначеЕсли СтрокаНачислений.Свойство("МинимальноеЗначение1") И СтрокаНачислений.Свойство("МаксимальноеЗначение1") Тогда 
				Размер = СтрокаНачислений.МаксимальноеЗначение1;
				РазмерМин = СтрокаНачислений.МинимальноеЗначение1;
				РазмерМакс = СтрокаНачислений.МаксимальноеЗначение1;
			КонецЕсли;	
		КонецЕсли;
		
		ОписаниеНачисления = КоллекцияНачислений.Добавить();
		ЗаполнитьЗначенияСвойств(ОписаниеНачисления, СтрокаНачислений);
		
		ОписаниеНачисления.Размер = Размер;
		ОписаниеНачисления.РазмерМин = РазмерМин;
		ОписаниеНачисления.РазмерМакс = РазмерМакс;
		
		Если ПересчетТолькоЗависимыхНачислений
			И (СоответствиеФиксРасчет.Получить(СтрокаНачислений.Начисление) = Истина
				ИЛИ Не ИнфоОВидеРасчета.ТребуетсяРасчетБазы) Тогда
				
			ОписаниеНачисления.ФиксРасчет = Истина;
			
		КонецЕсли; 
		
		Для НомерПоказателя = 1 По МаксимальноеКоличествоПоказателей Цикл
			
			Показатель = СтрокаНачислений["Показатель" + НомерПоказателя];
			Если НЕ ЗначениеЗаполнено(Показатель) Тогда
				Прервать;
			КонецЕсли; 
			
			ОписаниеПоказателя = КоллекцияПоказателей.Добавить();
			ОписаниеПоказателя.ИдентификаторСтрокиВидаРасчета = ОписаниеНачисления.ИдентификаторСтрокиВидаРасчета;
			ОписаниеПоказателя.Показатель = Показатель;
			
			ПутьКЗначению = "Значение" + НомерПоказателя;
			Если СтрокаНачислений.Свойство(ПутьКЗначению) Тогда
				ОписаниеПоказателя.Значение = СтрокаНачислений[ПутьКЗначению];
			КонецЕсли; 
			
			ПутьКЗначению = "МинимальноеЗначение" + НомерПоказателя;
			Если СтрокаНачислений.Свойство(ПутьКЗначению) Тогда
				ОписаниеПоказателя.ЗначениеМин = СтрокаНачислений[ПутьКЗначению];
			КонецЕсли; 
			
			ПутьКЗначению = "МаксимальноеЗначение" + НомерПоказателя;
			Если СтрокаНачислений.Свойство(ПутьКЗначению) Тогда
				ОписаниеПоказателя.ЗначениеМакс = СтрокаНачислений[ПутьКЗначению];
			КонецЕсли; 
			
		КонецЦикла;
		
	КонецЦикла;
	
	// Доп. тарифы коэффициенты
	ДанныеПоказателей = ОбщегоНазначенияКлиентСервер.ПолучитьРеквизитФормыПоПути(Форма, ОписаниеТаблицыВидовРасчета.ПутьКДаннымПоказателей);
	СтрокиДопПоказателей = ДанныеПоказателей.НайтиСтроки(Новый Структура("ИдентификаторСтрокиВидаРасчета", 0));
	Для каждого СтрокаПоказателя Из СтрокиДопПоказателей Цикл
		
		ОписаниеПоказателя = КоллекцияПоказателей.Добавить();
		ОписаниеПоказателя.ИдентификаторСтрокиВидаРасчета = 0;
		ОписаниеПоказателя.Показатель = СтрокаПоказателя.Показатель;
			
		ПутьКЗначению = "Значение";
		Если СтрокаПоказателя.Свойство(ПутьКЗначению) Тогда
			ОписаниеПоказателя.Значение = СтрокаПоказателя[ПутьКЗначению];
		КонецЕсли; 
		
		ПутьКЗначению = "ЗначениеМин";
		Если СтрокаПоказателя.Свойство(ПутьКЗначению) Тогда
			ОписаниеПоказателя.ЗначениеМин = СтрокаПоказателя[ПутьКЗначению];
		КонецЕсли; 
		
		ПутьКЗначению = "ЗначениеМакс";
		Если СтрокаПоказателя.Свойство(ПутьКЗначению) Тогда
			ОписаниеПоказателя.ЗначениеМакс = СтрокаПоказателя[ПутьКЗначению];
		КонецЕсли;
		
	КонецЦикла;
	
	ОписаниеПозиций = Новый Структура;
	ОписаниеПозиций.Вставить("Организация", Организация);
	ОписаниеПозиций.Вставить("ДатаВступленияВСилу", ДатаРасчета);
	ОписаниеПозиций.Вставить("Позиции", КоллекцияПозиций);
	ОписаниеПозиций.Вставить("Начисления", КоллекцияНачислений);
	ОписаниеПозиций.Вставить("Показатели", КоллекцияПоказателей);
	
	РассчитатьФОТНесколькихПозиций(ОписаниеПозиций);
	
	ЗаполнитьЗначенияСвойств(ДанныеПозиции, ОписаниеПозиций.Позиции[0], СвойстваПозицииСРезультатамиРасчетаФОТ());
		
	Для каждого РассчитанноеНачисление Из ОписаниеПозиций.Начисления Цикл
		
		СтрокиНачислений = ДанныеНачислений.НайтиСтроки(Новый Структура("Начисление", РассчитанноеНачисление.Начисление));
		Для каждого СтрокаНачислений Из СтрокиНачислений Цикл
			ЗаполнитьЗначенияСвойств(СтрокаНачислений, РассчитанноеНачисление, "Размер,РазмерМин,РазмерМакс");
		КонецЦикла;
			
	КонецЦикла;
	
	Форма.НачисленияФиксРасчет = Неопределено;
	
КонецПроцедуры

Процедура РассчитатьФОТНесколькихПозиций(ОписаниеПозиций) Экспорт
	
	Организация = ОписаниеПозиций.Организация;
	ДатаРасчета = ОписаниеПозиций.ДатаВступленияВСилу;
	
	ТаблицаПозиций = ОписаниеПозиций.Позиции.Скопировать();
	ТаблицаПозиций.Колонки.Добавить("Сотрудник", Новый ОписаниеТипов("СправочникСсылка.Сотрудники"));
	ТаблицаПозиций.Колонки.Добавить("СотрудникМин", Новый ОписаниеТипов("СправочникСсылка.Сотрудники"));
	ТаблицаПозиций.Колонки.Добавить("СотрудникМакс", Новый ОписаниеТипов("СправочникСсылка.Сотрудники"));
	ТаблицаПозиций.Колонки.Добавить("ФизическоеЛицо", Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица"));
	
	СоответствиеПозицийСотрудникам = Новый Соответствие;
	СоответствиеПозицийСотрудникамМин = Новый Соответствие;
	СоответствиеПозицийСотрудникамМакс = Новый Соответствие;
	
	Для каждого СтрокаТаблицаПозиций Из ТаблицаПозиций Цикл
		
		СтрокаТаблицаПозиций.Сотрудник = Справочники.Сотрудники.ПолучитьСсылку();
		СтрокаТаблицаПозиций.СотрудникМин = Справочники.Сотрудники.ПолучитьСсылку();
		СтрокаТаблицаПозиций.СотрудникМакс = Справочники.Сотрудники.ПолучитьСсылку();
		
		СтрокаТаблицаПозиций.ФизическоеЛицо = Справочники.ФизическиеЛица.ПолучитьСсылку();
		
		СоответствиеПозицийСотрудникам.Вставить(СтрокаТаблицаПозиций.Сотрудник, СтрокаТаблицаПозиций.ИдентификаторСтрокиПозиции);
		СоответствиеПозицийСотрудникамМин.Вставить(СтрокаТаблицаПозиций.СотрудникМин, СтрокаТаблицаПозиций.ИдентификаторСтрокиПозиции);
		СоответствиеПозицийСотрудникамМакс.Вставить(СтрокаТаблицаПозиций.СотрудникМакс, СтрокаТаблицаПозиций.ИдентификаторСтрокиПозиции);
		
	КонецЦикла;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("ДатаРасчета", ДатаРасчета);
	Запрос.УстановитьПараметр("Позиции", ТаблицаПозиций);
	
	ТаблицаНачислений = ОписаниеПозиций.Начисления.Скопировать();
	Если ТаблицаНачислений.Колонки.Найти("ФиксРасчет") = Неопределено Тогда
		ТаблицаНачислений.Колонки.Добавить("ФиксРасчет", Новый ОписаниеТипов("Булево"));
	КонецЕсли; 
	Запрос.УстановитьПараметр("Начисления", ТаблицаНачислений);
	
	Запрос.УстановитьПараметр("Показатели", ОписаниеПозиций.Показатели.Скопировать());
	
	Запрос.УстановитьПараметр("ИспользоватьВилкуСтавокВШтатномРасписании", ПолучитьФункциональнуюОпцию("ИспользоватьВилкуСтавокВШтатномРасписании"));
	
	ВРНадбавкаЗаВредность = НачисленияНадбавкаЗаВредность();
	Запрос.УстановитьПараметр("ВРНадбавкаЗаВредность", ВРНадбавкаЗаВредность);
	Запрос.УстановитьПараметр("ПоказательПроцентНадбавкиЗаВредность", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.ПроцентНадбавкиЗаВредность"));
	
	
	Запрос.УстановитьПараметр("ДоляНеполногоРабочегоВремени", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.ДоляНеполногоРабочегоВремени"));
	
	Запрос.УстановитьПараметр("ВремяВДнях", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.ВремяВДнях"));
	Запрос.УстановитьПараметр("ОтработаноДней", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.ОтработаноДней"));
	Запрос.УстановитьПараметр("НормаДнейПоГрафикуПолногоРабочегоВремени", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.НормаВремениВДнях"));
	Запрос.УстановитьПараметр("НормаДней", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.НормаДней"));

	Запрос.УстановитьПараметр("ВремяВЧасах", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.ВремяВЧасах"));
	Запрос.УстановитьПараметр("ОтработаноЧасов", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.ОтработаноЧасов"));
	Запрос.УстановитьПараметр("НормаЧасов", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.НормаВремениВЧасах"));
	
	Запрос.УстановитьПараметр("КалендарныеДни", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.КалендарныеДни"));
	Запрос.УстановитьПараметр("КалендарныеДниМесяца", ОбщегоНазначенияКлиентСервер.ПредопределенныйЭлемент("Справочник.ПоказателиРасчетаЗарплаты.КалендарныеДниМесяца"));
	
	Запрос.УстановитьПараметр("НачисленияВходящиеВФОТ", РасчетЗарплатыРасширенный.НачисленияВходящиеВСоставФОТ());
	
	Запрос.Текст =
		"ВЫБРАТЬ
		|	&ДатаРасчета КАК Период,
		|	ПозицииДокумента.Позиция,
		|	ПозицииДокумента.ИдентификаторСтрокиПозиции,
		|	&Организация КАК Организация,
		|	ПозицииДокумента.Должность,
		|	ПозицииДокумента.Подразделение КАК СтруктурнаяЕдиница,
		|	ВЫРАЗИТЬ(ПозицииДокумента.Подразделение КАК Справочник.ПодразделенияОрганизаций) КАК Подразделение,
		|	ПозицииДокумента.ГрафикРаботыСотрудников КАК ГрафикРаботы,
		|	ПозицииДокумента.ОкладТариф,
		|	ПозицииДокумента.ОкладТарифМин,
		|	ПозицииДокумента.ОкладТарифМакс,
		|	ПозицииДокумента.ФОТ,
		|	ПозицииДокумента.ФОТМин,
		|	ПозицииДокумента.ФОТМакс,
		|	ПозицииДокумента.НадбавкаЗаВредностьРазмер,
		|	ПозицииДокумента.НадбавкаЗаВредностьРазмерМин,
		|	ПозицииДокумента.НадбавкаЗаВредностьРазмерМакс,
		|	ПозицииДокумента.ВыплачиваетсяНадбавкаЗаВредность,
		|	ПозицииДокумента.ПроцентНадбавкиЗаВредность,
		|	ПозицииДокумента.Сотрудник,
		|	ПозицииДокумента.СотрудникМин,
		|	ПозицииДокумента.СотрудникМакс,
		|	ПозицииДокумента.ФизическоеЛицо
		|ПОМЕСТИТЬ ВТПозицииПредварительно
		|ИЗ
		|	&Позиции КАК ПозицииДокумента";
		
	Запрос.Выполнить();
			
	// Таблицы периодических показателей организации.
	ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
		"ЗначенияПериодическихПоказателейРасчетаЗарплатыОрганизаций",
		Запрос.МенеджерВременныхТаблиц,
		Истина,
		ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра(
			"ВТПозицииПредварительно",
			"Организация"),
		,
		"ВТЗначенияПериодическихПоказателейОрганизаций");
	
	// Таблицы периодических показателей подразделения.
	ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
		"ЗначенияПериодическихПоказателейРасчетаЗарплатыПодразделений",
		Запрос.МенеджерВременныхТаблиц,
		Истина,
		ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра(
			"ВТПозицииПредварительно",
			"Подразделение"),
		,
		"ВТЗначенияПериодическихПоказателейПодразделений");
	
	Запрос.Текст =
		"ВЫБРАТЬ
		|	Позиции.Период,
		|	Позиции.Позиция,
		|	Позиции.ИдентификаторСтрокиПозиции,
		|	Позиции.Организация,
		|	Позиции.Должность,
		|	Позиции.Подразделение,
		|	Позиции.ГрафикРаботы,
		|	Позиции.ОкладТариф,
		|	Позиции.ОкладТарифМин,
		|	Позиции.ОкладТарифМакс,
		|	Позиции.ФОТ,
		|	Позиции.ФОТМин,
		|	Позиции.ФОТМакс,
		|	Позиции.НадбавкаЗаВредностьРазмер,
		|	Позиции.НадбавкаЗаВредностьРазмерМин,
		|	Позиции.НадбавкаЗаВредностьРазмерМакс,
		|	Позиции.ВыплачиваетсяНадбавкаЗаВредность,
		|	Позиции.ПроцентНадбавкиЗаВредность,
		|	Позиции.Сотрудник,
		|	Позиции.СотрудникМин,
		|	Позиции.СотрудникМакс,
		|	Позиции.ФизическоеЛицо
		|ПОМЕСТИТЬ ВТПозиции
		|ИЗ
		|	ВТПозицииПредварительно КАК Позиции
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	ЕСТЬNULL(СреднемесячныеНормыВремениПолногоГрафиковРаботыСотрудников.СреднемесячноеЧислоЧасов, СреднемесячныеНормыВремениГрафиковРаботыСотрудников.СреднемесячноеЧислоЧасов) КАК СреднемесячноеЧислоЧасов,
		|	ЕСТЬNULL(СреднемесячныеНормыВремениПолногоГрафиковРаботыСотрудников.СреднемесячноеЧислоДней, СреднемесячныеНормыВремениГрафиковРаботыСотрудников.СреднемесячноеЧислоДней) КАК СреднемесячноеЧислоДней,
		|	СреднемесячныеНормыВремениГрафиковРаботыСотрудников.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников,
		|	СреднемесячныеНормыВремениГрафиковРаботыСотрудников.СреднемесячноеЧислоДней КАК СреднемесячноеЧислоДнейНорма,
		|	ВЫБОР
		|		КОГДА НЕ СреднемесячныеНормыВремениПолногоГрафиковРаботыСотрудников.СреднемесячноеЧислоЧасов ЕСТЬ NULL 
		|				И НЕ СреднемесячныеНормыВремениГрафиковРаботыСотрудников.СреднемесячноеЧислоЧасов ЕСТЬ NULL 
		|			ТОГДА СреднемесячныеНормыВремениГрафиковРаботыСотрудников.СреднемесячноеЧислоЧасов / СреднемесячныеНормыВремениПолногоГрафиковРаботыСотрудников.СреднемесячноеЧислоЧасов
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК ДоляНеполногоРабочегоВремени
		|ПОМЕСТИТЬ ВТСреднемесячныеЗначенияНормыВремени
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СреднемесячныеНормыВремениГрафиковРаботыСотрудников КАК СреднемесячныеНормыВремениГрафиковРаботыСотрудников
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеНормыВремениГрафиковРаботыСотрудников.ГрафикРаботыСотрудников
		|			И (СреднемесячныеНормыВремениГрафиковРаботыСотрудников.Год = ГОД(&ДатаРасчета))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СреднемесячныеНормыВремениГрафиковРаботыСотрудников КАК СреднемесячныеНормыВремениПолногоГрафиковРаботыСотрудников
		|		ПО (ВЫРАЗИТЬ(Позиции.ГрафикРаботы КАК Справочник.ГрафикиРаботыСотрудников).ГрафикПолногоРабочегоВремени = СреднемесячныеНормыВремениПолногоГрафиковРаботыСотрудников.ГрафикРаботыСотрудников)
		|			И (СреднемесячныеНормыВремениПолногоГрафиковРаботыСотрудников.Год = ГОД(&ДатаРасчета))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НачисленияПозиций.ИдентификаторСтрокиПозиции,
		|	НачисленияПозиций.ИдентификаторСтрокиВидаРасчета,
		|	ВЫРАЗИТЬ(НачисленияПозиций.Начисление КАК ПланВидовРасчета.Начисления) КАК Начисление,
		|	НачисленияПозиций.Размер,
		|	НачисленияПозиций.РазмерМин,
		|	НачисленияПозиций.РазмерМакс,
		|	НачисленияПозиций.ФиксРасчет
		|ПОМЕСТИТЬ ВТНачисленияПредварительно
		|ИЗ
		|	&Начисления КАК НачисленияПозиций
		|ГДЕ
		|	НачисленияПозиций.Действие <> ЗНАЧЕНИЕ(Перечисление.ДействияСНачислениямиИУдержаниями.Отменить)
		|	И НачисленияПозиций.Начисление <> ЗНАЧЕНИЕ(ПланВидовРасчета.Начисления.ПустаяСсылка)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НачисленияПозиций.ИдентификаторСтрокиПозиции,
		|	НачисленияПозиций.ИдентификаторСтрокиВидаРасчета,
		|	НачисленияПозиций.Начисление,
		|	ВЫБОР
		|		КОГДА НачисленияПозиций.Начисление В (&НачисленияВходящиеВФОТ)
		|			ТОГДА НачисленияПозиций.Размер
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Размер,
		|	ВЫБОР
		|		КОГДА НачисленияПозиций.Начисление В (&НачисленияВходящиеВФОТ)
		|			ТОГДА НачисленияПозиций.РазмерМин
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК РазмерМин,
		|	ВЫБОР
		|		КОГДА НачисленияПозиций.Начисление В (&НачисленияВходящиеВФОТ)
		|			ТОГДА НачисленияПозиций.РазмерМакс
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК РазмерМакс,
		|	ВЫБОР
		|		КОГДА НачисленияПозиций.Начисление В (&НачисленияВходящиеВФОТ)
		|			ТОГДА НачисленияПозиций.ФиксРасчет
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ КАК ФиксРасчет
		|ПОМЕСТИТЬ ВТНачисления
		|ИЗ
		|	ВТНачисленияПредварительно КАК НачисленияПозиций
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.ИдентификаторСтрокиПозиции,
		|	Позиции.ИдентификаторСтрокиПозиции * 100002,
		|	&ВРНадбавкаЗаВредность,
		|	0,
		|	0,
		|	0,
		|	ЛОЖЬ
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	Позиции.ВыплачиваетсяНадбавкаЗаВредность
		|	И &ВРНадбавкаЗаВредность <> НЕОПРЕДЕЛЕНО
		|	И &ВРНадбавкаЗаВредность В (&НачисленияВходящиеВФОТ)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПоказателиНачислений.ИдентификаторСтрокиПозиции,
		|	ПоказателиНачислений.ИдентификаторСтрокиВидаРасчета,
		|	ПоказателиНачислений.Показатель,
		|	ПоказателиНачислений.Значение,
		|	ПоказателиНачислений.ЗначениеМин,
		|	ПоказателиНачислений.ЗначениеМакс
		|ПОМЕСТИТЬ ВТПоказатели
		|ИЗ
		|	&Показатели КАК ПоказателиНачислений
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПоказателиРасчетаЗарплатыШкалаОценкиСтажа.Ссылка КАК Показатель,
		|	МАКСИМУМ(ЕСТЬNULL(ПоказателиРасчетаЗарплатыШкалаОценкиСтажа.ЗначениеПоказателя, 0)) КАК Значение
		|ПОМЕСТИТЬ ВТПоказателиЗависящиеОтСтажа
		|ИЗ
		|	Справочник.ПоказателиРасчетаЗарплаты.ШкалаОценкиСтажа КАК ПоказателиРасчетаЗарплатыШкалаОценкиСтажа
		|ГДЕ
		|	ПоказателиРасчетаЗарплатыШкалаОценкиСтажа.Ссылка.ТипПоказателя = ЗНАЧЕНИЕ(Перечисление.ТипыПоказателейРасчетаЗарплаты.ЧисловойЗависящийОтСтажа)
		|
		|СГРУППИРОВАТЬ ПО
		|	ПоказателиРасчетаЗарплатыШкалаОценкиСтажа.Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Позиции.Позиция КАК Позиция,
		|	Начисления.ИдентификаторСтрокиВидаРасчета КАК ИдентификаторСтрокиВидаРасчета,
		|	Позиции.Организация,
		|	Позиции.Подразделение,
		|	Позиции.Сотрудник,
		|	Позиции.ФизическоеЛицо,
		|	Позиции.ГрафикРаботы,
		|	Позиции.ОкладТариф,
		|	Позиции.ФОТ,
		|	ВЫРАЗИТЬ(Начисления.Начисление КАК ПланВидовРасчета.Начисления) КАК Начисление,
		|	Начисления.Размер,
		|	Начисления.ФиксРасчет,
		|	НЕОПРЕДЕЛЕНО КАК РасчетПоМакс,
		|	Начисления.ИдентификаторСтрокиПозиции,
		|	Позиции.НадбавкаЗаВредностьРазмер
		|ПОМЕСТИТЬ ВТПолныйСписокПозицийСНачислениями
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНачисления КАК Начисления
		|		ПО Позиции.ИдентификаторСтрокиПозиции = Начисления.ИдентификаторСтрокиПозиции
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Позиция,
		|	Начисления.ИдентификаторСтрокиВидаРасчета,
		|	Позиции.Организация,
		|	Позиции.Подразделение,
		|	Позиции.СотрудникМин,
		|	Позиции.ФизическоеЛицо,
		|	Позиции.ГрафикРаботы,
		|	Позиции.ОкладТарифМин,
		|	Позиции.ФОТМин,
		|	Начисления.Начисление,
		|	Начисления.РазмерМин,
		|	Начисления.ФиксРасчет,
		|	ЛОЖЬ,
		|	Позиции.ИдентификаторСтрокиПозиции,
		|	Позиции.НадбавкаЗаВредностьРазмерМин
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНачисления КАК Начисления
		|		ПО Позиции.ИдентификаторСтрокиПозиции = Начисления.ИдентификаторСтрокиПозиции
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Позиция,
		|	Начисления.ИдентификаторСтрокиВидаРасчета,
		|	Позиции.Организация,
		|	Позиции.Подразделение,
		|	Позиции.СотрудникМакс,
		|	Позиции.ФизическоеЛицо,
		|	Позиции.ГрафикРаботы,
		|	Позиции.ОкладТарифМакс,
		|	Позиции.ФОТМакс,
		|	Начисления.Начисление,
		|	Начисления.РазмерМакс,
		|	Начисления.ФиксРасчет,
		|	ИСТИНА,
		|	Позиции.ИдентификаторСтрокиПозиции,
		|	Позиции.НадбавкаЗаВредностьРазмерМакс
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНачисления КАК Начисления
		|		ПО Позиции.ИдентификаторСтрокиПозиции = Начисления.ИдентификаторСтрокиПозиции
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПолныйСписокПозицийСНачислениями.Сотрудник,
		|	МИНИМУМ(ПолныйСписокПозицийСНачислениями.Начисление.РеквизитДопУпорядочивания) КАК Порядок,
		|	ПолныйСписокПозицийСНачислениями.РасчетПоМакс,
		|	ПолныйСписокПозицийСНачислениями.ИдентификаторСтрокиПозиции
		|ПОМЕСТИТЬ ВТМинимальныйПорядокОсновныхНачислений
		|ИЗ
		|	ВТПолныйСписокПозицийСНачислениями КАК ПолныйСписокПозицийСНачислениями
		|ГДЕ
		|	ПолныйСписокПозицийСНачислениями.Начисление.ВидВремени В (ЗНАЧЕНИЕ(Перечисление.ВидыРабочегоВремениСотрудников.ОтработанноеВПределахНормы), ЗНАЧЕНИЕ(Перечисление.ВидыРабочегоВремениСотрудников.ЧасовоеОтработанноеВПределахНормы))
		|
		|СГРУППИРОВАТЬ ПО
		|	ПолныйСписокПозицийСНачислениями.Сотрудник,
		|	ПолныйСписокПозицийСНачислениями.РасчетПоМакс,
		|	ПолныйСписокПозицийСНачислениями.ИдентификаторСтрокиПозиции
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПолныйСписокПозицийСНачислениями.Сотрудник КАК Сотрудник,
		|	Показатели.Показатель КАК Показатель,
		|	ВЫБОР
		|		КОГДА ПолныйСписокПозицийСНачислениями.РасчетПоМакс = ИСТИНА
		|			ТОГДА Показатели.ЗначениеМакс
		|		КОГДА ПолныйСписокПозицийСНачислениями.РасчетПоМакс = ЛОЖЬ
		|			ТОГДА Показатели.ЗначениеМин
		|		ИНАЧЕ Показатели.Значение
		|	КОНЕЦ КАК Значение
		|ПОМЕСТИТЬ ВТВсеПоказатели
		|ИЗ
		|	ВТПолныйСписокПозицийСНачислениями КАК ПолныйСписокПозицийСНачислениями
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоказатели КАК Показатели
		|		ПО ПолныйСписокПозицийСНачислениями.ИдентификаторСтрокиПозиции = Показатели.ИдентификаторСтрокиПозиции
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	Показатели.Показатель,
		|	Показатели.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЗначенияПериодическихПоказателейОрганизаций КАК Показатели
		|		ПО Позиции.Период = Показатели.Период
		|			И Позиции.Организация = Показатели.Организация
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И Показатели.Значение <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	Показатели.Показатель,
		|	Показатели.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЗначенияПериодическихПоказателейОрганизаций КАК Показатели
		|		ПО Позиции.Период = Показатели.Период
		|			И Позиции.Организация = Показатели.Организация
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И Показатели.Значение <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	Показатели.Показатель,
		|	Показатели.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЗначенияПериодическихПоказателейОрганизаций КАК Показатели
		|		ПО Позиции.Период = Показатели.Период
		|			И Позиции.Организация = Показатели.Организация
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И Показатели.Значение <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	Показатели.Показатель,
		|	Показатели.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЗначенияПериодическихПоказателейПодразделений КАК Показатели
		|		ПО Позиции.Период = Показатели.Период
		|			И Позиции.Подразделение = Показатели.Подразделение
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И Показатели.Значение <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	Показатели.Показатель,
		|	Показатели.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЗначенияПериодическихПоказателейПодразделений КАК Показатели
		|		ПО Позиции.Период = Показатели.Период
		|			И Позиции.Подразделение = Показатели.Подразделение
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И Показатели.Значение <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	Показатели.Показатель,
		|	Показатели.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЗначенияПериодическихПоказателейПодразделений КАК Показатели
		|		ПО Позиции.Период = Показатели.Период
		|			И Позиции.Подразделение = Показатели.Подразделение
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И Показатели.Значение <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&КалендарныеДни,
		|	1
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &КалендарныеДни <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&КалендарныеДни,
		|	1
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &КалендарныеДни <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&КалендарныеДни,
		|	1
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &КалендарныеДни <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&КалендарныеДниМесяца,
		|	1
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &КалендарныеДниМесяца <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&КалендарныеДниМесяца,
		|	1
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &КалендарныеДниМесяца <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&КалендарныеДниМесяца,
		|	1
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &КалендарныеДниМесяца <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&ДоляНеполногоРабочегоВремени,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.ДоляНеполногоРабочегоВремени, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ДоляНеполногоРабочегоВремени <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&ДоляНеполногоРабочегоВремени,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.ДоляНеполногоРабочегоВремени, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ДоляНеполногоРабочегоВремени <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&ДоляНеполногоРабочегоВремени,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.ДоляНеполногоРабочегоВремени, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ДоляНеполногоРабочегоВремени <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&НормаДней,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДнейНорма, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаДней <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&НормаДней,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДнейНорма, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаДней <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&НормаДней,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДнейНорма, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаДней <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&НормаДнейПоГрафикуПолногоРабочегоВремени,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаДнейПоГрафикуПолногоРабочегоВремени <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&НормаДнейПоГрафикуПолногоРабочегоВремени,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаДнейПоГрафикуПолногоРабочегоВремени <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&НормаДнейПоГрафикуПолногоРабочегоВремени,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаДнейПоГрафикуПолногоРабочегоВремени <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&ВремяВДнях,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ВремяВДнях <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&ВремяВДнях,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ВремяВДнях <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&ВремяВДнях,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ВремяВДнях <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&ОтработаноДней,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ОтработаноДней <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&ОтработаноДней,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ОтработаноДней <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&ОтработаноДней,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ОтработаноДней <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&ПоказательПроцентНадбавкиЗаВредность,
		|	Позиции.ПроцентНадбавкиЗаВредность
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	Позиции.ВыплачиваетсяНадбавкаЗаВредность
		|	И НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ПоказательПроцентНадбавкиЗаВредность <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&ПоказательПроцентНадбавкиЗаВредность,
		|	Позиции.ПроцентНадбавкиЗаВредность
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	Позиции.ВыплачиваетсяНадбавкаЗаВредность
		|	И &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ПоказательПроцентНадбавкиЗаВредность <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&ПоказательПроцентНадбавкиЗаВредность,
		|	Позиции.ПроцентНадбавкиЗаВредность
		|ИЗ
		|	ВТПозиции КАК Позиции
		|ГДЕ
		|	Позиции.ВыплачиваетсяНадбавкаЗаВредность
		|	И &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ПоказательПроцентНадбавкиЗаВредность <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&НормаЧасов,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаЧасов <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&НормаЧасов,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаЧасов <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&НормаЧасов,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &НормаЧасов <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&ВремяВЧасах,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ВремяВЧасах <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&ВремяВЧасах,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ВремяВЧасах <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&ВремяВЧасах,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ВремяВЧасах <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	&ОтработаноЧасов,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ОтработаноЧасов <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	&ОтработаноЧасов,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ОтработаноЧасов <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	&ОтработаноЧасов,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоЧасов, 1)
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО Позиции.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|	И &ОтработаноЧасов <> НЕОПРЕДЕЛЕНО
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.Сотрудник,
		|	ПоказателиЗависящиеОтСтажа.Показатель,
		|	ПоказателиЗависящиеОтСтажа.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоказателиЗависящиеОтСтажа КАК ПоказателиЗависящиеОтСтажа
		|		ПО (ИСТИНА)
		|ГДЕ
		|	НЕ &ИспользоватьВилкуСтавокВШтатномРасписании
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМин,
		|	ПоказателиЗависящиеОтСтажа.Показатель,
		|	ПоказателиЗависящиеОтСтажа.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоказателиЗависящиеОтСтажа КАК ПоказателиЗависящиеОтСтажа
		|		ПО (ИСТИНА)
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Позиции.СотрудникМакс,
		|	ПоказателиЗависящиеОтСтажа.Показатель,
		|	ПоказателиЗависящиеОтСтажа.Значение
		|ИЗ
		|	ВТПозиции КАК Позиции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоказателиЗависящиеОтСтажа КАК ПоказателиЗависящиеОтСтажа
		|		ПО (ИСТИНА)
		|ГДЕ
		|	&ИспользоватьВилкуСтавокВШтатномРасписании
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МинимальныйПорядокОсновныхНачислений.ИдентификаторСтрокиПозиции,
		|	СУММА(ВЫБОР
		|			КОГДА МинимальныйПорядокОсновныхНачислений.РасчетПоМакс = НЕОПРЕДЕЛЕНО
		|				ТОГДА Показатели.Значение
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ОкладТариф,
		|	СУММА(ВЫБОР
		|			КОГДА МинимальныйПорядокОсновныхНачислений.РасчетПоМакс = ИСТИНА
		|				ТОГДА Показатели.ЗначениеМакс
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ОкладТарифМакс,
		|	СУММА(ВЫБОР
		|			КОГДА МинимальныйПорядокОсновныхНачислений.РасчетПоМакс = ЛОЖЬ
		|				ТОГДА Показатели.ЗначениеМин
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ОкладТарифМин
		|ИЗ
		|	ВТМинимальныйПорядокОсновныхНачислений КАК МинимальныйПорядокОсновныхНачислений
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНачисления КАК Начисления
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовРасчета.Начисления.Показатели КАК НачисленияПоказатели
		|			ПО Начисления.Начисление = НачисленияПоказатели.Ссылка
		|				И (НачисленияПоказатели.ОсновнойПоказатель)
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПоказатели КАК Показатели
		|			ПО Начисления.ИдентификаторСтрокиВидаРасчета = Показатели.ИдентификаторСтрокиВидаРасчета
		|				И Начисления.ИдентификаторСтрокиПозиции = Показатели.ИдентификаторСтрокиПозиции
		|				И (НачисленияПоказатели.Показатель = Показатели.Показатель)
		|		ПО МинимальныйПорядокОсновныхНачислений.ИдентификаторСтрокиПозиции = Начисления.ИдентификаторСтрокиПозиции
		|			И МинимальныйПорядокОсновныхНачислений.Порядок = Начисления.Начисление.РеквизитДопУпорядочивания
		|
		|СГРУППИРОВАТЬ ПО
		|	МинимальныйПорядокОсновныхНачислений.ИдентификаторСтрокиПозиции
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВсеПоказатели.Сотрудник,
		|	ВсеПоказатели.Показатель,
		|	ВсеПоказатели.Значение
		|ИЗ
		|	ВТВсеПоказатели КАК ВсеПоказатели
		|ГДЕ
		|	ВсеПоказатели.Показатель <> НЕОПРЕДЕЛЕНО
		|	И ЕСТЬNULL(ВсеПоказатели.Показатель, ЗНАЧЕНИЕ(Справочник.ПоказателиРасчетаЗарплаты.ПустаяСсылка)) <> ЗНАЧЕНИЕ(Справочник.ПоказателиРасчетаЗарплаты.ПустаяСсылка)
		|
		|УПОРЯДОЧИТЬ ПО
		|	ВсеПоказатели.Сотрудник,
		|	ВсеПоказатели.Показатель,
		|	ВсеПоказатели.Значение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПолныйСписокПозицийСНачислениями.Организация,
		|	ПолныйСписокПозицийСНачислениями.Подразделение,
		|	ПолныйСписокПозицийСНачислениями.Сотрудник КАК Сотрудник,
		|	ПолныйСписокПозицийСНачислениями.ФизическоеЛицо,
		|	ПолныйСписокПозицийСНачислениями.ГрафикРаботы,
		|	ПолныйСписокПозицийСНачислениями.Начисление КАК Начисление,
		|	ВЫБОР
		|		КОГДА ПолныйСписокПозицийСНачислениями.Начисление = &ВРНадбавкаЗаВредность
		|			ТОГДА ЛОЖЬ
		|		КОГДА НЕ ПолныйСписокПозицийСНачислениями.Начисление В (&НачисленияВходящиеВФОТ)
		|			ТОГДА ИСТИНА
		|		КОГДА ПолныйСписокПозицийСНачислениями.Размер = 0
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ПолныйСписокПозицийСНачислениями.ФиксРасчет
		|	КОНЕЦ КАК ФиксРасчет,
		|	ИСТИНА КАК ФиксРасчетВремени,
		|	0 КАК ИдентификаторСтрокиВидаРасчета,
		|	0 КАК Значение1,
		|	ПолныйСписокПозицийСНачислениями.Размер КАК Результат,
		|	НАЧАЛОПЕРИОДА(&ДатаРасчета, МЕСЯЦ) КАК ДатаНачала,
		|	КОНЕЦПЕРИОДА(&ДатаРасчета, МЕСЯЦ) КАК ДатаОкончания,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1) КАК ВремяВДнях,
		|	ЕСТЬNULL(СреднемесячныеЗначенияНормыВремени.СреднемесячноеЧислоДней, 1) КАК НормаДнейПоГрафикуПолногоРабочегоВремени
		|ИЗ
		|	ВТПолныйСписокПозицийСНачислениями КАК ПолныйСписокПозицийСНачислениями
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднемесячныеЗначенияНормыВремени КАК СреднемесячныеЗначенияНормыВремени
		|		ПО ПолныйСписокПозицийСНачислениями.ГрафикРаботы = СреднемесячныеЗначенияНормыВремени.ГрафикРаботыСотрудников
		|
		|УПОРЯДОЧИТЬ ПО
		|	Сотрудник,
		|	Начисление";
		
	ТекстЗапросовПоказателей = "";
	Для НомерПоказателя = 1 По ЗарплатаКадрыРасширенныйПовтИсп.МаксимальноеКоличествоПоказателейИспользуемыхПриРасчете() Цикл
		ТекстЗапросовПоказателей = ТекстЗапросовПоказателей + Символы.ПС + "0 КАК Значение" + НомерПоказателя + ",";
	КонецЦикла;
		
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "0 КАК Значение1,", СокрЛП(ТекстЗапросовПоказателей));
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	ТаблицаОкладов = РезультатЗапроса[РезультатЗапроса.Количество() - 3].Выгрузить();
	Для каждого СтрокаТаблицаОкладов Из ТаблицаОкладов Цикл
		НайденныеСтрокиПозиций = ОписаниеПозиций.Позиции.НайтиСтроки(Новый Структура("ИдентификаторСтрокиПозиции", СтрокаТаблицаОкладов.ИдентификаторСтрокиПозиции));
		Для каждого НайденнаяСтрока Из НайденныеСтрокиПозиций Цикл
			ЗаполнитьЗначенияСвойств(НайденнаяСтрока, СтрокаТаблицаОкладов, "ОкладТариф,ОкладТарифМакс,ОкладТарифМин");
		КонецЦикла;
	КонецЦикла;
	
	ИзвестныеЗначенияПоказателей = РезультатЗапроса[РезультатЗапроса.Количество() - 2].Выгрузить();
	
	// Получение таблицы начислений со всеми показателями.
	РассчитываемаяТаблица = РасчетЗарплатыРасширенный.ПустаяТаблицаНачисления();
	Выборка = РезультатЗапроса[РезультатЗапроса.Количество() - 1].Выбрать();
	Пока Выборка.Следующий() Цикл
		ЗаполнитьЗначенияСвойств(РассчитываемаяТаблица.Добавить(), Выборка);
	КонецЦикла; 
	
	// Заполним результат не рассчитываемых начислений.
	МассивНачислений = ОбщегоНазначения.ВыгрузитьКолонку(ОписаниеПозиций.Начисления, "Начисление", Истина);
	ОбщегоНазначенияКлиентСервер.УдалитьЗначениеИзМассива(МассивНачислений, ПланыВидовРасчета.Начисления.ПустаяСсылка());
	
	ЗначенияРеквизитаРассчитывается = Новый Соответствие;
	Если МассивНачислений.Количество() > 0 Тогда 
		ЗначенияРеквизитаРассчитывается = ОбщегоНазначения.ЗначениеРеквизитаОбъектов(МассивНачислений, "Рассчитывается");
	КонецЕсли;
	
	Для Каждого РассчитаннаяСтрока Из РассчитываемаяТаблица Цикл
		
		НачислениеРассчитывается = ЗначенияРеквизитаРассчитывается[РассчитаннаяСтрока.Начисление];
		Если НачислениеРассчитывается = Ложь Тогда 
			
			ВидРасчетаИнфо = ЗарплатаКадрыРасширенныйПовтИсп.ПолучитьИнформациюОВидеРасчета(РассчитаннаяСтрока.Начисление);
			
			Если ВидРасчетаИнфо.ВключатьВФОТ Тогда
				
				ИдентификаторСтрокиПозиции = СоответствиеПозицийСотрудникам.Получить(РассчитаннаяСтрока.Сотрудник);
				Если ИдентификаторСтрокиПозиции <> Неопределено Тогда
					СтруктураПоиска = Новый Структура("ИдентификаторСтрокиПозиции, Начисление", ИдентификаторСтрокиПозиции, РассчитаннаяСтрока.Начисление);
					СтрокиНачислений = ОписаниеПозиций.Начисления.НайтиСтроки(СтруктураПоиска);
					Если СтрокиНачислений.Количество() > 0 Тогда 
						РассчитаннаяСтрока.Результат = СтрокиНачислений[0].Размер;
					КонецЕсли;
				КонецЕсли;
				
				ИдентификаторСтрокиПозиции = СоответствиеПозицийСотрудникамМин.Получить(РассчитаннаяСтрока.Сотрудник);
				Если ИдентификаторСтрокиПозиции <> Неопределено Тогда
					СтруктураПоиска = Новый Структура("ИдентификаторСтрокиПозиции, Начисление", ИдентификаторСтрокиПозиции, РассчитаннаяСтрока.Начисление);
					СтрокиНачислений = ОписаниеПозиций.Начисления.НайтиСтроки(СтруктураПоиска);
					Если СтрокиНачислений.Количество() > 0 Тогда 
						РассчитаннаяСтрока.Результат = СтрокиНачислений[0].РазмерМин;
					КонецЕсли;
				КонецЕсли;
				
				ИдентификаторСтрокиПозиции = СоответствиеПозицийСотрудникамМакс.Получить(РассчитаннаяСтрока.Сотрудник);
				Если ИдентификаторСтрокиПозиции <> Неопределено Тогда
					СтруктураПоиска = Новый Структура("ИдентификаторСтрокиПозиции, Начисление", ИдентификаторСтрокиПозиции, РассчитаннаяСтрока.Начисление);
					СтрокиНачислений = ОписаниеПозиций.Начисления.НайтиСтроки(СтруктураПоиска);
					Если СтрокиНачислений.Количество() > 0 Тогда 
						РассчитаннаяСтрока.Результат = СтрокиНачислений[0].РазмерМакс;
					КонецЕсли;
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
	
	УстановитьПривилегированныйРежим(Истина);
	
	// Расчет ФОТ
	РасчетЗарплатыРасширенный.РассчитатьФОТ(
		РассчитываемаяТаблица,
		ИзвестныеЗначенияПоказателей,
		Организация,
		ДатаРасчета);
	
	УстановитьПривилегированныйРежим(Ложь);
	
	СоответствиеФОТПозиции = Новый Соответствие;
	СоответствиеФОТПозицииМин = Новый Соответствие;
	СоответствиеФОТПозицииМакс = Новый Соответствие;
	
	Для каждого СтрокаРассчитываемаяТаблица Из РассчитываемаяТаблица Цикл
		
		ЗаполнитьРазмерСтрокНачислений(ОписаниеПозиций.Начисления, СтрокаРассчитываемаяТаблица, "Размер", СоответствиеПозицийСотрудникам, СоответствиеФОТПозиции);
		ЗаполнитьРазмерСтрокНачислений(ОписаниеПозиций.Начисления, СтрокаРассчитываемаяТаблица, "РазмерМин", СоответствиеПозицийСотрудникамМин, СоответствиеФОТПозицииМин);
		ЗаполнитьРазмерСтрокНачислений(ОписаниеПозиций.Начисления, СтрокаРассчитываемаяТаблица, "РазмерМакс", СоответствиеПозицийСотрудникамМакс, СоответствиеФОТПозицииМакс);
		
	КонецЦикла;
	
	ЗаполнитьФОТНесколькихПозиций(ОписаниеПозиций.Позиции, СоответствиеФОТПозиции, "ФОТ");
	ЗаполнитьФОТНесколькихПозиций(ОписаниеПозиций.Позиции, СоответствиеФОТПозицииМин, "ФОТМин");
	ЗаполнитьФОТНесколькихПозиций(ОписаниеПозиций.Позиции, СоответствиеФОТПозицииМакс, "ФОТМакс");
	
	СтрокиНадбавкиЗаВредность = РассчитываемаяТаблица.НайтиСтроки(Новый Структура("Начисление", ВРНадбавкаЗаВредность));
	Для каждого СтрокаНадбавкиЗаВредность Из СтрокиНадбавкиЗаВредность Цикл
		
		ЗаполнитьРазмерыНадбавки(
			ОписаниеПозиций.Позиции, СтрокаНадбавкиЗаВредность, СоответствиеПозицийСотрудникам, "НадбавкаЗаВредностьРазмер", "ФОТ");
		ЗаполнитьРазмерыНадбавки(
			ОписаниеПозиций.Позиции, СтрокаНадбавкиЗаВредность, СоответствиеПозицийСотрудникамМин, "НадбавкаЗаВредностьРазмерМин", "ФОТМин");
		ЗаполнитьРазмерыНадбавки(
			ОписаниеПозиций.Позиции, СтрокаНадбавкиЗаВредность, СоответствиеПозицийСотрудникамМакс, "НадбавкаЗаВредностьРазмерМакс", "ФОТМакс");
		
	КонецЦикла;
	
	
КонецПроцедуры

Процедура ЗаполнитьРазмерыНадбавки(ТЧПозиции, СтрокаСНачислением, СоответствиеПозицийСотрудникам, ИдентификаторКолонкиРазмер, ИдентификаторКолонкиФОТ, ПерезаполнитьРазмер = Истина)
	
	ИдентификаторСтрокиПозиции = СоответствиеПозицийСотрудникам.Получить(СтрокаСНачислением.Сотрудник);
	СтрокиПозиции = ТЧПозиции.НайтиСтроки(Новый Структура("ИдентификаторСтрокиПозиции", ИдентификаторСтрокиПозиции));
	Для каждого СтрокаПозиции Из СтрокиПозиции Цикл
		Если ПерезаполнитьРазмер Тогда
			СтрокаПозиции[ИдентификаторКолонкиРазмер] = СтрокаСНачислением.Результат;
		КонецЕсли; 
		СтрокаПозиции[ИдентификаторКолонкиФОТ] = СтрокаПозиции[ИдентификаторКолонкиФОТ] + СтрокаПозиции[ИдентификаторКолонкиРазмер];
	КонецЦикла;
	
КонецПроцедуры

Процедура ЗаполнитьРазмерСтрокНачислений(ТЧНачисления, РассчитаннаяСтрока, ИдентификаторКолонкиРазмер, СоответствиеПозицийСотрудникам, СоответствиеФОТПозиции)
	
	ИдентификаторСтрокиПозиции = СоответствиеПозицийСотрудникам.Получить(РассчитаннаяСтрока.Сотрудник);
	Если ИдентификаторСтрокиПозиции <> Неопределено Тогда
		
		СтруктураПоиска = Новый Структура("ИдентификаторСтрокиПозиции, Начисление", ИдентификаторСтрокиПозиции, РассчитаннаяСтрока.Начисление);
		СтрокиНачислений = ТЧНачисления.НайтиСтроки(СтруктураПоиска);
		Для каждого НайденнаяСтрокаНачислений Из СтрокиНачислений Цикл
			
			НайденнаяСтрокаНачислений[ИдентификаторКолонкиРазмер] = РассчитаннаяСтрока.Результат;
			
			ЗначениеФОТ = СоответствиеФОТПозиции.Получить(ИдентификаторСтрокиПозиции);
			Если ЗначениеФОТ = Неопределено Тогда
				ЗначениеФОТ = 0;
			КонецЕсли; 
			
			СоответствиеФОТПозиции.Вставить(ИдентификаторСтрокиПозиции, ЗначениеФОТ + НайденнаяСтрокаНачислений[ИдентификаторКолонкиРазмер]);
			
		КонецЦикла;
		
	КонецЕсли; 
		
КонецПроцедуры

Процедура ЗаполнитьФОТНесколькихПозиций(ТЧПозиции, СоответствиеФОТПозиции, ИдентификаторКолонкиФОТ)
	
	Для каждого ЭлементСоответствия Из СоответствиеФОТПозиции Цикл
		
		СтрокиПозиции = ТЧПозиции.НайтиСтроки(Новый Структура("ИдентификаторСтрокиПозиции", ЭлементСоответствия.Ключ));
		Для каждого СтрокаПозиции Из СтрокиПозиции Цикл
			СтрокаПозиции[ИдентификаторКолонкиФОТ] = ЭлементСоответствия.Значение;
		КонецЦикла;
		
	КонецЦикла;
		
КонецПроцедуры

Функция ИтогФОТПоРеквизиту(ТаблицаНачислений, ИмяРеквизита)
	
	ИтогФОТ = 0;
	
	Для каждого СтрокаТаблицаНачислений Из ТаблицаНачислений Цикл
		
		Если ТипЗнч(ТаблицаНачислений) = Тип("ТаблицаЗначений") Тогда
			Если ТаблицаНачислений.Колонки.Найти("Действие") <> Неопределено
				И СтрокаТаблицаНачислений.Действие = Перечисления.ДействияСНачислениямиИУдержаниями.Отменить Тогда
				Продолжить;
			КонецЕсли; 
		Иначе
			Если СтрокаТаблицаНачислений.Свойство("Действие")
				И СтрокаТаблицаНачислений.Действие = Перечисления.ДействияСНачислениямиИУдержаниями.Отменить Тогда
				Продолжить;
			КонецЕсли; 
		КонецЕсли;
		
		ВидРасчетаИнфо = ЗарплатаКадрыРасширенныйПовтИсп.ПолучитьИнформациюОВидеРасчета(СтрокаТаблицаНачислений.Начисление);
		Если ВидРасчетаИнфо.ВключатьВФОТ Тогда
			ИтогФОТ = ИтогФОТ + СтрокаТаблицаНачислений[ИмяРеквизита];
		КонецЕсли;
		
	КонецЦикла;
	
	Возврат ИтогФОТ;
	
КонецФункции

Процедура РассчитатьИтогиФОТПоПозиции(Форма, ДанныеТекущейПозиции, ТаблицаНачислений) Экспорт
	
	ФОИспользоватьВилкуСтавокВШтатномРасписании = Форма.ПолучитьФункциональнуюОпциюФормы("ИспользоватьВилкуСтавокВШтатномРасписании");
	
	Если ФОИспользоватьВилкуСтавокВШтатномРасписании Тогда
		
		ДанныеТекущейПозиции.ФОТМин =
			ИтогФОТПоРеквизиту(ТаблицаНачислений, "РазмерМин")
			+ ДанныеТекущейПозиции.НадбавкаЗаВредностьРазмерМин
			;
			
		ДанныеТекущейПозиции.ФОТМакс =
			ИтогФОТПоРеквизиту(ТаблицаНачислений, "РазмерМакс")
			+ ДанныеТекущейПозиции.НадбавкаЗаВредностьРазмерМакс
			;
			
		ДанныеТекущейПозиции.ФОТ = ДанныеТекущейПозиции.ФОТМакс;
			
	Иначе
			
		ДанныеТекущейПозиции.ФОТ =
			ИтогФОТПоРеквизиту(ТаблицаНачислений, "Размер")
			+ ДанныеТекущейПозиции.НадбавкаЗаВредностьРазмер
			;
			
		ДанныеТекущейПозиции.ФОТМин = ДанныеТекущейПозиции.ФОТ;
		ДанныеТекущейПозиции.ФОТМакс = ДанныеТекущейПозиции.ФОТ;
			
	КонецЕсли; 

	Для каждого СтрокаТаблицаНачислений Из ТаблицаНачислений Цикл
		
		Если ТипЗнч(ТаблицаНачислений) = Тип("ТаблицаЗначений") Тогда
			Если ТаблицаНачислений.Колонки.Найти("Действие") <> Неопределено
				И СтрокаТаблицаНачислений.Действие = Перечисления.ДействияСНачислениямиИУдержаниями.Отменить Тогда
				Продолжить;
			КонецЕсли; 
		Иначе
			Если СтрокаТаблицаНачислений.Свойство("Действие")
				И СтрокаТаблицаНачислений.Действие = Перечисления.ДействияСНачислениямиИУдержаниями.Отменить Тогда
				Продолжить;
			КонецЕсли; 
		КонецЕсли;
		
		ИнформацияОВидеРасчета = ЗарплатаКадрыРасширенныйПовтИсп.ПолучитьИнформациюОВидеРасчета(СтрокаТаблицаНачислений.Начисление);
		Если (ИнформацияОВидеРасчета.ВидВремени = Перечисления.ВидыРабочегоВремениСотрудников.ОтработанноеВПределахНормы
			ИЛИ ИнформацияОВидеРасчета.ВидВремени = Перечисления.ВидыРабочегоВремениСотрудников.ЧасовоеОтработанноеВПределахНормы)
			И ИнформацияОВидеРасчета.ЗачетНормыВремени Тогда
			
			Для каждого Показатель Из ИнформацияОВидеРасчета.Показатели Цикл
				
				Если Показатель.ОсновнойПоказатель Тогда
					
					НомерПоказателя = ИнформацияОВидеРасчета.Показатели.Найти(Показатель) + 1;
					
					Если ТипЗнч(ТаблицаНачислений) = Тип("ТаблицаЗначений") Тогда
						ЕстьРеквизитЗначение = ТаблицаНачислений.Колонки.Найти("Значение" + НомерПоказателя) <> Неопределено;
						ЕстьРеквизитМинимальноеЗначение = ТаблицаНачислений.Колонки.Найти("МинимальноеЗначение" + НомерПоказателя) <> Неопределено;
						ЕстьРеквизитМаксимальноеЗначение = ТаблицаНачислений.Колонки.Найти("МаксимальноеЗначение" + НомерПоказателя) <> Неопределено;
					Иначе
						ЕстьРеквизитЗначение = СтрокаТаблицаНачислений.Свойство("Значение" + НомерПоказателя);
						ЕстьРеквизитМинимальноеЗначение = СтрокаТаблицаНачислений.Свойство("МинимальноеЗначение" + НомерПоказателя);
						ЕстьРеквизитМаксимальноеЗначение = СтрокаТаблицаНачислений.Свойство("МаксимальноеЗначение" + НомерПоказателя);
					КонецЕсли;
					
					Если ЕстьРеквизитЗначение Тогда
						ДанныеТекущейПозиции.ОкладТариф = СтрокаТаблицаНачислений["Значение" + НомерПоказателя];
					КонецЕсли;
					
					Если ЕстьРеквизитМинимальноеЗначение Тогда
						ДанныеТекущейПозиции.ОкладТарифМин = СтрокаТаблицаНачислений["МинимальноеЗначение" + НомерПоказателя];
					КонецЕсли;
					
					Если ЕстьРеквизитМаксимальноеЗначение Тогда
						ДанныеТекущейПозиции.ОкладТарифМакс = СтрокаТаблицаНачислений["МаксимальноеЗначение" + НомерПоказателя];
					КонецЕсли;
					
					Прервать;
			
				КонецЕсли; 
				
			КонецЦикла;
			
			Прервать;
			
		КонецЕсли; 
		
	КонецЦикла;
	
	Если ДанныеТекущейПозиции.Свойство("Комментарий") Тогда
		
		ДанныеТекущейПозиции.Комментарий = УправлениеШтатнымРасписаниемКлиентСервер.ПолучитьКомментарийКДействиюСПозициейШР(
			ДанныеТекущейПозиции, Форма.ДоступноЧтениеНачисленийШтатногоРасписания);
			
	КонецЕсли;
	
КонецПроцедуры

Процедура РассчитатьФОТПозицийВДокументеИзмененияШтатногоРасписания(ДокументОбъект, ДатаВступленияВСилу, СписокПозиций = Неопределено) Экспорт
	
	ОписаниеПозиций = Новый Структура;
	ОписаниеПозиций.Вставить("Организация", ДокументОбъект.Организация);
	ОписаниеПозиций.Вставить("ДатаВступленияВСилу", ДатаВступленияВСилу);
	
	КоллекцияПозиций = ПустаяТаблицаКоллекцииПозицийДляРасчетаФОТ();
	КоллекцияНачислений = ПустаяТаблицаКоллекцииНачисленийДляРасчетаФОТ();
	КоллекцияПоказателей = ПустаяТаблицаКоллекцииПоказателейДляРасчетаФОТ();
	
	Если СписокПозиций = Неопределено Тогда
		ПересчитываемыеПозиции = ДокументОбъект.Позиции.ВыгрузитьКолонку("Позиция");
	Иначе
		ПересчитываемыеПозиции = СписокПозиций;
	КонецЕсли;
	
	Для каждого ПересчитываемаяПозиция Из ПересчитываемыеПозиции Цикл
		
		СтрокиПозиции = ДокументОбъект.Позиции.Выгрузить(Новый Структура("Позиция", ПересчитываемаяПозиция));
		ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(СтрокиПозиции, КоллекцияПозиций);
		
		Для каждого СтрокаПозиции Из СтрокиПозиции Цикл
			
			СтрокиНачислений = ДокументОбъект.Начисления.Выгрузить(Новый Структура("ИдентификаторСтрокиПозиции", СтрокаПозиции.ИдентификаторСтрокиПозиции));
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(СтрокиНачислений, КоллекцияНачислений);
			
			СтрокиПоказателей = ДокументОбъект.Показатели.Выгрузить(Новый Структура("ИдентификаторСтрокиПозиции", СтрокаПозиции.ИдентификаторСтрокиПозиции));
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(СтрокиПоказателей, КоллекцияПоказателей);
			
		КонецЦикла;
		
	КонецЦикла;
	
	ОписаниеПозиций.Вставить("Позиции", КоллекцияПозиций);
	ОписаниеПозиций.Вставить("Начисления", КоллекцияНачислений);
	ОписаниеПозиций.Вставить("Показатели", КоллекцияПоказателей);
	
	УправлениеШтатнымРасписанием.РассчитатьФОТНесколькихПозиций(ОписаниеПозиций);
	
	Для каждого СтрокаПозиции Из КоллекцияПозиций Цикл
		
		СтрокаПозицииДокумента = ДокументОбъект.Позиции.Найти(СтрокаПозиции.Позиция, "Позиция");
		Если СтрокаПозицииДокумента <> Неопределено Тогда
			
			ЗаполнитьЗначенияСвойств(СтрокаПозицииДокумента, СтрокаПозиции, СвойстваПозицииСРезультатамиРасчетаФОТ());
			
			РассчитанныеСтрокиНачислений = КоллекцияНачислений.НайтиСтроки(Новый Структура("ИдентификаторСтрокиПозиции", СтрокаПозиции.ИдентификаторСтрокиПозиции));
			Для каждого РассчитаннаяСтрока Из РассчитанныеСтрокиНачислений Цикл
				
				СтрокиНачисленийДокумента = ДокументОбъект.Начисления.НайтиСтроки(
					Новый Структура("ИдентификаторСтрокиПозиции,Начисление", РассчитаннаяСтрока.ИдентификаторСтрокиПозиции, РассчитаннаяСтрока.Начисление));
					
				Для каждого СтрокаНачисленийДокумента Из СтрокиНачисленийДокумента Цикл
					ЗаполнитьЗначенияСвойств(СтрокаНачисленийДокумента, РассчитаннаяСтрока, "Размер,РазмерМин,РазмерМакс");
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЕсли; 
		
	КонецЦикла;
	
КонецПроцедуры

Процедура РассчитатьФОТПозицийСправочника(Организация, ДатаРасчета, ПозицииОбъекты) Экспорт
	
	ОписаниеПозиций = Новый Структура;
	ОписаниеПозиций.Вставить("Организация", Организация);
	ОписаниеПозиций.Вставить("ДатаВступленияВСилу", ДатаРасчета);
	
	КоллекцияПозиций = ПустаяТаблицаКоллекцииПозицийДляРасчетаФОТ();
	КоллекцияНачислений = ПустаяТаблицаКоллекцииНачисленийДляРасчетаФОТ();
	КоллекцияПоказателей = ПустаяТаблицаКоллекцииПоказателейДляРасчетаФОТ();
	
	СоответствиеСсылокОбъектам = Новый Соответствие;
	
	ИдентификаторСтрокиПозиции = 1;
	Для каждого ПозицияОбъект Из ПозицииОбъекты Цикл
		
		СоответствиеСсылокОбъектам.Вставить(ПозицияОбъект.Ссылка, ПозицияОбъект);
		
		СтрокаПозиции = КоллекцияПозиций.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаПозиции, ПозицияОбъект);
		СтрокаПозиции.Позиция = ПозицияОбъект.Ссылка;
		СтрокаПозиции.ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции;
		
		Для каждого НачислениеПозиции Из ПозицияОбъект.Начисления Цикл
			
			СтрокаНачислений = КоллекцияНачислений.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНачислений, НачислениеПозиции);
			СтрокаНачислений.ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции;
			
		КонецЦикла;
		
		Для каждого ПоказательПозиции Из ПозицияОбъект.Показатели Цикл
			
			СтрокаПоказателя = КоллекцияПоказателей.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаПоказателя, ПоказательПозиции);
			СтрокаПоказателя.ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции;
			
		КонецЦикла;
		
		ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции + 1;
		
	КонецЦикла;
	
	ОписаниеПозиций.Вставить("Позиции", КоллекцияПозиций);
	ОписаниеПозиций.Вставить("Начисления", КоллекцияНачислений);
	ОписаниеПозиций.Вставить("Показатели", КоллекцияПоказателей);
	
	УправлениеШтатнымРасписанием.РассчитатьФОТНесколькихПозиций(ОписаниеПозиций);
	
	Для каждого СтрокаПозиции Из КоллекцияПозиций Цикл
		
		ПозицияОбъект = СоответствиеСсылокОбъектам.Получить(СтрокаПозиции.Позиция);
		Если ПозицияОбъект <> Неопределено Тогда
			
			ЗаполнитьЗначенияСвойств(ПозицияОбъект, СтрокаПозиции, СвойстваПозицииСРезультатамиРасчетаФОТ());
			
			РассчитанныеСтрокиНачислений = КоллекцияНачислений.НайтиСтроки(Новый Структура("ИдентификаторСтрокиПозиции", СтрокаПозиции.ИдентификаторСтрокиПозиции));
			Для каждого РассчитаннаяСтрока Из РассчитанныеСтрокиНачислений Цикл
				
				СтрокиНачисленийПозиции = ПозицияОбъект.Начисления.НайтиСтроки(
					Новый Структура("Начисление", РассчитаннаяСтрока.Начисление));
					
				Для каждого СтрокаНачисленийПозиции Из СтрокиНачисленийПозиции Цикл
					ЗаполнитьЗначенияСвойств(СтрокаНачисленийПозиции, РассчитаннаяСтрока, "Размер,РазмерМин,РазмерМакс");
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЕсли; 
		
	КонецЦикла;
	
КонецПроцедуры

Функция ПустаяТаблицаКоллекцииПозицийДляРасчетаФОТ() Экспорт
	
	КоллекцияПозиций = Новый ТаблицаЗначений;
	КоллекцияПозиций.Колонки.Добавить("Позиция", Новый ОписаниеТипов("СправочникСсылка.ШтатноеРасписание"));
	КоллекцияПозиций.Колонки.Добавить("ИдентификаторСтрокиПозиции", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("Должность", Новый ОписаниеТипов("СправочникСсылка.Должности"));
	КоллекцияПозиций.Колонки.Добавить("Подразделение", Новый ОписаниеТипов("СправочникСсылка.ПодразделенияОрганизаций"));
	КоллекцияПозиций.Колонки.Добавить("ГрафикРаботыСотрудников", Новый ОписаниеТипов("СправочникСсылка.ГрафикиРаботыСотрудников"));
	КоллекцияПозиций.Колонки.Добавить("ТарифнаяСетка", Новый ОписаниеТипов("СправочникСсылка.ТарифныеСетки"));
	КоллекцияПозиций.Колонки.Добавить("ОкладТариф", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("ОкладТарифМин", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("ОкладТарифМакс", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("ФОТ", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("ФОТМин", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("ФОТМакс", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("НадбавкаЗаВредностьРазмер", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("НадбавкаЗаВредностьРазмерМин", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("НадбавкаЗаВредностьРазмерМакс", Новый ОписаниеТипов("Число"));
	КоллекцияПозиций.Колонки.Добавить("ВыплачиваетсяНадбавкаЗаВредность", Новый ОписаниеТипов("Булево"));
	КоллекцияПозиций.Колонки.Добавить("ПроцентНадбавкиЗаВредность", Новый ОписаниеТипов("Число"));
	
	Возврат КоллекцияПозиций;
	
КонецФункции

Функция ПустаяТаблицаКоллекцииНачисленийДляРасчетаФОТ() Экспорт
	
	КоллекцияНачислений = Новый ТаблицаЗначений;
	КоллекцияНачислений.Колонки.Добавить("ИдентификаторСтрокиПозиции", Новый ОписаниеТипов("Число"));
	КоллекцияНачислений.Колонки.Добавить("ИдентификаторСтрокиВидаРасчета", Новый ОписаниеТипов("Число"));
	КоллекцияНачислений.Колонки.Добавить("Начисление", Новый ОписаниеТипов("ПланВидовРасчетаСсылка.Начисления"));
	КоллекцияНачислений.Колонки.Добавить("Действие", Новый ОписаниеТипов("ПеречислениеСсылка.ДействияСНачислениямиИУдержаниями"));
	КоллекцияНачислений.Колонки.Добавить("Размер", Новый ОписаниеТипов("Число"));
	КоллекцияНачислений.Колонки.Добавить("РазмерМин", Новый ОписаниеТипов("Число"));
	КоллекцияНачислений.Колонки.Добавить("РазмерМакс", Новый ОписаниеТипов("Число"));
	КоллекцияНачислений.Колонки.Добавить("ФиксРасчет", Новый ОписаниеТипов("Булево"));
	
	Возврат КоллекцияНачислений;
	
КонецФункции

Функция ПустаяТаблицаКоллекцииПоказателейДляРасчетаФОТ()  Экспорт
	
	КоллекцияПоказателей = Новый ТаблицаЗначений;
	КоллекцияПоказателей.Колонки.Добавить("ИдентификаторСтрокиПозиции", Новый ОписаниеТипов("Число"));
	КоллекцияПоказателей.Колонки.Добавить("ИдентификаторСтрокиВидаРасчета", Новый ОписаниеТипов("Число"));
	КоллекцияПоказателей.Колонки.Добавить("Показатель", Новый ОписаниеТипов("СправочникСсылка.ПоказателиРасчетаЗарплаты"));
	КоллекцияПоказателей.Колонки.Добавить("Значение", Новый ОписаниеТипов("Число"));
	КоллекцияПоказателей.Колонки.Добавить("ЗначениеМин", Новый ОписаниеТипов("Число"));
	КоллекцияПоказателей.Колонки.Добавить("ЗначениеМакс", Новый ОписаниеТипов("Число"));
	
	Возврат КоллекцияПоказателей;
	
КонецФункции

Функция СвойстваПозицииСРезультатамиРасчетаФОТ()
	
	Возврат
		"ОкладТариф,
		|ОкладТарифМин,
		|ОкладТарифМакс,
		|ФОТ,
		|ФОТМин,
		|ФОТМакс,
		|НадбавкаЗаВредностьРазмер,
		|НадбавкаЗаВредностьРазмерМин,
		|НадбавкаЗаВредностьРазмерМакс";
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// ВСПОМОГАТЕЛЬНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

Функция ТекстУсловийЗапросаСОтборами(Запрос, Отбор, ФОИспользоватьИсториюИзмененияШтатногоРасписания, УсловияЗапроса = Неопределено)
	
	Если УсловияЗапроса = Неопределено Тогда
		УсловияЗапроса = Новый Массив;
	КонецЕсли;
	
	Если Отбор <> Неопределено Тогда
		
		Для каждого ОписаниеЭлементаОтбора Из Отбор Цикл
			
			Если ТипЗнч(ОписаниеЭлементаОтбора.ПравоеЗначение) = Тип("Строка") Тогда
				ПравоеЗначение = ОписаниеЭлементаОтбора.ПравоеЗначение;
			ИначеЕсли ТипЗнч(ОписаниеЭлементаОтбора.ПравоеЗначение) = Тип("Число") Тогда
				ПравоеЗначение = Формат(ОписаниеЭлементаОтбора.ПравоеЗначение, "ЧГ=");
			ИначеЕсли ТипЗнч(ОписаниеЭлементаОтбора.ПравоеЗначение) = Тип("Дата") Тогда
				ПравоеЗначение = "ДАТАВРЕМЯ(" + Формат(ОписаниеЭлементаОтбора.ПравоеЗначение, "ДФ='гггг, М, д, Ч, м, с'; ДП=") + ")";
			ИначеЕсли ТипЗнч(ОписаниеЭлементаОтбора.ПравоеЗначение) = Тип("Булево") Тогда
				Если ОписаниеЭлементаОтбора.ПравоеЗначение Тогда
					ПравоеЗначение = "(ИСТИНА)";
				Иначе
					ПравоеЗначение = "(ЛОЖЬ)";
				КонецЕсли;
			Иначе
				НомерПараметра = Запрос.Параметры.Количество();
				ИмяПараметра = "ПозицииШтатногоРасписанияПараметр" + Формат(НомерПараметра, "ЧГ=");
				ПравоеЗначение = "&" + ИмяПараметра;
				Запрос.УстановитьПараметр(ИмяПараметра, ОписаниеЭлементаОтбора.ПравоеЗначение)
			КонецЕсли; 
			
			Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
				УсловияЗапроса.Добавить(
					"(ИсторияИспользованияШтатногоРасписания." + ОписаниеЭлементаОтбора.ЛевоеЗначение + " " + ОписаниеЭлементаОтбора.ВидСравнения
					+ " (" + ПравоеЗначение + "))");
			Иначе
				Если ВРег(ОписаниеЭлементаОтбора.ЛевоеЗначение) <> ВРег("Регистратор") Тогда
					УсловияЗапроса.Добавить(
						"(ШтатноеРасписание." + ОписаниеЭлементаОтбора.ЛевоеЗначение + " " + ОписаниеЭлементаОтбора.ВидСравнения
						+ " (" + ПравоеЗначение + "))");
				КонецЕсли; 
			КонецЕсли;
				
		КонецЦикла;
		
	КонецЕсли;
	
	Если УсловияЗапроса.Количество() = 0 Тогда
		ТекстУсловий = "(ИСТИНА)";
	Иначе
		
		ТекстУсловий = "";
		Для каждого УсловиеЗапроса Из УсловияЗапроса Цикл
			ТекстУсловий = ?(ПустаяСтрока(ТекстУсловий), "", ТекстУсловий + Символы.ПС + " И ") + УсловиеЗапроса;
		КонецЦикла;
		
	КонецЕсли;
	
	Возврат ТекстУсловий;
	
КонецФункции

Функция ФорматКоличестваСтавок() Экспорт
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьРаботуНаНеполнуюСтавку") Тогда
		Возврат "ЧДЦ=2";
	Иначе
		Возврат "ЧДЦ=0";
	КонецЕсли;
	
КонецФункции

Функция РезультатЗаполненияПоТекущейКадровойРасстановке(ПараметрыВыполнения) Экспорт
	
	Позиции = ПараметрыВыполнения.Позиции; 
	Начисления = ПараметрыВыполнения.Начисления; 
	Показатели = ПараметрыВыполнения.Показатели;
	ЕжегодныеОтпуска = ПараметрыВыполнения.ЕжегодныеОтпуска;
	Специальности = ПараметрыВыполнения.Специальности;
		
	Если Показатели.Колонки.Найти("ИдентификаторСтрокиПозиции") = Неопределено Тогда
		
		Показатели.Колонки.Добавить("ИдентификаторСтрокиПозиции", Новый ОписаниеТипов("Число"));
		СоответствиеИдентификаторов = Новый Соответствие;
		
		Для каждого СтрокаПоказателя Из Показатели Цикл
			
			ИдентификаторСтрокиВидаРасчета = СтрокаПоказателя.ИдентификаторСтрокиВидаРасчета;
			
			ИдентификаторСтрокиПозиции = СоответствиеИдентификаторов.Получить(ИдентификаторСтрокиВидаРасчета);
			Если ИдентификаторСтрокиПозиции = Неопределено Тогда
				
				НайденныеСтроки = Начисления.НайтиСтроки(Новый Структура("ИдентификаторСтрокиВидаРасчета", ИдентификаторСтрокиВидаРасчета));
				Если НайденныеСтроки.Количество() > 0 Тогда
					ИдентификаторСтрокиПозиции = НайденныеСтроки[0].ИдентификаторСтрокиПозиции;
					СоответствиеИдентификаторов.Вставить(ИдентификаторСтрокиВидаРасчета, ИдентификаторСтрокиПозиции);
				КонецЕсли; 
			
			КонецЕсли; 
			
			Если ИдентификаторСтрокиПозиции <> Неопределено Тогда
				СтрокаПоказателя.ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозиции;
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	КолонкаНомерСтроки = Позиции.Колонки.Найти("LineNumber");
	Если КолонкаНомерСтроки <> Неопределено Тогда
		КолонкаНомерСтроки.Имя = "НомерСтроки";
	КонецЕсли; 
	
	РезультатЗапросаПоДаннымЗаполнения = СформироватьЗапросПоОтклонениюШтатногоРасписания(
		ПараметрыВыполнения.Организация,
		ПараметрыВыполнения.ДатаВступленияВСилу,
		Позиции.Скопировать(),
		ПараметрыВыполнения.Подразделение);
		
	ДанныеЗаполнения = РезультатЗапросаПоДаннымЗаполнения.Выбрать(); 
	
	МассивСтрокДляЗаполненияНачислений = Новый Массив;
	ИзмененныеПозиции = Новый Массив;
	
	ИдентификаторСтрокиПозицииМакс = МаксимальныйИдентификаторСтроки(Позиции, "ИдентификаторСтрокиПозиции");
	Пока ДанныеЗаполнения.Следующий() Цикл
		
		СтруктураПоиска = Новый Структура;
		Если ЗначениеЗаполнено(ДанныеЗаполнения.Позиция) Тогда
			СтруктураПоиска.Вставить("Позиция", ДанныеЗаполнения.Позиция);
		Иначе
			СтруктураПоиска.Вставить("Подразделение", ДанныеЗаполнения.Подразделение);
			СтруктураПоиска.Вставить("Должность", ДанныеЗаполнения.Должность);
		КонецЕсли;
		
		НайденныеСтроки = Позиции.НайтиСтроки(СтруктураПоиска);
		
		Если НайденныеСтроки.Количество() = 0 Тогда
			
			СтрокаПозиция = Позиции.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаПозиция, ДанныеЗаполнения);
			
			Если НЕ ЗначениеЗаполнено(ДанныеЗаполнения.Позиция) Тогда
				СтрокаПозиция.Действие = Перечисления.ДействияСПозициямиШтатногоРасписания.СоздатьНовуюПозицию;
			Иначе
				ИзмененныеПозиции.Добавить(ДанныеЗаполнения.Позиция);
			КонецЕсли; 
			
			ИдентификаторСтрокиПозицииМакс = ИдентификаторСтрокиПозицииМакс + 1;
			СтрокаПозиция.ИдентификаторСтрокиПозиции = ИдентификаторСтрокиПозицииМакс;
			
			МассивСтрокДляЗаполненияНачислений.Добавить(СтрокаПозиция);
			
		Иначе
			СтрокаПозиция = НайденныеСтроки[0];
			СтрокаПозиция.КоличествоСтавок = ДанныеЗаполнения.КоличествоСтавок;
		КонецЕсли;
		
	КонецЦикла;	
	
	ИдентификаторСтрокиВидаРасчетаМакс = МаксимальныйИдентификаторСтроки(Начисления, "ИдентификаторСтрокиВидаРасчета");
	Если МассивСтрокДляЗаполненияНачислений.Количество() > 0 Тогда
		
		ДанныеДляПолученияКадровыхДанных = Позиции.Скопировать(МассивСтрокДляЗаполненияНачислений, "Подразделение,Должность,ИдентификаторСтрокиПозиции");
		ТекущиеДанныеПозиций = ТекущиеКадровыеДанныеПозиций(ПараметрыВыполнения.Организация, ДанныеДляПолученияКадровыхДанных, ПараметрыВыполнения.ДатаВступленияВСилу);
		ДанныеИзмененныхПозиций = ДанныеПозицийШтатногоРасписания(Истина, ИзмененныеПозиции, ПараметрыВыполнения.ДатаВступленияВСилу);
		
		Для каждого СтрокаДляЗаполнения Из МассивСтрокДляЗаполненияНачислений Цикл
			
			Если ЗначениеЗаполнено(СтрокаДляЗаполнения.Позиция) И СтрокаДляЗаполнения.Позиция.Утверждена Тогда
				ДанныеПоСтроке = ДанныеИзмененныхПозиций.Получить(СтрокаДляЗаполнения.Позиция);
			Иначе
				ДанныеПоСтроке = ТекущиеДанныеПозиций.Получить(СтрокаДляЗаполнения.ИдентификаторСтрокиПозиции);
			КонецЕсли;
			
			Если ДанныеПоСтроке <> Неопределено Тогда
				
				Для каждого ДанныеНачисления Из ДанныеПоСтроке.Начисления Цикл
					
					ИдентификаторСтрокиВидаРасчетаМакс = ИдентификаторСтрокиВидаРасчетаМакс + 1;
					
					СтрокаНачислений = Начисления.Добавить();
					СтрокаНачислений.Начисление = ДанныеНачисления.Начисление;
					СтрокаНачислений.ИдентификаторСтрокиПозиции = СтрокаДляЗаполнения.ИдентификаторСтрокиПозиции;
					СтрокаНачислений.ИдентификаторСтрокиВидаРасчета = ИдентификаторСтрокиВидаРасчетаМакс;
					СтрокаНачислений.Действие = Перечисления.ДействияСНачислениямиИУдержаниями.Утвердить;
					
					Для каждого ДанныеПоказателя Из ДанныеНачисления.Показатели Цикл
						
						Если ЗначениеЗаполнено(ДанныеПоказателя.Показатель) Тогда
							
							СтрокаПоказателей = Показатели.Добавить();
							СтрокаПоказателей.ИдентификаторСтрокиВидаРасчета = ИдентификаторСтрокиВидаРасчетаМакс;
							СтрокаПоказателей.ИдентификаторСтрокиПозиции = СтрокаНачислений.ИдентификаторСтрокиПозиции;
							СтрокаПоказателей.Показатель = ДанныеПоказателя.Показатель;
							
							Если ДанныеПоказателя.Свойство("Значение") Тогда
								СтрокаПоказателей.Значение = ДанныеПоказателя.Значение;
							КонецЕсли;
							
							Если ДанныеПоказателя.Свойство("МинимальноеЗначение") Тогда
								СтрокаПоказателей.ЗначениеМин = ДанныеПоказателя.МинимальноеЗначение;
							КонецЕсли;
							
							Если ДанныеПоказателя.Свойство("МаксимальноеЗначение") Тогда
								СтрокаПоказателей.ЗначениеМакс = ДанныеПоказателя.МаксимальноеЗначение;
							КонецЕсли;
						
							Если ДанныеПоказателя.Свойство("ЗначениеМин") Тогда
								СтрокаПоказателей.ЗначениеМин = ДанныеПоказателя.ЗначениеМин;
							КонецЕсли;
							
							Если ДанныеПоказателя.Свойство("ЗначениеМакс") Тогда
								СтрокаПоказателей.ЗначениеМакс = ДанныеПоказателя.ЗначениеМакс;
							КонецЕсли;
							
						КонецЕсли; 
						
					КонецЦикла;
					
				КонецЦикла;
				
				Для каждого ДанныеПоОтпускам Из ДанныеПоСтроке.ЕжегодныеОтпуска Цикл
					
					СтрокаОтпусков = ЕжегодныеОтпуска.Добавить();
					СтрокаОтпусков.ИдентификаторСтрокиПозиции = СтрокаДляЗаполнения.ИдентификаторСтрокиПозиции;
					ЗаполнитьЗначенияСвойств(СтрокаОтпусков, ДанныеПоОтпускам);
					
					СтрокаОтпусков.Действие = Перечисления.ДействияСЕжегоднымиОтпусками.Утвердить;
					
				КонецЦикла;
				
				Для каждого ДанныеПоСпециальностям Из ДанныеПоСтроке.Специальности Цикл
					
					СтрокаСпециальности = Специальности.Добавить();
					СтрокаСпециальности.ИдентификаторСтрокиПозиции = СтрокаДляЗаполнения.ИдентификаторСтрокиПозиции;
					ЗаполнитьЗначенияСвойств(СтрокаСпециальности, ДанныеПоСпециальностям);
					
				КонецЦикла;
		
			КонецЕсли; 
			
		КонецЦикла;
		
	КонецЕсли;
	
	УпорядочитьСписокПозиций(Позиции);
	
	РезультатСозданияПозиций = Новый Структура("Организация,ДатаВступленияВСилу");
	ЗаполнитьЗначенияСвойств(РезультатСозданияПозиций, ПараметрыВыполнения);
	
	РезультатСозданияПозиций.Вставить("Позиции", Позиции);
	РезультатСозданияПозиций.Вставить("Начисления", Начисления);
	РезультатСозданияПозиций.Вставить("Показатели", Показатели);
	РезультатСозданияПозиций.Вставить("ЕжегодныеОтпуска", ЕжегодныеОтпуска);
	РезультатСозданияПозиций.Вставить("Специальности", Специальности);
	
	РассчитатьФОТНесколькихПозиций(РезультатСозданияПозиций);

	Возврат РезультатСозданияПозиций;
	
КонецФункции

Процедура ЗаполнитьДокументПоДаннымЗаполнения(ДокументОбъект, ДанныеЗаполнения) Экспорт
	
	Если ДанныеЗаполнения.Свойство("Позиции") Тогда
		ДокументОбъект.Позиции.Загрузить(ДанныеЗаполнения.Позиции);
	КонецЕсли; 
	
	Если ДанныеЗаполнения.Свойство("Начисления") Тогда
		ДокументОбъект.Начисления.Загрузить(ДанныеЗаполнения.Начисления);
	КонецЕсли; 
	
	Если ДанныеЗаполнения.Свойство("Показатели") Тогда
		ДокументОбъект.Показатели.Загрузить(ДанныеЗаполнения.Показатели);
	КонецЕсли; 
	
	Если ДанныеЗаполнения.Свойство("ЕжегодныеОтпуска") Тогда
		ДокументОбъект.ЕжегодныеОтпуска.Загрузить(ДанныеЗаполнения.ЕжегодныеОтпуска);
	КонецЕсли; 
	
	Если ДанныеЗаполнения.Свойство("Специальности") Тогда
		ДокументОбъект.Специальности.Загрузить(ДанныеЗаполнения.Специальности);
	КонецЕсли; 

КонецПроцедуры

Процедура УпорядочитьСписокПозиций(Позиции) Экспорт
	
	Если ТипЗнч(Позиции) = Тип("ТаблицаЗначений") Тогда
		ТаблицаПозиций = Позиции.Скопировать();
	Иначе
		ТаблицаПозиций = Позиции.Выгрузить();
	КонецЕсли;
	
	ЕстьРазрядКатегория = Ложь;
	Для каждого Колонка Из ТаблицаПозиций.Колонки Цикл
		Если НЕ ЕстьРазрядКатегория И ВРег(Колонка.Имя) = ВРег("РазрядКатегория") Тогда
			ЕстьРазрядКатегория = Истина;
		КонецЕсли;
	КонецЦикла;
	
	ТаблицаПозиций.Колонки.Добавить("ПодразделениеРеквизитДопУпорядочивания");
	ДанныеПодразделений = ОбщегоНазначения.ЗначенияРеквизитовОбъектов(ТаблицаПозиций.ВыгрузитьКолонку("Подразделение"), "РеквизитДопУпорядочиванияИерархического");
	ТаблицаПозиций.Колонки.Добавить("ДолжностьРеквизитДопУпорядочивания");
	ДанныеДолжностей = ОбщегоНазначения.ЗначенияРеквизитовОбъектов(ТаблицаПозиций.ВыгрузитьКолонку("Должность"), "РеквизитДопУпорядочивания");
	СтрокаСортировки = "ПодразделениеРеквизитДопУпорядочивания, ДолжностьРеквизитДопУпорядочивания";
	Если ЕстьРазрядКатегория Тогда
		ТаблицаПозиций.Колонки.Добавить("РазрядКатегорияРеквизитДопУпорядочивания");
		ДанныеРазрядовКатегорий = ОбщегоНазначения.ЗначенияРеквизитовОбъектов(ТаблицаПозиций.ВыгрузитьКолонку("РазрядКатегория"), "РеквизитДопУпорядочивания");
		СтрокаСортировки = СтрокаСортировки + ", РазрядКатегорияРеквизитДопУпорядочивания";
	КонецЕсли;
	
	Для каждого СтрокаТаблицыПозиций Из ТаблицаПозиций Цикл
		ДанныеПодразделения = ДанныеПодразделений.Получить(СтрокаТаблицыПозиций.Подразделение);
		Если ДанныеПодразделения <> Неопределено Тогда
			СтрокаТаблицыПозиций.ПодразделениеРеквизитДопУпорядочивания = ДанныеПодразделения.РеквизитДопУпорядочиванияИерархического;
		КонецЕсли;
		ДанныеДолжности = ДанныеДолжностей.Получить(СтрокаТаблицыПозиций.Должность);
		Если ДанныеДолжности <> Неопределено Тогда
			СтрокаТаблицыПозиций.ДолжностьРеквизитДопУпорядочивания = ДанныеДолжности.РеквизитДопУпорядочивания;
		КонецЕсли;
		Если ЕстьРазрядКатегория Тогда
			ДанныеРазрядаКатегорий = ДанныеРазрядовКатегорий.Получить(СтрокаТаблицыПозиций.Должность);
			Если ДанныеРазрядаКатегорий <> Неопределено Тогда
				СтрокаТаблицыПозиций.РазрядКатегорияРеквизитДопУпорядочивания = ДанныеРазрядаКатегорий.РеквизитДопУпорядочивания;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	ТаблицаПозиций.Сортировать(СтрокаСортировки);
	ТаблицаПозиций.Колонки.Удалить("ПодразделениеРеквизитДопУпорядочивания");
	ТаблицаПозиций.Колонки.Удалить("ДолжностьРеквизитДопУпорядочивания");
	ТаблицаПозиций.Колонки.Удалить("РазрядКатегорияРеквизитДопУпорядочивания");
	
	Если ТипЗнч(Позиции) = Тип("ТаблицаЗначений") Тогда
		Позиции = ТаблицаПозиций.Скопировать();
	Иначе
		Позиции.Загрузить(ТаблицаПозиций);
	КонецЕсли;
	
КонецПроцедуры

Функция МаксимальныйИдентификаторСтроки(КоллекцияСтрокПозиций, ИдентификаторРеквизита) Экспорт
	
	ИдентификаторСтрокиМакс = 0;	
	
	Для Каждого СтрокаПозиции Из КоллекцияСтрокПозиций Цикл
		Если СтрокаПозиции[ИдентификаторРеквизита] > ИдентификаторСтрокиМакс Тогда
			ИдентификаторСтрокиМакс = СтрокаПозиции[ИдентификаторРеквизита];
		КонецЕсли;
	КонецЦикла;	
	
	Возврат ИдентификаторСтрокиМакс;
	
КонецФункции

Функция ПараметрыВыбораКатегорииНачислений() Экспорт
	
	МассивКатегорийНачислений = КадровыйУчетРасширенный.ПараметрыВыбораКатегорииНачислений();
	Возврат МассивКатегорийНачислений;
	
КонецФункции

Функция ЗначениеПараметраВыбораНачисленийПоОтношениюКДенежномуСодержанию(Форма) Экспорт

	Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.ГосударственнаяСлужба") Тогда
		Модуль = ОбщегоНазначения.ОбщийМодуль("ГосударственнаяСлужба");
		Возврат Модуль.ЗначениеПараметраВыбораНачисленийВПозицииШтатногоРасписанияПоОтношениюКДенежномуСодержанию(Форма);
	Иначе
		Возврат Неопределено;
	КонецЕсли;	

КонецФункции 

Функция ЗначениеПараметраВыбораНачисленийПоОтношениюКДенежномуДовольствию(Форма) Экспорт

	Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.ГосударственнаяСлужба") Тогда
		Модуль = ОбщегоНазначения.ОбщийМодуль("ГосударственнаяСлужба");
		Возврат Модуль.ЗначениеПараметраВыбораНачисленийВПозицииШтатногоРасписанияПоОтношениюКДенежномуДовольствию(Форма);
	Иначе
		Возврат Неопределено;
	КонецЕсли;	

КонецФункции

Процедура СинхронизироватьРеквизитыПозиции(Объект, ФОИспользоватьВилкуСтавокВШтатномРасписании, СинхронизироватьНачисления = Ложь) Экспорт
	
	Если ФОИспользоватьВилкуСтавокВШтатномРасписании Тогда
		
		Объект.ОкладТариф = Объект.ОкладТарифМакс;
		Объект.ФОТ = Объект.ФОТМакс;
		Объект.НадбавкаЗаВредностьРазмер = Объект.НадбавкаЗаВредностьРазмерМакс;
			
	Иначе
			
		Объект.ОкладТарифМин = Объект.ОкладТариф;
		Объект.ФОТМин = Объект.ФОТ;
		Объект.НадбавкаЗаВредностьРазмерМин = Объект.НадбавкаЗаВредностьРазмер;
		
		Объект.ОкладТарифМакс = Объект.ОкладТариф;
		Объект.ФОТМакс = Объект.ФОТ;
		Объект.НадбавкаЗаВредностьРазмерМакс = Объект.НадбавкаЗаВредностьРазмер;
		
	КонецЕсли;
	
	Если СинхронизироватьНачисления Тогда
		СинхронизироватьРеквизитыНачислений(Объект, ФОИспользоватьВилкуСтавокВШтатномРасписании);
	КонецЕсли; 
	
КонецПроцедуры

Процедура СинхронизироватьРеквизитыНачислений(Объект, ФОИспользоватьВилкуСтавокВШтатномРасписании)
	
	Для каждого СтрокаТЧНачисления Из Объект.Начисления Цикл
		
		Если ФОИспользоватьВилкуСтавокВШтатномРасписании Тогда
			СтрокаТЧНачисления.Размер = СтрокаТЧНачисления.РазмерМакс;
		Иначе
			СтрокаТЧНачисления.РазмерМин = СтрокаТЧНачисления.Размер;
			СтрокаТЧНачисления.РазмерМакс = СтрокаТЧНачисления.Размер;
		КонецЕсли;
		
	КонецЦикла;
	
	Для каждого СтрокаТЧПоказатели Из Объект.Показатели Цикл
		
		Если ФОИспользоватьВилкуСтавокВШтатномРасписании Тогда
			СтрокаТЧПоказатели.Значение = СтрокаТЧПоказатели.ЗначениеМакс;
		Иначе
			СтрокаТЧПоказатели.ЗначениеМин = СтрокаТЧПоказатели.Значение;
			СтрокаТЧПоказатели.ЗначениеМакс = СтрокаТЧПоказатели.Значение;
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

// Обработчик события ПриЗаписи, инициирует обновление структуры списка справочника ШтатноеРасписание.
//
Процедура ОбновитьСтруктуруШтатногоРасписанияПриЗаписи(Источник, Отказ) Экспорт
	
	Если ЗарплатаКадры.ОтключитьБизнесЛогикуПриЗаписи(Источник) Тогда
		Возврат;
	КонецЕсли;
	
	Если ТипЗнч(Источник) = Тип("СправочникОбъект.ШтатноеРасписание")
		И Источник.ЭтоГруппа Тогда
		Возврат;
	КонецЕсли; 
	
	Если Источник.ДополнительныеСвойства.Свойство("ОтключитьОбновлениеСтруктурыШтатногоРасписания") Тогда
		Возврат;
	КонецЕсли; 
	
	Справочники.ШтатноеРасписание.ОбновитьСтруктуруШтатногоРасписанияПоПодразделениям();
	
КонецПроцедуры

Процедура ОтключитьОбновлениеСтруктурыШтатногоРасписания(Объект) Экспорт
	
	Объект.ДополнительныеСвойства.Вставить("ОтключитьОбновлениеСтруктурыШтатногоРасписания", Истина);
	
КонецПроцедуры

Функция ТекущиеКадровыеДанныеПозиций(Организация, ДанныеДляПолученияКадровыхДанных, ДатаДанных) Экспорт
	
	СтруктураПараметров = Новый Структура("Организация,Период", Организация, ДатаДанных);
	
	ИспользоватьПриОписанииПозицииШтатногоРасписанияРазрядыКатегорииКлассы = 
		ПолучитьФункциональнуюОпцию("ИспользоватьПриОписанииПозицииШтатногоРасписанияРазрядыКатегорииКлассыДолжностейИПрофессий", СтруктураПараметров);
		
	ФОИспользоватьВилкуСтавокВШтатномРасписании = ПолучитьФункциональнуюОпцию("ИспользоватьВилкуСтавокВШтатномРасписании");
		
	ДанныеПозиций = Новый Соответствие;
	Для каждого ИсходныеДанные Из ДанныеДляПолученияКадровыхДанных Цикл
		ДанныеПозиций.Вставить(ИсходныеДанные.ИдентификаторСтрокиПозиции, Новый Структура("Начисления,ЕжегодныеОтпуска,Специальности", Новый Массив, Новый Массив, Новый Массив));
	КонецЦикла;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("ДанныеДляПолученияКадровыхДанных", ДанныеДляПолученияКадровыхДанных);

	ПараметрыПолученияСотрудников = КадровыйУчет.ПараметрыПолученияСотрудниковОрганизацийПоСпискуФизическихЛиц();
	ПараметрыПолученияСотрудников.Организация = Организация;
	ПараметрыПолученияСотрудников.НачалоПериода = ДатаДанных;
	ПараметрыПолученияСотрудников.ОкончаниеПериода = ДатаДанных;
	ПараметрыПолученияСотрудников.КадровыеДанные = "Подразделение,Должность,ДолжностьПоШтатномуРасписанию";
	
	КадровыйУчет.СоздатьВТСотрудникиОрганизации(Запрос.МенеджерВременныхТаблиц, Истина, ПараметрыПолученияСотрудников);
	
	Запрос.Текст =
		"ВЫБРАТЬ
		|	ДанныеДляЗаполнения.Подразделение,
		|	ДанныеДляЗаполнения.Должность,
		|	ДанныеДляЗаполнения.ИдентификаторСтрокиПозиции КАК ИдентификаторСтрокиПозиции
		|ПОМЕСТИТЬ ВТДанныеДляЗаполнения
		|ИЗ
		|	&ДанныеДляПолученияКадровыхДанных КАК ДанныеДляЗаполнения
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СотрудникиОрганизации.Период,
		|	СотрудникиОрганизации.Сотрудник,
		|	ДанныеДляЗаполнения.ИдентификаторСтрокиПозиции
		|ПОМЕСТИТЬ ВТСотрудникиСИдентификаторами
		|ИЗ
		|	ВТСотрудникиОрганизации КАК СотрудникиОрганизации
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДанныеДляЗаполнения КАК ДанныеДляЗаполнения
		|		ПО СотрудникиОрганизации.Подразделение = ДанныеДляЗаполнения.Подразделение
		|			И СотрудникиОрганизации.Должность = ДанныеДляЗаполнения.Должность
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ВТСотрудникиСИдентификаторами.Сотрудник,
		|	ВТСотрудникиСИдентификаторами.Период
		|ПОМЕСТИТЬ ВТСотрудники
		|ИЗ
		|	ВТСотрудникиСИдентификаторами КАК ВТСотрудникиСИдентификаторами";
		
	Запрос.Выполнить();
		
	// Заполнение начислений
	ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТСотрудники", "Сотрудник");
	
	ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистраСрез();
	ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы,
		"Начисление.СпособВыполненияНачисления",
		"=",
		"ЗНАЧЕНИЕ(Перечисление.СпособыВыполненияНачислений.ЕжемесячноПриОкончательномРасчете)");
	
	ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
		"ПлановыеНачисления",
		Запрос.МенеджерВременныхТаблиц,
		Истина,
		ОписаниеФильтра,
		ПараметрыПостроения);
			
	ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
		"ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников",
		Запрос.МенеджерВременныхТаблиц,
		Истина,
		ОписаниеФильтра);
			
	Запрос.УстановитьПараметр("КатегорииНачисленияИлиНеоплаченногоВремени", ПараметрыВыбораКатегорииНачислений());
		
	Запрос.Текст =
		"ВЫБРАТЬ
		|	ПлановыеНачисления.Сотрудник КАК Сотрудник,
		|	ВЫРАЗИТЬ(ПлановыеНачисления.Начисление КАК ПланВидовРасчета.Начисления) КАК Начисление,
		|	ЕСТЬNULL(НачисленияПоказатели.Показатель, ЗНАЧЕНИЕ(ПланВидовРасчета.Начисления.ПустаяСсылка)) КАК Показатель
		|ПОМЕСТИТЬ ВТНачисленияСПоказателями
		|ИЗ
		|	ВТПлановыеНачисленияСрезПоследних КАК ПлановыеНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.Начисления.Показатели КАК НачисленияПоказатели
		|		ПО ПлановыеНачисления.Начисление = НачисленияПоказатели.Ссылка
		|			И (НачисленияПоказатели.ЗапрашиватьПриВводе)
		|ГДЕ
		|	ПлановыеНачисления.Используется
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТНачисленияСПоказателями.Начисление,
		|	ВТНачисленияСПоказателями.Показатель,
		|	ЕСТЬNULL(ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Значение, 0) КАК Значение,
		|	ВТСотрудникиСИдентификаторами.ИдентификаторСтрокиПозиции
		|ПОМЕСТИТЬ ВТИдентификаторыСтрокСНачислениями
		|ИЗ
		|	ВТНачисленияСПоказателями КАК ВТНачисленияСПоказателями
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних КАК ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников
		|		ПО (ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Сотрудник = ВТНачисленияСПоказателями.Сотрудник)
		|			И (ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Показатель = ВТНачисленияСПоказателями.Показатель)
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСИдентификаторами КАК ВТСотрудникиСИдентификаторами
		|		ПО ВТНачисленияСПоказателями.Сотрудник = ВТСотрудникиСИдентификаторами.Сотрудник
		|ГДЕ
		|	ВТНачисленияСПоказателями.Начисление.КатегорияНачисленияИлиНеоплаченногоВремени В(&КатегорииНачисленияИлиНеоплаченногоВремени)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТИдентификаторыСтрокСНачислениями.ИдентификаторСтрокиПозиции КАК ИдентификаторСтрокиПозиции,
		|	ВТИдентификаторыСтрокСНачислениями.Начисление КАК Начисление,
		|	ВТИдентификаторыСтрокСНачислениями.Показатель,
		|	МИНИМУМ(ВТИдентификаторыСтрокСНачислениями.Значение) КАК МинимальноеЗначение,
		|	МАКСИМУМ(ВТИдентификаторыСтрокСНачислениями.Значение) КАК МаксимальноеЗначение
		|ИЗ
		|	ВТИдентификаторыСтрокСНачислениями КАК ВТИдентификаторыСтрокСНачислениями
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТИдентификаторыСтрокСНачислениями.Начисление,
		|	ВТИдентификаторыСтрокСНачислениями.Показатель,
		|	ВТИдентификаторыСтрокСНачислениями.ИдентификаторСтрокиПозиции
		|
		|УПОРЯДОЧИТЬ ПО
		|	ВЫРАЗИТЬ(ВТИдентификаторыСтрокСНачислениями.Начисление КАК ПланВидовРасчета.Начисления).РеквизитДопУпорядочивания
		|ИТОГИ ПО
		|	ИдентификаторСтрокиПозиции,
		|	Начисление";
		
	РезультатЗапроса = Запрос.Выполнить();
		
	Если НЕ РезультатЗапроса.Пустой() Тогда
			
		Выборка = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ИдентификаторСтрокиПозиции");
		Пока Выборка.Следующий() Цикл
			
			ДанныеПозиции = ДанныеПозиций.Получить(Выборка.ИдентификаторСтрокиПозиции);
			
			СтрокиНачислений = ДанныеПозиции.Начисления;
			
			ВыборкаПоНачислениям = Выборка.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "Начисление");
			Пока ВыборкаПоНачислениям.Следующий() Цикл
				
				СтруктураНачисления = Новый Структура("Начисление,Показатели");
				СтруктураНачисления.Вставить("Начисление", ВыборкаПоНачислениям.Начисление);
				СтруктураНачисления.Вставить("Показатели", Новый Массив);
				
				ВыборкаПоПоказателям = ВыборкаПоНачислениям.Выбрать();
				Пока ВыборкаПоПоказателям.Следующий() Цикл
					
					Если ЗначениеЗаполнено(ВыборкаПоПоказателям.Показатель) Тогда
						
						СтруктураПоказателя = Новый Структура;
						СтруктураПоказателя.Вставить("Показатель", ВыборкаПоПоказателям.Показатель);
						
						Если ФОИспользоватьВилкуСтавокВШтатномРасписании Тогда
							СтруктураПоказателя.Вставить("МинимальноеЗначение", ВыборкаПоПоказателям.МинимальноеЗначение);
							СтруктураПоказателя.Вставить("МаксимальноеЗначение", ВыборкаПоПоказателям.МаксимальноеЗначение);
						Иначе
							СтруктураПоказателя.Вставить("Значение", ВыборкаПоПоказателям.МаксимальноеЗначение);
						КонецЕсли;
						
						СтруктураНачисления.Показатели.Добавить(СтруктураПоказателя);
						
					КонецЕсли; 
					
				КонецЦикла;
				
				СтрокиНачислений.Добавить(СтруктураНачисления);
					
			КонецЦикла;
				
		КонецЦикла;
			
	КонецЕсли; 
	
	// Заполнение дополнительных отпусков.
	
	ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
	"ПоложенныеВидыЕжегодныхОтпусков",
	Запрос.МенеджерВременныхТаблиц,
	Истина,
	ОписаниеФильтра);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ПоложенныеВидыЕжегодныхОтпусков.ВидЕжегодногоОтпуска,
	|	ПоложенныеВидыЕжегодныхОтпусков.КоличествоДнейВГод,
	|	СотрудникиСИдентификаторами.ИдентификаторСтрокиПозиции
	|ПОМЕСТИТЬ ВТИдентификаторыПозицийСОтпусками
	|ИЗ
	|	ВТПоложенныеВидыЕжегодныхОтпусковСрезПоследних КАК ПоложенныеВидыЕжегодныхОтпусков
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиСИдентификаторами КАК СотрудникиСИдентификаторами
	|		ПО ПоложенныеВидыЕжегодныхОтпусков.Сотрудник = СотрудникиСИдентификаторами.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ИдентификаторыПозицийСОтпусками.ВидЕжегодногоОтпуска,
	|	МАКСИМУМ(ИдентификаторыПозицийСОтпусками.КоличествоДнейВГод) КАК КоличествоДнейВГод,
	|	ИдентификаторыПозицийСОтпусками.ИдентификаторСтрокиПозиции КАК ИдентификаторСтрокиПозиции
	|ИЗ
	|	ВТИдентификаторыПозицийСОтпусками КАК ИдентификаторыПозицийСОтпусками
	|
	|СГРУППИРОВАТЬ ПО
	|	ИдентификаторыПозицийСОтпусками.ВидЕжегодногоОтпуска,
	|	ИдентификаторыПозицийСОтпусками.ИдентификаторСтрокиПозиции
	|ИТОГИ ПО
	|	ИдентификаторСтрокиПозиции";
	
	РезультатЗапроса = Запрос.Выполнить();
	Если НЕ РезультатЗапроса.Пустой() Тогда
		
		ВыборкаПоПозициям = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ИдентификаторСтрокиПозиции");
		Пока ВыборкаПоПозициям.Следующий() Цикл
			
			ДанныеПозиции = ДанныеПозиций.Получить(ВыборкаПоПозициям.ИдентификаторСтрокиПозиции);
			
			СтрокиОтпусков = ДанныеПозиции.ЕжегодныеОтпуска;
			
			ВыборкаПоОтпускам = ВыборкаПоПозициям.Выбрать();
			Пока ВыборкаПоОтпускам.Следующий() Цикл
				
				СтруктураОтпуска = Новый Структура;
				СтруктураОтпуска.Вставить("ВидЕжегодногоОтпуска", ВыборкаПоОтпускам.ВидЕжегодногоОтпуска);
				СтруктураОтпуска.Вставить("КоличествоДнейВГод", ВыборкаПоОтпускам.КоличествоДнейВГод);
				
				СтрокиОтпусков.Добавить(СтруктураОтпуска);
				
			КонецЦикла;
			
		КонецЦикла;
		
	КонецЕсли; 
	
	Возврат ДанныеПозиций;
	
КонецФункции

Функция СформироватьЗапросПоОтклонениюШтатногоРасписания(Организация, Дата, ТекущиеПозиции, Подразделение = Неопределено)
	
	ГоловнаяОрганизация = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Организация, "ГоловнаяОрганизация");
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("ТекущиеПозиции", ТекущиеПозиции);
	Запрос.УстановитьПараметр("Дата", Дата);
	Запрос.УстановитьПараметр("Подразделение", Подразделение);
	Запрос.УстановитьПараметр("НеОтбиратьПоПодразделению", Не ЗначениеЗаполнено(Подразделение));
	
	Запрос.УстановитьПараметр("ИспользоватьРазрядыКатегорииКлассыДолжностей",
		ПолучитьФункциональнуюОпцию("ИспользоватьТарифныеСеткиПриРасчетеЗарплаты")
		ИЛИ ПолучитьФункциональнуюОпцию("ИспользоватьПриОписанииПозицииШтатногоРасписанияРазрядыКатегорииКлассыДолжностейИПрофессий"));
		
	КадровыйУчетРасширенный.СоздатьВТТекущаяКадроваяРасстановка(Запрос.МенеджерВременныхТаблиц, Организация, Дата);
	
	ПараметрыПолученияПозиций = ПараметрыПолученияПозицийШтатногоРасписания();
	ПараметрыПолученияПозиций.ДатаАктуальности = Дата;
	ПараметрыПолученияПозиций.Организация = Организация;
	Если ЗначениеЗаполнено(Подразделение) Тогда
		ПараметрыПолученияПозиций.Подразделение = Подразделение;
	КонецЕсли; 
	
	СоздатьВТПозицииШтатногоРасписания(Истина, Запрос.МенеджерВременныхТаблиц, "ВТПозицииШтатногоРасписания", ПараметрыПолученияПозиций);
	
	Запрос.Текст = 
	 "ВЫБРАТЬ
	 |	ТекущиеПозиции.Должность КАК Должность,
	 |	ТекущиеПозиции.Подразделение КАК Подразделение,
	 |	ТекущиеПозиции.КоличествоСтавок КАК КоличествоСтавок,
	 |	ТекущиеПозиции.Позиция КАК Позиция,
	 |	ТекущиеПозиции.НомерСтроки
	 |ПОМЕСТИТЬ ВТТекущиеПозиции
	 |ИЗ
	 |	&ТекущиеПозиции КАК ТекущиеПозиции
	 |
	 |ИНДЕКСИРОВАТЬ ПО
	 |	Позиция,
	 |	Подразделение,
	 |	Должность
	 |;
	 |
	 |////////////////////////////////////////////////////////////////////////////////
	 |ВЫБРАТЬ
	 |	ЕСТЬNULL(ТекущиеПозиции.Должность, ПозицииШтатногоРасписания.Должность) КАК Должность,
	 |	ЕСТЬNULL(ТекущиеПозиции.Подразделение, ПозицииШтатногоРасписания.Подразделение) КАК Подразделение,
	 |	ЕСТЬNULL(ТекущиеПозиции.Позиция, ПозицииШтатногоРасписания.ПозицияШтатногоРасписания) КАК Позиция,
	 |	ЕСТЬNULL(ТекущиеПозиции.КоличествоСтавок, ПозицииШтатногоРасписания.КоличествоСтавок) КАК КоличествоСтавок
	 |ПОМЕСТИТЬ ВТТекущиеПозицииСгруппированныеДанные
	 |ИЗ
	 |	ВТТекущиеПозиции КАК ТекущиеПозиции
	 |		ПОЛНОЕ СОЕДИНЕНИЕ ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
	 |		ПО ТекущиеПозиции.Позиция = ПозицииШтатногоРасписания.ПозицияШтатногоРасписания
	 |
	 |ИНДЕКСИРОВАТЬ ПО
	 |	Позиция,
	 |	Подразделение,
	 |	Должность
	 |;
	 |
	 |////////////////////////////////////////////////////////////////////////////////
	 |ВЫБРАТЬ
	 |	ВЫБОР
	 |		КОГДА ТекущиеПозиции.Подразделение ЕСТЬ NULL 
	 |			ТОГДА ТекущаяКадроваяРасстановка.Подразделение
	 |		ИНАЧЕ ТекущиеПозиции.Подразделение
	 |	КОНЕЦ КАК Подразделение,
	 |	ВЫБОР
	 |		КОГДА ТекущиеПозиции.Должность ЕСТЬ NULL 
	 |			ТОГДА ТекущаяКадроваяРасстановка.Должность
	 |		ИНАЧЕ ТекущиеПозиции.Должность
	 |	КОНЕЦ КАК Должность,
	 |	ВЫБОР
	 |		КОГДА ЕСТЬNULL(ТекущиеПозиции.Позиция, ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)) = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
	 |				И НЕ ШтатноеРасписание.Ссылка ЕСТЬ NULL 
	 |			ТОГДА ШтатноеРасписание.Ссылка
	 |		ИНАЧЕ ТекущиеПозиции.Позиция
	 |	КОНЕЦ КАК ПозицияШтатногоРасписания,
	 |	ТекущаяКадроваяРасстановка.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников,
	 |	ЕСТЬNULL(ТекущиеПозиции.КоличествоСтавок, 0) КАК ШтатноеРасписаниеКоличествоСтавок,
	 |	ЕСТЬNULL(ТекущаяКадроваяРасстановка.КоличествоСтавок, 0) КАК НовоеКоличествоСтавок
	 |ПОМЕСТИТЬ ВТИзмененияШтатногоРасписания
	 |ИЗ
	 |	ВТТекущаяКадроваяРасстановка КАК ТекущаяКадроваяРасстановка
	 |		ЛЕВОЕ СОЕДИНЕНИЕ ВТТекущиеПозицииСгруппированныеДанные КАК ТекущиеПозиции
	 |		ПО (ТекущиеПозиции.Подразделение = ТекущаяКадроваяРасстановка.Подразделение)
	 |			И (ТекущиеПозиции.Должность = ТекущаяКадроваяРасстановка.Должность)
	 |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание КАК ШтатноеРасписание
	 |		ПО ТекущаяКадроваяРасстановка.Подразделение = ШтатноеРасписание.Подразделение
	 |			И ТекущаяКадроваяРасстановка.Должность = ШтатноеРасписание.Должность
	 |			И (НЕ ШтатноеРасписание.Закрыта)
	 |ГДЕ
	 |	ТекущаяКадроваяРасстановка.КоличествоСтавок > ЕСТЬNULL(ТекущиеПозиции.КоличествоСтавок, 0)
	 |	И (&НеОтбиратьПоПодразделению
	 |			ИЛИ ВЫБОР
	 |				КОГДА ТекущиеПозиции.Подразделение ЕСТЬ NULL 
	 |					ТОГДА ТекущаяКадроваяРасстановка.Подразделение
	 |				ИНАЧЕ ТекущиеПозиции.Подразделение
	 |			КОНЕЦ = &Подразделение)
	 |;
	 |
	 |////////////////////////////////////////////////////////////////////////////////
	 |ВЫБРАТЬ
	 |	ВЫБОР
	 |		КОГДА ТекущиеПозиции.Должность ЕСТЬ NULL 
	 |			ТОГДА ИзмененияШтатногоРасписания.Должность
	 |		ИНАЧЕ ТекущиеПозиции.Должность
	 |	КОНЕЦ КАК Должность,
	 |	ВЫБОР
	 |		КОГДА ТекущиеПозиции.Подразделение ЕСТЬ NULL 
	 |			ТОГДА ИзмененияШтатногоРасписания.Подразделение
	 |		ИНАЧЕ ТекущиеПозиции.Подразделение
	 |	КОНЕЦ КАК Подразделение,
	 |	ИзмененияШтатногоРасписания.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников,
	 |	ЕСТЬNULL(ТекущиеПозиции.КоличествоСтавок, 0) + ЕСТЬNULL(ИзмененияШтатногоРасписания.НовоеКоличествоСтавок, 0) КАК КоличествоСтавок,
	 |	ВЫБОР
	 |		КОГДА ТекущиеПозиции.Позиция ЕСТЬ NULL 
	 |			ТОГДА ИзмененияШтатногоРасписания.ПозицияШтатногоРасписания
	 |		ИНАЧЕ ТекущиеПозиции.Позиция
	 |	КОНЕЦ КАК Позиция,
	 |	ВЫБОР
	 |		КОГДА ТекущиеПозиции.НомерСтроки ЕСТЬ NULL 
	 |			ТОГДА ИСТИНА
	 |		ИНАЧЕ ЛОЖЬ
	 |	КОНЕЦ КАК НоваяСтрока,
	 |	ЕСТЬNULL(ТекущиеПозиции.НомерСтроки, 9999999) КАК НомерСтрокиПорядок
	 |ИЗ
	 |	ВТТекущиеПозиции КАК ТекущиеПозиции
	 |		ПОЛНОЕ СОЕДИНЕНИЕ ВТИзмененияШтатногоРасписания КАК ИзмененияШтатногоРасписания
	 |		ПО ТекущиеПозиции.Подразделение = ИзмененияШтатногоРасписания.Подразделение
	 |			И ТекущиеПозиции.Должность = ИзмененияШтатногоРасписания.Должность
	 |
	 |УПОРЯДОЧИТЬ ПО
	 |	НомерСтрокиПорядок";
	 
	 РезультатЗапроса = Запрос.Выполнить();
	 
	 Возврат РезультатЗапроса;				   
	
КонецФункции	

Функция ГрафикРаботыПоУмолчанию(ОбъектВладелец) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ОбъектВладелец", ОбъектВладелец);
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Организации.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников
		|ИЗ
		|	Справочник.Организации КАК Организации
		|ГДЕ
		|	Организации.Ссылка = &ОбъектВладелец
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ПодразделенияОрганизаций.ГрафикРаботыСотрудников
		|ИЗ
		|	Справочник.ПодразделенияОрганизаций КАК ПодразделенияОрганизаций
		|ГДЕ
		|	ПодразделенияОрганизаций.Ссылка = &ОбъектВладелец
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ШтатноеРасписание.ГрафикРаботыСотрудников
		|ИЗ
		|	Справочник.ШтатноеРасписание КАК ШтатноеРасписание
		|ГДЕ
		|	ШтатноеРасписание.Ссылка = &ОбъектВладелец";
		
	РезультатЗапроса = Запрос.Выполнить();
	Если РезультатЗапроса.Пустой() Тогда
		ГрафикРаботыПоУмолчанию = Справочники.ГрафикиРаботыСотрудников.ПустаяСсылка();
	Иначе
		
		Выборка = РезультатЗапроса.Выбрать();
		Выборка.Следующий();
		
		ГрафикРаботыПоУмолчанию = Выборка.ГрафикРаботыСотрудников;
		
	КонецЕсли;
		
	Возврат ГрафикРаботыПоУмолчанию;
	
КонецФункции

Процедура ЗаполнитьПодписантовДокумента(ДокументОбъект, Знач ДатаСведений, Знач ВключаяГлавногоБухгалтера = Истина) Экспорт
	
	Если НЕ ЗначениеЗаполнено(ДокументОбъект.Организация) Тогда
		Возврат;
	КонецЕсли; 
	
	ЗапрашиваемыеЗначения = Новый Структура;
	ЗапрашиваемыеЗначения.Вставить("Организация", ДокументОбъект.Организация);
	
	ЗапрашиваемыеЗначения.Вставить("Руководитель");
	ЗапрашиваемыеЗначения.Вставить("ДолжностьРуководителя");
	
	ЗаполняемыеПоля = "Руководитель,ДолжностьРуководителя,РуководительКадровойСлужбы,ДолжностьРуководителяКадровойСлужбы";
	
	Если ВключаяГлавногоБухгалтера Тогда
		ЗапрашиваемыеЗначения.Вставить("ГлавныйБухгалтер");
		ЗаполняемыеПоля = ЗаполняемыеПоля + ",ГлавныйБухгалтер";
	КонецЕсли; 
	
	ЗапрашиваемыеЗначения.Вставить("РуководительКадровойСлужбы");
	ЗапрашиваемыеЗначения.Вставить("ДолжностьРуководителяКадровойСлужбы");
	
	ЗарплатаКадры.ПолучитьЗначенияПоУмолчанию(ЗапрашиваемыеЗначения, ДатаСведений);
	
	ЗаполнитьЗначенияСвойств(ДокументОбъект, ЗапрашиваемыеЗначения, ЗаполняемыеПоля);
	
КонецПроцедуры

Функция ТекстЗапросаВТМестоПозицииВСтруктуреПредприятия(Запрос, ИмяВТ = "ВТВсеПозицииНаДатуАктуальности", ИмяПоляПозиция = "ПозицияШтатногоРасписания")
	
	Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.ОрганизационнаяСтруктура") Тогда
		
		Модуль = ОбщегоНазначения.ОбщийМодуль("ОрганизационнаяСтруктура");
		ТекстЗапроса = Модуль.ТекстЗапросаВТМестоПозицииВСтруктуреПредприятия(ИмяВТ, ИмяПоляПозиция);
		
	Иначе 
		
		ТекстЗапроса = "ВЫБРАТЬ ПЕРВЫЕ 0
		               |	NULL КАК Позиция,
		               |	NULL КАК МестоВСтруктуреПредприятия
		               |ПОМЕСТИТЬ ВТМестоПозицииВСтруктуреПредприятия";
					   
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

Процедура СоздатьВТМестоПозицииВСтруктуреПредприятия(МенеджерВременныхТаблиц, ИмяВТ, ИмяПоляПозиция = "Позиция")
	
	Запрос = Новый Запрос;
	
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	
	Запрос.Текст = ТекстЗапросаВТМестоПозицииВСтруктуреПредприятия(Запрос, ИмяВТ, ИмяПоляПозиция);
	
	Запрос.Выполнить();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
#Область ЗапросыПоСпециальностямПозицийШтатногоРасписания

// Функция возвращает список специальностей, действующих на дату события для указанного списка позиций штатного
// расписания.
//
Функция СпециальностиПозицииШтатногоРасписания(СписокПозиций, ДатаСобытия, Регистратор = Неопределено) 
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("СписокПозиций",	СписокПозиций);
	Запрос.УстановитьПараметр("ДатаСобытия",	ДатаСобытия);
	Запрос.УстановитьПараметр("Регистратор",	Регистратор);
	
	ФОИспользоватьИсториюИзмененияШтатногоРасписания = ПолучитьФункциональнуюОпцию("ИспользоватьИсториюИзмененияШтатногоРасписания");
	Если ФОИспользоватьИсториюИзмененияШтатногоРасписания Тогда
		Запрос.Текст =
		"ВЫБРАТЬ
		|	МАКСИМУМ(ИсторияИспользованияШтатногоРасписания.Дата) КАК Дата,
		|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания
		|ПОМЕСТИТЬ ВТСрезПоследних
		|ИЗ
		|	РегистрСведений.ИсторияИспользованияШтатногоРасписания КАК ИсторияИспользованияШтатногоРасписания
		|ГДЕ
		|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания В(&СписокПозиций)
		|	И ИсторияИспользованияШтатногоРасписания.Дата < &ДатаСобытия
		|	И ИсторияИспользованияШтатногоРасписания.Регистратор <> &Регистратор
		|
		|СГРУППИРОВАТЬ ПО
		|	ИсторияИспользованияШтатногоРасписания.ПозицияШтатногоРасписания
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ПозицияШтатногоРасписания,
		|	Дата
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ИсторияСпециальностейПоШтатномуРасписанию.ПозицияШтатногоРасписания КАК ПозицияШтатногоРасписания,
		|	ИсторияСпециальностейПоШтатномуРасписанию.Специальность КАК Специальность
		|ИЗ
		|	РегистрСведений.ИсторияСпециальностейПоШтатномуРасписанию КАК ИсторияСпециальностейПоШтатномуРасписанию
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСрезПоследних КАК СрезПоследних
		|		ПО ИсторияСпециальностейПоШтатномуРасписанию.ПозицияШтатногоРасписания = СрезПоследних.ПозицияШтатногоРасписания
		|			И ИсторияСпециальностейПоШтатномуРасписанию.Дата = СрезПоследних.Дата
		|
		|УПОРЯДОЧИТЬ ПО
		|	ПозицияШтатногоРасписания,
		|	Специальность";
		
	Иначе
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ШтатноеРасписаниеСпециальности.Ссылка КАК ПозицияШтатногоРасписания,
		|	ШтатноеРасписаниеСпециальности.Специальность КАК Специальность
		|ИЗ
		|	Справочник.ШтатноеРасписание.Специальности КАК ШтатноеРасписаниеСпециальности
		|ГДЕ
		|	ШтатноеРасписаниеСпециальности.Ссылка В(&СписокПозиций)
		|	И НЕ ШтатноеРасписаниеСпециальности.Ссылка.ЭтоГруппа
		|	И ШтатноеРасписаниеСпециальности.Ссылка.Утверждена
		|	И ШтатноеРасписаниеСпециальности.Ссылка.ДатаУтверждения <= &ДатаСобытия
		|	И (ШтатноеРасписаниеСпециальности.Ссылка.ДатаЗакрытия >= &ДатаСобытия
		|			ИЛИ ШтатноеРасписаниеСпециальности.Ссылка.ДатаЗакрытия = ДАТАВРЕМЯ(1, 1, 1))
		|
		|УПОРЯДОЧИТЬ ПО
		|	ПозицияШтатногоРасписания,
		|	Специальность";
		
	КонецЕсли;
	
	Возврат Запрос.Выполнить().Выгрузить();
	
КонецФункции

Процедура СоздатьВТСпециальностиПозицийШтатногоРасписания(ТолькоРазрешенные, ОписательВременныхТаблиц, ИмяВТСпециальностиПозицийШтатногоРасписания = "ВТСпециальностиПозицийШтатногоРасписания")
	
	Запрос = ЗапросВТСпециальностиПозицийШтатногоРасписания(
		ТолькоРазрешенные, ОписательВременныхТаблиц.ИмяВТПозицииШтатногоРасписания, ОписательВременныхТаблиц.ИменаРеквизитов, ИмяВТСпециальностиПозицийШтатногоРасписания);
		
	Запрос.МенеджерВременныхТаблиц = ОписательВременныхТаблиц.МенеджерВременныхТаблиц;
	
	Запрос.Выполнить();
	
КонецПроцедуры	

Функция ЗапросВТСпециальностиПозицийШтатногоРасписания(ТолькоРазрешенные, ИмяВТПозицииШтатногоРасписания, ИменаРеквизитов, ИмяВТСпециальностиПозицийШтатногоРасписания)
	
	Запрос = Новый Запрос;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьИсториюИзмененияШтатногоРасписания") Тогда
		
		ТекстЗапроса = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания,
		|	ИсторияСпециальностейПоШтатномуРасписанию.Специальность КАК Специальность
		|ПОМЕСТИТЬ ВТСпециальностиПозицийШтатногоРасписания
		|ИЗ
		|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ИсторияСпециальностейПоШтатномуРасписанию КАК ИсторияСпециальностейПоШтатномуРасписанию
		|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = ИсторияСпециальностейПоШтатномуРасписанию.ПозицияШтатногоРасписания
		|			И ПозицииШтатногоРасписания.Дата = ИсторияСпециальностейПоШтатномуРасписанию.Дата
		|{ГДЕ
		|	ИсторияСпециальностейПоШтатномуРасписанию.ПозицияШтатногоРасписания.Владелец.* КАК Организация,
		|	ИсторияСпециальностейПоШтатномуРасписанию.ПозицияШтатногоРасписания.Подразделение.* КАК Подразделение,
		|	ИсторияСпециальностейПоШтатномуРасписанию.ПозицияШтатногоРасписания.Должность.* КАК Должность,
		|	ИсторияСпециальностейПоШтатномуРасписанию.ПозицияШтатногоРасписания.*}";
		
	Иначе
		
		ТекстЗапроса = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ПозицииШтатногоРасписания.ПозицияШтатногоРасписания,
		|	Специальности.Специальность КАК Специальность
		|ПОМЕСТИТЬ ВТСпециальностиПозицийШтатногоРасписания
		|ИЗ
		|	ВТПозицииШтатногоРасписания КАК ПозицииШтатногоРасписания
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ШтатноеРасписание.Специальности КАК Специальности
		|		ПО ПозицииШтатногоРасписания.ПозицияШтатногоРасписания = Специальности.Ссылка
		|{ГДЕ
		|	Специальности.Ссылка.Владелец.* КАК Организация,
		|	Специальности.Ссылка.Подразделение.*,
		|	Специальности.Ссылка.Должность.*,
		|	Специальности.Ссылка.Ссылка.* КАК ПозицияШтатногоРасписания}";
		
	КонецЕсли;

	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТПозицииШтатногоРасписания", ИмяВТПозицииШтатногоРасписания);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПозицииШтатногоРасписания.ПозицияШтатногоРасписания", "ПозицииШтатногоРасписания." + ИменаРеквизитов.Позиция);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПозицииШтатногоРасписания.Дата", "ПозицииШтатногоРасписания." + ИменаРеквизитов.Дата);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВТСпециальностиПозицийШтатногоРасписания", ИмяВТСпециальностиПозицийШтатногоРасписания);
	
	Если НЕ ТолькоРазрешенные Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВЫБРАТЬ РАЗРЕШЕННЫЕ", "ВЫБРАТЬ");
	КонецЕсли;
	
	Запрос.Текст = ТекстЗапроса;
	
	Возврат Запрос;
	
КонецФункции

#КонецОбласти

////////////////////////////////////////////////////////////////////////////////
// ОБНОВЛЕНИЕ ИНФОРМАЦИОННОЙ БАЗЫ

// Добавляет в список Обработчики процедуры-обработчики обновления,
// необходимые данной подсистеме.
//
// Параметры:
//   Обработчики - ТаблицаЗначений - см. описание функции НоваяТаблицаОбработчиковОбновления
//                                   общего модуля ОбновлениеИнформационнойБазы.
// 
Процедура ЗарегистрироватьОбработчикиОбновления(Обработчики)Экспорт
	
	Обработчик = Обработчики.Добавить();
	Обработчик.Версия = "3.0.0.0";
	Обработчик.Процедура = "УправлениеШтатнымРасписанием.СинхронизироватьИспользованиеШтатногоРасписания";
	Обработчик.НачальноеЗаполнение = Истина;
	
	
КонецПроцедуры

Процедура СинхронизироватьИспользованиеШтатногоРасписания() Экспорт
	
	НастройкиШтатногоРасписания = РегистрыСведений.НастройкиШтатногоРасписания.СоздатьМенеджерЗаписи();
	НастройкиШтатногоРасписания.Прочитать();
	
	ЗаписыватьНастройки = Ложь;
	Если НастройкиШтатногоРасписания.Выбран() Тогда
	
		Если НастройкиШтатногоРасписания.ИспользоватьШтатноеРасписание = НастройкиШтатногоРасписания.НеИспользоватьШтатноеРасписание Тогда
			НастройкиШтатногоРасписания.НеИспользоватьШтатноеРасписание = Не НастройкиШтатногоРасписания.ИспользоватьШтатноеРасписание;
			ЗаписыватьНастройки = Истина;
		КонецЕсли;
		Если НастройкиШтатногоРасписания.ИспользоватьИсториюИзмененияШтатногоРасписания = НастройкиШтатногоРасписания.НеИспользоватьИсториюИзмененияШтатногоРасписания Тогда
			НастройкиШтатногоРасписания.НеИспользоватьИсториюИзмененияШтатногоРасписания = Не НастройкиШтатногоРасписания.ИспользоватьИсториюИзмененияШтатногоРасписания;
			ЗаписыватьНастройки = Истина;
		КонецЕсли;
		Если НастройкиШтатногоРасписания.ИспользоватьВилкуСтавокВШтатномРасписании = НастройкиШтатногоРасписания.НеИспользоватьВилкуСтавокВШтатномРасписании Тогда
			НастройкиШтатногоРасписания.НеИспользоватьВилкуСтавокВШтатномРасписании = Не НастройкиШтатногоРасписания.ИспользоватьВилкуСтавокВШтатномРасписании;
			ЗаписыватьНастройки = Истина;
		КонецЕсли;
		
	Иначе
		
		ЗначенияПоУмолчанию = НастройкиШтатногоРасписанияПоУмолчанию();
		Для Каждого КлючИЗначение Из ЗначенияПоУмолчанию Цикл
			НастройкиШтатногоРасписания[КлючИЗначение.Ключ] = КлючИЗначение.Значение;
		КонецЦикла;
		ЗаписыватьНастройки = Истина;
		
	КонецЕсли;
	
	Если ЗаписыватьНастройки Тогда
		НастройкиШтатногоРасписания.Записать();
	КонецЕсли;
	
КонецПроцедуры


Процедура ЗаполнитьТекущуюДолжностьПоШтатномуРасписанию() Экспорт
	
	Если НЕ ПолучитьФункциональнуюОпцию("ИспользоватьШтатноеРасписание") Тогда
		Возврат;
	КонецЕсли; 
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.Текст =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ТекущиеКадровыеДанныеСотрудников.Сотрудник КАК Сотрудник,
		|	ДАТАВРЕМЯ(1,1,1) КАК Период,
		|	ДАТАВРЕМЯ(1,1,1) КАК ДатаНачала,
		|	ДАТАВРЕМЯ(1,1,1) КАК ДатаОкончания
		|ПОМЕСТИТЬ ВТСотрудникиСНеЗаполненнойДолжностью
		|ИЗ
		|	РегистрСведений.ТекущиеКадровыеДанныеСотрудников КАК ТекущиеКадровыеДанныеСотрудников
		|ГДЕ
		|	ТекущиеКадровыеДанныеСотрудников.ТекущаяДолжность <> ЗНАЧЕНИЕ(Справочник.Должности.ПустаяСсылка)
		|	И ТекущиеКадровыеДанныеСотрудников.ТекущаяДолжностьПоШтатномуРасписанию = ЗНАЧЕНИЕ(Справочник.ШтатноеРасписание.ПустаяСсылка)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СотрудникиСНеЗаполненнойДолжностью.Сотрудник
		|ИЗ
		|	ВТСотрудникиСНеЗаполненнойДолжностью КАК СотрудникиСНеЗаполненнойДолжностью";
		
	РезультатЗапроса = Запрос.Выполнить();
	Если НЕ РезультатЗапроса.Пустой() Тогда
		
		МассивСотрудниковДляОбновления = РезультатЗапроса.Выгрузить().ВыгрузитьКолонку("Сотрудник");
		Запрос.УстановитьПараметр("МассивСотрудниковДляОбновления", МассивСотрудниковДляОбновления);
		
		ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТСотрудникиСНеЗаполненнойДолжностью", "Сотрудник");
		
		ИмяВТКадроваяИсторияСотрудниковСрезПоследних = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТКадроваяИсторияСотрудниковСрезПоследних");
		ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
			"КадроваяИсторияСотрудников",
			Запрос.МенеджерВременныхТаблиц,
			Ложь,
			ОписаниеФильтра,
			,
			ИмяВТКадроваяИсторияСотрудниковСрезПоследних);
		
		Запрос.Текст =
			"ВЫБРАТЬ
			|	КадроваяИсторияСотрудников.Сотрудник,
			|	КадроваяИсторияСотрудников.Организация,
			|	КадроваяИсторияСотрудников.Подразделение,
			|	КадроваяИсторияСотрудников.Должность,
			|	КадроваяИсторияСотрудников.ДолжностьПоШтатномуРасписанию,
			|	КадроваяИсторияСотрудников.ВидЗанятости,
			|	КадроваяИсторияСотрудников.ВидДоговора
			|ПОМЕСТИТЬ ВТКадроваяИсторияСотрудниковСрезПоследних
			|ИЗ
			|	&КадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников";
			
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&КадроваяИсторияСотрудников", ИмяВТКадроваяИсторияСотрудниковСрезПоследних);
		
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.Подработки") Тогда
			
			ИмяВТСостоянияПодработокСрезПоследних = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТСостоянияПодработокСрезПоследних");
			ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистраСрезПоследних(
				"СостоянияПодработок",
				Запрос.МенеджерВременныхТаблиц,
				Ложь,
				ОписаниеФильтра,
				,
				ИмяВТСостоянияПодработокСрезПоследних);
			
			Запрос.Текст = Запрос.Текст + "
				|
				|ОБЪЕДИНИТЬ ВСЕ
				|"
				+ "ВЫБРАТЬ
				|	СостоянияПодработок.Сотрудник,
				|	СостоянияПодработок.Организация,
				|	СостоянияПодработок.Подразделение,
				|	СостоянияПодработок.Должность,
				|	СостоянияПодработок.ДолжностьПоШтатномуРасписанию,
				|	СостоянияПодработок.ВидЗанятости,
				|	СостоянияПодработок.ВидДоговора
				|ИЗ
				|	&СостоянияПодработок КАК СостоянияПодработок";
			
			Запрос.Текст = СтрЗаменить(Запрос.Текст, "&СостоянияПодработок", ИмяВТСостоянияПодработокСрезПоследних);
			
		КонецЕсли;
		
		Запрос.Выполнить();
			
		// Получим таблицу событий прием и увольнения.
		ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистра();
		
		// Сформируем отбор по события прием и увольнение.
		СобытияПриемУвольнение = Новый Массив;
		СобытияПриемУвольнение.Добавить(Перечисления.ВидыКадровыхСобытий.Прием);
		СобытияПриемУвольнение.Добавить(Перечисления.ВидыКадровыхСобытий.Увольнение);
		
		ЗарплатаКадрыОбщиеНаборыДанных.ДобавитьВКоллекциюОтбор(ПараметрыПостроения.Отборы, "ВидСобытия","В", СобытияПриемУвольнение);
		
		ИмяВТКадроваяИсторияСотрудников = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТКадроваяИсторияСотрудников");
		ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистра(
			"КадроваяИсторияСотрудников",
			Запрос.МенеджерВременныхТаблиц,
			Ложь,
			ОписаниеФильтра,
			ПараметрыПостроения,
			ИмяВТКадроваяИсторияСотрудников);
		
		Запрос.Текст =
			"ВЫБРАТЬ
			|	КадроваяИсторияСотрудников.Период,
			|	КадроваяИсторияСотрудников.Сотрудник,
			|	КадроваяИсторияСотрудников.ВидСобытия
			|ПОМЕСТИТЬ ВТКадроваяИсторияСотрудников
			|ИЗ
			|	&КадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников";
			
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&КадроваяИсторияСотрудников", ИмяВТКадроваяИсторияСотрудников);
		
		Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.Подработки") Тогда

			ИмяВТСостоянияПодработок = ЗарплатаКадрыОбщиеНаборыДанных.УникальноеИмяТекстаЗапроса("ВТСостоянияПодработок");
			ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистра(
				"СостоянияПодработок",
				Запрос.МенеджерВременныхТаблиц,
				Ложь,
				ОписаниеФильтра,
				ПараметрыПостроения,
				ИмяВТСостоянияПодработок);
				
			Запрос.Текст = Запрос.Текст + "
				|
				|ОБЪЕДИНИТЬ ВСЕ
				|"
				+ "ВЫБРАТЬ
				|	СостоянияПодработок.Период,
				|	СостоянияПодработок.Сотрудник,
				|	СостоянияПодработок.ВидСобытия
				|ИЗ
				|	&СостоянияПодработок КАК СостоянияПодработок";
				
			Запрос.Текст = СтрЗаменить(Запрос.Текст, "&СостоянияПодработок", ИмяВТСостоянияПодработок);
			
		КонецЕсли;
		
		Запрос.Выполнить();
		
		КадровыйУчетВнутренний.ОбновитьТекущиеКадровыеДанныеСотрудников(Запрос);
		
	КонецЕсли; 
	
КонецПроцедуры

#КонецОбласти