#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

Перем Организация, НачалоПериода, КонецПериода;

#Область ОбработчикиСобытий
	
Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ПользовательскиеНастройкиМодифицированы = Ложь;
	
	УстановитьОбязательныеНастройки(ПользовательскиеНастройкиМодифицированы);
	
	// Подготовим и выведем отчет.
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	
	НастройкиКомпоновкиДанных = КомпоновщикНастроек.ПолучитьНастройки();
	
	НастроитьСоставКолонок(НастройкиКомпоновкиДанных);
	
	НаборыДанных = ИнициализироватьВнешнийНаборДанных();
	
	МакетКомпоновки = КомпоновщикМакета.Выполнить(
		СхемаКомпоновкиДанных,
		НастройкиКомпоновкиДанных,
		ДанныеРасшифровки);
		
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	
	ПроцессорКомпоновки.Инициализировать(МакетКомпоновки, НаборыДанных, ДанныеРасшифровки, Истина);
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(ДокументРезультат);
	ПроцессорВывода.НачатьВывод();
	ПроцессорВывода.Вывести(ПроцессорКомпоновки, Истина);
	ПроцессорВывода.ЗакончитьВывод();
	
КонецПроцедуры

#КонецОбласти 

#Область СлужбеныеПроцедурыИФункции

// Для общей формы "Форма отчета" подсистемы "Варианты отчетов".
Процедура ОпределитьНастройкиФормы(Форма, КлючВарианта, Настройки) Экспорт
	
	Настройки.СоответствиеПериодичностиПараметров.Вставить(Новый ПараметрКомпоновкиДанных("Период"), Перечисления.ДоступныеПериодыОтчета.Месяц);
	
КонецПроцедуры

Процедура УстановитьОбязательныеНастройки(ПользовательскиеНастройкиМодифицированы)
	
	Организация = Справочники.Организации.ПустаяСсылка();
	
	ПараметрОрганизация = КомпоновкаДанныхКлиентСервер.ПолучитьПараметр(КомпоновщикНастроек, "Организация");
	Если ПараметрОрганизация <> Неопределено Тогда
		Если ПараметрОрганизация.Использование Тогда
			Организация = ПараметрОрганизация.Значение;
		КонецЕсли;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(Организация) Тогда
		СтрокаСообщения = НСтр("ru='Не установлено значение параметра ""Организация"".';uk='Не встановлено параметр ""Організація"".'");
		ВызватьИсключение СтрокаСообщения;
	КонецЕсли;
	
	НастройкиОтчета = КомпоновщикНастроек.ПолучитьНастройки();
	ЗначениеПараметра = НастройкиОтчета.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	Если ЗначениеПараметра <> Неопределено Тогда
		НачалоПериода = Дата(ЗначениеПараметра.Значение.ДатаНачала);
		КонецПериода  = Дата(ЗначениеПараметра.Значение.ДатаОкончания);
	КонецЕсли;
	
	Если НачалоПериода = '00010101' Тогда
		НачалоПериода = НачалоМесяца(ТекущаяДатаСеанса());
	КонецЕсли;
	Если КонецПериода = '00010101' Тогда
		КонецПериода = КонецМесяца(ТекущаяДатаСеанса());
	КонецЕсли;
	
	Валюта = Константы.ВалютаРегламентированногоУчета.Получить();
	ПараметрВалюта = КомпоновкаДанныхКлиентСервер.ПолучитьПараметр(КомпоновщикНастроек, "Валюта");
	Если ПараметрВалюта.Значение <> Валюта Тогда
		КомпоновкаДанныхКлиентСервер.УстановитьПараметр(КомпоновщикНастроек, "Валюта", Валюта);
		ПользовательскиеНастройкиМодифицированы = Истина;
	КонецЕсли;
	
	// Сообщим форме отчета, что настройки модифицированы
	Если ПользовательскиеНастройкиМодифицированы Тогда
		КомпоновщикНастроек.ПользовательскиеНастройки.ДополнительныеСвойства.Вставить("ПользовательскиеНастройкиМодифицированы", Истина);
	КонецЕсли;
	
КонецПроцедуры

Функция ИнициализироватьВнешнийНаборДанных()
	
	СтрокаСписокТаблиц = "НачисленнаяЗарплатаИВзносы, НачисленныйНДФЛ, УдержаннаяЗарплата, НачисленныеПроцентыПоЗаймам";
	
	ТекущийМесяц = НачалоПериода;
	
	ИнициализацияТаблиц = Истина;
	
	РезультирующаяТаблицаНачислений = Неопределено;
	РезультирующаяТаблицаНДФЛ       = Неопределено;
	РезультирующаяТаблицаУдержаний  = Неопределено;
	РезультирующаяТаблицаПроцентов  = Неопределено;
	
	Пока ТекущийМесяц <= НачалоМесяца(КонецПериода) Цикл
		
		СтруктураПараметров = Новый Структура("Организация, ПериодРегистрации, СтрокаСписокТаблиц",
		Организация, ТекущийМесяц, СтрокаСписокТаблиц);
		
		АдресХранилища = ПоместитьВоВременноеХранилище(Неопределено);
		
		Документы.ОтражениеЗарплатыВФинансовомУчете.ПодготовитьДанныеДляЗаполнения(СтруктураПараметров, АдресХранилища);
		
		Параметры = Новый Структура;
		Параметры.Вставить("АдресХранилища",          АдресХранилища);
		Параметры.Вставить("СтрокаСписокТаблиц",      СтрокаСписокТаблиц);
		Параметры.Вставить("ЗаполнятьАналитики",      Ложь);
		Параметры.Вставить("ТекстОповещения",         );
		Параметры.Вставить("ПояснениеОповещения",     );
		Параметры.Вставить("ЕстьДанныеДляЗаполнения", Ложь);
		Параметры.Вставить("Сводно",                  Ложь);
		
		Результат = ТаблицыОтражения();
		
		Документы.ОтражениеЗарплатыВФинансовомУчете.ЗаполнениеПослеВыполненияДлительнойОперации(Результат, Параметры, Ложь);
		
		Если ИнициализацияТаблиц Тогда
			
			РезультирующаяТаблицаНачислений     = Результат.НачисленнаяЗарплатаИВзносыПоФизлицам;
			РезультирующаяТаблицаНДФЛ           = Результат.НачисленныйНДФЛ;
			РезультирующаяТаблицаУдержаний      = Результат.УдержаннаяЗарплата;
			РезультирующаяТаблицаПроцентов      = Результат.НачисленныеПроцентыПоЗаймам;
			
			ИнициализацияТаблиц = Ложь;
			
		Иначе
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(Результат.НачисленнаяЗарплатаИВзносыПоФизлицам,   РезультирующаяТаблицаНачислений);
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(Результат.НачисленныйНДФЛ,       РезультирующаяТаблицаНДФЛ);
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(Результат.УдержаннаяЗарплата,    РезультирующаяТаблицаУдержаний);
			ОбщегоНазначенияКлиентСервер.ДополнитьТаблицу(Результат.НачисленныеПроцентыПоЗаймам,    РезультирующаяТаблицаПроцентов);
		КонецЕсли;
		
		ТекущийМесяц = ДобавитьМесяц(ТекущийМесяц, 1);
		
	КонецЦикла;

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Документы.Ссылка КАК Ссылка,
		|	Документы.Сводно КАК Сводно,
		|	Документы.Организация
		|ПОМЕСТИТЬ ВТДокументы
		|ИЗ
		|	Документ.ОтражениеЗарплатыВФинансовомУчете КАК Документы
		|ГДЕ
		|	Документы.Проведен
		|	И Документы.ПериодРегистрации МЕЖДУ &НачалоПериода И &КонецПериода
		|	И Документы.Организация = &Организация
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	&Организация,
		|	НачисленнаяЗарплата.ПодразделениеПредприятия,
		|	ВЫБОР
		|		КОГДА НачисленнаяЗарплата.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоЗарплате.НачисленоСдельноДоход)
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.СпособыОтраженияЗарплатыВБухУчете.ПустаяСсылка)
		|		ИНАЧЕ НачисленнаяЗарплата.СпособОтраженияЗарплатыВБухучете
		|	КОНЕЦ КАК СпособОтраженияЗарплатыВБухучете,
		|	НачисленнаяЗарплата.ФизическоеЛицо,
		|	НачисленнаяЗарплата.ВидОперации,
		|	НачисленнаяЗарплата.Сумма,
		|	НачисленнаяЗарплата.ВзносыВсего КАК Взносы,
		|	0 КАК СуммаОтражено,
		|	0 КАК ВзносыОтражено
		|ПОМЕСТИТЬ ВТНачислено
		|ИЗ
		|	&НачисленнаяЗарплата КАК НачисленнаяЗарплата
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НачисленныйНДФЛ.ПодразделениеПредприятия,
		|	НачисленныйНДФЛ.ВидОперации,
		|	НачисленныйНДФЛ.ФизическоеЛицо,
		|	НачисленныйНДФЛ.Сумма КАК НДФЛНачислено,
		|	0 КАК НДФЛОтражено
		|ПОМЕСТИТЬ ВТНДФЛ
		|ИЗ
		|	&НачисленныйНДФЛ КАК НачисленныйНДФЛ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НачисленныеПроцентыПоЗаймам.ПодразделениеПредприятия,
		|	НачисленныеПроцентыПоЗаймам.ФизическоеЛицо,
		|	НачисленныеПроцентыПоЗаймам.Сумма КАК ПроцентыНачислено,
		|	0 КАК ПроцентыОтражено
		|ПОМЕСТИТЬ ВТПроценты
		|ИЗ
		|	&НачисленныеПроцентыПоЗаймам КАК НачисленныеПроцентыПоЗаймам
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	УдержаннаяЗарплата.ПодразделениеПредприятия,
		|	УдержаннаяЗарплата.ВидОперации,
		|	УдержаннаяЗарплата.ФизическоеЛицо,
		|	УдержаннаяЗарплата.Контрагент,
		|	УдержаннаяЗарплата.Сумма КАК УдержанияНачислено,
		|	0 КАК УдержанияОтражено
		|ПОМЕСТИТЬ ВТУдержания
		|ИЗ
		|	&УдержаннаяЗарплата КАК УдержаннаяЗарплата
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТДокументы.Организация,
		|	НачисленияПоФизлицам.ПодразделениеПредприятия,
		|	НачисленияПоФизлицам.ФизическоеЛицо,
		|	НачисленияПоФизлицам.ВидОперации,
		|	НачисленияПоФизлицам.СпособОтраженияЗарплатыВБухучете,
		|	НачисленияПоФизлицам.Сумма КАК СуммаОтражено,
		|	НачисленияПоФизлицам.ВзносыВсего КАК ВзносыОтражено,
		|	0 КАК Сумма,
		|	0 КАК Взносы
		|ПОМЕСТИТЬ ВТОтражено
		|ИЗ
		|	ВТДокументы КАК ВТДокументы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтражениеЗарплатыВФинансовомУчете.НачисленнаяЗарплатаИВзносыПоФизлицам КАК НачисленияПоФизлицам
		|		ПО ВТДокументы.Ссылка = НачисленияПоФизлицам.Ссылка
		|ГДЕ
		|	НЕ ВТДокументы.Сводно
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТДокументы.Организация,
		|	НачисленияСводно.ПодразделениеПредприятия,
		|	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка),
		|	НачисленияСводно.ВидОперации,
		|	НачисленияСводно.СпособОтраженияЗарплатыВБухучете,
		|	НачисленияСводно.Сумма,
		|	НачисленияСводно.ВзносыВсего,
		|	0,
		|	0
		|ИЗ
		|	ВТДокументы КАК ВТДокументы
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтражениеЗарплатыВФинансовомУчете.НачисленнаяЗарплатаИВзносы КАК НачисленияСводно
		|		ПО ВТДокументы.Ссылка = НачисленияСводно.Ссылка
		|ГДЕ
		|	ВТДокументы.Сводно
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТНачислено.Организация,
		|	ВТНачислено.ПодразделениеПредприятия,
		|	ВТНачислено.СпособОтраженияЗарплатыВБухучете,
		|	ВТНачислено.ФизическоеЛицо,
		|	ВТНачислено.ВидОперации,
		|	ВТНачислено.Сумма,
		|	ВТНачислено.Взносы,	
		|	ВТНачислено.СуммаОтражено,
		|	ВТНачислено.ВзносыОтражено
		|ПОМЕСТИТЬ ВТНачисленнаяЗарплата
		|ИЗ
		|	ВТНачислено КАК ВТНачислено
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТОтражено.Организация,
		|	ВТОтражено.ПодразделениеПредприятия,
		|	ВТОтражено.СпособОтраженияЗарплатыВБухучете,
		|	ВТОтражено.ФизическоеЛицо,
		|	ВТОтражено.ВидОперации,
		|	ВТОтражено.Сумма,
		|	ВТОтражено.Взносы,	
		|	ВТОтражено.СуммаОтражено,
		|	ВТОтражено.ВзносыОтражено
		|ИЗ
		|	ВТОтражено КАК ВТОтражено
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТНДФЛ.ПодразделениеПредприятия,
		|	ВТНДФЛ.ВидОперации,
		|	ВТНДФЛ.ФизическоеЛицо,
		|	ВТНДФЛ.НДФЛНачислено,
		|	ВТНДФЛ.НДФЛОтражено
		|ПОМЕСТИТЬ ВТНДФЛОбъединение
		|ИЗ
		|	ВТНДФЛ КАК ВТНДФЛ
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОтраженныйНДФЛ.ПодразделениеПредприятия,
		|	ОтраженныйНДФЛ.ВидОперации,
		|	ОтраженныйНДФЛ.ФизическоеЛицо,
		|	0,
		|	ОтраженныйНДФЛ.Сумма
		|ИЗ
		|	Документ.ОтражениеЗарплатыВФинансовомУчете.НачисленныйНДФЛ КАК ОтраженныйНДФЛ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументы КАК ВТДокументы
		|		ПО ОтраженныйНДФЛ.Ссылка = ВТДокументы.Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТПроценты.ПодразделениеПредприятия,
		|	ВТПроценты.ФизическоеЛицо,
		|	ВТПроценты.ПроцентыНачислено,
		|	ВТПроценты.ПроцентыОтражено
		|ПОМЕСТИТЬ ВТПроцентыОбъединение
		|ИЗ
		|	ВТПроценты КАК ВТПроценты
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОтражениеЗарплатыВФинансовомУчетеНачисленныеПроцентыПоЗаймам.ПодразделениеПредприятия,
		|	ОтражениеЗарплатыВФинансовомУчетеНачисленныеПроцентыПоЗаймам.ФизическоеЛицо,
		|	0,
		|	ОтражениеЗарплатыВФинансовомУчетеНачисленныеПроцентыПоЗаймам.Сумма
		|ИЗ
		|	Документ.ОтражениеЗарплатыВФинансовомУчете.НачисленныеПроцентыПоЗаймам КАК ОтражениеЗарплатыВФинансовомУчетеНачисленныеПроцентыПоЗаймам
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументы КАК ВТДокументы
		|		ПО ОтражениеЗарплатыВФинансовомУчетеНачисленныеПроцентыПоЗаймам.Ссылка = ВТДокументы.Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТУдержания.ПодразделениеПредприятия,
		|	ВТУдержания.ВидОперации,
		|	ВТУдержания.ФизическоеЛицо,
		|	ВТУдержания.Контрагент,
		|	ВТУдержания.УдержанияНачислено,
		|	ВТУдержания.УдержанияОтражено
		|ПОМЕСТИТЬ ВТУдержанияОбъединение
		|ИЗ
		|	ВТУдержания КАК ВТУдержания
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	УдержаннаяЗарплатаПритянаяКУчету.ПодразделениеПредприятия,
		|	УдержаннаяЗарплатаПритянаяКУчету.ВидОперации,
		|	УдержаннаяЗарплатаПритянаяКУчету.ФизическоеЛицо,
		|	УдержаннаяЗарплатаПритянаяКУчету.Контрагент,
		|	0,
		|	УдержаннаяЗарплатаПритянаяКУчету.Сумма
		|ИЗ
		|	Документ.ОтражениеЗарплатыВФинансовомУчете.УдержаннаяЗарплата КАК УдержаннаяЗарплатаПритянаяКУчету
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументы КАК ВТДокументы
		|		ПО УдержаннаяЗарплатаПритянаяКУчету.Ссылка = ВТДокументы.Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТНачисленнаяЗарплата.Организация,
		|	ВТНачисленнаяЗарплата.ПодразделениеПредприятия,
		|	ВТНачисленнаяЗарплата.СпособОтраженияЗарплатыВБухучете,
		|	ВТНачисленнаяЗарплата.ФизическоеЛицо,
		|	ВТНачисленнаяЗарплата.ВидОперации,
		|	СУММА(ВТНачисленнаяЗарплата.Сумма) КАК Сумма,
		|	СУММА(ВТНачисленнаяЗарплата.Взносы) КАК Взносы,
		|	СУММА(ВТНачисленнаяЗарплата.СуммаОтражено) КАК СуммаОтражено,
		|	СУММА(ВТНачисленнаяЗарплата.ВзносыОтражено) КАК ВзносыОтражено,
		|	ВЫБОР
		|		КОГДА СУММА(ВТНачисленнаяЗарплата.Сумма) - СУММА(ВТНачисленнаяЗарплата.СуммаОтражено) + СУММА(ВТНачисленнаяЗарплата.Взносы) - СУММА(ВТНачисленнаяЗарплата.ВзносыОтражено) <> 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ТребуетсяОтражение,
		|	""НачисленнаяЗарплата"" КАК ИдентификаторНабора
		|ИЗ
		|	ВТНачисленнаяЗарплата КАК ВТНачисленнаяЗарплата
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТНачисленнаяЗарплата.ПодразделениеПредприятия,
		|	ВТНачисленнаяЗарплата.ФизическоеЛицо,
		|	ВТНачисленнаяЗарплата.СпособОтраженияЗарплатыВБухучете,
		|	ВТНачисленнаяЗарплата.ВидОперации,
		|	ВТНачисленнаяЗарплата.Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТНДФЛОбъединение.ПодразделениеПредприятия,
		|	ВТНДФЛОбъединение.ВидОперации,
		|	ВТНДФЛОбъединение.ФизическоеЛицо,
		|	СУММА(ВТНДФЛОбъединение.НДФЛНачислено) КАК НДФЛНачислено,
		|	СУММА(ВТНДФЛОбъединение.НДФЛОтражено) КАК НДФЛОтражено,
		|	ВЫБОР
		|		КОГДА СУММА(ВТНДФЛОбъединение.НДФЛНачислено) - СУММА(ВТНДФЛОбъединение.НДФЛОтражено) <> 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ТребуетсяОтражение,
		|	&Организация,
		|	""НачисленныйНДФЛ"" КАК ИдентификаторНабора
		|ИЗ
		|	ВТНДФЛОбъединение КАК ВТНДФЛОбъединение
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТНДФЛОбъединение.ФизическоеЛицо,
		|	ВТНДФЛОбъединение.ПодразделениеПредприятия,
		|	ВТНДФЛОбъединение.ВидОперации
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТУдержанияОбъединение.ПодразделениеПредприятия,
		|	ВТУдержанияОбъединение.ВидОперации,
		|	ВТУдержанияОбъединение.ФизическоеЛицо,
		|	ВТУдержанияОбъединение.Контрагент,
		|	СУММА(ВТУдержанияОбъединение.УдержанияНачислено) КАК УдержанияНачислено,
		|	СУММА(ВТУдержанияОбъединение.УдержанияОтражено) КАК УдержанияОтражено,
		|	ВЫБОР
		|		КОГДА СУММА(ВТУдержанияОбъединение.УдержанияНачислено) - СУММА(ВТУдержанияОбъединение.УдержанияОтражено) <> 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ТребуетсяОтражение,
		|	&Организация,
		|	""УдержаннаяЗарплата"" КАК ИдентификаторНабора
		|ИЗ
		|	ВТУдержанияОбъединение КАК ВТУдержанияОбъединение
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТУдержанияОбъединение.ВидОперации,
		|	ВТУдержанияОбъединение.ПодразделениеПредприятия,
		|	ВТУдержанияОбъединение.ФизическоеЛицо,
		|	ВТУдержанияОбъединение.Контрагент
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТПроцентыОбъединение.ПодразделениеПредприятия,
		|	ВТПроцентыОбъединение.ФизическоеЛицо,
		|	&Организация,
		|	""НачисленныеПроцентыПоЗаймам"" КАК ИдентификаторНабора,
		|	СУММА(ВТПроцентыОбъединение.ПроцентыНачислено) КАК ПроцентыНачислено,
		|	СУММА(ВТПроцентыОбъединение.ПроцентыОтражено) КАК ПроцентыОтражено,
		|	ВЫБОР
		|		КОГДА СУММА(ВТПроцентыОбъединение.ПроцентыНачислено) - СУММА(ВТПроцентыОбъединение.ПроцентыОтражено) <> 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ТребуетсяОтражение
		|ИЗ
		|	ВТПроцентыОбъединение КАК ВТПроцентыОбъединение
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТПроцентыОбъединение.ФизическоеЛицо,
		|	ВТПроцентыОбъединение.ПодразделениеПредприятия";
		
	Запрос.УстановитьПараметр("НачисленнаяЗарплата",   РезультирующаяТаблицаНачислений);
	Запрос.УстановитьПараметр("НачисленныйНДФЛ",       РезультирующаяТаблицаНДФЛ);
	Запрос.УстановитьПараметр("УдержаннаяЗарплата",    РезультирующаяТаблицаУдержаний);
	Запрос.УстановитьПараметр("НачисленныеПроцентыПоЗаймам",    РезультирующаяТаблицаПроцентов);
	Запрос.УстановитьПараметр("Организация",           Организация);
	Запрос.УстановитьПараметр("НачалоПериода",         НачалоПериода);
	Запрос.УстановитьПараметр("КонецПериода",          КонецПериода);
	
	Результат = Запрос.ВыполнитьПакет();
	
	НаборыДанных = Новый Структура;
	НаборыДанных.Вставить("НачисленнаяЗарплата", Результат[10].Выгрузить());
	НаборыДанных.Вставить("НачисленныйНДФЛ",     Результат[11].Выгрузить());
	НаборыДанных.Вставить("УдержаннаяЗарплата",  Результат[12].Выгрузить());
	НаборыДанных.Вставить("НачисленныеПроцентыПоЗаймам",  Результат[13].Выгрузить());
	
	Возврат НаборыДанных;
	
КонецФункции

Функция ТаблицыОтражения()
	
	НачисленнаяЗарплатаИВзносы = Новый ТаблицаЗначений;
	Реквизиты = Метаданные.Документы.ОтражениеЗарплатыВФинансовомУчете.ТабличныеЧасти.НачисленнаяЗарплатаИВзносы.Реквизиты;
	Для Каждого Реквизит Из Реквизиты Цикл
		НачисленнаяЗарплатаИВзносы.Колонки.Добавить(Реквизит.Имя, Реквизит.Тип);
	КонецЦикла;
	
	НачисленнаяЗарплатаИВзносыПоФизлицам = Новый ТаблицаЗначений;
	Реквизиты = Метаданные.Документы.ОтражениеЗарплатыВФинансовомУчете.ТабличныеЧасти.НачисленнаяЗарплатаИВзносыПоФизлицам.Реквизиты;
	Для Каждого Реквизит Из Реквизиты Цикл
		НачисленнаяЗарплатаИВзносыПоФизлицам.Колонки.Добавить(Реквизит.Имя, Реквизит.Тип);
	КонецЦикла;
	
	НачисленныйНДФЛ = Новый ТаблицаЗначений;
	Реквизиты = Метаданные.Документы.ОтражениеЗарплатыВФинансовомУчете.ТабличныеЧасти.НачисленныйНДФЛ.Реквизиты;
	Для Каждого Реквизит Из Реквизиты Цикл
		НачисленныйНДФЛ.Колонки.Добавить(Реквизит.Имя, Реквизит.Тип);
	КонецЦикла;
	
	УдержаннаяЗарплата = Новый ТаблицаЗначений;
	Реквизиты = Метаданные.Документы.ОтражениеЗарплатыВФинансовомУчете.ТабличныеЧасти.УдержаннаяЗарплата.Реквизиты;
	Для Каждого Реквизит Из Реквизиты Цикл
		УдержаннаяЗарплата.Колонки.Добавить(Реквизит.Имя, Реквизит.Тип);
	КонецЦикла;
	
	НачисленныеПроцентыПоЗаймам = Новый ТаблицаЗначений;
	Реквизиты = Метаданные.Документы.ОтражениеЗарплатыВФинансовомУчете.ТабличныеЧасти.НачисленныеПроцентыПоЗаймам.Реквизиты;
	Для Каждого Реквизит Из Реквизиты Цикл
		НачисленныеПроцентыПоЗаймам.Колонки.Добавить(Реквизит.Имя, Реквизит.Тип);
	КонецЦикла;
	
	Результат = Новый Структура("НачисленнаяЗарплатаИВзносы, НачисленнаяЗарплатаИВзносыПоФизлицам, НачисленныйНДФЛ, УдержаннаяЗарплата, НачисленныеПроцентыПоЗаймам",
		НачисленнаяЗарплатаИВзносы, НачисленнаяЗарплатаИВзносыПоФизлицам, НачисленныйНДФЛ, УдержаннаяЗарплата, НачисленныеПроцентыПоЗаймам);
	
	Возврат Результат;
	
КонецФункции

Процедура НастроитьСоставКолонок(НастройкиКомпоновкиДанных)
	
	НеиспользуемыеПоля = Новый Массив;
	
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ТФОМС"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ТФОМСКОтражению"));
	
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРСтраховая"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРСтраховаяКОтражению"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРНакопительная"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРНакопительнаяКОтражению"));
	
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРПоСуммарномуТарифу"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРПоСуммарномуТарифуКОтражению"));
	
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРНаДоплатуШахтерам"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРНаДоплатуШахтерамКОтражению"));
	
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРНаДоплатуЛетчикам"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРНаДоплатуЛетчикамКОтражению"));

		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРЗаЗанятыхНаПодземныхИВредныхРаботах"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРЗаЗанятыхНаПодземныхИВредныхРаботахКОтражению"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРЗаЗанятыхНаТяжелыхИПрочихРаботах"));
		НеиспользуемыеПоля.Добавить(Новый ПолеКомпоновкиДанных("ПФРЗаЗанятыхНаТяжелыхИПрочихРаботахКОтражению"));
	
	МассивПолей = Новый Массив;
	
	Для Каждого ЭлементСтруктуры Из НастройкиКомпоновкиДанных.Структура Цикл
		
		ДобавитьВыбранныеПоляВМассив(
			ЭлементСтруктуры.Выбор.Элементы,
			МассивПолей,
			Ложь);
		
	КонецЦикла;
	
	Для Каждого ВыбранноеПоле Из МассивПолей Цикл
		
		Если НеиспользуемыеПоля.Найти(ВыбранноеПоле.Поле) <> Неопределено Тогда
			ВыбранноеПоле.Использование = Ложь;
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ДобавитьВыбранныеПоляВМассив(ЭлементСтруктуры, МассивПолей, ТолькоГруппы = Ложь)
	
	Если ТипЗнч(ЭлементСтруктуры) = Тип("КомпоновщикНастроекКомпоновкиДанных") Тогда
		ВыбранныеПоля = ЭлементСтруктуры.Настройки.Выбор;
	Иначе
		ВыбранныеПоля = ЭлементСтруктуры;
	КонецЕсли;
	
	Для каждого Элемент Из ЭлементСтруктуры Цикл
		Если ТипЗнч(Элемент) = Тип("АвтоВыбранноеПолеКомпоновкиДанных") Тогда
			Продолжить;
		ИначеЕсли ТипЗнч(Элемент) = Тип("ГруппаВыбранныхПолейКомпоновкиДанных") Тогда
			Если ТолькоГруппы Тогда
				МассивПолей.Добавить(Элемент);
			КонецЕсли;
			ДобавитьВыбранныеПоляВМассив(Элемент.Элементы, МассивПолей, ТолькоГруппы);
		Иначе
			Если Не ТолькоГруппы Тогда
				МассивПолей.Добавить(Элемент);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти 

#КонецЕсли

